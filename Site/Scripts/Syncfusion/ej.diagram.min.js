/*!
*  filename: ej.diagram.min.js
*  version : 13.1.0.21
*  Copyright Syncfusion Inc. 2001 - 2015. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./../common/ej.unobtrusive.min","./../web/ej.menu.min"],n):n()})(function(){(function($,ej,undefined){"use strict";ej.widget("ejDiagram","ej.datavisualization.Diagram",{element:null,model:null,validTags:["div"],defaults:{width:null,height:null,nodes:[],connectors:[],defaultSettings:{connector:null,node:null},nodeTemplate:null,connectorTemplate:null,dataSourceSettings:{dataSource:null,query:null,tableName:null,id:"",parent:"",nodes:null,connectors:null,root:""},snapSettings:{horizontalGridLines:{linesInterval:[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],snapInterval:[20],lineDashArray:"0",lineColor:"lightgray"},verticalGridLines:{linesInterval:[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],snapInterval:[20],lineDashArray:"0",lineColor:"lightgray"},snapConstraints:15,enableSnapToObject:!0,snapAngle:5,snapObjectDistance:5},pageSettings:{pageWidth:null,pageHeight:null,multiplePage:!1,pageBorderWidth:0,pageBackgroundColor:"#ffffff",pageBorderColor:"#565656",pageMargin:24,showPageBreak:!1,pageOrientation:"portrait",scrollLimit:"infinity",scrollableArea:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},autoScrollBorder:{left:15,top:15,right:15,bottom:15}},locale:"en-US",contextMenu:{items:[],showCustomMenuItemsOnly:!1},enableContextMenu:!0,enableAutoScroll:!0,showTooltip:!0,tooltipTemplateId:"",layout:{type:"none",orientation:"toptobottom",horizontalSpacing:30,verticalSpacing:30,marginX:0,marginY:0,fixedNode:"",getLayoutInfo:null},drawingTools:{},backgroundImage:null,backgroundColor:"transparent",bridgeDirection:"top",version:"13.1",constraints:122,tool:6,drawType:null,selectedItems:{offsetX:0,offsetY:0,width:0,height:0,rotateAngle:0,children:[],constraints:14,userHandles:[]},zoomFactor:.2,nodeCollectionChange:null,autoScrollChange:null,itemClick:null,connectorCollectionChange:null,selectionChange:null,mouseLeave:null,mouseEnter:null,mouseOver:null,click:null,doubleClick:null,drop:null,drag:null,textChange:null,sizeChange:null,connectionChange:null,rotationChange:null,contextMenuClick:null,contextMenuBeforeOpen:null,connectorSourceChange:null,connectorTargetChange:null},observables:["nodes","connectors","locale","enableContextMenu","enableAutoScroll","showTooltip","bridgeDirection","tool","zoomFactor","pageSettings.pageHeight","pageSettings.pageWidth","pageSettings.multiplePage","pageSettings.pageBorderWidth","pageSettings.pageBackgroundColor","pageSettings.pageBorderColor","pageSettings.pageMargin","pageSettings.showPageBreak","pageSettings.pageOrientation","pageSettings.scrollLimit","snapSettings.enableSnapToObject","snapSettings.snapAngle","snapSettings.snapObjectDistance","selector.offsetX","selector.offsetY","selector.width","selector.height","selector.rotateAngle",],nodes:ej.util.valueFunction("nodes"),connectors:ej.util.valueFunction("connectors"),locale:ej.util.valueFunction("locale"),enableContextMenu:ej.util.valueFunction("enableContextMenu"),enableAutoScroll:ej.util.valueFunction("enableAutoScroll"),showTooltip:ej.util.valueFunction("showTooltip"),bridgeDirection:ej.util.valueFunction("bridgeDirection"),tool:ej.util.valueFunction("tool"),zoomFactor:ej.util.valueFunction("zoomFactor"),_pageHeight:ej.util.valueFunction("pageSettings.pageHeight"),_pageWidth:ej.util.valueFunction("pageSettings.pageWidth"),_multiplePage:ej.util.valueFunction("pageSettings.multiplePage"),_pageBorderWidth:ej.util.valueFunction("pageSettings.pageBorderWidth"),_pageBackgroundColor:ej.util.valueFunction("pageSettings.pageBackgroundColor"),_pageBorderColor:ej.util.valueFunction("pageSettings.pageBorderColor"),_pageMargin:ej.util.valueFunction("pageSettings.pageMargin"),_showPageBreak:ej.util.valueFunction("pageSettings.showPageBreak"),_pageOrientation:ej.util.valueFunction("pageSettings.pageOrientation"),_scrollLimit:ej.util.valueFunction("pageSettings.scrollLimit"),_enableSnapToObject:ej.util.valueFunction("snapSettings.enableSnapToObject"),_snapAngle:ej.util.valueFunction("snapSettings.snapAngle"),_snapObjectDistance:ej.util.valueFunction("snapSettings.snapObjectDistance"),_selectorOffsetX:ej.util.valueFunction("selector.offsetX"),_selectorOffsetY:ej.util.valueFunction("selector.offsetY"),_selectorWidth:ej.util.valueFunction("selector.width"),_selectorHeight:ej.util.valueFunction("selector.height"),_selectorRotateAngle:ej.util.valueFunction("selector.rotateAngle"),dataTypes:{nodes:"data",connectors:"data",contextMenu:{items:"array",showCustomMenuItemsOnly:"boolean"},layout:{type:"enum",orientation:"enum",horizontalSpacing:"number",verticalSpacing:"number",marginX:"number",marginY:"number"}},_canvas:null,_svg:null,_toolToActivate:null,_inAction:!1,_isPinching:!1,_isEditing:!1,_nodeToHit:null,_currentCursor:null,_pasteIndex:null,_page:null,_view:null,_currentLabel:null,_zOrder:0,_clipboardData:null,_currZoom:1,_selectedItem:"",_historyList:{currentEntry:{next:null,previous:null},canUndo:!1,canRedo:!1},_defaultContextMenuItems:[{name:"cut",text:"Cut"},{name:"copy",text:"Copy"},{name:"paste",text:"Paste"},{name:"undo",text:"Undo"},{name:"redo",text:"Redo"},{name:"selectAll",text:"Select All"},{name:"grouping",text:"Grouping",subItems:[{name:"group",text:"Group"},{name:"ungroup",text:"Ungroup"}]},{name:"order",text:"Order",subItems:[{name:"bringToFront",text:"Bring To Front"},{name:"moveForward",text:"Move Forward"},{name:"sendToBack",text:"Send To Back"},{name:"sendBackward",text:"Send Backward"}]}],_hScrollOffset:0,_vScrollOffset:0,_hScrollbar:null,_vScrollbar:null,_scrollPixel:30,activeTool:null,selectionList:[],tools:null,nameTable:{},_updateScrollOffset:function(n,t,i){this._hScrollOffset=n;this._vScrollOffset=t;ej.datavisualization.Diagram.ScrollUtil._transform(this,n,t,i);this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);var r=this;this._views.forEach(function(i){var f=r._views[i],u;f.type=="overview"&&(u=$("#"+i).ejOverview("instance"),u&&u._scrollOverviewRect(n,t,r._currZoom))})},_init:function(){var n=window.SVGSVGElement?!0:!1;n&&(this._cloneGlobalVariables(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(),this._initDefaults(),this._initViews(),this._initData(),this._doLayout(),this._initCanvas(),this._initDiagramTool(),this._initVisualGuide(),this._wireEvents(),this._initHandles(),this._initContextMenu(),this._drawingTool=!1,this._isDropped=!1)},_cloneGlobalVariables:function(){this._historyList=$.extend(!0,{},this._historyList)},_setModel:function(n){var t,u,r,i;for(t in n)switch(t){case"height":case"width":this._initViews(!0);this._initCanvas(!0);break;case"nodes":this.nodes([]);this.nodes(typeof t.nodes=="function"?t.nodes():n[t]);this._initNodeCollection(!0);$(this.element).find(".ej-d-node").remove();$(this.element).find(".ej-d-group").remove();this._hasSelection()&&this._clearSelection();i=this;this._views.forEach(function(n){var t=i._views[n];i._setNodeZOrder(t);i._renderNodes(t,!0)});break;case"connectors":this.connectors([]);this.connectors(typeof t.connectors=="function"?t.connectors():n[t]);this._initConnectorCollection();$(this.element).find(".ej-d-connector").remove();this._hasSelection()&&this._clearSelection();i=this;this._views.forEach(function(n){var t=i._views[n];i._renderConnectors(t)});break;case"phases":i.model.phases=[];this._initPhaseCollection(n.phases);this.element.remove(".ej-d-node");this.element.remove(".ej-d-group");i=this;this._views.forEach(function(n){var t=i._views[n];i._renderphases(t)});break;case"enableContextMenu":this.model.enableContextMenu=n[t];this._initContextMenu(this._isLoad);break;case"contextMenu":this.model.contextMenu=n[t];this._initContextMenu(this._isLoad);break;case"snapSettings":r=n[t];r&&Object.keys(r).length>0&&(this._updateSnapSettings(n[t]),ej.datavisualization.Diagram.SvgContext._renderGrid(this._canvas,this._svg,this._page,this));break;case"selectorConstraints":this._setSelectorConstraints(n[t]);break;case"constraints":this._hasSelection()&&this._clearSelection();break;case"drawingTools":this.model.drawingTools=n[t];this._registerDrawingTools();break;case"backgroundImage":this.model.backgroundImage=n[t];ej.datavisualization.Diagram.SvgContext._renderBackground(this._canvas,this._svg,this._page,this.model);break;case"enableAutoScroll":this.enableAutoScroll(n[t]);break;case"autoScrollMargin":this.model.autoScrollMargin=n[t];break;case"layout":this.model.layout=$.extend(!0,{},this.model.layout,n[t]);this._setLayout(n[t]);break;case"selectedItems":this.updateSelector(n[t]);break;case"pageSettings":this.updatePageSettings(n[t]);break;case"locale":this.locale(n[t]);u=document.getElementById(this.element[0].id+"_contextMenu");u.parentNode.removeChild(u);this.model.contextMenu&&this.model.contextMenu.items&&this.model.contextMenu.items.length>0&&(this.model.contextMenu.items=[]);this._renderContextMenu();break;case"nodeTemplate":this.clear();this._initData();i=this;this._views.forEach(function(n){var t=i._views[n];i._renderNodes(t);i._renderConnectors(t)});this.layout();break;case"bridgeDirection":case"tool":this.update(n);break;case"connectorTemplate":this._updateConnectors();break;case"dataSourceSettings":r=n[t];r&&Object.keys(r).length>0&&(this.clear(),$.extend(!0,this.model.dataSourceSettings,{},n[t]),this._initData(),i=this,this._views.forEach(function(n){var t=i._views[n];i._renderNodes(t);i._renderConnectors(t)}),this.layout())}},_initData:function(){var dataSource,nodes,connectors,dataSourceApplied,tempNodes,tempconnectors,i,collapsedNodes;if(this.model.dataSourceSettings&&(dataSource=this.model.dataSourceSettings.dataSource||this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors),dataSource){if(nodes=[],connectors=[],this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors){if(this.model.dataSourceSettings.nodes){if(dataSource=this.model.dataSourceSettings.nodes.dataSource||this.model.dataSourceSettings.dataSource,dataSource)if(dataSource instanceof ej.DataManager){$.ajaxSetup({async:!1});var query=this._findQuery(this.model.dataSourceSettings.nodes,this.model.dataSourceSettings.nodeBinding),queryPromise=dataSource.executeQuery(eval(query)),diagram=this;queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyTemplate(diagram.model.dataSourceSettings,n.result,nodes,"nodes")})}else this._applyTemplate(this.model.dataSourceSettings,dataSource,nodes,"nodes");this.model.dataSourceSettings.connectors&&(dataSource=this.model.dataSourceSettings.connectors.dataSource||this.model.dataSourceSettings.dataSource,dataSource&&(dataSource instanceof ej.DataManager?($.ajaxSetup({async:!1}),query=this._findQuery(this.model.dataSourceSettings.connectors,this.model.dataSourceSettings.connectorBinding),queryPromise=dataSource.executeQuery(eval(query)),queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyTemplate(diagram.model.dataSourceSettings,n.result,connectors,"connectors")})):this._applyTemplate(this.model.dataSourceSettings,dataSource,connectors,"connectors")))}}else dataSource instanceof ej.DataManager?(this._initDataSource(dataSource,nodes,connectors),this.model.dataSourceSettings.parent&&(dataSourceApplied=!0)):dataSource.length&&(this._applyDataSource(this.model.dataSourceSettings,dataSource,nodes,connectors),this.model.dataSourceSettings.parent&&(dataSourceApplied=!0));for(tempNodes=[],tempconnectors=[],this.nodes().length>0&&(tempNodes=this.nodes()),this.connectors().length>0&&(tempconnectors=this.connectors()),this.nodes(nodes),this.connectors(connectors),i=0;i<tempNodes.length;i++)this.nodes().push(tempNodes[i]);for(i=0;i<tempconnectors.length;i++)this.connectors().push(tempconnectors[i])}collapsedNodes=this._initNodeCollection(!1,dataSourceApplied);this._initConnectorCollection(dataSourceApplied);collapsedNodes.length>0&&this._collapseNodes(collapsedNodes);this._initPhaseCollection()},_initPhaseCollection:function(n){var r=n?n:this.model.phases,i,t,u;if(r)for(i=0;i<r.length;i++)t=r[i],t&&(u=this.nameTable[t.name],u&&delete this.nameTable[u.name],this.nameTable[t.name]=t,n&&this.model.phases.push(t))},_initDataSource:function(dataSource,nodes,connectors){var diagram=this,mapper,query,queryPromise;dataSource.dataSource.json&&dataSource.dataSource.json.length>0?diagram._applyDataSource(diagram.model.dataSourceSettings,dataSource.dataSource.json,nodes,connectors):dataSource.dataSource.table||(mapper=this.model.dataSourceSettings,dataSource instanceof ej.DataManager&&($.ajaxSetup({async:!1}),query=this._findQuery(mapper,this.model.dataSourceSettings.nodeBinding),queryPromise=this.model.dataSourceSettings.dataSource.executeQuery(eval(query)),queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyDataSource(diagram.model.dataSourceSettings,n.result,nodes,connectors)})))},_findQuery:function(n,t){var u=[],e=ej.Query(),h=n.query||this.model.dataSourceSettings.query,c,o,r,i,s,f;if(ej.isNullOrUndefined(h)){c=n.dataSource||this.model.dataSourceSettings.dataSource;o=n.tableName||this.model.dataSourceSettings.tableName;for(r in n)r==="tableName"||r==="dataSource"||r==="designTemplate"||r.match("Binding")||n[r]&&u.push(n[r]);for(i in t)if(i==="labels")for(s=t[i],f=0;f<s.length;f++)s[f].text&&u.push(s[f].text);else i=="shape"||i=="line"?t[i][type]&&r.push(t[i][type]):t[i]&&u.push(t[i]);u.length>0&&e.select(u);c.dataSource.url.match(o+"$")||ej.isNullOrUndefined(o)||e.from(o)}else e=h;return e},_applyDataSource:function(n,t,i,r){for(var u=[],a,s,c,p,l,e,f,o,v,y,w,h=0;h<t.length;h++)f=t[h],u[f[n.parent]]?u[f[n.parent]].items.push(f):u[f[n.parent]]={items:[f]},n.root===f[n.id]&&(a={items:[f]});if(o=[],n.parent)if(a)o.push(a);else for(e in u)(e||e===0)&&e!="undefined"&&e!='""'&&e!="null"||o.push(u[e]);else o.push(u[undefined]);for(this.model.nodeTemplate&&(typeof this.model.nodeTemplate=="string"&&(this.model.nodeTemplate=ej.util.getObject(this.model.nodeTemplate,window)),$.isFunction(this.model.nodeTemplate)&&(y=this.model.nodeTemplate)),this.model.connectorTemplate&&(typeof this.model.connectorTemplate=="string"&&(this.model.connectorTemplate=ej.util.getObject(this.model.connectorTemplate,window)),$.isFunction(this.model.connectorTemplate)&&(w=this.model.connectorTemplate)),s=0;s<o.length;s++)for(c=0;c<o[s].items.length;c++)p=o[s].items[c],l=this._applyNodeTemplate(n,p,y),i.push(l),n.parent&&(v=u[l[n.id]],v.items&&this._renderChildNodes(n,v,l.name,i,r,u,y,w))},_renderChildNodes:function(n,t,i,r,u,f,e,o){for(var c,h,l,s=0;s<t.items.length;s++)c=t.items[s],h=this._applyNodeTemplate(n,c,e),r.push(h),u.push(this._applyConnectorTemplate(n,null,i,h.name,o)),l=f[c[n.id]],l&&this._renderChildNodes(n,l,h.name,r,u,f,e,o)},_applyTemplate:function(n,t,i,r){var f,u,e,o,s;if(this.model.nodeTemplate&&(typeof this.model.nodeTemplate=="string"&&(this.model.nodeTemplate=ej.util.getObject(this.model.nodeTemplate,window)),$.isFunction(this.model.nodeTemplate)&&(f=this.model.nodeTemplate)),this.model.connectorTemplate&&(typeof this.model.connectorTemplate=="string"&&(this.model.connectorTemplate=ej.util.getObject(this.model.connectorTemplate,window)),$.isFunction(this.model.connectorTemplate)&&(s=this.model.connectorTemplate)),r=="nodes")for(u=0;u<t.length;u++)e=this._applyNodeTemplate(n,t[u],f),i.push(e);if(r=="connectors")for(u=0;u<t.length;u++)o=this._applyConnectorTemplate(n,t[u],null,null,s),i.push(o)},_applyNodeTemplate:function(n,t,i){var r=t;return r.name!==""&&r.name||(r.name=ej.datavisualization.Diagram.Util.randomId()),r&&(r=this._getNewNode(r)),i&&i(this,r),r._type==="group"&&(r=this._getNewGroup(r),this._initGroupNode(r)),r},_applyConnectorTemplate:function(n,t,i,r,u){var f={};return f.name=ej.datavisualization.Diagram.Util.randomId(),f.sourceNode=i,f.targetNode=r,f&&(f=this._getNewConnector(f)),u&&u(this,f),f},_collapseNodes:function(n){for(var i,t=0;t<n.length;t++)i=n[t],this._collapseChildren(i)},_initViews:function(n){n||(this._views=[],this._views.push(this._id));this._views[this._id]={type:"mainview",context:ej.datavisualization.Diagram.SvgContext,style:"position:relative; height:"+this.model.height+"; width:"+this.model.width+";"}},_setOverview:function(n,t){var n,i;n?(this._overview=n,this._views[n._id]||(this._views.push(n._id),this._views[n._id]={context:ej.datavisualization.Diagram.SvgContext,type:"overview"},n._renderDocument(this._views[n._id]),this._setNodeZOrder(this._views[n._id]),this._renderNodes(this._views[n._id],null,!0),this._renderConnectors(this._views[n._id]),n._updateOverview(this._views[n._id]))):(n=$("#"+t).ejOverview("instance"),n._removeDocument(this._views[t]),this._views[t]=undefined,i=this._views.indexOf(t),this._views.splice(i,1))},_getChild:function(n){if(n)return typeof n=="object"?n.name:n},_getChildren:function(n){var i,r,t;if(n){for(i=[],r=0;r<n.length;r++)t=n[r],t&&(typeof t=="object"?i.push(t.name):i.push(t));return i}},_initGroupNode:function(n){for(var t=null,i=0;i<n.children.length;i++)t=n.children[i],t&&typeof t=="object"&&(t._type=="group"||t.children||t.segments||t.type=="connector"?t.segments||t.type=="connector"?(t=this._getNewConnector(t),t.name==""&&(t.name=ej.datavisualization.Diagram.Util.randomId())):(t=this._getNewGroup(t),t.name==""&&(t.name=ej.datavisualization.Diagram.Util.randomId()),this._initGroupNode(t)):(n.type!="bpmn"&&(t=this._getNewNode(t)),t.name==""&&(t.name=ej.datavisualization.Diagram.Util.randomId()),t._type=="node"&&t.labels.length&&(t.width==0||t.height==0)&&this._getNodeDimension(t)),n.children[i]=t.name,t.parent=n.name,this.nameTable[t.name]=t,this.nodes()[this.nodes().length]=this.nameTable[t.name])},_initNodeCollection:function(n,t){var f=[],r=this.nodes(),e=this.nodes().length,u,i;for(this.model.nodeTemplate&&!this.model.dataSourceSettings.dataSource&&(typeof this.model.nodeTemplate=="string"&&(this.model.nodeTemplate=ej.util.getObject(this.model.nodeTemplate,window)),$.isFunction(this.model.nodeTemplate)&&(u=this.model.nodeTemplate)),i=0;i<e;i++)typeof r[i].shape!="object"&&(r[i].type=="bpmn"&&this._isLoad&&(r[i].children=undefined),r[i]=ej.datavisualization.Diagram.NodeType(r[i],this)),r[i].name==""&&r[i].name==ej.datavisualization.Diagram.Util.randomId(),r[i].type==="swimlane"||r[i].isSwimlane?(r[i]=ej.datavisualization.Diagram.SwimLaneHelper._initSwimLane(r[i],this),this.nameTable[r[i].name]=ej.datavisualization.Diagram.Group(r[i])):r[i]._type==="group"||r[i].children&&r[i].children.length>0?(r[i]=this._getNewGroup(r[i]),r[i]._type="group",this.nameTable[r[i].name]=r[i],this._initGroupNode(r[i]),r[i].type=="bpmn"&&ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,r[i])):t?r[i].shape&&typeof r[i].shape=="object"&&ej.datavisualization.Diagram.Util._updateShapeProperties(r[i]):(r[i]=this._getNewNode(r[i]),this.nameTable[r[i].name]=r[i],ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,r[i])),!t&&u&&u(this,r[i]),r[i]._type==="node"&&r[i].labels.length&&(r[i].width==0||r[i].height==0)&&this._getNodeDimension(r[i]),this.nameTable[r[i].name]=r[i],r[i].isExpanded||f.push(r[i]);return f},_getNodeDimension:function(n){var u=n._width,f=n._height,e=n.width?n.width:n.maxWidth?n.maxWidth:n.minWidth,i=document.createElement("span"),o=0,s=0,t,r;if(n.labels.length){for(ej.datavisualization.Diagram.Util.attr(i,{id:n.name+"_label","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(i),r=0;r<n.labels.length;r++)t=n.labels[r],t.bold&&(i.style.fontWeight="bold"),t.italic&&(i.style.fontStyle="italic"),i.style.textDecoration=t.textDecoration,i.style.fontFamily=t.fontFamily,i.style.fontSize=t.fontSize+"px",i.style.color=t.fontColor,i.style.backgroundColor=t.fillColor,i.style.borderColor=t.borderColor,i.style.borderWidth=t.borderWidth,i.textContent=t.text,i.style.wordWrap="break-word",i.style.whiteSpace="pre",n.maxWidth&&(i.style.maxWidth=e-(t.margin.left+t.margin.right)-t.fontSize+"px"),n.minWidth&&(i.style.minWidth=e-(t.margin.left+t.margin.right)-t.fontSize+"px"),o+=i.offsetWidth+t.margin.left+t.margin.right,s+=i.offsetHeight+t.margin.top+t.margin.bottom;n._width=Math.max(n.minWidth||0,o||0);n.maxWidth&&(n._width=Math.min(n.maxWidth,n._width));n._height=Math.max(n.minHeight||0,s||0);n.maxHeight&&(n._height=Math.min(n.maxHeight,n._height));n.width||n.labels[0].horizontalAlignment!="left"||(n.offsetX+=(n._width-u)/2);n.width||n.labels[0].horizontalAlignment!="right"||(n.offsetX-=(n._width-u)/2);n.height||n.labels[0].verticalAlignment!="top"||(n.offsetY+=(n._height-f)/2);n.height||n.labels[0].verticalAlignment!="bottom"||(n.offsetY-=(n._height-f)/2);this.element[0].removeChild(i)}},_getNewNode:function(n){return n.shape&&typeof n.shape=="object"&&ej.datavisualization.Diagram.Util._updateShapeProperties(n),ej.datavisualization.Diagram.Node($.extend(!0,{},this.model.defaultSettings.node,n))},_getNewGroup:function(n){var t=null,i;if(n.children&&n.children.length>0)for(i in n.children)t=this.nameTable[this._getChild(n.children[i])],t&&(t.segments?(this.nameTable[t.name]&&delete this.nameTable[t.name],this.nameTable[t.name]=this._getNewConnector(t),this._dock(this.nameTable[t.name],this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(this.nameTable[t.name],this),this._updateQuad(this,this.nameTable[t.name])):t._type==="node"?(this.nameTable[t.name]&&delete this.nameTable[t.name],this.nameTable[t.name]=this._getNewNode(t)):t._type==="group"&&(this.nameTable[t.name]&&delete this.nameTable[t.name],this.nameTable[t.name]=this._getNewGroup(t)));return ej.datavisualization.Diagram.Group($.extend(!0,{},this.model.defaultSettings.node,n))},_getNewConnector:function(n){var t=$.extend(!0,{},this.model.defaultSettings.connector,n);return this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments[0]&&(t.defaultType=this.model.defaultSettings.connector.segments[0].type),ej.datavisualization.Diagram.Util._initConnectionEnds(t,this),ej.datavisualization.Diagram.Connector(t)},_getTightChildrenBounds:function(n){for(var r,e=this._getChildren(n.children),t,u=null,i,f=0,o=e.length;f<o;f++)i=this.nameTable[e[f]],i&&(r=ej.datavisualization.Diagram.Util.bounds(i),t=ej.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),i.verticalAlign=="stretch"?t.height=0:i.horizontalAlign=="stretch"&&(t.width=0)),u=u?this._union(t,u):t;return u},_getBoundsWithoutStretch:function(n,t,i){for(var s=this._getChildren(n.children),f,e,u=null,r,o=0,h=s.length;o<h;o++)r=this.nameTable[s[o]],e=ej.datavisualization.Diagram.Util.bounds(r),f=ej.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]),t?r.verticalAlign!="stretch"||r.verticalAlign=="stretch"&&r.horizontalAlign=="stretch"||(f.height=0):i&&(r.horizontalAlign!="stretch"||r.verticalAlign=="stretch"&&r.horizontalAlign=="stretch"||(f.width=0)),u=u?this._union(f,u):f;return u.width+=n.paddingLeft+n.paddingRight,u.height+=n.paddingTop+n.paddingBottom,u},_getPhaseStack:function(n){var t;return n&&n.isSwimlane&&n.children&&n.children.length>0&&(t=this.nameTable[this._getChild(n.children[1])]),t},_getMinMaxSize:function(n,t,i,r){var o=null,s=null,c,u,f,h,l,e;return t>=n.minWidth&&t<=n.maxWidth?o=t:n.horizontalAlign=="stretch"&&n.parent&&!r?(u=this.nameTable[n.parent],u&&(f=ej.datavisualization.Diagram.Util.bounds(u),f.width==0&&f.height==0&&(f.width=t,f.height=i),e=this._getMinMaxSize(u,f.width,f.height),u.isSwimlane&&u.orientation=="vertical"&&(c=this.nameTable[u.children[0]],c&&(e.height-=c.height)),e.width-=u.paddingLeft+u.paddingRight+u.marginLeft+u.marginRight,e.height-=u.paddingTop+u.paddingBottom+u.marginTop+u.marginBottom,o=e.width?e.width:t)):o=t<n.minWidth&&n.minWidth!=0?n.minWidth:t>n.maxWidth&&n.maxWidth!=0?n.maxWidth:t,i>=n.minHeight&&i<=n.maxHeight?s=i:(u=this.nameTable[n.parent],n.verticalAlign!="stretch"||!n.parent||r||n.isLane?s=i<n.minHeight&&n.minHeight!=0?n.minHeight:i>n.maxHeight&&n.maxHeight!=0?n.maxHeight:i:(f=ej.datavisualization.Diagram.Util.bounds(u),f.width==0&&f.height==0&&(h=null,l=!1,f.width=n.minWidth,f.height=n.minHeight,(n.minWidth==0||n.minHeight==0)&&(f.width=t,f.height=i,h=!1,l=!0),l||(h=!0)),e=this._getMinMaxSize(u,f.width,f.height),e.width-=u.paddingLeft+u.paddingRight+u.marginLeft+u.marginRight,e.height-=u.paddingTop+u.paddingBottom+u.marginTop+u.marginBottom,h&&(e.height-=n.marginTop),s=e.height?e.height:i)),{width:o,height:s}},_initConnectorCollection:function(n){var r=this.connectors(),t,u,i,f;for(this.model.connectorTemplate&&(typeof this.model.connectorTemplate=="string"&&(this.model.connectorTemplate=ej.util.getObject(this.model.connectorTemplate,window)),$.isFunction(this.model.connectorTemplate)&&(u=this.model.connectorTemplate)),i=0,f=r.length;i<f;i++)t=n?r[i]:this._getNewConnector(r[i]),this.nameTable[t.name]=t,n||this._dock(t,this.nameTable),this._updateEdges(t),u&&!n&&u(this,t),r[i]=t},_initDefaults:function(){this._initTools()},_initCanvas:function(n){this._renderCanvas(n);this.model.selectorConstraints&&this.model.selectedItems&&(this.model.selectedItems.constraints=this.model.selectorConstraints)},_updateConnectorBridging:function(n){for(var i,r,t,e=ej.datavisualization.Diagram.Util.bounds(n),f=ej.datavisualization.Diagram.SpatialUtil.findQuads(this._spatialSearch,e),u=0;u<f.length;u++)if(i=f[u],i.objects.length>0)for(r=0;r<i.objects.length;r++)t=i.objects[r],t.visible&&t.segments&&t!=n&&(ej.datavisualization.Diagram.Util.updateBridging(t,this),ej.datavisualization.Diagram.DiagramContext.update(t,this))},_initVisualGuide:function(){if(this.showTooltip()&&!this.model.tooltipTemplateId){var n=document.createElement("script"),t={id:this.element[0].id+"_defaultTooltip",type:"text/x-jsrender"};ej.datavisualization.Diagram.Util.attr(n,t);n.innerHTML='<span class="e-diagram-tooltipLabel-default"> {{:type}}{{:x}}{{:type1}}{{:y}}<\/span>';this._canvas.appendChild(n)}else this.element.remove("#"+this.element[0].id+"_defaultTooltip")},_initTools:function(){this.tools={select:new ej.datavisualization.Diagram.SelectTool(this),move:new ej.datavisualization.Diagram.MoveTool(this),resize:new ej.datavisualization.Diagram.ResizeTool(this),rotate:new ej.datavisualization.Diagram.RotateTool(this),endPoint:new ej.datavisualization.Diagram.ConnectionEditTool(this),panTool:new ej.datavisualization.Diagram.PanTool(this),straightLine:new ej.datavisualization.Diagram.StraightLineTool(this),orthogonalLine:new ej.datavisualization.Diagram.OrthogonalLineTool(this),phase:new ej.datavisualization.Diagram.PhaseTool(this),shapeTool:new ej.datavisualization.Diagram.ShapeTool(this)};this._toolToActivate="select";this.activeTool=this.tools[this._toolToActivate];this._registerDrawingTools()},_initDiagramTool:function(){var n=this.tool(),t;n&ej.datavisualization.Diagram.Tool.ContinuesDraw?this.model.drawType&&(t=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(t,!1)):n&ej.datavisualization.Diagram.Tool.DrawOnce?this.model.drawType&&(t=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(t,!0)):n&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):n&ej.datavisualization.Diagram.Tool.MultipleSelect&&this.activateTool("select")},_drawToolShape:function(n,t){n=="rectangle"||n=="ellipse"||n=="image"||n=="path"||n=="polygon"||n=="native"||n=="html"||n==="text"?this.activateTool("shapeTool",t):n=="straightLine"?this.activateTool("straightLine",t):n=="orthogonalLine"&&this.activateTool("orthogonalLine",t)},_initHandles:function(){var t=this.model.selectedItems.userHandles,n;if(t)for(n=0;n<t.length;n++)t[n]=ej.datavisualization.Diagram.UserHandle(t[n]),t[n].tool&&(t[n].tool.diagram=this,this.tools[t[n].name]=t[n].tool)},_destroy:function(){this.element.empty().removeClass("e-datavisualization-diagram")},updatePageSettings:function(n){n&&(n.pageHeight&&this._pageHeight(Number(typeof n.pageHeight=="function"?n.pageHeight():n.pageHeight)),n.pageWidth&&this._pageWidth(Number(typeof n.pageWidth=="function"?n.pageWidth():n.pageWidth)),n.pageBorderWidth&&this._pageBorderWidth(Number(typeof n.pageBorderWidth=="function"?n.pageBorderWidth():n.pageBorderWidth)),n.pageMargin&&this._pageMargin(Number(typeof n.pageMargin=="function"?n.pageMargin():n.pageMargin)),n.pageBackgroundColor&&this._pageBackgroundColor(typeof n.pageBackgroundColor=="function"?n.pageBackgroundColor():n.pageBackgroundColor),n.scrollLimit&&this._scrollLimit(typeof n.scrollLimit=="function"?n.scrollLimit():n.scrollLimit),n.scrollableArea&&(this.model.pageSettings.scrollableArea=n.scrollableArea),n.pageBorderColor&&this._pageBorderColor(typeof n.pageBorderColor=="function"?n.pageBorderColor():n.pageBorderColor),ej.datavisualization.Diagram.PageUtil._updatePageSize(this),ej.datavisualization.Diagram.SvgContext._updateBackground(this._hScrollOffset,this._vScrollOffset,this._currZoom,this),ej.datavisualization.Diagram.SvgContext._updateGrid(this._hScrollOffset,this._vScrollOffset,this._currZoom,this))},_updateSnapSettings:function(n){n&&(n.snapAngle&&this._snapAngle(Number(typeof n.snapAngle=="function"?n.snapAngle():n.snapAngle)),n.snapObjectDistance&&this._snapObjectDistance(Number(typeof n.snapObjectDistance=="function"?n.snapObjectDistance():n.snapObjectDistance)))},getNode:function(n,t){if(n)return this._getNode(n,t)},addPhase:function(n,t){this._addPhase(n,t)},_updateSwimlanePhase:function(n,t,i){var r,u,f,e;n&&t&&(t.label&&(r=this.nameTable["phaseStack"+n.name],r&&(t.label=$.extend(!0,{},t.label),t.label.name=r.labels[0].name,t.label.mode=ej.datavisualization.Diagram.LabelEditMode.View,n.label=t.label,this.updateLabel(r.name,r.labels[0],t.label))),(t.lineColor||t.lineDashArray||t.lineWidth)&&(u={},t.lineColor&&(n.lineColor=t.lineColor,u.stroke=t.lineColor),t.lineDashArray&&(n.lineDashArray=t.lineDashArray,u["stroke-dasharray"]=t.lineDashArray),t.lineWidth&&(n.lineWidth=t.lineWidth,u["stroke-width"]=t.lineWidth),ej.datavisualization.Diagram.SvgContext._updatePhaseStyle(n,u,this)),t.offset!=n.offset&&(f=.0001,e=.0001,this.tools.phase.selectedSeperetor=n,n.orientation==="horizontal"?f=t.offset-n.offset:n.orientation==="vertical"&&(e=t.offset-n.offset),this.tools.phase._updateSwimlane(n,f,e,!1,n.orientation==="horizontal"?!0:!1),i||(this._clearSelection(),this.addSelection(n)),this.tools.phase.selectedSeperetor=null))},updateNode:function(n,t){var r,u,f,e,i,o;n&&(i=this._findNode(n),r=i&&(i.isSwimlane||i.isLane||i.isPhase||i.type==="phase"),(r||!r)&&(this._needUpdate=!1,i&&(t.offsetX|t.offsetX===0&&(u=t.offsetX-i.offsetX,this._translate(i,u,0,this.nameTable),i.marginLeft!=0&&(i.marginLeft+=u)),t.offsetY|t.offsetY===0&&(f=t.offsetY-i.offsetY,this._translate(i,0,f,this.nameTable),i.marginTop!=0&&(i.marginTop+=f)),t.rotateAngle|t.rotateAngle===0&&this._rotate(i,t.rotateAngle-i.rotateAngle,this.nameTable),t.width&&(i.width=i.width?i.width:1,this.scale(i,t.width/i.width,1,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable)),t.height&&(i.height=i.height?i.height:1,this.scale(i,1,t.height/i.height,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable)),t.connectorPadding!=undefined&&(i.connectorPadding=t.connectorPadding,this.scale(i,1,1,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable)),t.visible!=undefined&&(i.visible=t.visible,t.visible||this._clearSelection()),t.constraints&&(i._type!="group"&&i.constraints&ej.datavisualization.Diagram.NodeConstraints.Shadow!=t.constraints&ej.datavisualization.Diagram.NodeConstraints.Shadow&&(i.constraints&ej.datavisualization.Diagram.NodeConstraints.Shadow?(i.constraints=t.constraints,ej.datavisualization.Diagram.DiagramContext.removeShadow(i,this)):(i.constraints=t.constraints,ej.datavisualization.Diagram.DiagramContext.renderShadow(i,this))),i.constraints=t.constraints,this.selectionList[0]&&this.selectionList[0].name===i.name&&(ej.datavisualization.Diagram.SvgContext.clearSelector(this._svg,this._adornerLayer),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._svg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._svg,this.selectionList[0].type==="pseudoGroup",this._currZoom,this._adornerLayer))),t.fillColor&&(i.fillColor=t.fillColor),t.opacity&&(i.opacity=t.opacity),t.borderColor&&(i.borderColor=t.borderColor),t.borderWidth&&(i.borderWidth=t.borderWidth),t.borderDashArray&&(i.borderDashArray=t.borderDashArray),t.gradient!==undefined&&(i.gradient=t.gradient),i=this._findNode(n),t.shape&&typeof t.shape=="object"?(ej.datavisualization.Diagram.Util._updateShapeProperties(t),ej.browserInfo().name==="msie"&&i.type=="html"&&(e=document.getElementById(i.name+"_parentdiv"),e.parentNode.removeChild(e)),ej.datavisualization.Diagram.DiagramContext.setNodeShape(i,this)):this._updateShape(i,t),i&&i.type!="phase"&&(ej.datavisualization.Diagram.DiagramContext.update(i,this),i.type=="bpmn"?ej.datavisualization.Diagram.DiagramContext.updateBPMNNodeStyle(i,this):ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(i,this)),this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._svg,this._currZoom,this,this.model.selectedItems.constraints),t.isExpanded!==undefined&&(t.isExpanded?(i.isExpanded=!0,this._expandChildren(i)):(i.isExpanded=!1,this._collapseChildren(i)),this.layout()))),n&&(i=this._findNode(n),i&&i._type==="node"&&t&&t.type==="group"&&t.children&&t.children.length>0&&(o=!1,this._svg.document.getElementById(i.name)&&(o=!0),this.remove(i),i.borderColor="transparent",i.borderDashArray="",i.borderWidth=1,i.fillColor="#1BA0E2",i.labels=[],i.fillColor="",i.type=t.type,i.children=t.children,i=ej.datavisualization.Diagram.Group(i),this._initGroupNode(i),o&&(ej.datavisualization.Diagram.Util._updateGroupBounds(i,this),this.add(i),this._clearSelection(),this._addSelection(i)))),i&&(i.isLane||i.isSwimlane||i.type==="phase"||i.isPhase)&&(this._needUpdate=!0,i.isLane?this._updateLane(i,t):i.isSwimlane?(this._needUpdate=!1,this._updateSwimlane(i,t)):(i.type==="phase"||i.phase)&&(this._needUpdate=!1,this._updateSwimlanePhase(i,t))))},_updateShape:function(n,t){var i=!1,r;t.type&&(n.type=t.type,n._shape=t.shape?t.shape:t.type,i=!0);t.shape&&(n.shape=t.shape,i=!0);t.cornerRadius&&(n.cornerRadius=t.cornerRadius,i=!0);t.pathData&&(n.pathData=t.pathData,i=!0);t.templateId&&(n.templateId=t.templateId,i=!0);t.html&&(n.html=t.html,i=!0);t.contentId&&(n.contentId=t.contentId,i=!0);t.source&&(n.source=t.source,i=!0);t.textBlock&&(n.textBlock=t.textBlock,i=!0);t.points&&(n.points=t.points,i=!0);t.event&&(n.event=t.event,i=!0);t.trigger&&(n.trigger=t.trigger,i=!0);t.gateway&&(n.gateway=t.gateway,i=!0);t.collection!=undefined&&(n.collection=t.collection,i=!0);t.activity&&(n.activity=t.activity,i=!0);t.task&&(n.task=$.extend(!0,{},n.task,t.task),i=!0);t.subProcess&&(n.subProcess=$.extend(!0,{},n.subProcess,t.subProcess),i=!0);t.direction&&(n.direction=t.direction,i=!0);i&&(ej.browserInfo().name==="msie"&&n.type=="html"&&(r=document.getElementById(n.name+"_parentdiv"),r.parentNode.removeChild(r)),n.type!=="bpmn"?ej.datavisualization.Diagram.DiagramContext.setNodeShape(n,this):ej.datavisualization.Diagram.DiagramContext.updateBPMNNodeShape(n,this))},_udatePhaseSize:function(n,t){var i=this.nameTable[this._getChild(n.children[1])],s,e,h,o,u,r,f;if(n.orientation==="vertical"){if(i.minWidth!=t.phaseSize){if(i.width=i.maxWidth,i.minWidth=t.phaseSize,s=i.maxWidth-t.phaseSize,e=t.phaseSize/i.maxWidth,i.maxWidth=t.phaseSize,this.scale(i,e,.0001,ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable),i.children&&i.children.length>0)for(u=0;u<i.children.length;u++)r=this.nameTable[this._getChild(i.children[u])],r&&this.scale(r,e,.0001,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);f=this.nameTable[this._getChild(n.children[2])];f.marginLeft-=s}}else if(n.orientation==="horizontal"&&i.minHeight!=t.phaseSize){if(i.height=i.maxHeight,i.minHeight=t.phaseSize,h=i.maxHeight-t.phaseSize,o=t.phaseSize/i.maxHeight,i.maxHeight=t.phaseSize,this.scale(i,.0001,o,ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable),i.children&&i.children.length>0)for(u=0;u<i.children.length;u++)r=this.nameTable[this._getChild(i.children[u])],r&&this.scale(r,.0001,o,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);f=this.nameTable[this._getChild(n.children[2])];f.marginTop-=h}},_updateLane:function(n,t){var u,i,r;n&&t&&(t.header&&n.children&&n.children.length>0&&(u=this._getChild(n.children[0]),u&&(i=this.nameTable[u]),i&&(t.header.text&&(r=ej.datavisualization.Diagram.Label(t.header),r.fillColor="transparent",r.mode=ej.datavisualization.Diagram.LabelEditMode.View,r.rotateAngle=t.header.rotateAngle?t.header.rotateAngle:i.labels[0].rotateAngle,this.updateLabel(i.name,i.labels[0],r)),t.header.fillColor&&t.header.fillColor!=i.fillColor&&this.updateNode(i.name,{fillColor:t.header.fillColor}))),t.fillColor&&t.fillColor!=n.fillColor&&this.updateNode(n.name,{fillColor:t.fillColor}),t.minHeight&&t.minHeight!=n.minHeight&&(n.minHeight=t.minHeight),t.minWidth&&t.minWidth!=n.minWidth&&(n.minWidth=t.minWidth),t.constraints&&t.constraints!=n.constraints&&(n.constraints=t.constraints))},_updateLastPhase:function(n,t){var i,r,u;n.isSwimlane&&n.phases&&n.phases.length==1&&(i=0,r=this.nameTable[n.phases[0]],n.orientation==="horizontal"?(r.offset=n.minWidth-i,this.updateNode(this.nameTable["phaseStack"+n.phases[0]].name,{width:n.minWidth-i})):n.orientation==="vertical"&&(r.offset=n.minHeight-i,u=r.offset-i,u=u-(t.header?t.header.height:50),this.updateNode(this.nameTable["phaseStack"+n.phases[0]].name,{height:u})))},_updateSwimlane:function(n,t){var e,r,u,h,c,o,s,i,f;if(t.header&&n.children&&n.children.length>0&&(e=this._getChild(n.children[0]),e&&(r=this.nameTable[e]),r&&(t.header.text!=r.labels[0].text&&(u=ej.datavisualization.Diagram.Label(t.header),u.fillColor="transparent",u.mode=ej.datavisualization.Diagram.LabelEditMode.View,u.rotateAngle=t.header.rotateAngle?t.header.rotateAngle:r.labels[0].rotateAngle,this.updateLabel(r.name,r.labels[0],u)),t.header.fillColor&&t.header.fillColor!=r.fillColor&&this.updateNode(r.name,{fillColor:t.header.fillColor}))),t.offsetX&&t.offsetX!=n.offsetX&&(h=t.offsetX-n.offsetX,this._translate(n,h,0,this.nameTable)),t.offsetY&&t.offsetY!=n.offsetY&&(c=t.offsetY-n.offsetY,this._translate(n,0,c,this.nameTable)),t.phases&&t.phases.length>0)for(i=0;i<t.phases.length;i++)o=this.nameTable[this._getChild(t.phases[i])],o&&this._updateSwimlanePhase(o,t.phases[i],!0);if(t.lanes&&t.lanes.length>0)for(i=0;i<t.lanes.length;i++)s=this.nameTable[this._getChild(t.lanes[i])],s&&this._updateLane(s,t.lanes[i]);t&&t.phaseSize&&(f=!1);t.minHeight&&t.minHeight!=n.minHeight&&(n.minHeight=t.minHeight,f=!0);t.minWidth&&t.minWidth!=n.minWidth&&(n.minWidth=t.minWidth,f=!0);f&&this._updateLastPhase(n,t);(t.phaseSize||t.phaseSize===0)&&this._udatePhaseSize(n,t);ej.datavisualization.Diagram.DiagramContext.update(n,this);ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._svg,this._currZoom,this,this.model.selectedItems.constraints)},updateConnector:function(n,t){var i,u,r;n&&(i=this._findConnector(n),i&&(t.constraints&&(i.constraints=t.constraints),t.lineColor&&(i.lineColor=t.lineColor),t.lineWidth&&(i.lineWidth=t.lineWidth),t.lineDashArray&&(i.lineDashArray=t.lineDashArray),t.opacity&&(i.opacity=t.opacity),t.cornerRadius&&(i.cornerRadius=t.cornerRadius),t.sourcePadding!=undefined&&(i.sourcePadding=t.sourcePadding,this._dock(i,this.nameTable)),t.targetPadding!=undefined&&(i.targetPadding=t.targetPadding,this._dock(i,this.nameTable)),t.visible!=undefined&&(i.visible=t.visible,t.visible||this._clearSelection()),t.segments&&(i.segments=t.segments,ej.datavisualization.Diagram.Util._initConnectionEnds(i,this),this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments[0]&&(u=this.model.defaultSettings.connector.segments[0].type),ej.datavisualization.Diagram.Util._initializeSegments(i,u),this._dock(i,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(i,this),i==this.selectionList[0]&&(this._clearSelection(),this._addSelection(i))),t.targetDecorator&&(r=i.targetDecorator?$.extend(!0,{},i.targetDecorator,t.targetDecorator):ej.datavisualization.Diagram.Decorator(t.targetDecorator),i.targetDecorator=r),t.sourceDecorator&&(r=i.sourceDecorator?$.extend(!0,{},i.sourceDecorator,t.sourceDecorator):ej.datavisualization.Diagram.Decorator(t.sourceDecorator),i.sourceDecorator=r),(t.sourceDecorator||t.targetDecorator)&&(ej.datavisualization.Diagram.DiagramContext.clearDecorators(i,this),ej.datavisualization.Diagram.DiagramContext.renderDecorators(i,this)),this._svg&&(ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.DiagramContext.updateConnectorStyle(i,this)),this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._svg,this._currZoom,this,this.model.selectedItems.constraints)))},update:function(n){var i,t,u,r,e,f;if(n.tool&&(this.activeTool._showAllPorts(!0),t=n.tool,t&ej.datavisualization.Diagram.Tool.ContinuesDraw?this.model.drawType&&(i=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(i,!1)):t&ej.datavisualization.Diagram.Tool.DrawOnce?this.model.drawType&&(i=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(i,!0)):t&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):t&ej.datavisualization.Diagram.Tool.MultipleSelect&&this.activateTool("select")),n.bridgeDirection)for(this.bridgeDirection(n.bridgeDirection),u=this.connectors(),r=0,e=u.length;r<e;r++)f=u[r],ej.datavisualization.Diagram.Util.updateBridging(f,this),ej.datavisualization.Diagram.DiagramContext.update(f,this)},bringToCenter:function(n){var t=this._currZoom,r=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),i={x:n.x*t,y:n.y*t,width:n.width*t,height:n.height*t},u=i.x+i.width/2-r.width/2,f=i.y+i.height/2-r.height/2;ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-u,this._vScrollOffset-f,null,!1)},bringIntoView:function(n){var r=0,u=0,t=this._currZoom;n.right=n.right?n.right:n.x+n.width;n.bottom=n.bottom?n.bottom:n.y+n.height;n={x:n.x*t,y:n.y*t,right:n.right*t,bottom:n.bottom*t};var f=this._hScrollOffset,e=this._vScrollOffset,i=ej.datavisualization.Diagram.ScrollUtil._viewPort(this);n.right>-f+i.width&&(r=n.right-i.width);n.x<-f&&(r=n.x);n.bottom>-e+i.height&&(u=n.bottom-i.height);n.y<-e&&(u=n.y);ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-r,this._vScrollOffset-u,null,!1)},getBridgeSegment:function(n,t,i,r,u){return"A "+r/2+" "+r/2+"  "+i+" , 1 "+u+" "+t.x+","+t.y},fitToPage:function(n,t,i){var r,e,o={},u,s,n,c,l,h,f,a,v;if(this.nodes().length>0||this.connectors().length>0){s=ej.datavisualization.Diagram.ScrollUtil._viewPort(this);i=i||{};i={top:isNaN(i.top)?25:i.top,bottom:isNaN(i.bottom)?25:i.bottom,left:isNaN(i.left)?25:i.left,right:isNaN(i.right)?25:i.right};t=t?t:"pageSettings";n=n?n:"page";t!="custom"&&(u=this._getDigramBounds(t));c=u.width;l=u.height;o.x=(s.width-(i.left+i.right))/c;o.y=(s.height-(i.top+i.bottom))/l;h=this._hScrollOffset;f=this._vScrollOffset;switch(n){case"width":r=o.x;e=r/this._getCurrentZoom();h-=u.x*r;f-=this._vScrollOffset*e;f=t!="custom"?f:f+this._vScrollOffset*e;break;case"height":r=o.y;e=r/this._getCurrentZoom();a=(s.width-(t!="content"?u.width:c)*r)/2-u.x*r;v=(s.height-(t!="content"?u.height:l)*r)/2-u.y*r;h+=a+(i.left-i.right)/2*r;f+=v+(i.top-i.bottom)/2*r;break;case"page":r=Math.min(o.x,o.y);e=r/this._getCurrentZoom();Math.min(o.x,o.y)==o.x?(h-=u.x*r,f-=this._vScrollOffset*e,f=t!="custom"?f:f+this._vScrollOffset*e):(a=(s.width-(t!="content"?u.width:c)*r)/2-u.x*r,v=(s.height-(t!="content"?u.height:l)*r)/2-u.y*r,h+=a+(i.left-i.right)/2*r,f+=v+(i.top-i.bottom)/2*r)}ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,e,h,f,new ej.datavisualization.Diagram.Point(0,0),!0)}else e=1/this._getCurrentZoom(),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,e,this._hScrollOffset,this._vScrollOffset,new ej.datavisualization.Diagram.Point(0,0),!0)},exportDiagram:function(n){var e,v,u,i,s,y,o,f,p,l,r,w,a;n||(n={});var b=n&&n.region?n.region:"content",g=n&&n.mode?n.mode:"download",t=n.margin||{};if(t={top:isNaN(t.top)?25:t.top,bottom:isNaN(t.bottom)?25:t.bottom,left:isNaN(t.left)?25:t.left,right:isNaN(t.right)?25:t.right},i=this._getDigramBounds(b),n.bounds&&(v=!0,i={x:isNaN(n.bounds.x)?i.x:n.bounds.x,y:isNaN(n.bounds.y)?i.y:n.bounds.y,width:n.bounds.width||i.width,height:n.bounds.height||i.height}),i.x-=t.left,i.y-=t.top,i.width+=t.left+t.right,i.height+=t.top+t.bottom,s=n.fileName||"diagram",n.format!="svg"){if(y=this._diagramAsCanvas({bounds:i,margin:t},v),e=n.format||"jpg",!(ej.browserInfo().name==="msie"&&parseFloat(ej.browserInfo().version)<10)){if(o=u=y.toDataURL(),n.mode=="data")return u;o=o.replace(/^data:[a-z]*;,/,"");var k=o.split(","),h=atob(k[1]),c=new ArrayBuffer(h.length),d=new Uint8Array(c);for(f=0;f<h.length;f++)d[f]=h.charCodeAt(f)}}else{if(e=n.format||"svg",p=u=this._diagramAsSvg({bounds:i,margin:t}),n.mode=="data")return u;ej.browserInfo().name==="msie"&&parseFloat(ej.browserInfo().version)<10||(c=(new XMLSerializer).serializeToString(p))}if(n.mode=="download"){if(ej.browserInfo().name==="msie"&&parseFloat(ej.browserInfo().version)<10)return alert("Downloading option is not supported in IE-9, Please use the returned data"),u;l=new Blob([c],{type:"text/plain;charset=utf-8"});ej.browserInfo().name==="msie"?window.navigator.msSaveOrOpenBlob(l,s+"."+e):(r=document.createElement("a"),w=URL.createObjectURL(l),r.href=w,r.setAttribute("download",s+"."+e),document.createEvent?(a=document.createEvent("MouseEvents"),a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(a)):r.fireEvent&&r.fireEvent("onclick"))}},_diagramAsSvg:function(n){var i=new ej.datavisualization.Diagram.Svg({id:"diagram_svg",width:n.bounds.width,height:n.bounds.height}),r,u,e,f,t,o;for(document.body.appendChild(i.document),r=this._svg.document.getElementById(this._canvas.id+"_diagramLayer"),r=r.cloneNode(!0),i.appendChild(r),r.setAttribute("transform","translate("+-n.bounds.x+", "+-n.bounds.y+")"),u=this.nodes(),t=0;t<u.length;t++)e=u[t],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(e,i);for(f=this.connectors(),t=0;t<f.length;t++)o=f[t],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(o,i);return document.body.removeChild(i.document),i.appendChild(this._svg.document.getElementById(this._canvas.id+"patterndefinition").cloneNode(!0)),i.document},_diagramAsCanvas:function(n,t){var h,f,e=n.bounds,nt=n.margin,k=this.model.pageSettings.pageBackgroundColor,s=new ej.datavisualization.Diagram.Canvas({id:"mycanvas",width:e.width,height:e.height}),w=s.document.getContext("2d"),c,l,i,v,b,a,u,y,p;for(w.fillStyle=k,w.translate(-e.x,-e.y),w.fillRect(e.x,e.y,e.width,e.height),h=t?ej.datavisualization.Diagram.Util._getIntersectingElement(this,n.bounds):this.nodes().concat(this.connectors()),h=this._sortByZIndex(h,!0),i=0;i<h.length;i++)f=h[i],f.segments?ej.datavisualization.Diagram.CanvasContext.renderConnector(f,s):f._type!=="group"||f.parent?f._type==="node"&&ej.datavisualization.Diagram.CanvasContext.renderNode(f,s):ej.datavisualization.Diagram.CanvasContext.renderGroup(f,s,this);if(c=0,l=0,this.model.phases)for(i=0;i<this.model.phases.length;i++){if(v=this.nameTable[this.model.phases[i].parent],v){b=this._getChildren(v.children);b.length>1&&(a=this.nameTable[b[0]]);var o=ej.datavisualization.Diagram.Util.bounds(v),r=[],d,g=o.top+50,tt=o.left+50;if(this.model.phases[i].orientation=="vertical")for(r.push({x:0,y:0}),r.push({x:o.width,y:0}),d=ej.datavisualization.Diagram.SvgContext._convertToSVGPoints(r),c=o.x,l=o.y+this.model.phases[i].offset,a&&(g+=a.height),u=0,y=r.length;u<y;++u)p=ej.datavisualization.Diagram.Geometry.translate(r[u],c,l),r[u]=p;else for(r.push({x:0,y:a.height?a.height:0}),r.push({x:0,y:o.height}),c=o.x+this.model.phases[i].offset,l=o.y,u=0,y=r.length;u<y;++u)p=ej.datavisualization.Diagram.Geometry.translate(r[u],c,l),r[u]=p}ej.datavisualization.Diagram.CanvasContext.renderPhases(this.model.phases[i],s,r)}return s.document},print:function(){var r=this.exportDiagram({mode:"data",region:"pageSettings"}),i=document.createElement("img"),u={id:this.element[0].id+"_printImage",src:r},t,n;ej.datavisualization.Diagram.Util.attr(i,u);t=document.createElement("div");t.appendChild(i);n=window.open("");n!=null&&(n.document.write("<html><head><title><\/title><\/head>"),n.document.write('<BODY onload="window.print()">'),n.document.write("<center>"+t.innerHTML+"<\/center>"),n.document.close())},save:function(){var t=this.model.drawingTools,i=this.model.selectedItems.userHandles,n;return this.model.drawingTools=null,this.model.selectedItems.userHandles=null,this.nameTable.multipleSelection&&ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable.multipleSelection),this._updateTableNodes(),n=jQuery.extend(!0,{},this.model),this._updateGroupChildren(n),this.model.drawingTools=t,this.model.selectedItems.userHandles=i,this._checkForNullValues(n),n},_checkForNullValues:function(n){this._checkTargetNull(n.pageSettings)},_checkTargetNull:function(n){for(var t in n)n[t]==null||n[t]==Infinity?n[t]=0:typeof n[t]=="object"&&n[t]&&this._checkTargetNull(n[t])},_updateGroupChildren:function(n){var i=[],r,t;if(n&&n.nodes&&n.nodes.length>0)for(t=0;t<n.nodes.length;t++)n.nodes[t].parent!==""||n.nodes[t].isSwimlane?n.nodes[t].isSwimlane&&(r=this._getNode(n.nodes[t].name),r&&i.push(jQuery.extend(!0,{},r))):(this._updateChildren(n.nodes[t]),i.push(jQuery.extend(!0,{},n.nodes[t])));n.nodes=i},_updateChildren:function(n){var u=[],i,r,t;if(n&&n.children&&n.children.length>0)for(t=0;t<n.children.length;t++)r=this._getChild(n.children[t]),r&&(i=this.nameTable[r]),i&&u.push(jQuery.extend(!0,{},i));n.children=u},_containsNode:function(n){var t,i;for(n=this._getChild(n),t=null,i=0;i<this.nodes().length;i++)if(t=this.nodes()[i],t&&t.name===n)return!0;return null},_containsPhase:function(n){for(var t=null,i=0;i<this.model.phases.length;i++)if(t=this.model.phases[i],t&&t.name===n)return!0;return null},_updateToModel:function(n){var i,t;if(n){if(i=null,n.children&&n.children.length>0)for(t=0;t<n.children.length;t++)i=this.nameTable[this._getChild(n.children[t])],this._updateToModel(i);this._containsNode(n)||this.nodes().push(n)}},_updateTableNodes:function(){var t=0,n,u,i,r;for(t;t<this.nodes().length;t++)if(n=this.nameTable[this.nodes()[t].name],n&&(n.children&&n.children.length>0&&this._updateToModel(n),this.nodes()[t]=n,n._type==="group"&&this._updateTableGroup(n),n.phases&&n.phases.length>0))for(r=0;r<n.phases.length;r++)i=this.nameTable[n.phases[r]],i&&(this._containsPhase(i.name)?i=i:this.model.phases.push(i));for(t;t<this.connectors().length;t++)u=this.nameTable[this.connectors()[t].name],u&&(this.connectors()[t]=u)},_updateTableGroup:function(n){for(var i=n.children,t=0;t<n.children.length;t++)n.children[t]=this.nameTable[this._getChild(n.children[t])],n.children[t]&&n.children[t]._type==="group"&&this._updateTableGroup(n.children[t])},upgrade:function(n){if(n.version)n.version=="13.1";else if(this.commonAPIChanges(n),n.nodes)for(var t=0;t<n.nodes.length;t++)n.nodes[t].inEdges||(n.nodes[t].inEdges=[],n.nodes[t].outEdges=[]),n.nodes[t].constraints=ej.datavisualization.Diagram.NodeConstraints.Default},commonAPIChanges:function(n){var t,i;if(n.defaultSettings={node:n.nodeDefaults,connectors:n.connectorDefaults},n.connectors)for(t=0;t<n.connectors.length;t++)n.connectors[t].constraints=ej.datavisualization.Diagram.ConnectorConstraints.Default,n.connectors[t].line&&(n.connectors[t].line.type=="straight"?(i=[{type:"straight",startPoint:n.connectors[t].line.startPoint,endPoint:n.connectors[t].line.endPoint}],this.commonSourceTargetChanges(n.connectors[t])):n.connectors[t].line.type=="orthogonal"?(i=[{type:"orthogonal",startPoint:n.connectors[t].line.startPoint,endPoint:n.connectors[t].line.endPoint}],this.commonSourceTargetChanges(n.connectors[t])):n.connectors[t].line.type=="bezier"&&(i=[{type:"bezier",startPoint:n.connectors[t].line.startPoint,endPoint:n.connectors[t].line.endPoint,point1:n.connectors[t].line.point1,point2:n.connectors[t].line.point2}],this.commonSourceTargetChanges(n.connectors[t])),n.connectors[t].sourcePoint=n.connectors[t].line.startPoint,n.connectors[t].targetPoint=n.connectors[t].line.endPoint,n.connectors[t].segments=i)},commonSourceTargetChanges:function(n){n.sourceNodeName&&(n.sourceNode=n.sourceNodeName);n.sourceNodePort&&(n.sourcePort=n.sourceNodePort);n.targetNodeName&&(n.targetNode=n.targetNodeName);n.targetPortName&&(n.targetPort=n.targetPortName)},load:function(n){var t,i;this._isLoad=!0;this.clear();t=document.getElementById(this.element[0].id+"_contextMenu");t&&t.parentNode.removeChild(t);i={nodes:n.nodes?n.nodes:[],connectors:n.connectors?n.connectors:[],contextMenu:n.contextMenu?n.contextMenu:{},snapSettings:n.snapSettings?n.snapSettings:{},backgroundImage:n.backgroundImage?n.backgroundImage:null,enableAutoScroll:n.enableAutoScroll?n.enableAutoScroll:!0,autoScrollMargin:n.autoScrollMargin?n.autoScrollMargin:20,layout:n.layout?n.layout:{},pageSettings:n.pageSettings?n.pageSettings:{},click:n.click?n.click:null,connectionChange:n.connectionChange?n.connectionChange:null,defaultSettings:n.defaultSettings?n.defaultSettings:null,dataSource:n.dataSource?n.dataSource:null,dataSourceSchema:n.dataSourceSettings?n.dataSourceSettings:{node:null,connector:null},doubleClick:n.doubleClick?n.doubleClick:null,enableContextMenu:n.enableContextMenu?n.enableContextMenu:!0,showTooltip:n.showTooltip?n.showTooltip:!0,height:n.height?n.height:null,mouseEnter:n.mouseEnter?n.mouseEnter:null,mouseOver:n.mouseOver?n.mouseOver:null,mouseLeave:n.mouseLeave?n.mouseLeave:null,nodeTemplate:n.nodeTemplate?n.nodeTemplate:null,rotationChange:n.rotationChange?n.rotationChange:null,selectorConstraints:n.selectorConstraints?n.selectorConstraints:ej.datavisualization.Diagram.SelectorConstraints.All,tooltipTemplateId:n.tooltipTemplateId?n.tooltipTemplateId:null,width:n.width?n.width:null,constraints:n.constraints,zoomFactor:n.zoomFactor?n.zoomFactor:1,phases:n.phases?n.phases:[]};$("#"+this._id).ejDiagram(i);this._isLoad=!1},layout:function(){this._setLayout()},_setLayout:function(){this._doLayout();ej.datavisualization.Diagram.PageUtil._updatePageSize(this);this._clearSelection()},addSelection:function(n){this._addSelection(n)},updateSelectedObject:function(n){var t=this.nameTable[n];t&&(this.activeTool.selectedObject=t)},updateSelection:function(n){ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._updateSelectionHandle(n)},activateTool:function(n,t){this.tools[n]&&(this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0),this._toolToActivate=n,this.activeTool=this.tools[this._toolToActivate],t!=undefined&&(this.activeTool.singleAction=t));this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(this._currentCursor="pointer",this.activeTool.startPoint=ej.datavisualization.Diagram.Point(0,0),this.activeTool._isMouseDown=!1);this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&(this.activeTool.singleAction?this.tool(this.tool()|ej.datavisualization.Diagram.Tool.DrawOnce):this.tool(this.tool()|ej.datavisualization.Diagram.Tool.ContinuesDraw),this.activeTool._showAllPorts());this._drawingTool=!0},deactivateTool:function(){this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0);this.tool()&ej.datavisualization.Diagram.Tool.DrawOnce&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.DrawOnce);this.tool()&ej.datavisualization.Diagram.Tool.ContinuesDraw&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.ContinuesDraw);this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._mousedown=!1,this._currentCursor="pointer"):(this._toolToActivate="select",this.activeTool=this.tools[this._toolToActivate])},updateLabel:function(n,t,i){var r,u;if(n&&ej.datavisualization.Diagram.Util.isPageEditable(this)&&(r=this._findNode(n),r||(r=this._findConnector(n)),i&&t&&!i.name||t.name==i.name)){if(r){for(u in i)t.hasOwnProperty(u)&&(t[u]=i[u]);i.wrapText!==undefined&&(t.wrapping=i.wrapText?"wrapwithoverflow":"nowrap");r.segments||r.type!=="text"?(ej.datavisualization.Diagram.DiagramContext.updateLabelStyle(r,t,this),ej.datavisualization.Diagram.DiagramContext.updateLabel(r,t,this)):r.type==="text"&&ej.datavisualization.Diagram.DiagramContext.updateTextBlock(r,t,this)}i.mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&this.startLabelEdit(r,t)}},startLabelEdit:function(n,t){var r,i,u;if(n){for(r=0;r<this.selectionList.length;r++)if(i=this.selectionList[r],i!==n&&typeof i.labels.length!="undefined")for(u=0;u<i.labels.length;u++)i.labels[u].mode=ej.datavisualization.Diagram.LabelEditMode.View;t||n.type!=="text"||(t=n.textBlock);this._setLabelEditing(t)?this._startEdit(n):this._endEdit()}},_setSelectorConstraints:function(n){this.model.selectedItems.constraints=n;this.selectionList[0]&&(ej.datavisualization.Diagram.SvgContext.clearSelector(this._svg,this._adornerLayer),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._svg,this._adornerLayer,this._currZoom,n),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._svg,this.selectionList[0].type=="pseudoGroup",this._currZoom,this._adornerLayer))},group:function(){var t,n,r,u,i,f;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"){for(t=[],n=0;n<this.selectionList[0].children.length;n++)t.push(this.nameTable[this.selectionList[0].children[n]]);for(this._sortByZIndex(t,!0),u=ej.datavisualization.Diagram.Util.randomId(),i=new ej.datavisualization.Diagram.Group({name:u}),this._clearSelection(),n=0;n<t.length;n++)this._isUndo=!0,i.children.push(t[n].name),t[n].parent=u,ej.datavisualization.Diagram.Util.removeItem(this.selectionList,t[n].name),t[n].segments?ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[t[n].name]):ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[t[n].name]),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t[n].name],t[n]),this._browserInfo.name==="msie"&&(t[n].type=="html"?(r=document.getElementById(t[n].name+"_parentdiv"),r.parentNode.removeChild(r)):t[n]._type==="group"&&this._checkForHtmlNode(t[n])),r=this._svg.document.getElementById(t[n].name),r.parentNode.removeChild(r);ej.datavisualization.Diagram.Util.clear(this.selectionList);i=this._getNewGroup(i);this.add(i);this._addSelection(i);f={type:"groupchanged",object:i,actionType:"group"};this.addHistoryEntry(f);this._isUndo=!1}},_checkForHtmlNode:function(n){for(var t,r,u=this._getChildren(n.children),i=0;i<u.length;i++)t=this.nameTable[u[i]],t&&(t._type==="group"?this._checkForHtmlNode(t):t.type=="html"&&(r=document.getElementById(t.name+"_parentdiv"),r.parentNode.removeChild(r)))},_removeChildren:function(n,t){for(var i,u=this._getChildren(n.children),r=0;r<u.length;r++)i=this.nameTable[u[r]],i&&(n.isLane?(this._disConnect(i,t),this._removeConnector(i,t)):i.segments?(this._removeEdges(i),i.sourceNode=i.sourcePort=i.targetNode=i.targetPort=null):this._disConnect(i,t,!0),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),i),i._type==="group"?(this._removeChildren(i,t),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),delete this.nameTable[i.name]):(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]),this._removeElement(i))},ungroup:function(){var u,i,f,r,n,t,e;if(this.selectionList[0]&&this.selectionList[0]._type==="group"&&this.selectionList[0].canUngroup&&!(this.selectionList[0].isSwimlane||this.selectionList[0].isLane)){for(this._isUndo=!0,u=this.selectionList[0].children,r=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],f=this.selectionList[0],$("#"+this.selectionList[0].name)[0].parentNode.removeChild($("#"+this.selectionList[0].name)[0]),$("#"+this.selectionList[0].name)[0]&&$("#"+this.selectionList[0].name)[0].parentNode.removeChild($("#"+this.selectionList[0].name)[0]),this._browserInfo.name==="msie"&&this._checkForHtmlNode(this.selectionList[0]),this._clearSelection(),ej.datavisualization.Diagram.Util.clear(this.selectionList),i=0;i<u.length;i++)t=this.nameTable[u[i]],$(r).children("#"+t.name)[0]&&r.removeChild($(r).children("#"+t.name)[0]),t&&(t.parent&&(t.parent=null),t.segments?(n=t,n.parent="",this._updateEdges(n),this._dock(n,this.nameTable),ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this),this.connectors().indexOf(n)===-1&&this.connectors().push(n)):(n=t,n.parent="",n._type==="group"?(this._updateChildrenEdges(n),(n.isLane||n.isSwimlane)&&(n.width=0,n.height=0),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this)):ej.datavisualization.Diagram.DiagramContext.renderNode(n,this),this.nodes().indexOf(n)===-1&&this.nodes().push(n)));ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(f.name));e={type:"groupchanged",object:f,actionType:"ungroup"};this.addHistoryEntry(e);this._isUndo=!1}},nudge:function(n,t){t=t?t:1;var r={up:{x:0,y:-t},down:{x:0,y:t},left:{x:-t,y:0},right:{x:t,y:0}},i=r[n];i&&this.selectionList[0]&&this._nudge(this.selectionList[0],i.x,i.y)},selectAll:function(){var t,u,n,f,i=null,r;for(this._clearSelection(),t=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),u=this.nodes(),n=0,f=u.length;n<f;n++)ej.datavisualization.Diagram.Util.canSelect(u[n])&&(i=this.nameTable[u[n].name],i&&i.parent==""&&i.type!="pseudoGroup"&&t.children.push(i.name));for(r=this.connectors(),n=0,f=r.length;n<f;n++)ej.datavisualization.Diagram.Util.canSelect(r[n])&&r[n].parent==""&&t.children.push(r[n].name);ej.datavisualization.Diagram.Util._updateGroupBounds(t,this);this.nodes().push(t);this.nameTable[t.name]=t;t.children.length>0&&this._addSelection(t)},align:function(n){var o,r,t,e,i,s,u,f;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0&&(o=this.nameTable[this.selectionList[0].name].children,n==="left"?r=this._findCornerNodes().left:n==="right"?r=this._findCornerNodes().right:n==="top"?r=this._findCornerNodes().top:n==="bottom"&&(r=this._findCornerNodes().bottom),r?t=ej.datavisualization.Diagram.Util.bounds(r):(n==="center"||n==="middle")&&(t=ej.datavisualization.Diagram.Util.bounds(this.selectionList[0])),t)){for(u=0,f=0,e=0;e<o.length;e++)s=this.nameTable[o[e]],i=ej.datavisualization.Diagram.Util.bounds(s),n==="left"?u=-(i.x-t.x):n==="right"?u=-(i.x+i.width-(t.x+t.width)):n==="top"?f=-(i.y-t.y):n==="bottom"?f=-(i.y+i.height-(t.y+t.height)):n==="center"?u=-(i.x+i.width/2-(t.x+t.width/2)):n==="middle"&&(f=-(i.y+i.height/2-(t.y+t.height/2))),this._moveNode(u,f,s);ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._svg,this._currZoom,this,this.model.selectedItems.constraints)}},sameSize:function(){var i,n;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var r=this.nameTable[this.selectionList[0].name].children,u=this.nameTable[this.selectionList[0].children[0]],t=ej.datavisualization.Diagram.Util.bounds(u);for(i=0;i<r.length;i++)n=this.nameTable[r[i]],n.segments||(n._shape==="path"&&(n.height!==t.height||n.width!==t.width)&&(n._scaled=!0),n.height=t.height,n.width=t.width,this._updateQuad(this,n),ej.datavisualization.Diagram.DiagramContext.update(n,this));ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._svg,this._currZoom,this,this.model.selectedItems.constraints)}},sameHeight:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,u=this.nameTable[this.selectionList[0].children[0]],r=ej.datavisualization.Diagram.Util.bounds(u);for(t=0;t<i.length;t++)n=this.nameTable[i[t]],n.segments||(n._shape==="path"&&n.height!==r.height&&(n._scaled=!0),n.height=r.height,this._updateQuad(this,n),ej.datavisualization.Diagram.DiagramContext.update(n,this));ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._svg,this._currZoom,this,this.model.selectedItems.constraints)}},sameWidth:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,u=this.nameTable[this.selectionList[0].children[0]],r=ej.datavisualization.Diagram.Util.bounds(u);for(t=0;t<i.length;t++)n=this.nameTable[i[t]],n.segments||(n._shape==="path"&&n.width!==r.width&&(n._scaled=!0),n.width=r.width,this._updateQuad(this,n),ej.datavisualization.Diagram.DiagramContext.update(n,this));ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._svg,this._currZoom,this,this.model.selectedItems.constraints)}},spaceDown:function(){var t,e,i,n,s,r,u,f;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&(t=this.selectionList[0].children,this._sliceDockLines(t),this._sortByYvalue(this.selectionList[0].children),e=t.length,t&&e>2)){var h=this._findCornerNodes(),c=h.top,o=0,i=null,n=null;for(r in t)i=null,n=null,i=this.nameTable[this._getChild(t[r])],n=this.nameTable[this._getChild(t[Number(r)+1])],i&&n&&(u=ej.datavisualization.Diagram.Util.bounds(i),f=ej.datavisualization.Diagram.Util.bounds(n),o+=f.y-(u.y+u.height));s=o/(e-1);for(r in t)i=this.nameTable[this._getChild(t[r])],n=this.nameTable[this._getChild(t[Number(r)+1])],i&&n&&(u=ej.datavisualization.Diagram.Util.bounds(i),f=ej.datavisualization.Diagram.Util.bounds(n),this._translate(n,0,u.bottom-f.top+s,this.nameTable),this._updateQuad(this,n),this._updateNodeMargin(n),ej.datavisualization.Diagram.DiagramContext.update(n,this))}},spaceAcross:function(){var t,e,i,n,s,c,r,u,f;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&(t=this.selectionList[0].children,this._sliceDockLines(t),this._sortByXvalue(this.selectionList[0].children),e=t.length,t&&e>2)){var h=this._findCornerNodes(),l=h.left,o=0,i=null,n=null;for(r in t)i=null,n=null,i=this.nameTable[this._getChild(t[r])],n=this.nameTable[this._getChild(t[Number(r)+1])],i&&n&&(u=ej.datavisualization.Diagram.Util.bounds(i),f=ej.datavisualization.Diagram.Util.bounds(n),o+=f.x-(u.x+u.width));s=o/(e-1);c=0;for(r in t)i=this.nameTable[this._getChild(t[r])],n=this.nameTable[this._getChild(t[Number(r)+1])],i&&n&&(u=ej.datavisualization.Diagram.Util.bounds(i),f=ej.datavisualization.Diagram.Util.bounds(n),this._translate(n,u.right-f.left+s,0,this.nameTable),this._updateQuad(this,n),this._updateNodeMargin(n),ej.datavisualization.Diagram.DiagramContext.update(n,this))}},sendBackward:function(){var t,i,r,n,u,e,f,o;if(this.selectionList[0]&&this.selectionList[0].type!="pseudoGroup"&&(n=this.selectionList[0],n)){for(t=this._findOverlapNode(n),this._sortByZIndex(t),u=0;u<t.length;u++)if(n.zOrder>t[u].zOrder){r=t[u];break}if(e=n.zOrder,r){for(f=r.zOrder,i=f;i<e;i++)n.parent!=""?this._findObjectByIndex(i,!0).zOrder+=1:this._findObjectByIndex(i).zOrder+=1;n.parent!=""?n.parent&&(o=this.nameTable[n.parent],this._findChildren(o,n.name).zOrder=f):this._findObjectByName(n.name).zOrder=f;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(r.name));ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints)}}},moveForward:function(){var t,i,r,n,u,e,f,o;if(this.selectionList[0]&&this.selectionList[0].type!="pseudoGroup"&&(n=this.selectionList[0],n)){for(t=this._findOverlapNode(n),this._sortByZIndex(t),u=t.length-1;u>=0;u--)if(n.zOrder<t[u].zOrder){r=t[u];break}if(e=n.zOrder,r){for(f=r.zOrder,i=f;i>e;i--)n.parent!=""?this._findObjectByIndex(i,!0).zOrder-=1:this._findObjectByIndex(i).zOrder-=1;n.parent!=""?n.parent&&(o=this.nameTable[n.parent],this._findChildren(o,n.name).zOrder=f):this._findObjectByName(n.name).zOrder=f;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(r.name).nextSibling);ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints)}}},sendToBack:function(){var n=this.selectionList[0],r,t,f;if(n&&n.type!="pseudoGroup"){var e=this._findOverlapNode(n),u=this._sortByZIndex(e),o=n.zOrder,i=n.zOrder;for(t=0;t<u.length;t++)u[t].zOrder<i&&(i=u[t].zOrder,r=u[t]);if(r){for(t=i;t<o;t++)n.parent!=""?this._findObjectByIndex(t,!0).zOrder+=1:this._findObjectByIndex(t).zOrder+=1;n.parent!=""?n.parent&&(f=this.nameTable[n.parent],this._findChildren(f,n.name).zOrder=i):this._findObjectByName(n.name).zOrder=i;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(r.name));ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints)}}},bringToFront:function(){var n=this.selectionList[0],r,t,f;if(n&&n.type!="pseudoGroup"){var e=this._findOverlapNode(n),i=this._sortByZIndex(e),o=n.zOrder,u=n.zOrder;for(t=0;t<i.length;t++)i[t].zOrder>u&&(u=i[t].zOrder,r=i[t]);if(r){for(t=0;t<i.length;t++)i[t].zOrder>o&&(i[t].zOrder-=1);n.parent?(f=this.nameTable[n.parent],this._findChildren(f,n.name).zOrder=u):this._findObjectByName(n.name).zOrder=u;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(r.name).nextSibling);ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints)}}},undo:function(){var t,n;if(ej.datavisualization.Diagram.Util.isPageEditable(this)&&ej.datavisualization.Diagram.Util.canUndo(this)){this._isUndo=!0;n=this.getUndoEntry();switch(n&&n.type){case"positionchanged":t={object:n.undoObject,isMultipleNode:n.isMultipleNode};this._recordPinPointChanged(t);break;case"rotationchanged":t={object:n.undoObject,isMultipleNode:n.isMultipleNode};this._recordRotationChanged(t);break;case"sizechanged":t={object:n.undoObject,isMultipleNode:n.isMultipleNode};this._recordSizeChanged(t);break;case"endpointchanged":t={undoObject:n.undoObject,redoObject:n.redoObject,isMultipleNode:n.isMultipleNode,_isUndo:!0};this._recordEndPointChanged(t);break;case"collectionchanged":t={changeType:n.changeType,childTable:n.childTable,edgeTable:n.edgeTable,isUndo:!0,sourcePorts:n.sourcePorts,targetPorts:n.targetPorts};t.object=jQuery.extend(!0,{},n.object);this._recordCollectionChanged(t);break;case"labelchanged":t={object:n.shape,label:n.previousLabelValue};this._recordLabelChanged(t);break;case"groupchanged":t={object:n.object,isUndo:!0,actionType:n.actionType};this._recordGroupChanged(t)}this._isUndo=!1}},redo:function(){var n,t;this._isUndo=!0;n=this.getRedoEntry();switch(n&&n.type){case"positionchanged":t={object:n.redoObject,isMultipleNode:n.isMultipleNode};this._recordPinPointChanged(t);break;case"rotationchanged":t={object:n.redoObject,isMultipleNode:n.isMultipleNode};this._recordRotationChanged(t);break;case"sizechanged":t={object:n.redoObject,isMultipleNode:n.isMultipleNode};this._recordSizeChanged(t);break;case"endpointchanged":t={undoObject:n.undoObject,redoObject:n.redoObject,isMultipleNode:n.isMultipleNode,_isUndo:!1};this._recordEndPointChanged(t);case"collectionchanged":t={changeType:n.changeType,childTable:n.childTable,isUndo:!1};t.object=jQuery.extend(!0,{},n.object);this._recordCollectionChanged(t);break;case"labelchanged":t={object:n.shape,label:n.updatedLabelValue};this._recordLabelChanged(t);break;case"groupchanged":t={object:n.object,actionType:n.actionType,isUndo:!1};this._recordGroupChanged(t)}this._isUndo=!1},addHistoryEntry:function(n){var t,i;this._historyList.currentEntry!=null&&(t=this._historyList.currentEntry,t.next?t.previous&&(i=t.next,i.previous=null,t.next=n,n.previous=t):(t.next=n,n.previous=t));this._historyList.currentEntry=n;this._historyList.canUndo=!0;this._historyList.canRedo=!1},clearHistory:function(){var n=this._historyList;n.currentEntry=null;n.canUndo=!1;n.canRedo=!1;this._hScrollbar._scrollData=null;this._vScrollbar._scrollData=null},getUndoEntry:function(){var i=null,t,n=this._historyList;return n.canUndo&&(i=n.currentEntry,t=n.currentEntry.previous,t?(n.currentEntry=t,n.canRedo||(n.canRedo=!0)):(n.canRedo=!0,n.canUndo=!1)),i},getRedoEntry:function(){var i=null,t,n=this._historyList;return n.canRedo&&(t=n.currentEntry.previous||n.canUndo?n.currentEntry.next:n.currentEntry,t&&(n.currentEntry=t,n.canUndo||(n.canUndo=!0),t.next||(n.canRedo=!1,n.canUndo=!0)),i=n.currentEntry),i},cut:function(){ej.datavisualization.Diagram.Util.isPageEditable(this)&&(this._pasteIndex=0,this._setClipboard(),this._delete())},addPorts:function(n,t){var i,u,r;if(ej.datavisualization.Diagram.Util.isPageEditable(this)&&(i=this.nameTable[n],i&&t))for(r=0;r<t.length;r++)u=ej.datavisualization.Diagram.Port(t[r]),i.ports.push(u),ej.datavisualization.Diagram.DiagramContext.renderPort(i,u,this)},copy:function(){ej.datavisualization.Diagram.Util.isPageEditable(this)&&(this._pasteIndex=1,this.selectionList&&this.selectionList.length>0&&this._setClipboard())},paste:function(){ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._paste()},_setClipboard:function(){var i,t,f,s,r,u,n,e,o;if(this.selectionList.length>0){if(t=this.selectionList[0],f={},t._type==="group"||t.type==="pseudoGroup"){for(n=this._getChildren(t.children),r=0;r<n.length;r++)for(u=r+1;u<n.length;u++)e=this.nameTable[n[r]],o=this.nameTable[n[u]],o&&e&&o.zOrder<e.zOrder&&(s=n[r],n[r]=n[u],n[u]=s);f=this._getChildTable(t,f)}f[t.name]=t;i=$.extend(!0,{},{childTable:f,node:t});i.node.segments&&(i.node.targetNode=null,i.node.targetPort=null,i.node.sourceNode=null,i.node.sourcePort=null);this._clipboardData=i}},_getChildTable:function(n,t){var u,f,o,e,i,s,h,r;if(f=this._getChildren(n.children),f)for(e=0;e<f.length;e++)if(o=f[e],u=this.nameTable[o],u&&(u.parent===n.name||n.type=="pseudoGroup")){if(i=t[u.name]=$.extend(!0,{},u),(i._type==="group"||i.type==="pseudoGroup")&&(t=this._getChildTable(i,t)),i.inEdges&&i.inEdges.length>0)for(s in i.inEdges)r=this.nameTable[i.inEdges[s]],r&&(t[r.name]&&delete t[r.name],t[r.name]=r);if(i.outEdges&&i.outEdges.length>0)for(h in i.outEdges)r=this.nameTable[i.outEdges[h]],r&&(t[r.name]&&delete t[r.name],t[r.name]=r)}return t},_paste:function(){var r,i,t,n,s,u,e,f,o,c,h;if(this._clipboardData){if(r=this._clipboardData,r=$.extend(!0,{},{childTable:r.childTable,node:r.node}),n=r.node,n.container)n=this._pasteSwimlane(n,r),i=this._pasteIndex*10,this._translate(n,i,i,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(n,this),this._clearSelection(),this._addSelection(n);else if(n.type=="pseudoGroup"){for(s=n.children,u=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),this._isUndo=!0,e=0;e<s.length;e++)f=s[e],t=r.childTable[f],t&&(t.isLane||t.isSwimlane)?this._pasteSwimlane(t,r,!0):t&&(f=f+ej.datavisualization.Diagram.Util.randomId(),delete r.childTable[t.name],t.name=f,t.parent="",r.childTable[t.name]=t,this._preserveConnection(r.childTable,t),u.children.push(f),t._type==="group"&&this._pasteChildren(r.childTable,t),i=this._pasteIndex*10,this._translate(t,i,i,this.nameTable),this.add(t));this._clearSelection();this.nodes().push(u);this.nameTable[u.name]=u;ej.datavisualization.Diagram.Util._updateGroupBounds(u,this);this._addSelection(u);o={};o=this._getChildTable(this.selectionList[0],o);c={type:"collectionchanged",object:jQuery.extend(!0,{},this.selectionList[0]),childTable:jQuery.extend(!0,{},o),changeType:"insert"};this.addHistoryEntry(c);this._isUndo=!1}else n.type=="bpmn"?(h=ej.datavisualization.Diagram.Util.randomId(),n.name=n.name+h,this._cloneGroupNode(n,h,this.nameTable),n.inEdges=[],n.outEdges=[],this.add(n),i=this._pasteIndex*10,n=this.nameTable[n.name],this._translate(n,i,i,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(n,this),this._clearSelection(),this._addSelection(n)):(n.name=n.name+ej.datavisualization.Diagram.Util.randomId(),n.parent="",n._type==="group"?this._pasteChildren(r.childTable,n):n.segments||n.segments||(n.inEdges=[],n.outEdges=[]),i=this._pasteIndex*10,n.segments?ej.datavisualization.Diagram.Util._translateLine(n,i,i):this._translate(n,i,i,this.nameTable),this.add(n));this._pasteIndex++}},_cloneSwimlaneObj:function(n,t){var f,r,u,i;if(n=jQuery.extend(!0,{},n),n.name+=t,n.lanes&&n.lanes.length>0)for(i=0;i<n.lanes.length;i++)if(n.lanes[i]&&(n.lanes[i].name+=t,n.lanes[i].children&&n.lanes[i].children.length>0))for(f=n.lanes[i].children,r=0;r<f.length;r++)u=jQuery.extend(!0,{},f[r]),u.name+=t,u.parent=n.lanes[i].name,n.lanes[i].children[r]=u;if(n.phases&&n.phases.length>0)for(i=0;i<n.phases.length;i++)n.phases[i]&&(n.phases[i].name+=t,n.phases[i].parent=n.name);return n},_pasteSwimlane:function(n,t){var u=n.name,f=ej.datavisualization.Diagram.Util.randomId(),i,r;return(this._cloneSwimlane(n,t,f),n.isSwimlane)?(i=this.getNode(u),i||(i=this.getNode(t.childTable[u],t.childTable)),i=this._cloneSwimlaneObj(i,f),n=ej.datavisualization.Diagram.SwimLaneHelper._initSwimLane(ej.datavisualization.Diagram.SwimLane(i),this),this.add(n),ej.datavisualization.Diagram.DiagramContext.update(n,this),n):n.isLane&&(r=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(n,this,t),r)?(r.width=0,r.height=0,this.add(r),r):void 0},_cloneNode:function(n,t,i,r){var e=!1,o=null,n,u,f;if(n){if(n=typeof n=="string"?n:n.name,n=jQuery.extend(!0,{},t.childTable[n]),n.isPhaseStack&&(n.name=n.name.split("phaseStack")[0]+i+"phaseStack",e=!0,o=n.name),n.children&&n.children.length>0)for(u in n.children)this._cloneNode(n.children[u],t,i,o),n.children[u]&&(typeof n.children[u]=="string"?n.children[u]+=i:n.children[u].name+=i);if(r?n.parent=typeof r=="string"?r:r.name:n.parent!=""&&(n.parent+=i),n.inEdges&&n.inEdges.length>0)for(f in n.inEdges)n.inEdges[f]+=i;if(n.outEdges&&n.outEdges.length>0)for(f in n.outEdges)n.outEdges[f]+=i;e||(n.name+=i);this.nameTable[n.name]=n}},_cloneSwimlane:function(n,t,i){var f=n.name,u,r;if(n.name+=i,n.children&&n.children.length>0)for(r in n.children)this._cloneNode(n.children[r],t,i,n),typeof n.children[r]=="string"?n.children[r]+=i:n.children[r]=n.children[r].isPhaseStack?f+i+"phaseStack":n.children[r].name+i;if(n.phases&&n.phases.length>0)for(r in n.phases)u=jQuery.extend(!0,{},this.nameTable[n.phases[r]]),u.name+=i,u.parent+=i,this.nameTable[u.name]=u,n.phases[r]=u.name;this.nameTable[n.name]=n},_updateChildName:function(n,t){var r,i;if(n&&t)for(r=n.children,i=0;i<r.length;i++)r[i]=r[i]+t},_pasteChild:function(n,t,i,r){var u=u+ej.datavisualization.Diagram.Util.randomId();delete t[n.name];n.name=u;t[n.name]=n;this._preserveConnection(t,n);n.parent=i.name;r.push(u);n._type==="group"&&this._pasteChildren(t,n);this.add(n)},_pasteChildren:function(n,t){for(var i,f,e=[],u=t.children,r=0;r<u.length;r++)f=this._getChild(u[r]),i=n[f],i&&(i.segments||this._pasteChild(i,n,t,e));for(r=0;r<u.length;r++)f=this._getChild(u[r]),i=n[f],i&&i.segments&&this._pasteChild(i,n,t,e);t.children=e;this._preserveConnection(n,t)},_preserveConnections:function(n,t){for(var i,u=this._getChildren(t.children),r=0;r<u.length;r++)i=n[u[r]],i&&(this._preserveConnection(n,i),i._type==="group"&&this._preserveConnections(n,t))},_preserveConnection:function(n,t){var i,r,f,u;if(t.segments)t.targetNode&&(u=n[t.targetNode],u&&u.inEdges.push(t.name)),t.sourceNode&&(u=n[t.sourceNode],u&&u.outEdges.push(t.name));else{if(f=t.inEdges.length,f>0){for(i=0;i<f;i++)r=n[t.inEdges[i]],r&&(r.targetNode=t.name);t.inEdges=[]}if(f=t.outEdges.length,f>0){for(i=0;i<t.outEdges.length;i++)r=n[t.outEdges[i]],r&&(r.sourceNode=t.name);t.outEdges=[]}}},_expandChildren:function(n){for(var i,t,r=0;r<n.outEdges.length;r++)i=this.nameTable[n.outEdges[r]],i.visible=!0,ej.datavisualization.Diagram.DiagramContext.update(i,this),this._updateQuad(i),t=this.nameTable[i.targetNode],t.isExpanded&&this._expandChildren(t),t.visible=!0,t.excludeFromLayout=!1,ej.datavisualization.Diagram.DiagramContext.update(t,this),this._updateQuad(t)},_collapseChildren:function(n){for(var i,t,r=0;r<n.outEdges.length;r++)i=this.nameTable[n.outEdges[r]],i.visible=!1,ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),t=this.nameTable[i.targetNode],t.isExpanded&&this._collapseChildren(t),t.visible=!1,t.excludeFromLayout=!0,ej.datavisualization.Diagram.DiagramContext.update(t,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],t),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,t)},zoomTo:function(n){n||(n=new ej.datavisualization.Diagram.Zoom);n.zoomCommand&ej.datavisualization.Diagram.ZoomCommand.ZoomIn?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+n.zoomFactor,0,0,n.focusPoint,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+n.zoomFactor),0,0,n.focusPoint,!0)},remove:function(n){n&&this.nameTable[n.name]&&ej.datavisualization.Diagram.Util.isPageEditable(this)?this._remove(n):this._delete()},clear:function(){this._clearSelection();for(var n=this.connectors().length-1;n>=0;n--)this._remove(this.connectors()[n],null,!0);for(n=this.nodes().length-1;n>=0;n--)this._remove(this.nodes()[n],null,!0);this.clearHistory();$("#"+this._canvas.id+"_hScrollbar").ejScrollBar({width:0});$("#"+this._canvas.id+"_vScrollbar").ejScrollBar({height:0})},_add:function(n,t){var r=!1,h,u,s,f,e,i,c,o,l;if(n.length>0)for(i=0;i<n.length;i++)this.add(n[i]);else if(n=ej.datavisualization.Diagram.NodeType(n,this),n.addInfo&&(n.addInfo.height&&(n.height=n.addInfo.height),n.addInfo.width&&(n.width=n.addInfo.width)),h=n.segments?"connector":"node",u={changeType:"insert",element:this.getNode(n),cancel:!1},n.isPhase||(this._raiseEvent(h+"CollectionChange",u),n._absolutePath=null),n.isLane?this._updateLane(n,u.element):n.isSwimlane&&this._updateSwimlane(n,u.element),!u.cancel)if(this._setZorder(n),n.isLane||n.isSwimlane){if(r=this.nodes().push(n),this.nameTable[n.name]=n,r&&n._type==="group"&&t){if(this._paletteItemClick&&(n.offsetX=n.minWidth/2+50,n.offsetY=n.minHeight/2+50),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this),n.phases&&n.phases.length>0)for(e=null,i=0,c=n.phases.length;i<c;i++)e=this.nameTable[n.phases[i]],e.type=="phase"&&ej.datavisualization.Diagram.SvgContext.renderphase(e,this._svg,this._diagramLayer,this);this._clearSelection();this._addSelection(n)}}else n.segments?(n=this._getNewConnector(n),r=this.model.connectors.push(n),r&&(ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,n),this._updateEdges(n),this._dock(n,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(n,this),n.parent||t&&ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this),this.nameTable[n.name]=n,t&&(this._clearSelection(),this._addSelection(n)))):(n._type==="group"||n.children&&n.children.length>0?(n=ej.datavisualization.Diagram.Group(n),n._type="group",this._initGroupNode(n)):(n=this._getNewNode(n),this._getNodeDimension(n)),r=this.nodes().push(n),this.nameTable[n.name]=n,r&&(n._type==="group"||n.children&&n.children.length>0?(this._updateParent(n),n.offsetX==0&&n.offsetY==0&&ej.datavisualization.Diagram.Util._updateGroupBounds(n,this,!0),this._updateChildrenEdges(n),t&&(ej.datavisualization.Diagram.Util._updateGroupBounds(n,this,!0),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this),ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,n))):(ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,n),t&&(s=null,n.parent&&(s=this._svg.document.getElementById(n.parent),f=this.nameTable[n.parent],f&&(f.children.push(n.name),ej.datavisualization.Diagram.Util._updateGroupBounds(f,this),ej.datavisualization.Diagram.DiagramContext.update(f,this))),(n.parent===""||n.isPhase||this._isInsert)&&ej.datavisualization.Diagram.DiagramContext.renderNode(n,this,s))),this.nameTable[n.name]=n,t&&(this._clearSelection(),this._addSelection(n))));return this._isUndo||this._selectedSymbol||n.parent==""&&(o={},this.selectionList&&this.selectionList.length>0&&(o=this._getChildTable(this.selectionList[0],o)),l={type:"collectionchanged",object:jQuery.extend(!0,{},n),childTable:jQuery.extend(!0,{},o),changeType:"insert"},this.addHistoryEntry(l)),r},add:function(n,t){if(ej.datavisualization.Diagram.Util.isPageEditable(this))return this._add(n,!0,t)},updateUserHandles:function(n){n=this.nameTable[n.name];ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,n,this._svg,!1,!1,this._currZoom)},scrollToNode:function(n){var u,f,i=this._currZoom,r=this.element[0].getBoundingClientRect(),t=ej.datavisualization.Diagram.Util.bounds(n),e,o;u=(t.x+t.width/2)*i;f=(t.y+t.height/2)*i;e=this._hScrollOffset;o=this._vScrollOffset;r.width+this._hScrollOffset<u+t.width/2&&(e=u+(t.width/2+20)*i-r.width);r.height+this._vScrollOffset<f+t.height/2&&(o=f+(t.height/2+20)*i-r.height);this._updateScrollOffset(e,o)},findNode:function(n){return this._findNode(n)},getObjectType:function(n){return n?n.segments?"connector":n._type==="node"||n.type=="bpmn"||n.type=="basic"||n.type=="flow"||n.type=="arrow"?"node":n.type==="text"||n.type==="image"||n.type==="native"||n.type==="html"?"node":n._type!="group"&&n.type=="pseudoGroup"?"pseudoGroup":n._type==="group"||n.isLane||n.isSwimlane?"group":n.isSwimlane?"swimlane":null:null},_registerDrawingTools:function(){var t,n;for(t in this.model.drawingTools)n=this.model.drawingTools[t],n.diagram=this,this.tools[n.name]=n},_sortByXvalue:function(n){for(var f,i,r,u,e,o,t=0;t<n.length;t++)for(i=t+1;i<n.length;i++)e=this.nameTable[n[t]],o=this.nameTable[n[i]],r=ej.datavisualization.Diagram.Util.bounds(e),u=ej.datavisualization.Diagram.Util.bounds(o),(r.x>u.x||r.right>u.right)&&(f=n[t],n[t]=n[i],n[i]=f);return n},_sortByYvalue:function(n){for(var f,i,r,u,e,o,t=0;t<n.length;t++)for(i=t+1;i<n.length;i++)e=this.nameTable[n[t]],o=this.nameTable[n[i]],r=ej.datavisualization.Diagram.Util.bounds(e),u=ej.datavisualization.Diagram.Util.bounds(o),(r.y>u.y||r.bottom>u.bottom)&&(f=n[t],n[t]=n[i],n[i]=f);return n},_sortByZIndex:function(n,t){var u,i,r;if(t)for(i=0;i<n.length;i++)for(r=i+1;r<n.length;r++)n[i].zOrder>n[r].zOrder&&(u=n[i],n[i]=n[r],n[r]=u);else for(i=0;i<n.length;i++)for(r=i+1;r<n.length;r++)n[i].zOrder<n[r].zOrder&&(u=n[i],n[i]=n[r],n[r]=u);return n},_findCornerNodes:function(){var i,r,u,f,e,n,s=this.selectionList[0].children,o=this.nameTable[this.selectionList[0].children[0]],t,h,c,l,a;if(i=o,r=o,u=o,f=o,s.length>1)for(e=0;e<s.length;e++)t=this.nameTable[s[e]],n=ej.datavisualization.Diagram.Util.bounds(t),h=ej.datavisualization.Diagram.Util.bounds(r),n.x+n.width>h.x+h.width&&(r=t),c=ej.datavisualization.Diagram.Util.bounds(f),n.y+n.height>c.y+c.height&&(f=t),l=ej.datavisualization.Diagram.Util.bounds(i),n.x<l.x&&(i=t),a=ej.datavisualization.Diagram.Util.bounds(u),n.y<a.y&&(u=t);return{left:i,right:r,top:u,bottom:f}},_moveNode:function(n,t,i){this._translate(i,n,t,this.nameTable);this._updateNodeMargin(i);ej.datavisualization.Diagram.DiagramContext.update(i,this)},_nudge:function(n,t,i){this.activateTool("move");this.activeTool.inAction=!0;this._translate(n,t,i,this.nameTable);this._updateNodeMargin(n);ej.datavisualization.Diagram.DiagramContext.update(n,this);this._updateSelectionHandle(!0)},_findObjectByName:function(n){var t=null;return this._findNode(n)&&(t=this._findNode(n)),this._findConnector(n)&&(t=this._findConnector(n)),t},_findObjectByIndex:function(n,t){var e,u=null,i,r,f,o;if(t){if(o=this.nameTable[this.selectionList[0].parent],o)for(e=this._getChildren(o.children),f=0;f<e.length;f++)i=this.nameTable[e[f]],i.zOrder===n&&(u=e[f])}else{for(r=0;r<this.nodes().length;r++)i=this.nodes()[r],i.zOrder===n&&(u=i);for(r=0;r<this.connectors().length;r++)i=this.connectors()[r],i.zOrder===n&&(u=i)}return typeof u=="string"?this.nameTable[u]:u},_findOverlapNode:function(n){var i=[],t,r,f=[],s,h,e,o,u;if(n.parent){if(e=this.nameTable[n.parent],e)for(u=this._getChildren(e.children),t=0;t<u.length;t++)u[t]!==n.name&&(o=this.nameTable[u[t]],o&&f.push(o))}else{for(t=0;t<this.nodes().length;t++)i.push(this.nodes()[t]);for(t=0;t<this.connectors().length;t++)i.push(this.connectors()[t]);if(s=ej.datavisualization.Diagram.Util.bounds(n),n)for(r=0;r<i.length;r++)h=ej.datavisualization.Diagram.Util.bounds(i[r]),n.name!==i[r].name&&this._intersect(s,h)&&f.push(i[r])}return f},_intersect:function(n,t){return n.x<=t.x+t.width&&t.x<=n.x+n.width&&n.y<=t.y+t.height&&t.y<=n.y+n.height},_createTooltipDiv:function(){var n=document.createElement("div"),t={id:this.element[0].id+"_tooltipDiv","class":"e-diagram-tooltip-default",style:"padding-top:3px; height: 24px;pointer-events:none;"};return ej.datavisualization.Diagram.Util.attr(n,t),this._canvas.appendChild(n),n},_renderTooltip:function(n){var t,u,r,f,i;n.parent&&this.nameTable[n.parent]&&this.nameTable[n.parent].container||this.showTooltip()&&$.templates&&(t=$("#"+this.element[0].id+"_tooltipDiv")[0],t||(t=this._createTooltipDiv()),i=this._currZoom,this.model.tooltipTemplateId?n.segments||(t.style.top=-this._vScrollOffset+(n.offsetY*i-n.height/2*i+n.height*i+15)+"px",t.style.left=-this._hScrollOffset+(n.offsetX*i-n.width/2*i)+(n.width/2*i-$(t).width()/2)+"px",u=$.templates("#"+this.model.tooltipTemplateId),r=[{name:this.activeTool.selectedObject.name,x:n.offsetX-n.width/2+"px",y:n.offsetY-n.height/2+"px",width:n.width+"px",height:n.height+"px",rotationAngle:n.rotateAngle}],f=u.render(r),$(t).html(f)):(u=$.templates("#"+this.element[0].id+"_defaultTooltip"),this.activeTool instanceof ej.datavisualization.Diagram.MoveTool?(t.style.width="150px",n.segments||(r=[{type:"X : ",type1:"Y : ",x:Math.round(n.offsetX-n.width/2)+"px  ",y:Math.round(n.offsetY-n.height/2)+"px"}])):this.activeTool instanceof ej.datavisualization.Diagram.ResizeTool?(t.style.width="150px",r=[{type:"W : ",type1:"H : ",x:Math.round(n.width)+"px  ",y:Math.round(n.height)+"px"}]):this.activeTool instanceof ej.datavisualization.Diagram.RotateTool&&(t.style.width="50px",r=[{type:"",type1:"",x:Math.round(n.rotateAngle)+"&deg; ",y:""}]),r?(t.style.top=-this._vScrollOffset+(n.offsetY*i-n.height/2*i+n.height*i+15)+"px",t.style.left=-this._hScrollOffset+(n.offsetX*i-n.width/2*i)+(n.width/2*i-$(t).width()/2)+"px",f=u.render(r),$(t).html(f)):this._removeTooltip()))},_removeTooltip:function(){var n=document.getElementById(this.element[0].id+"_tooltipDiv");n&&n.parentNode.removeChild(n)},_renderCanvas:function(n){this._browserInfo=ej.browserInfo();n||(this._canvas=document.createElement("div"),this.element.append(this._canvas));this._canvas.setAttribute("id",this.element[0].id+"_canvas");this._canvas.setAttribute("class","drawing");this._canvas.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";");this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width});this._views[this._id].canvas=this._canvas;this.element[0].setAttribute("tabindex",0);this._renderDiagram(n)},_getDigramBounds:function(n){var t,i,u,f,r;return t=this._spatialSearch.pageLeft||0,i=this._spatialSearch.pageTop||0,u=this._spatialSearch.pageRight-this._spatialSearch.pageLeft||0,f=this._spatialSearch.pageBottom-this._spatialSearch.pageTop||0,n!="content"&&(this.model.pageSettings&&this._multiplePage()?(t=this._spatialSearch.pageLeft,i=this._spatialSearch.pageTop,this._pageWidth()&&(t=Math.floor(t/this._pageWidth())*this._pageWidth(),u=Math.ceil(this._spatialSearch.pageRight/this._pageWidth())*this._pageWidth()-t),this._pageHeight()&&(i=Math.floor(i/this._pageHeight())*this._pageHeight(),f=Math.ceil(this._spatialSearch.pageBottom/this._pageHeight())*this._pageHeight()-i),this._spatialSearch.pageRight===null&&this._pageWidth()!==0&&(u=this._pageWidth()),this._spatialSearch.pageBottom===null&&this._pageHeight()!==0&&(f=this._pageHeight())):(this._pageWidth()&&(t=Math.min(0,this._spatialSearch.pageLeft),u=this._pageWidth()),this._pageHeight()&&(i=Math.min(0,this._spatialSearch.pageTop),f=this._pageHeight()))),r=new ej.datavisualization.Diagram.Rectangle,r.x=t,r.y=i,r.width=u,r.height=f,r},_initContextMenu:function(n){this.enableContextMenu()?this._renderContextMenu(n):$("#"+this.element[0].id+"_contextMenu").remove()},_renderContextMenuItem:function(n){var t=document.createElement("li"),f=document.createElement("a"),o=ej.datavisualization.Diagram.Locale[this.locale()],i,u,r,e;if($.each(o,function(t,i){n.name===t&&(f.innerHTML=i,n.text=i)}),t.setAttribute("id",this.element[0].id+"_contextMenu_"+n.name),t.setAttribute("style","display:none;"),i=document.createElement("span"),i.setAttribute("id",n.text+"_image"),i.setAttribute("style","display:table-cell; vertical-align:middle; text-align:center"),i.setAttribute("class","sf-d-menuitem "+n.name),f.appendChild(i),n.subItems&&n.subItems.length>0){for(u=document.createElement("ul"),r=0,r;r<n.subItems.length;r++)e=this._renderContextMenuItem(n.subItems[r],u),e.setAttribute("style","display:block;"),u.appendChild(e);t.appendChild(u)}return t.appendChild(f),t},_renderContextMenu:function(n){var i,f,r,t;if(!n&&!this.model.contextMenu.showCustomMenuItemsOnly){for(i=[],t=0;t<this._defaultContextMenuItems.length;t++)if(f=!1,this.model.contextMenu.items.length)for(r=0;r<this.model.contextMenu.items.length;r++){if(this.model.contextMenu.items[r].name===this._defaultContextMenuItems[t].name){f=!0;break}r!==this.model.contextMenu.items.length-1||f||i.push(this._defaultContextMenuItems[t])}else i.push(this._defaultContextMenuItems[t]);for(t=0;t<i.length;t++)this.model.contextMenu.items.push(i[t])}var e=this.model.contextMenu.items,t=0,o,s,u=document.createElement("ul");u.setAttribute("id",this.element[0].id+"_contextMenu");for(t in e)o=e[t],s=this._renderContextMenuItem(o,u),u.appendChild(s);this._canvas.appendChild(u);$("#"+this.element[0].id+"_contextMenu").ejMenu({menuType:ej.MenuType.ContextMenu,contextMenuTarget:"#"+this.element[0].id+"_canvas",click:$.proxy(this._onMenuItemClick,this),beforeOpen:$.proxy(this._onContextMenuOpen,this),mouseover:$.proxy(this._onMenuItemMouseOver,this),mouseout:$.proxy(this._onMenuItemMouseOut,this),close:$.proxy(this._onContextMenuClose,this)})},_onContextMenuClose:function(){this.element[0].focus()},_onContextMenuOpen:function(n){var t=this.element[0].id,i=this._findNodeUnderMouse(n),r=!1,u;$(n.target).parents(".e-scrollbar").length&&(n.cancel=!0,$("#"+this.element[0].id+"_contextMenu").ejMenu("instance")._hideContextMenu());this.selectionList[0]&&(this.selectionList[0].type==="pseudoGroup"||this.selectionList[0]._type==="group")&&(r=!0);i&&(this.selectionList.length<=0||this.selectionList[0]!=i)&&!r&&(n.cancel=!0,$("#"+this.element[0].id+"_contextMenu").ejMenu("instance")._hideContextMenu());!i&&this.selectionList.length>0&&!r&&this._clearSelection();this.enableContextMenu()&&($("#"+t+"_contextMenu_cut")[0]&&($("#"+t+"_contextMenu_cut")[0].style.display="block"),$("#"+t+"_contextMenu_copy")[0]&&($("#"+t+"_contextMenu_copy")[0].style.display="block"),$("#"+t+"_contextMenu_paste")[0]&&($("#"+t+"_contextMenu_paste")[0].style.display="block"),$("#"+t+"_contextMenu_undo")[0]&&($("#"+t+"_contextMenu_undo")[0].style.display="block"),$("#"+t+"_contextMenu_redo")[0]&&($("#"+t+"_contextMenu_redo")[0].style.display="block"),$("#"+t+"_contextMenu_selectAll")[0]&&($("#"+t+"_contextMenu_selectAll")[0].style.display="block"),$("#"+t+"_contextMenu_cut")[0]&&($("#"+t+"_contextMenu_cut")[0].style.display="block"),$("#"+t+"_contextMenu_grouping")[0]&&($("#"+t+"_contextMenu_grouping")[0].style.display="block"),$("#"+t+"_contextMenu_order")[0]&&($("#"+t+"_contextMenu_order")[0].style.display="block"),this.selectionList.length==0&&($("#"+t+"_contextMenu_cut")[0]&&($("#"+t+"_contextMenu_cut")[0].style.display="none"),$("#"+t+"_contextMenu_copy")[0]&&($("#"+t+"_contextMenu_copy")[0].style.display="none"),$("#"+t+"_contextMenu_cut")[0]&&($("#"+t+"_contextMenu_cut")[0].style.display="none"),$("#"+t+"_contextMenu_grouping")[0]&&($("#"+t+"_contextMenu_grouping")[0].style.display="none"),$("#"+t+"_contextMenu_order")[0]&&($("#"+t+"_contextMenu_order")[0].style.display="none")),$("#"+t+"_contextMenu_paste")[0]&&($("#"+t+"_contextMenu_paste")[0].style.display=this._clipboardData?"block":"none"));u={diagram:this,contextmenu:n};this._trigger("contextMenuBeforeOpen",u)},_onMenuItemClick:function(n){var t=n.events.ID.replace(this._id+"_contextMenu_","");switch(t){case"cut":this.cut();break;case"copy":this.copy();break;case"paste":this.paste();break;case"undo":this.undo();break;case"redo":this.redo();break;case"selectAll":this.selectAll();break;case"group":this.group();break;case"ungroup":this.ungroup();break;case"bringToFront":this.bringToFront();break;case"sendToBack":this.sendToBack();break;case"moveForward":this.moveForward();break;case"sendBackward":this.sendBackward()}this._trigger("contextMenuClick",n)},_onMenuItemMouseOver:function(n){var t=n.events.element.lastChild.childNodes[1];$(t).addClass("hover")},_onMenuItemMouseOut:function(n){var t=n.events.element.lastChild.childNodes[1];$(t).removeClass("hover")},_renderDiagram:function(n){var t=this;this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);this._views.forEach(function(i){var r=t._views[i];r.context._renderDocument(r,t,n);r.type=="mainview"&&r.context==ej.datavisualization.Diagram.SvgContext&&(t._createScrollbar(t._canvas),ej.datavisualization.Diagram.ScrollUtil._initScrollbar(t),ej.datavisualization.Diagram.PageUtil._updatePageSize(t));n||(t._setNodeZOrder(r),t._renderNodes(r),t._renderConnectors(r),t._renderphases(r))});$(this._svg.document).pinchDiagram(this._view,this)},_createScrollbar:function(n){var i=document.createElement("div"),t;i.setAttribute("id",n.id+"_hScrollbar");n.appendChild(i);t=document.createElement("div");t.setAttribute("id",n.id+"_vScrollbar");n.appendChild(t)},_doLayout:function(){this.model.layout&&this.model.layout.type!==ej.datavisualization.Diagram.LayoutTypes.None&&(this._updateEdgeCollection(),ej.datavisualization.Diagram.Layout.doLayout(this))},_updateNodes:function(){for(var t=this.nodes(),n=0;n<t.length;n++)ej.datavisualization.Diagram.DiagramContext.update(t[n],this)},_updateConnectors:function(){for(var t=this.connectors(),n=0;n<t.length;n++)ej.datavisualization.Diagram.DiagramContext.update(t[n],this)},_updateEdgeCollection:function(){for(var n=0;n<this.connectors().length;n++)this._updateEdges(this.connectors()[n])},updateViewPort:function(){this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);ej.datavisualization.Diagram.DiagramContext.updateViewPort(this)},_containsSameIndex:function(n,t){var u,f,e,r,i;if(t){for(e=t.children,i=0;i<e.length;i++)if(r=this.nameTable[this._getChild(e[i])],r&&r.zOrder&&r.zOrder===n)return!0}else for(u=this.nodes(),i=0;i<u.length>0;i++)if(f=u[i],f&&f.zOrder===n)return!0;return!1},_setZorder:function(n){var u,i,t,r;if(n&&n.zOrder){if(n.zOrder==-1)if(this._containsSameIndex(this._zOrder)){do this._zOrder++;while(this._containsSameIndex(this._zOrder));n.zOrder=this._zOrder}else n.zOrder=this._zOrder,this._zOrder++;if(n._type==="group")for(u=n.children,t=0;t<u.length;t++)if(i=this.nameTable[this._getChild(u[t])],i&&i.zOrder&&i.zOrder===-1)if(r=t,this._containsSameIndex(t,n)){do r++;while(this._containsSameIndex(r));i.zOrder=r}else i.zOrder=t}},_union:function(n,t){var i=Math.min(n.x,t.x),r=Math.min(n.y,t.y),u=Math.max(n.x+n.width,t.x+t.width),f=Math.max(n.y+n.height,t.y+t.height);return new ej.datavisualization.Diagram.Rectangle(i,r,u-i,f-r)},_getSeperetor:function(n){return this.nameTable[n]},_updatePhase:function(n){var u,t,r,i;n&&n.phases&&n.phases.length>0&&(u=n.phases.length,t=this.nameTable[n.phases[u-1]],t&&(n.orientation=="vertical"?(r=n.height-t.offset,t.offset=n.height,i=this.nameTable["phaseStack"+t.name],i&&this.updateNode(i.name,{height:i.height+r,offsetY:i.offsetY+r/2})):t.offset=n.width))},_renderphases:function(){var t=this.model.phases,n,i;if(t)for(n=0,i=t.length;n<i;n++)t[n].type=="phase"&&ej.datavisualization.Diagram.SvgContext.renderphase(t[n],this._svg,this._diagramLayer,this)},_setNodeZOrder:function(){var o=null,s,h,n,e,t,r,i,u,f;if(this.nodes()){for(n=this.nodes(),e=0;e<n.length;e++)n[e].parent===""&&this._setZorder(n[e]);for(t=0;t<n.length;t++){for(r=t+1;r<n.length;r++)n[t].zOrder>n[r].zOrder&&n[t].parent===""&&n[r].parent===""&&(s=n[r].zOrder,h=n[t].zOrder,o=n[t],n[t]=n[r],n[r]=o);if(n[t]._type==="group")for(i=n[t].children,u=0;u<i.length;u++)for(f=u+1;f<i.length;f++)i[u].zOrder>i[f].zOrder&&(s=i[f].zOrder,h=i[u].zOrder,o=i[u],i[u]=i[f],i[f]=o)}}},_renderNodes:function(n,t,i){var f,u,o,r,e;if(this.nodes())for(f=this.nodes(),u=0,o=f.length;u<o;++u)r=this.nameTable[f[u].name],e=n.svg||n._canvas,r._type!=="group"||r.parent?r.parent||n.context.renderNode(r,e,n.diagramLayer,this):(r.container||ej.datavisualization.Diagram.Util._updateGroupBounds(r,this,!0),n.context.renderGroup(r,e,n.diagramLayer,this.nameTable,this,t,i),ej.datavisualization.Diagram.Util._updateGroupBounds(r,this),ej.datavisualization.Diagram.DiagramContext.update(r,this))},_renderConnectors:function(n){var r,f,t,i,u,e;if(this.connectors()){for(r=this.connectors(),f=n.svg||n._canvas,i=0,u=r.length;i<u;++i)t=r[i],this._setZorder(t);for(i=0,u=r.length;i<u;++i)t=r[i],ej.datavisualization.Diagram.Util.updateBridging(t,this),t.parent&&t.parent!=""?(e=this._svg.document.getElementById(t.parent),e&&n.context.renderConnector(t,f,e,this)):n.context.renderConnector(t,f,n.diagramLayer,this)}},_wireEvents:function(){var n=$(this._canvas),t;this._on(n,ej.eventType.mouseDown,this._mousedown);this._on(n,ej.eventType.mouseMove,this._mousemove);this._on(n,ej.eventType.mouseUp,this._mouseup);this._on(n,ej.eventType.mouseLeave,this._documentmouseup);this._on(n,"dblclick",this._doubleclick);this._on(n,"doubletap",this._doubleclick);this._on(this.element,"keydown",this._keydown);this._on(this.element,"keyup",this._keyup);this._on(n,"pinchin",this._pinchin);this._on(n,"pinchout",this._pinchout);this._on(this.element,"touchstart",this._handleTouchStart);ej.browserInfo().name==="mozilla"?this._on(this.element,"DOMMouseScroll",this._handleMouseWheel):this._on(this.element,"mousewheel",this._handleMouseWheel);this._on($(document),"mouseup",this._documentmouseup);window&&this._on($(window),"resize",this.updateViewPort);t=this;$(n).ejDroppable({drop:function(n,i){t._svgdrop(n,i);t._isDropped=!0}})},_mousePosition:function(n,t){var u=this._isTouchEvent(n),e=this._scrollLeft!==undefined?this._scrollLeft:this._canvas.scrollLeft,o=this._scrollTop!==undefined?this._scrollTop:this._canvas.scrollTop,f=this._controlBBox?this._controlBBox:this._canvas.getBoundingClientRect(),i=u.clientX+e-f.left,r=o+u.clientY-f.top;return t||(i=(i+this._hScrollOffset)/this._currZoom,r=(r+this._vScrollOffset)/this._currZoom),new ej.datavisualization.Diagram.Point(Math.round(i*100)/100,Math.round(r*100)/100)},_contextmenu:function(n){n.preventDefault();n.stopPropagation()},_pinchin:function(n){n.preventDefault()},_pinchout:function(n){n.preventDefault()},_handleTouchStart:function(n){n.preventDefault()},_mousedown:function(n){if(this._isPinching=!1,this._invoke(n)&&(this._scrollLeft=this._canvas.scrollLeft,this._scrollTop=this._canvas.scrollTop,this._controlBBox=this._canvas.getBoundingClientRect(),this._isForeignObject(n.originalEvent.target)||n.preventDefault(),this.model.contextMenu&&$("#"+this.element[0].id+"_contextMenu").css("display")!=="none"&&(n.cancel=!0),this._isEditing&&this._endEdit(),n.which===1||n.which===3||n.which===0&&n.originalEvent.changedTouches)){if(n.which===0&&n.originalEvent.changedTouches){var t=null,i=this._isUserHandle(n);this._isInternalTool(this.activeTool)&&!this.activeTool.inAction&&(i||(t=this._findNodeUnderMouse(n),this._raiseMouseEvents(t)),!t&&this.selectionList[0]&&(t=this.selectionList[0]),this._checkToolToActivate(n,t))}(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&n.shiftKey&&(t=this._findNodeUnderMouse(n),!t&&this.selectionList[0]&&(t=this.selectionList[0]),this._checkToolToActivate(n,t));this._toolToActivate==="panTool"?this.activeTool=this.tools[this._toolToActivate]:this.activateTool(this._toolToActivate);this.activeTool.mousedown(n)}},_invoke:function(n){var t=n.originalEvent.target.className;return n.originalEvent.target&&(t=="edit"||t=="editBox"||t=="e-hhandle"||t=="e-hhandlespace"||t=="e-vhandle"||t=="e-vhandlespace")?!1:!0},_handleMouseWheel:function(n){var i,t,r,u,f;n.originalEvent.preventDefault&&n.originalEvent.preventDefault();i=new ej.datavisualization.Diagram.Point(0,0);(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)?(i=this._mousePosition(n.originalEvent),n.originalEvent.wheelDelta>0||-40*n.originalEvent.detail>0?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+Number(this.zoomFactor()),0,0,i,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+Number(this.zoomFactor())),0,0,i,!0)):(t=0,n.originalEvent.wheelDelta>0||-40*n.originalEvent.detail>0?(r=this._vScrollbar.model.minimum,this._vScrollOffset-this._scrollPixel>=r||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset-this._scrollPixel),t=-this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,r),t=0)):(u=this._vScrollbar.model.maximum,f=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),u>=this._vScrollOffset+this._scrollPixel||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset+this._scrollPixel),t=this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,u),t=0)),this._updateEditBox(0,t))},_mousemove:function(n){var p,t,d,e,b,u,f,y,i;if(n.type=="touchmove"&&n.originalEvent.touches.length>1)this._isPinching=!0;else if(this._isPinching=!1,i=null,p=this._isUserHandle(n),this.activeTool.inAction===!1&&this._selectedSymbol){var r=this._currZoom,w=$("#"+this.element[0].id).offset(),h=this._isTouchEvent(n),c,l;h?(c=h.pageX,l=h.pageY):(c=n.pageX,l=n.pageY);var a=c+this._hScrollOffset-w.left,v=l+this._vScrollOffset-w.top,t=$.extend(!0,{},this._selectedSymbol);this._selectedSymbol&&(t=$.extend(!0,{},this._selectedSymbol),t.name+=ej.datavisualization.Diagram.Util.randomId(),t.segments?(ej.datavisualization.Diagram.Util._translateLine(t,a/r,v/r),e={element:t},e.cancel||this.add(t)):(d=this._palNameTable,e={element:t},e.cancel||(b=ej.datavisualization.Diagram.Util.randomId(),this._cloneGroupNode(t,b),t._type==="group"&&t.type!="bpmn"?(u=ej.datavisualization.Diagram.Util._getChildrenBounds(t,this),ej.datavisualization.Diagram.Util._translate(t,a/r-u.x-u.height/2,v/r-u.y-u.width/2,this.nameTable,this)):(t.offsetX=a/r,t.offsetY=v/r),t.isLane?(f=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(t,this.nameTable),f.isLane=t.isLane,f.orientation=t.orientation,this.add(f),ej.datavisualization.Diagram.SvgContext._hideNode(f,this._svg)):this.add(t))),this.element[0].focus(),this._toolToActivate="move",this.activateTool("move"),y=document.getElementsByClassName("dragClone")[0],y&&(y.style.display="none"),this.activateTool("move",!0),this._scrollLeft=this._canvas.scrollLeft,this._scrollTop=this._canvas.scrollTop,this._controlBBox=this._canvas.getBoundingClientRect(),this.activeTool.mousedown(n),this.activeTool.mousemove(n))}else if(this._isInternalTool(this.activeTool)&&!this.activeTool.inAction?(p||(i=this._findNodeUnderMouse(n),i&&(this._nodeToHit&&this._nodeToHit!=i&&!this._nodeToHit.segments&&this.activeTool._showPort(this._nodeToHit,!0),i.segments||this.activeTool._showPort(i)),this._raiseMouseEvents(i)),!i&&this.selectionList[0]&&(i=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(n,i)):(this.activeTool.inAction||(this._toolToActivate=this.activeTool.name,this._currentCursor=this.activeTool.cursor),i=this._findNodeUnderMouse(n),i&&this._raiseMouseEvents(i)),this._updateCursor(),this.activeTool.mousemove(n),this.activeTool.inAction&&this.enableAutoScroll()){var k=this._viewPort,o=this._mousePosition(n,!0),s=this.model.pageSettings.autoScrollBorder;o.x+s.right>=k.width-18?(this._beginAutoScroll("right",n),this._canAutoScroll=!0):o.x<=s.left?(this._beginAutoScroll("left",n),this._canAutoScroll=!0):o.y+s.bottom>=k.height-18?(this._beginAutoScroll("bottom",n),this._canAutoScroll=!0):o.y<=s.top?(this._beginAutoScroll("top",n),this._canAutoScroll=!0):this._canAutoScroll=!1}},_cloneGroupNode:function(n,t,i){var r=null,u,e=n.children=this._getChildren(n.children),f;if(n._type==="group")for(f=0;f<e.length;f++)i?r=i[e[f]]:this._paletteTable&&(r=this._paletteTable[e[f]]),r&&(r=$.extend(!0,{},r),r._type==="group"&&this._cloneGroupNode(r,t),u=$.extend(!0,{},r),u.name+=t,u.parent=n.name,e[f]=u.name,this.nameTable[u.name]=u)},_setActiveTool:function(n){var u=this._mousePosition(n),t,i,r;this.activeTool.inAction||!this._isUserHandleActive(this.activeTool.name)&&this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length||(this._isInternalTool(this.activeTool)||this.activeTool.singleAction)&&(i=!1,this.selectionList[0]&&(t=this.selectionList[0],i=this._checkToolToActivate(n,t)),i||(t=this._findNodeUnderMouse(n),this._isUserHandle(n)?(r=$(n.target).parents("g").first().context.id.split("_")[0],this._checkToolToActivate(n,t),this.activeTool=this.tools[this._toolToActivate]):(this._checkToolToActivate(n,t),this._raiseMouseEvents(t),this._isUserHandleActive(this.activateTool.name)&&!this._drawingTool&&(this.activeTool=this.tools[this._toolToActivate]))))},_beginAutoScroll:function(n,t){var f=100,e=this,r=0,u=0,i=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),o=this._hScrollbar.model.maximum+i.width,s=this._vScrollbar.model.maximum+i.height;if(this._canAutoScroll){switch(n){case"right":(this._hScrollOffset+i.width+10<o||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(r=10);break;case"left":(this._hScrollOffset-10>this._hScrollbar.model.minimum||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(r=-10);break;case"bottom":(this._vScrollOffset+i.height+10<s||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(u=10);break;case"top":(this._vScrollOffset-10>this._vScrollbar.model.minimum||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(u=-10)}setTimeout(function(){e._raiseEvent("autoScrollChange",{delay:f});e._updateScrollBar(r,u,n,t)},f)}},_updateScrollBar:function(n,t,i,r){if(n===0&&t===0)this._canAutoScroll=!1;else if(this.activeTool.inAction){var u=this._hScrollOffset+n*this._currZoom,f=this._vScrollOffset+t*this._currZoom;this._updateSelectionOnScroll(n,t);this._updateScrollOffset(u,f);this._beginAutoScroll(i,r)}},_updateSelectionOnScroll:function(n,t){var i=this.activeTool,r,u,f,e;i.name==="select"?(i.currentPoint=new ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i._updateHelper()):i.name==="orthogonalLine"||i.name==="straightLine"?(i.currentPoint=new ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i._targetPossibleConnection=i._currentPossibleConnection,i._targetPort=i._possibleConnectionPort,i._updateHelper()):this.selectionList.length>0&&(r=this.selectionList[0],i.currentPoint=ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i.name==="move"?i._canMoveLabel?this._translateLabel(r,i.activeLabel,n,t):this._translate(r,n,t,this.nameTable):i.name==="resize"?(ej.datavisualization.Diagram.SnapUtil._removeGuidelines(this),i._updateSize(r,i.previousPoint,i.currentPoint)):i.name==="endPoint"&&(i.selectedSegment&&i._endPoint=="segmentEnd"?(u=i.currentPoint.x-i.previousPoint.x,f=i.currentPoint.y-i.previousPoint.y,i._updateAdjacentSegments(u,f)):(e=i._updatePoints(r),i._disconnect(r),i._updateConnection(r,e))),i.previousPoint=ej.datavisualization.Diagram.Point(i.currentPoint.x,i.currentPoint.y),i._canMoveLabel||(ej.datavisualization.Diagram.DiagramContext.update(r,this),this._updateSelectionHandle(),this._renderTooltip(r)))},_isUserHandle:function(n){return n.target.parentNode.className.animVal==="userHandle"?!0:!1},_isUserHandleActive:function(n){var i=!1,t,r;if(this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length>0)for(t=0,r=this.model.selectedItems.userHandles.length,t;t<r;t++)if(this.model.selectedItems.userHandles[t].name===n){i=!0;break}else i=!0;return i},_raiseMouseEvents:function(n){!n&&this._nodeToHit&&(this._raiseEvent("mouseLeave",{element:this.getNode(this._nodeToHit)}),this._nodeToHit==null||this._nodeToHit.segments||this.activeTool instanceof ej.datavisualization.Diagram.LineTool||this.activeTool._showPort(this._nodeToHit,!0));n?this._nodeToHit!==n&&(this._nodeToHit=n,this._raiseEvent("mouseEnter",{element:this.getNode(n)})):this._nodeToHit=null;n&&this._raiseEvent("mouseOver",{element:this.getNode(n)})},_isHandle:function(n){var t=$(n.target).parent("g.handle");return t.length>0?!0:!1},_findNodeUnderMouse:function(n){var t=null,r,i,u;if(n.target){if(i=$(n.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),u=n.target.id.split("_"),u[u.length-1]=="lblbg")return;i&&(r=i.attr("class"),r==="ej-d-node"||r==="ej-d-group"?(t=this._findNode(i.attr("id")),t&&t.parent&&this.nameTable[t.parent]&&this.nameTable[t.parent].type=="bpmn"&&(t=this.nameTable[t.parent])):r==="ej-d-connector"&&(t=this._findConnector(i.attr("id"))))}return t},_findConnectableNodeUnderMouse:function(n){for(var i=null,f,r=$(n.target).parents(".ej-d-node,.ej-d-group"),t=r[0],u=1;t;)f=t.getAttribute("class"),i=this._findNode(t.getAttribute("id")),ej.datavisualization.Diagram.Util.canConnect(i)||!i.parent?t=null:(t=r[u],u++);return i},_isForeignObject:function(n){var t=n.parentNode;if(t)while(t.parentNode!=null){if(t.className==="foreignObject")return t;t=t.parentNode}return null},_mouseup:function(n){var u,i,t,r,f;this._isPinching||this._invoke(n)&&(u=this._isForeignObject(n.originalEvent.target),u||n.preventDefault(),n.target.id===this._id+"_canvas_svg"&&this._raiseEvent("click",{element:this}),this.activeTool.mouseup(n),this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(document.onmousemove=null,document.onmouseup=null),this._selectedSymbol&&(i={element:this.getNode(this.selectionList[0]),cancel:!1},this._raiseDropEvent(i),i.cancel?this._remove(i.element):(t=this.selectionList[0],t&&(this.scrollToNode(t),t.labels.length>0&&t.labels[0].mode==="edit"&&!t.labels[0].readOnly?t.isPhase||t.isSwimlane||t.isLane||(this._isEditing=!0,this.startLabelEdit(t,t.labels[0])):this.element[0].focus(),this._raiseEvent("selectionChange",i))),r={},this.selectionList&&this.selectionList.length>0&&(r=this._getChildTable(this.selectionList[0],r)),f={type:"collectionchanged",object:jQuery.extend(!0,{},t),childTable:jQuery.extend(!0,{},r),changeType:"insert"},this.addHistoryEntry(f),this._selectedSymbol=null),this.activeTool instanceof ej.datavisualization.Diagram.TextTool||!document.activeElement||document.activeElement.id===this.element[0].id||this._isEditing||u||this.element[0].focus(),this._currentCursor=this.activeTool.cursor,this._updateCursor());delete this._scrollLeft;delete this._scrollTop;delete this._controlBBox},_doubleclick:function(){var t,n;this.activeTool.name!="panTool"&&(t={element:this.getNode(this._nodeToHit),cancel:!1,actualObject:this.getNode(this.activeTool.actualObject)},this._isEditing||this._raiseEvent("doubleClick",t),this._nodeToHit&&this.activeTool._doubleClick(this._nodeToHit),this.activeTool.inAction||!(this.selectionList.length>0||this.activeTool.selectedObject)||t.cancel||(n=this.activeTool.selectedObject?this.activeTool.selectedObject:this.selectionList[0],this._isEditing||n.type=="pseudoGroup"||t.cancel||(!this._isEditing&&n.type==="text"&&this._setLabelEditing(n.textBlock)?(this.scrollToNode(n),this._startEdit(n)):!this._isEditing&&(n.labels&&(n.labels.length===0||typeof n.labels.length=="undefined")||n.labels&&n.labels.length>0&&this._setLabelEditing(n.labels[0]))&&(this.scrollToNode(n),this._startEdit(n)))))},_keydown:function(n){var t=n.keyCode?n.keyCode:n.which,i;t===113?this.selectionList.length>0&&(i=this.selectionList[0],i.type=="pseudoGroup"||(i.type==="text"&&this._setLabelEditing(i.textBlock)?this._startEdit(i):i.labels.length>0&&this._setLabelEditing(i.labels[0])&&this._startEdit(i))):this._isEditing&&t===27?this._endEdit():!this._isEditing&&(t===46||navigator.platform.match("Mac")&&t===8)?this._delete():!this._isEditing&&(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&t===88?this.cut():!this._isEditing&&(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&t===67?this.copy():!this._isEditing&&(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&t===86?this.paste():(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&t===65?(this._isEditing&&this._endEdit(),n.preventDefault(),this.selectAll()):!this._isEditing&&(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&t===89?this.redo():!this._isEditing&&(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&t===90&&this.undo();this._isEditing||t!==37&&t!==38&&t!==39&&t!==40||(n.preventDefault(),t===37?n.shiftKey?this.nudge("left",5):this.nudge("left"):t===38?n.shiftKey?this.nudge("up",5):this.nudge("up"):t===39?n.shiftKey?this.nudge("right",5):this.nudge("right"):t===40&&(n.shiftKey?this.nudge("down",5):this.nudge("down")));this.activeTool.keydown(n)},_keyup:function(n){var t=n.keyCode?n.keyCode:n.which;this._isEditing||t!==37&&t!==38&&t!==39&&t!==40||(n.preventDefault(),this.activeTool.inAction=!1,this._updateSelectionHandle())},_registerHistoryEvents:function(){this.historyManager.addEventHandler("collectionchanged",$.proxy(this._recordCollectionChanged,this));this.historyManager.addEventHandler("positionchanged",$.proxy(this._recordPinPointChanged,this));this.historyManager.addEventHandler("sizechanged",$.proxy(this._recordResizeChanged,this));this.historyManager.addEventHandler("rotationchanged",$.proxy(this._recordRotationChanged,this));this.historyManager.addEventHandler("endpointchanged",$.proxy(this._recordEndPointChanged,this));this.historyManager.addEventHandler("labelchanged",$.proxy(this._recordLabelChanged,this));this.historyManager.addEventHandler("groupingchanged",$.proxy(this._recordGroupChanged,this))},_updatePoints:function(n,t,i,r){var u=new ej.datavisualization.Diagram.Point(i.x-t.x,i.y-t.y);ej.datavisualization.Diagram.Geometry.isEmptyPoint(u)||n._updateEndPoint(u.x,u.y,r)},_recordCollectionChanged:function(n){var o,f,i,u,r,s,t,e;if(this._clearSelection(),this._isUndo=!0,this._isInsert=!0,o=n.changeType,n.isUndo&&(o=n.changeType=="insert"?"remove":"insert"),o=="insert")if(n.object.container){if(!n.object.container){for(t in n.childTable)s=n.childTable[t],this.nameTable[t]=s;i=n.object;i.isSwimlane?(i.width=0,i.height=0,this.add(i)):i.isLane&&(e=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(i,this),e&&(e.width=0,e.height=0,this.add(e)))}}else if(n.object.type!="pseudoGroup"){if(!n.object.segments){if(f=null,n.object.inEdges.length>0)for(t=0;t<n.object.inEdges.length;t++)this.nameTable[n.object.inEdges[t]]&&(this.nameTable[n.object.inEdges[t]].targetNode=n.object.name),f=n.targetPorts[n.object.inEdges[t]],f&&this.nameTable[n.object.inEdges[t]]&&(this.nameTable[n.object.inEdges[t]].targetPort=f);if(n.object.outEdges.length>0)for(t=0;t<n.object.outEdges.length;t++)this.nameTable[n.object.outEdges[t]]&&(this.nameTable[n.object.outEdges[t]].sourceNode=n.object.name),f=n.sourcePorts[n.object.outEdges[t]],f&&this.nameTable[n.object.outEdges[t]]&&(this.nameTable[n.object.outEdges[t]].sourcePort=f)}n.object._type==="group"&&this._addChildren(n.object,n.childTable);this.add(n.object,n);n.object._type==="group"?(this._addConnector(n.object,n),this._addGroupConnector(n.object,n)):this._addConnector(n.object,n);this._clearSelection();this.addSelection(this.nameTable[n.object.name])}else{for(delete this.nameTable.multipleSelection,r=ej.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup"}),t=0;t<n.object.children.length;t++)r.children.push(n.object.children[t]),i=n.childTable[n.object.children[t]],i.parent="",i._type==="group"&&this._addChildren(i,n.childTable),this.add(n.childTable[n.object.children[t]],n);for(this._addGroupConnector(n.object,n),t=0;t<r.children.length;t++)if(i=this.nameTable[r.children[t]],!i.segments){if(i.inEdges.length>0)for(u=0;u<i.inEdges.length;u++)this.nameTable[i.inEdges[u]].targetNode=i.name;if(i.outEdges.length>0)for(u=0;u<i.outEdges.length;u++)this.nameTable[i.outEdges[u]].sourceNode=i.name}this._clearSelection();this.nodes().push(r);r.offsetX=n.object.offsetX;r.offsetY=n.object.offsetY;r.height=n.object.height;r.width=n.object.width;r.rotateAngle=n.object.rotateAngle;this.nameTable[r.name]=r;this.addSelection(r)}else if(o=="remove")if(n.object.type!="pseudoGroup")this._remove(n.object);else for(t=0;t<n.object.children.length;t++)this._remove(this.nameTable[n.object.children[t]]);this._isUndo=!1;this._isInsert=!1},_addGroupConnector:function(n,t){var r,f,e,i,o,s,u;if(!n.segments)for(s=this._getChildren(n.children),e=0;e<s.length;e++){if(u=this.nameTable[s[e]],u.inEdges&&u.inEdges.length>0)for(r=u.inEdges,i=0,o=r.length;i<o;i++)f=t.edgeTable?t.edgeTable[r[i]]:t.childTable[r[i]],f&&this.add(f);if(u.outEdges&&u.outEdges.length>0)for(r=u.outEdges,i=0,o=r.length;i<o;i++)f=t.edgeTable?t.edgeTable[r[i]]:t.childTable[r[i]],f&&this.add(f)}},_addConnector:function(n,t){var r,u,i,f;if(!n.segments){if(n.inEdges&&n.inEdges.length>0)for(r=n.inEdges,i=0,f=r.length;i<f;i++)u=t.edgeTable[r[i]],this.add(u);if(n.outEdges&&n.outEdges.length>0)for(r=n.outEdges,i=0,f=r.length;i<f;i++)u=t.edgeTable[r[i]],this.add(u)}},_addChildren:function(n,t){for(var r,u=this._getChildren(n.children),i=0;i<u.length;i++)r=t[u[i]],r._type==="group"?this._addChildren(r,t):this.nameTable[u[i]]=r},_updateRecordPinPoint:function(n,t,i){var r,o,u,h,s,c,l,f,e;if(n.type=="pseudoGroup"){for(s=n,c=this._getChildren(n.children),o=0;o<c.length;o++)u=this.nameTable[c[o]],h=t[c[o]],h&&(u.segments?(l=t[u.name],u.sourcePoint=l.sourcePoint,u.targetPoint=l.targetPoint,u.segments=l.segments):this._translate(u,h.offsetX-u.offsetX,h.offsetY-u.offsetY,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(u,this));this.selectionList[0]&&this.selectionList[0].name===s.name&&(this.selectionList[0].offsetX=s.offsetX,this.selectionList[0].offsetY=s.offsetY);ej.datavisualization.Diagram.SvgContext.updateSelector(s,this._svg,this._currZoom,this,this.model.selectedItems.constraints)}else n.segments?i?(r=t[n.name],n.sourcePoint=r.sourcePoint,n.targetPoint=r.targetPoint,n.segments=r.segments,ej.datavisualization.Diagram.DiagramContext.update(n,this)):(this._clearSelection(),r=this._findConnector(n.name),n.targetNode&&(f=this.nameTable[n.targetNode],ej.datavisualization.Diagram.Util.removeItem(f.inEdges,n)),n.sourceNode&&(f=this.nameTable[n.sourceNode],ej.datavisualization.Diagram.Util.removeItem(f.outEdges,n)),n.targetNode&&(f=this.nameTable[n.targetNode],f.inEdges.push(n.name)),n.sourceNode&&(f=this.nameTable[n.sourceNode],f.outEdges.push(n.name)),r.targetNode=n.targetNode,r.sourceNode=n.sourceNode,r.targetPort=n.targetPort,r.sourcePort=n.sourcePort,r.sourcePoint=n.sourcePoint,r.targetPoint=n.targetPoint,r.segments=n.segments,this._updateLabels(r,n.labels),ej.datavisualization.Diagram.DiagramContext.update(r,this),ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._svg,this._currZoom,this,this.model.selectedItems.constraints),this.addSelection(n)):i?(r=t[n.name],this._translate(n,r.offsetX-n.offsetX,r.offsetY-n.offsetY,t),ej.datavisualization.Diagram.DiagramContext.update(r,this)):(this._clearSelection(),r=this._findNode(n.name),this._translate(r,n.offsetX-r.offsetX,n.offsetY-r.offsetY,this.nameTable),this._updateLabels(r,n.labels),n.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[r.parent],this),r.parent&&(e=this.nameTable[r.parent],e&&e.container&&(e.container.type=="canvas"?ej.datavisualization.Diagram.SvgContext._alignOnCanvas1(e,this):e.container.type=="stack"&&ej.datavisualization.Diagram.SvgContext._alignOnStack(e,this))),ej.datavisualization.Diagram.DiagramContext.update(r,this),this.addSelection(r))},_updateLabels:function(n,t){n.labels=t;for(var i=0;i<n.labels.length;i++)ej.datavisualization.Diagram.DiagramContext.updateLabel(n,n.labels[i],this)},_recordPinPointChanged:function(n){var t=n.object.node,i=n.object.childTable;t.container||this._updateRecordPinPoint(t,i)},_updateRecordRotation:function(n,t){var r,f,i,e,o,s,h,u;if(n.type=="pseudoGroup"){for(r=this.nameTable[n.name],o=n.children,f=0;f<o.length;f++)i=this.nameTable[o[f]],e=t[o[f]],i&&(i.segments?(s=t[i.name],i.sourcePoint=s.sourcePoint,i.targetPoint=s.targetPoint,i.segments=s.segments):e&&(this._translate(i,e.offsetX-i.offsetX,e.offsetY-i.offsetY,this.nameTable),this._rotate(i,e.rotateAngle-i.rotateAngle,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(i,this));r&&(h=n.rotateAngle-r.rotateAngle,r.rotateAngle+=h,this.selectionList[0]&&(this.selectionList[0].rotateAngle=r.rotateAngle));ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._svg,this._currZoom,this,this.model.selectedItems.constraints)}else u=null,n.parent&&(u=this.nameTable[n.parent]),u&&u.container?u.container.type=="canvas"?ej.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this):u.container.type=="stack"&&ej.datavisualization.Diagram.SvgContext._alignOnStack(u,this):n&&(this._clearSelection(),r=this._findNode(n.name),this._rotate(r,n.rotateAngle-r.rotateAngle,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this),this.addSelection(r))},_recordSizeChanged:function(n){var t=n.object.node,i=n.object.childTable;t.container||this._updateRecordSize(t,i)},_updateRecordSize:function(n,t){var i,e,f,h,s,r,o,u;if(n._type==="group"||n.type==="pseudoGroup"){for(n.type=="pseudoGroup"&&(this.nameTable[n.name]=n),i=this._findNode(n.name),h=this._getChildren(i.children),s=this._getChildren(n.children),e=0;e<h.length;e++)r=this.nameTable[s[e]],f=t[s[e]],f&&(r.segments?(o=t[r.name],r.sourcePoint=o.sourcePoint,r.targetPoint=o.targetPoint,r.segments=o.segments,ej.datavisualization.Diagram.DiagramContext.update(r,this)):(this._translate(r,f.offsetX-r.offsetX,f.offsetY-r.offsetY,this.nameTable),this.scale(r,f.width/r.width,f.height/r.height,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this)));i.offsetX=n.offsetX;i.offsetY=n.offsetY;i.width=n.width;i.height=n.height;ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._svg,this._currZoom,this,this.model.selectedItems.constraints)}else u=null,n.parent&&(u=this.nameTable[n.parent]),u&&u.container?u.container.type=="canvas"?ej.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this):u.container.type=="stack"&&ej.datavisualization.Diagram.SvgContext._alignOnStack(u,this):n.segments||(i=this._findNode(n.name),this._translate(i,n.offsetX-i.offsetX,n.offsetY-i.offsetY,this.nameTable),this.scale(i,n.width/i.width,n.height/i.height,ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._svg,this._currZoom,this,this.model.selectedItems.constraints))},_recordRotationChanged:function(n){var t=n.object.node,i=n.object.childTable;t.container||this._updateRecordRotation(t,i)},_recordEndPointChanged:function(n){var t,i,r,u;n._isUndo?(t=i=n.undoObject,r=n.redoObject):(t=i=n.redoObject,r=n.undoObject);t=t.parent?this._findChildren(t.parent,t.name):this._findConnector(t.name);r.targetNode&&(u=this.nameTable[r.targetNode],ej.datavisualization.Diagram.Util.removeItem(u.inEdges,r));r.sourceNode&&(u=this.nameTable[r.sourceNode],ej.datavisualization.Diagram.Util.removeItem(u.outEdges,r));i.targetNode&&(u=this.nameTable[i.targetNode],u.inEdges.push(i.name));i.sourceNode&&(u=this.nameTable[i.sourceNode],u.outEdges.push(i.name));t.targetNode=i.targetNode;t.sourceNode=i.sourceNode;t.targetPort=i.targetPort;t.sourcePort=i.sourcePort;t.sourcePoint=i.sourcePoint;t.targetPoint=i.targetPoint;t.segments=i.segments;this._updateEdges(t);this._dock(t,this.nameTable);ej.datavisualization.Diagram.Util._updateConnectorSegments(t,t.sourcePort,t.targetPort,this);ej.datavisualization.Diagram.DiagramContext._refreshSegments(t,this);ej.datavisualization.Diagram.Util.updateBridging(t,this);ej.datavisualization.Diagram.DiagramContext.update(t,this);this._updateConnectorBridging(t);this._updateSelectionHandle();this.selectionList[0]&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._svg,this.model.zoomFactor);ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._svg,this._currZoom,this,this.model.selectedItems.constraints)},_recordLabelChanged:function(n){var t=this.nameTable[n.object.name];n.object.type==="text"?(t.textBlock.text=n.label,ej.datavisualization.Diagram.DiagramContext.updateTextBlock(t,t.textBlock,this)):(t.labels[0].text=n.label,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,t.labels[0],this))},_recordGroupChanged:function(n){var e,u,f,t,o,i,s,r;if(this._clearSelection(),e=n.actionType,n.isUndo&&(n.actionType==="group"&&(e="ungroup"),n.actionType==="ungroup"&&(e="group")),u=this._getChildren(n.object.children),e==="group"){for(f=new ej.datavisualization.Diagram.Group({name:n.object.name}),t=0;t<u.length;t++)f.children.push(u[t]),this.nameTable[u[t]].parent=f.name,i=this._svg.document.getElementById(u[t]),i&&i.parentNode.removeChild(i);this.add(f);this._addSelection(f)}else{for(o=n.object,i=this._svg.document.getElementById(o.name),i&&i.parentNode.removeChild(i),s=this._getChildren(o.children),t=0;t<s.length;t++)r=this.nameTable[s[t]],r.parent="",this._isUndo=!0,r.segments?ej.datavisualization.Diagram.DiagramContext.renderConnector(r,this):r._type!="group"?ej.datavisualization.Diagram.DiagramContext.renderNode(r,this):ej.datavisualization.Diagram.DiagramContext.renderGroup(r,this),this._isUndo=!1;ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(o.name))}},_svgdrop:function(n,t){var u={},s=n.originalEvent,i,b,e,f,r,o;s.preventDefault?s.preventDefault():s.returnValue=!1;var a=this._currZoom,v=$("#"+this.element[0].id).offset(),h=this._isTouchEvent(n),c,l;h?(c=h.pageX,l=h.pageY):(c=n.pageX,l=n.pageY);var y=c+this._hScrollOffset-v.left,p=l+this._vScrollOffset-v.top,w=t.helper[0].getAttribute("paletteId"),k=$("#"+w).ejSymbolPalette("instance");if(w){if(i=$.extend(!0,{},this._selectedSymbol),this._selectedSymbol=null,i.name+=ej.datavisualization.Diagram.Util.randomId(),i.segments)i.segments&&ej.datavisualization.Diagram.Util._translateLine(i,y,p),u={element:this.getNode(i)},this._raiseDropEvent(u),u.cancel||this.add(i),i=this.selectionList[0];else{if(b=$.extend(!0,{},k.nameTable),i.offsetX=y/a,i.offsetY=p/a,i._type==="group"){for(e=this._getChildren(i.children),f=0;f<e.length;f++)r=$.extend(!0,{},b[e[f]]),r.parent=i.name,r.name=i.name+r.name,e[f]=r.name,this.nameTable[r.name]=r,this.nodes().push(r),ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,r);i.height=i.width=0;this._updateChildBounds(i,this.nameTable)}i._type==="group"?i=this._getNewGroup(i):i.segments?i=this._getNewConnector(i):i.isPhase||i.type==="phase"||(i=this._getNewNode(i));u={element:i};this._raiseDropEvent(u);u.cancel||this.add(i);i=this.selectionList[0]}this.scrollToNode(i);i.labels.length>0&&i.labels[0].mode==="edit"?(this._isEditing=!0,this.startLabelEdit(i,i.labels[0])):this.element[0].focus()}else o=null,o=this._findNodeUnderMouse(n),u={element:t.helper,e:n,draggable:t.draggable,targetNode:o},o&&this._raiseDropEvent(u)},_isTouchEvent:function(n){return n.type=="touchmove"||n.type=="touchstart"||n.type=="touchend"?n.originalEvent?n.originalEvent.changedTouches[0]:n.changedTouches[0]:n},_raiseDropEvent:function(n){this._raiseEvent("drop",n)},_documentmouseup:function(n){if(!this.activeTool||!this.activeTool.inAction||this.activeTool instanceof ej.datavisualization.Diagram.TextTool||this.activeTool.mouseup(n,!0),this._selectedSymbol){var t=document.getElementsByClassName("dragClone")[0];t!=null&&(t.style.display="block");this._remove(this.selectionList[0])}},_getNode:function(n,t){var i;return(i=t?typeof n=="object"?t[n.name]:t[n]:typeof n=="object"?this.nameTable[n.name]:this.nameTable[n],!i&&typeof(n==="object")&&(i=n),i)?i.isLane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"lane"):i.isPhase||i.type==="phase"?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"phase"):i.isSwimlane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"swimlane",t):i._type==="node"||i._type==="group"||i._type==="pseudoGroup"||this.getObjectType(i)=="node"?i:i:null},_updateEdges:function(n){var t;ej.datavisualization.Diagram.Util.isTargetConnected(n)&&(t=this.nameTable[n.targetNode],t&&t.inEdges.indexOf(n.name)==-1&&t.inEdges.push(n.name));ej.datavisualization.Diagram.Util.isSourceConnected(n)&&(t=this.nameTable[n.sourceNode],t&&t.outEdges.indexOf(n.name)==-1&&t.outEdges.push(n.name))},_updateChildrenEdges:function(n){for(var t,r=this._getChildren(n.children),i=0;i<r.length;i++)t=r[i],t.segments?(this._updateEdges(t),this._dock(t,this.nameTable)):t._type==="group"&&this._updateChildrenEdges(t)},_updateParent:function(n){for(var u,t,r=this._getChildren(n.children),i=0;i<r.length;i++)u=this.nodes().indexOf(this.nameTable[r[i]]),t=n.type!="bpmn"?this._getNewNode(this.nameTable[r[i]]):this.nameTable[r[i]],t&&t._type==="group"?this._updateParent(t):t&&(t.parent=n.name,this.nameTable[t.name]=t,u!=-1&&(this.nodes()[u]=t))},_findPortAtPoint:function(n,t){var f,i,s,e,r,h,c,l,o,u,a;if(t)for(l=ej.datavisualization.Diagram.Util.bounds(t,!0),f=t.ports,u=0,a=f.length;u<a;++u)if(i=f[u],e=ej.datavisualization.Diagram.Size(i.size,i.size),r=ej.datavisualization.Diagram.Util._getPortPosition(i,l),o=ej.Matrix.identity(),ej.Matrix.rotate(o,t.rotateAngle,t.offsetX,t.offsetY),r=ej.Matrix.transform(o,r),h=r.x-i.size/2,c=r.y-i.size/2,s=ej.datavisualization.Diagram.Rectangle(h,c,e.width,e.height),ej.datavisualization.Diagram.Geometry.containsPoint(s,n))return i;return null},_findLabelAtPoint:function(n,t){var f,u=null,a,e,i,v,y,s,h,r,o,c,w=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],l,p;if(t&&(r=ej.datavisualization.Diagram.Util.bounds(t),f=t.labels,f.length>0))for(u=f[0],l=0,p=f.length;l<p;l++)if(u=f[l],o=$(w).find("#"+t.name+"_"+u.name)[0],s=o?o.offsetWidth:0,h=o?o.offsetHeight:0,s||(s=r.width),h||(h=u.fontSize),e=ej.datavisualization.Diagram.Size(s,h),i=ej.datavisualization.Diagram.Util._getLabelPosition(u,r),i.x=r.x+i.x,i.y=r.y+i.y,c=ej.Matrix.identity(),t.segments?ej.Matrix.rotate(c,0,r.x+r.width/2,r.y+r.height/2):ej.Matrix.rotate(c,t.rotateAngle,t.offsetX,t.offsetY),i=ej.Matrix.transform(c,i),v=i.x-e.width/2,y=i.y-e.height/2,a=ej.datavisualization.Diagram.Rectangle(v,y,e.width,e.height),ej.datavisualization.Diagram.Geometry.containsPoint(a,n))break;return u},_getCurrentZoom:function(){return this._currZoom},_findNode:function(n){return this.nameTable[n]},_findPort:function(n,t){for(var r=n.ports,i=0,u=r.length;i<u;i++)if(r[i].name===t)return r[i];return null},_findConnector:function(n){return this.nameTable[n]},_findChildren:function(n,t){for(var i,r,f=this._getChildren(n.children),u=0;u<f.length;u++)if(i=this.nameTable[f[u]],i){if(t==i.name)return i;if(i._type==="group"&&(r=this._findChildren(i,t),r))return r}return null},_delete:function(){var u,f,o,s,t,e,l,i,h,n,r,c;if(ej.datavisualization.Diagram.Util.isPageEditable(this)&&this.selectionList[0])if(this.selectionList[0].type&&this.selectionList[0].type!="phase"||this.selectionList[0].segments||this.selectionList[0]._type=="node"||this.selectionList[0]._type=="pseudoGroup"){if(u={},f={},u=this._getChildTable(this.selectionList[0],u),f=this._getEdgeTable(this.selectionList[0],f),!this._isUndo){if(o={},s={},!this.selectionList[0].segments){if(this.selectionList[0].outEdges.length>0)for(e=this.selectionList[0].outEdges.length,n=0;n<e;n++)t=this.nameTable[this.selectionList[0].outEdges[n]],t&&t.sourcePort&&(o[t.name]=t.sourcePort);if(this.selectionList[0].inEdges.length>0)for(e=this.selectionList[0].inEdges.length,n=0;n<e;n++)t=this.nameTable[this.selectionList[0].inEdges[n]],t&&t.targetPort&&(s[t.name]=t.targetPort)}l={type:"collectionchanged",object:jQuery.extend(!0,{},this.selectionList[0]),childTable:jQuery.extend(!0,{},u),edgeTable:jQuery.extend(!0,{},f),sourcePorts:o,targetPorts:s,changeType:"remove"};this.addHistoryEntry(l)}if(this.selectionList.length>0)if(i=this.selectionList[0],i.type=="pseudoGroup"){for(h=this._getChildren(i.children),n=h.length-1;n>=0;n--)this._remove(this.nameTable[h[n]]),this._isUndo=!0;this._isUndo=!1}else this._nodeToHit===i&&(this._nodeToHit=null),this._remove(i),i.container&&i.parent&&(r=this.nameTable[i.parent],r&&r.container&&r.container.type=="stack"&&(this._getChild(r.children[0])?(this.tools.move._updateContainer(this.nameTable[this._getChild(r.children[0])]),ej.datavisualization.Diagram.DiagramContext.update(r,this)):(c=this.nameTable[r.parent],c&&this._remove(c))));this._clearSelection()}else this.selectionList[0].type&&this.selectionList[0].type=="phase"&&(this._removePhase(this.selectionList[0].name),this._clearSelection())},_getSwimlaneHeader:function(n){var t;return n&&n.isSwimlane&&n.children&&n.children.length>0&&(t=this.nameTable[n.children[0]]),t},_addPhase:function(n,t){var i=this.nameTable[n],o=!1,u,s,f,r,e;i&&i.isSwimlane&&t&&(i&&i.orientation&&t.offset&&(i.orientation=="horizontal"?(u=i.offsetX-i.width/2,f=this._getFirstLane(i),f&&(u+=f.width),o=t.offset>i.width||i.offsetX-i.width/2+t.offset<u?!0:!1):i.orientation=="vertical"&&(u=i.offsetY-i.height/2,s=this._getSwimlaneHeader(i),s&&(u+=s.height),f=this._getFirstLane(i),f&&(u+=f.height),o=t.offset>i.height||i.offsetY-i.height/2+t.offset<u?!0:!1)),t.offset&&!o&&(r=ej.datavisualization.Diagram.phase(t),r.parent=i.name,this.nameTable[r.name]&&(ej.datavisualization.Diagram.Util.removeItem(this.model.phases,this.nameTable[r.name]),delete this.nameTable[r.name]),e=this._getInsertIndex(r)+1,this._updateInsertPhase(r,i.phases[e],i,e,r),i.phases.splice(e,0,r.name),this.model.phases.push(r),this.nameTable[r.name]=r,ej.datavisualization.Diagram.SvgContext.renderphase(r,this._svg,this._diagramLayer,this)))},_removePhase:function(n){var t=this.nameTable[n],e=this.nameTable[t.parent],s,h,i,r,f,o,u,c,l;e&&e.phases&&e.phases.length>1&&(s=this._svg.getElementById(n),s&&s.parentNode.removeChild(s),h=this._getPrevPhase(t),i=h,h==t&&(i=this._getNextPhase(t)),r=0,i!=t&&(this._getPhaseIndex(t.name)!=0?(r=t.offset-i.offset,i.offset+=t.offset-i.offset):r=i.offset,f=this.nameTable["phaseStack"+n],ej.datavisualization.Diagram.Util.removeItem(this.nodes(),f),o=this.nameTable[f.parent],o&&(u=this.nameTable["phaseStack"+i.name],this._getPhaseIndex(t.name)===0?t.orientation==="horizontal"?u.width=r:(c=this._getSwimlaneHeader(this.nameTable[t.parent]),u.height=r,c&&(u.height-=c.height)):this._getPhaseIndex(t.name)!=e.phases.length-1?t.orientation==="horizontal"?u.width+=r:u.height+=r:t.orientation==="horizontal"?u.width+=r:u.height+=r,t&&delete this.nameTable[n],ej.datavisualization.Diagram.SvgContext._updatephase(i,this),ej.datavisualization.Diagram.Util.removeItem(e.phases,t.name),ej.datavisualization.Diagram.Util.removeItem(o.children,f.name),ej.datavisualization.Diagram.SvgContext._alignOnStackContainer(o,this),l=this,this._views.forEach(function(n){var i=l._views[n],t=i.svg.getElementById(f.name),r=i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],u=$(r).find("#"+f.name)[0];t&&t.parentNode&&t.parentNode.removeChild(t);u&&r.removeChild(u)})),ej.datavisualization.Diagram.DiagramContext.update(o,this)))},_getEdgeTable:function(n,t){var u,e,o,i,r,h,f,s;if(!n.segments){if(n._type==="group")for(h=this._getChildren(n.children),o=0;o<h.length;o++){if(f=this.nameTable[h[o]],f&&f.inEdges&&f.inEdges.length>0)for(u=f.inEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r));if(f&&f.outEdges&&f.outEdges.length>0)for(u=f.outEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r))}if(n.inEdges&&n.inEdges.length>0)for(u=n.inEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r));if(n.outEdges&&n.outEdges.length>0)for(u=n.outEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r))}return t},_remove:function(n,t,i){var f,t,r,l,s,o,h,e,u,c;if(ej.datavisualization.Diagram.Util.isPageEditable(this)&&n&&(f=n.segments?"connector":"node",t=t?ej.datavisualization.Diagram.dependentconnector.dependent:ej.datavisualization.Diagram.dependentconnector.independent,r={changeType:"remove",element:this.getNode(n),cancel:!1,dependent:t},n.segments||(r.adjustDependent=!0,r.deleteDependent=!0),n.isPhase||this._raiseEvent(f+"CollectionChange",r),!r.cancel&&(ej.datavisualization.Diagram.Util.canDelete(n)||i))){if(l=n.name,n.type=="group"&&n.type!="pseudoGroup")for(s=this._getChildren(n.children),o=0;o<s.length;o++)if(h=this.nameTable[s[o]],h&&!ej.datavisualization.Diagram.Util.canDelete(h))return;n.segments?(this._removeEdges(n),n.sourceNode=n.sourcePort=n.targetNode=n.targetPort=null,ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[n.name])):(this._disConnect(n,r),this._removeConnector(n,r),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[n.name]));f=this.getObjectType(n);(f=="node"||f=="connector")&&(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[n.name],n),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,n),n.segments&&this._updateConnectorBridging(n));n.parent&&(e=this.nameTable[n.parent],e&&e.type=="group"&&(ej.datavisualization.Diagram.Util.removeItem(e.children,n.name),ej.datavisualization.Diagram.Util._updateGroupBounds(e,this)));delete this.nameTable[l];u=this._svg.getElementById(n.name);this._browserInfo.name==="msie"&&(n._type==="node"&&n.type==="html"&&u?(c=document.getElementById(n.name+"_parentdiv"),c.parentNode.removeChild(c)):n.type=="group"&&this._checkForHtmlNode(n));n._type=="group"&&n.type!="pseudoGroup"&&this._removeChildren(n,r);this._removeElement(n);n._type=="group"&&n.container&&ej.datavisualization.Diagram.SvgContext._removephases(n,this);u&&u.parentNode&&u.parentNode.removeChild(u);this.selectionList[0]&&this._clearSelection()}},_removeConnector:function(n,t){var r,i,u;if(!n.segments){if(t.deleteDependent&&!t.adjustDependent){if(n.inEdges&&n.inEdges.length>0)for(r=n.inEdges,i=r.length-1;i>=0;i--)this._updateConnection(this.nameTable[r[i]],!0);if(n.outEdges&&n.outEdges.length>0)for(r=n.outEdges,i=0,u=r.length;i<u;i++)this._updateConnection(this.nameTable[r[i]],!0)}if(t.deleteDependent&&t.adjustDependent)if(n.inEdges&&n.inEdges.length==0&&n.outEdges.length>0)for(r=n.outEdges,i=r.length-1;i>=0;i--)this._updateConnection(this.nameTable[r[i]],!0);else if(n.outEdges&&n.outEdges.length==0&&n.inEdges.length>0)for(r=n.inEdges,i=r.length-1;i>=0;i--)this.nameTable[r[i]]&&this._updateConnection(this.nameTable[r[i]],!0);else if((n.inEdges&&n.inEdges.length==1||n.inEdges.length>1)&&n.outEdges.length==1)for(r=n.outEdges,i=0,u=r.length;i<u;i++)this._updateConnection(this.nameTable[r[i]],!0);else if(!(n.inEdges&&n.inEdges.length>1&&n.outEdges.length>1))for(r=n.inEdges,i=0,u=r.length;i<u;i++)this._updateConnection(this.nameTable[r[i]],!0)}},_updateConnection:function(n,t){n&&(this._remove(n,t),this.updateConnector(n.name))},_removeElement:function(n){for(var i,t=0;t<this._views.length;t++)i=this._views[t],this._views[i].context.removeChild(n,this._views[i])},_disConnect:function(n,t,i){var u,f,s,c,h,l,r,e,o,a;if(t.deleteDependent&&t.adjustDependent&&!i){if(n.inEdges&&n.inEdges.length>0&&n.outEdges.length>0)if(u=n.inEdges,f=n.outEdges,(n.inEdges.length>1||n.inEdges.length==1)&&n.outEdges.length==1){for(r=0,o=u.length;r<o;r++)this.nameTable[u[r]]&&this.nameTable[f[0]]&&this.nameTable[u[r]].targetNode==this.nameTable[f[0]].sourceNode&&(h=this.nameTable[this.nameTable[f[0]].targetNode],h&&(l=$.extend(!0,{},h),this.nameTable[u[r]].targetNode=this.nameTable[f[0]].targetNode,this.nameTable[u[r]].targetPort=this.nameTable[f[0]].targetPort,h.inEdges[r]=this.nameTable[u[r]].name),ej.datavisualization.Diagram.Util.dock(this.nameTable[u[r]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[u[r]],this));this.nameTable[f[0]]&&(this.nameTable[f[0]].sourceNode=null,this.nameTable[f[0]].sourcePort=null)}else if(!(n.inEdges.length>1&&n.outEdges.length>1))for(r=0,o=u.length;r<o;r++)if(n.outEdges.length>0){for(c=this.nameTable[this.nameTable[u[r]].sourceNode],l=$.extend(!0,{},c),e=0,a=f.length;e<a;e++)this.nameTable[u[r]].targetNode==this.nameTable[f[e]].sourceNode&&(this.nameTable[f[e]].sourceNode=this.nameTable[u[r]].sourceNode,this.nameTable[f[e]].sourcePort=this.nameTable[u[r]].sourcePort,c.outEdges[l.outEdges.length+e]=this.nameTable[f[e]].name,ej.datavisualization.Diagram.Util.dock(this.nameTable[f[e]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[f[e]],this));this.nameTable[u[r]].targetNode=null;this.nameTable[u[r]].targetPort=null}return}if(n.inEdges&&n.inEdges.length>0)for(u=n.inEdges,r=0,o=u.length;r<o;r++)s=this.nameTable[u[r]],s.targetNode=null,s.targetPort=null;if(n.outEdges&&n.outEdges.length>0)for(f=n.outEdges,r=0,o=f.length;r<o;r++)s=this.nameTable[f[r]],s.sourceNode=null,s.sourcePort=null},_removeEdges:function(n){n.targetNode&&this.nameTable[n.targetNode]&&this.nameTable[n.targetNode].inEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[n.targetNode].inEdges,n.name);n.sourceNode&&this.nameTable[n.sourceNode]&&this.nameTable[n.sourceNode].outEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[n.sourceNode].outEdges,n.name)},_selectionContains:function(n){if(this._hasSelection()&&n)for(var t=0;t<this.selectionList.length;t++)if(n.name===this.selectionList[t].name)return!0;return!1},_getPhaseIndex:function(n){var t,i,r=-1;return t=this.nameTable[n],t&&t.parent&&(i=this.nameTable[t.parent],i.phases&&i.phases.length>0&&(r=i.phases.indexOf(n))),r},_getNextPhase:function(n){var r=null,i,t=this.nameTable[n.parent];return t&&t.phases&&t.phases.length>0&&(i=this._getPhaseIndex(n.name),r=i===t.phases.length-1?this.nameTable[t.phases[i]]:this.nameTable[t.phases[i+1]]),r},_getPrevPhase:function(n){var r=null,i,t=this.nameTable[n.parent];return t&&t.phases&&t.phases.length>0&&(i=this._getPhaseIndex(n.name),r=i===0?this.nameTable[t.phases[0]]:this.nameTable[t.phases[i-1]]),r},_getPrevOffset:function(n,t,i,r){var u,f,s=0,h=0,o,e;return r.children[0]&&(o=this.nameTable[this._getChild(r.children[0])],o&&(h=o.height)),r.orientation=="horizontal"&&(r.children[2]&&(u=this.nameTable[this._getChild(r.children[2])]),u&&u.children&&u.children.length>0&&(f=this.nameTable[this._getChild(u.children[0])],f&&f.children&&f.children.length>0&&(e=this.nameTable[this._getChild(f.children[0])],e&&e.name.indexOf("_Headerr")!=-1&&(s=e.width)))),{left:s,top:h}},_getPhaseBounds:function(n){var t=null,i,h,f,r=0,s=0,e=0,o=0,u,c,l;return n&&n.type=="phase"&&n.parent&&(u=this._getPrevPhase(n),c=this._getNextPhase(n),i=this.nameTable[n.parent],i&&i.orientation&&(t=ej.datavisualization.Diagram.Util.bounds(i),i.orientation=="horizontal"?(f=this._getPrevOffset(n,u,c,i,t),u&&u.name===n.name?(r=f.left+t.left,s=r+(n.offset-r-f.left)):(u&&(r=t.left+u.offset),s=n.offset-r+t.left),e=f.top+t.top,o=t.bottom-e,h=ej.datavisualization.Diagram.Rectangle(r,e,s,o)):(f=this._getPrevOffset(n,u,c,i,t),u===n?(l=typeof i.children[0]=="string"?this.nameTable[i.children[0]]:this.nameTable[i.children[0].name],r=f.left+t.left,o=n.offset+e,l&&(o-=l.height),e=f.top+t.top):(r=f.left+t.left,u&&(e=u.offset+t.top),o=t.top+n.offset-e),s=t.right-r,h=ej.datavisualization.Diagram.Rectangle(r,e,s,o)))),h},_addSelection:function(n){var t,r,i;ej.datavisualization.Diagram.Util.isPageEditable(this)&&n&&(ej.datavisualization.Diagram.Util.canSelect(n)||n.type=="phase")&&(this._selectionContains(n)||(this.selectionList.push(n),this._updateSelectorObject(n),t={changeType:"insert",element:this.getNode(n),cancel:!1},this._selectedSymboladd||this._raiseEvent("selectionChange",t),t.cancel?ej.datavisualization.Diagram.Util.removeItem(this.selectionList,n):(r=this._getPhaseBounds(n),ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints,r),this.model.selectedItems.userHandles!=null&&this.model.selectedItems.userHandles.length>0&&(i=!1,n.type=="pseudoGroup"&&(i=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,n,this._svg,i,this._currZoom,this._adornerLayer,this)))))},_getInsertIndex:function(n){var f=-1,u,i,t=this.nameTable[n.parent],r;if(t&&t.phases&&t.phases.length>0)for(u=this.nameTable[t.phases[0]].offset,r=0;r<t.phases.length;r++)i=this.nameTable[t.phases[r]],i&&i.offset<=n.offset&&i.offset>=u&&(u=i.offset,f=r);return f},_updateInsertPhase:function(n,t,i,r){var o=this.nameTable[t],e=this.nameTable[this._getChild(i.children[1])],f,s,h,c,l,u;e&&e.children&&e.children.length>0&&(f=this.nameTable["phaseStack"+t],i.isSwimlane&&i.orientation&&i.orientation=="vertical"?(s=f.height,f.height=o.offset-n.offset,h=s-f.height,u=ej.datavisualization.Diagram.Node({parent:e.name,name:"phaseStack"+n.name,height:h,width:f.width})):(c=f.width,f.width=o.offset-n.offset,l=c-f.width,u=ej.datavisualization.Diagram.Node({parent:e.name,name:"phaseStack"+n.name,height:f.height,width:l,isPhase:!0})),u.labels=[n.label?n.label:ej.datavisualization.Diagram.Label()],u.labels[0].rotateAngle=n.orientation=="horizontal"?0:270,u.constraints=ej.datavisualization.Diagram.ConnectorConstraints.Default&~ej.datavisualization.Diagram.ConnectorConstraints.Select,u.isPhase=!0,this.add(u),e.children.pop(u.name),e.children.splice(r,0,u.name),this.tools.move._updateContainer(u))},_getFirstLane:function(n){var t,i,r;return(n.children[2]&&(t=this.nameTable[this._getChild(n.children[2])]),t&&t.children&&t.children.length>0&&(i=this.nameTable[this._getChild(t.children[0])],i&&i.children&&i.children.length>0&&(r=this.nameTable[this._getChild(i.children[0])],r)))?r:null},updateSelector:function(n){if(this._selectedItem!=""){var t={};n.offsetX&&(t.offsetX=Number(typeof n.offsetX=="function"?n.offsetX():n.offsetX));n.offsetY&&(t.offsetY=Number(typeof n.offsetY=="function"?n.offsetY():n.offsetY));n.width&&(t.width=Number(typeof n.width=="function"?n.width():n.width));n.height&&(t.height=Number(typeof n.height=="function"?n.height():n.height));n.rotateAngle&&(t.rotateAngle=Number(typeof n.rotateAngle=="function"?n.rotateAngle():n.rotateAngle));this.updateNode(this._selectedItem,t)}n.userHandles&&(this.model.selectedItems.userHandles=n,this._initHandles())},_updateSelectorObject:function(n){var i,t;if(n.segments||(this._selectorOffsetX(n.offsetX),this._selectorOffsetY(n.offsetY),this._selectorWidth(n.width),this._selectorHeight(n.height),this._selectorRotateAngle(n.rotateAngle),this._selectedItem=n.name),n.type=="pseudoGroup")for(i=0;i<n.children.length;i++)t=n.children[i],typeof t=="object"?this.model.selectedItems.children.indexOf(t)<0&&this.model.selectedItems.children.push(t):typeof t=="string"&&this.model.selectedItems.children.indexOf(this.nameTable[t])<0&&this.model.selectedItems.children.push(this.nameTable[t]);else this.model.selectedItems.children.indexOf(n)<0&&this.model.selectedItems.children.push(n)},_clearSelectorObject:function(){this._selectorOffsetX(0);this._selectorOffsetY(0);this._selectorWidth(0);this._selectorHeight(0);this._selectorRotateAngle(0);this._selectedItem="";this.model.selectedItems.children=[]},_raiseEvent:function(n,t){return t.elementType=this.getObjectType(t.element),this._trigger(n,t)},_clearSelection:function(){if(this._hasSelection()){this._isEditing&&this.selectionList.length>0&&this._endEdit();var n={changeType:"remove",element:this.getNode(this.selectionList[0]),cancel:!1};this._selectedSymbol||this._raiseEvent("selectionChange",n);n.cancel||(this._clearSelectorObject(),this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.selectionList[0]),delete this.nameTable[this.selectionList[0].name]),ej.datavisualization.Diagram.Util.clear(this.selectionList),ej.datavisualization.Diagram.SvgContext.clearSelector(this._svg,this._adornerLayer))}},_updateSelectionHandle:function(n){var t,i,r;this.selectionList.length>0&&(t=this.nameTable[this.selectionList[0].name],i=this.model.selectedItems.constraints,n&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&(i=i&~ej.datavisualization.Diagram.SelectorConstraints.UserHandles),this._updateSelectorObject(t),ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._svg,this._currZoom,this,i),this.model.selectedItems.userHandles!=null&&this.model.selectedItems.userHandles.length>0&&(r=!1,t.type=="pseudoGroup"&&(r=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,t,this._svg,r,n,this._currZoom)))},_hasSelection:function(){return this.selectionList.length>0},_checkToolToActivate:function(n,t){var i=!1,r;return r=ej.datavisualization.Diagram.Util._getPseudoGroupConstraints(this,t,this.selectionList[0]),t?((t.segments&&(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&n.shiftKey||(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&n.altKey)&&(this._toolToActivate="endPoint",this._currentCursor="move",i=!0),i||(this._selectionContains(t)?(t.segments?i=this._canActivateEndPointTool(n,t):((!r||r&ej.datavisualization.Diagram.NodeConstraints.Resize)&&(i=this._canActivateResizeTool(n,t)),i||(!r||r&ej.datavisualization.Diagram.NodeConstraints.Rotate)&&(i=this._canActivateRotateTool(n,t))),i||(i=this._canActivateUserHandle(n,t)),i||(!r||r&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(i=this._canActivateMoveTool(n,t)),i||(i=this._canActivatephaseTool(n))):(!r||r&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(i=this._canActivateMoveTool(n,t)))):i=this._canActivatephaseTool(n),i||(this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this._toolToActivate="panTool",this._currentCursor="pointer"):(this._toolToActivate="select",this._currentCursor="default")),this._toolToActivate!="rotate"&&this._svg.document.removeAttribute("class"),i},_canActivatephaseTool:function(n){if($(n.target).parents(".ej-d-seperator").first()[0]){var i=$(n.target).parents("g").first()[0].id,t=this._getSeperetor(i);return this._currentCursor=t?t.orientation=="horizontal"?"e-resize":"n-resize":"default",this._toolToActivate="phase",!0}},_canActivateUserHandle:function(n){if(this._isUserHandle(n)){var t=$(n.target).parents("g").first().context.id.split("_")[0];return this._toolToActivate=t,this._currentCursor=this.tools[this._toolToActivate].cursor,!0}return!1},_canActivateEndPointTool:function(n,t){if(t){var i=n.target.getAttribute("class");if(i&&(i==="targetEndPoint"&&ej.datavisualization.Diagram.Util.canDragTargetEnd(t)||i==="sourceEndPoint"&&ej.datavisualization.Diagram.Util.canDragSourceEnd(t)||i.match("bezierpoint")&&ej.datavisualization.Diagram.Util.canDragSegmentThumbs(t)||i=="segmentEnd"))return this._toolToActivate="endPoint",this._currentCursor="move",!0}return!1},_canActivateResizeTool:function(n,t){var i=n.target.getAttribute("class");return ej.datavisualization.Diagram.Util.canResize(t,i)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Resizer&&(i==="nw-resize"||i==="n-resize"||i==="ne-resize"||i==="w-resize"||i==="e-resize"||i==="sw-resize"||i==="s-resize"||i==="se-resize")?(this._toolToActivate="resize",t.rotateAngle>=0&&t.rotateAngle<25||t.rotateAngle>=160&&t.rotateAngle<=200||t.rotateAngle>=340&&t.rotateAngle<=360?this._currentCursor=i:t.rotateAngle>=25&&t.rotateAngle<=65||t.rotateAngle>=205&&t.rotateAngle<=240?this._currentCursor=i==="n-resize"||i==="s-resize"?"ne-resize":i==="nw-resize"||i==="se-resize"?"n-resize":i==="e-resize"||i==="w-resize"?"nw-resize":"e-resize":t.rotateAngle>=70&&t.rotateAngle<=110||t.rotateAngle>=250&&t.rotateAngle<=290?this._currentCursor=i==="n-resize"||i==="s-resize"?"e-resize":i==="nw-resize"||i==="se-resize"?"ne-resize":i==="e-resize"||i==="w-resize"?"n-resize":"nw-resize":(t.rotateAngle>=115&&t.rotateAngle<=155||t.rotateAngle>=295&&t.rotateAngle<=335)&&(this._currentCursor=i==="n-resize"||i==="s-resize"?"nw-resize":i==="nw-resize"||i==="se-resize"?"e-resize":i==="e-resize"||i==="w-resize"?"ne-resize":"n-resize"),!0):!1},_canActivateMoveTool:function(n,t){var u=this._findNodeUnderMouse(n),i,r;if(u&&u.name===t.name){if(i=!0,t.parent&&(i=this.selectionList.length>0&&this._selectionContains(t)?!0:!1),i&&ej.datavisualization.Diagram.Util.canMoveLabel(t)&&(r=n.target.parentNode.id.split("_"),r[r.length-1]=="lblbg"))return this._toolToActivate="move",this._currentCursor="pointer",!0;if(ej.datavisualization.Diagram.Util.canMove(t))return this._toolToActivate="move",this._currentCursor=this.selectionList.length>0&&(this._selectionContains(t)||this.selectionList[0].children&&this._findChildren(this.selectionList[0],t.name))?"move":"default",!0}return!1},_canActivateRotateTool:function(n,t){if(ej.datavisualization.Diagram.Util.canRotate(t)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Rotator){var i=n.target.getAttribute("class");if(i==="rotate")return this._toolToActivate="rotate",this._svg.document.setAttribute("class","svg-rotate"),this._currentCursor="",!0}return!1},_canActivatePivotTool:function(n){var t=n.target.getAttribute("class");return t==="pivot"?(this._toolToActivate="pivot",this._currentCursor="default",!0):!1},_updateCursor:function(){this._svg.document.style.cursor=this._currentCursor;this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0].style.cursor=this._currentCursor},_getResizeCursor:function(n){var t="default";switch(n){case"topleft":t="nw-resize";break;case"topcenter":t="n-resize";break;case"topright":t="ne-resize";break;case"middleleft":t="w-resize";break;case"middleright":t="e-resize";break;case"bottomleft":t="sw-resize";break;case"bottomcenter":t="s-resize";break;case"bottomright":t="se-resize"}return t},_startEdit:function(n){var i,f,e,r,o,t,u,v=ej.Matrix.identity(),l=n.width?n.width:n._width,a=n.height?n.height:n._height,y,p,c,s,h;ej.Matrix.rotate(v,n.rotateAngle,l/2,a/2);n.type==="text"?(r=this._svg.getElementById(n.name+"_shape")!==null?this._svg.getElementById(n.name+"_shape").getBBox():{x:n.offsetX-l/2,y:n.offsetY-a/2,width:l,height:a},i=n.textBlock,i&&(o=ej.datavisualization.Diagram.Util.bounds(n),t=new ej.datavisualization.Diagram.Rectangle(r.x-i.fontSize,r.y-i.fontSize,r.width+i.fontSize/2,r.height+i.fontSize/2),u=this._currZoom,h=ej.Matrix.transform(v,ej.datavisualization.Diagram.Util._getLabelPosition(i,o)),f=n.offsetX-l/2+h.x,e=n.offsetY-a/2+h.y,i.horizontalAlignment=="left"?f+=r.width/2:i.horizontalAlignment=="right"&&(f-=r.width/2),i.verticalAlignment=="top"?e+=r.height/2:i.verticalAlignment=="bottom"&&(e-=r.height/2),r.width===0||r.height===0?(r=ej.datavisualization.Diagram.Util.bounds(n),t.width=r.width==0?50:o.width*u,t.x=f*u-t.width/2*u-this._hScrollOffset,t.height=i.fontSize,t.y=e*u-t.height/2*u-this._vScrollOffset):(t.width=50,t.height=i.fontSize,t.x=f*u-t.width/2*u-this._hScrollOffset,t.y=e*u-t.height/2*u-this._vScrollOffset),this._boundingBox=t,this._createEditBox(i,t.x,t.y,t.width,t.height,n),this._isEditing=!0)):(n.labels.length>0?(i=this.activeTool.getLabelUnderMouse(),i||(i=n.labels[0])):(y=this._findNode(n.name),i=new ej.datavisualization.Diagram.Label({name:"label"+ej.datavisualization.Diagram.Util.randomId()}),n.labels.push(i),p=y!==n?y:null,ej.datavisualization.Diagram.DiagramContext.addNodeLabel(n,i,p,this),this.activeTool.name==="textTool"&&(this.activateTool.activeLabel=i)),i&&!i.readOnly&&(c=document.getElementById(n.name+"_"+i.name),c?(o=ej.datavisualization.Diagram.Util.bounds(n),t=new ej.datavisualization.Diagram.Rectangle(c.offsetLeft,c.offsetTop,c.offsetWidth,c.offsetHeight),r=t,u=this._currZoom,s=ej.datavisualization.Diagram.Util._getLabelPosition(i,o),n.segments?(f=o.x+s.x,e=o.y+s.y):(i.horizontalAlignment=="left"?s.x+=r.width/2:i.horizontalAlignment=="right"&&(s.x-=r.width/2),i.verticalAlignment=="top"?s.y+=r.height/2:i.verticalAlignment=="bottom"&&(s.y-=r.height/2),h=ej.Matrix.transform(v,s),f=n.offsetX-l/2+h.x,e=n.offsetY-a/2+h.y),r.width===0||r.height===0?(r=ej.datavisualization.Diagram.Util.bounds(n),n.segments?(t.width=r.width<50?50:o.width*u,t.x=f*u-t.width/2*u-this._hScrollOffset):(t.width=r.width<50?50:o.width*u,t.x=f*u-t.width/2-this._hScrollOffset),t.height=i.fontSize,t.y=e*u-t.height/2*u-this._vScrollOffset):(t.x=f*u-t.width/2*u-this._hScrollOffset,t.y=e*u-t.height/2*u-this._vScrollOffset),this._boundingBox=t,this._createEditBox(i,t.x,t.y,t.width,t.height,n),this._isEditing=!0):this.activeTool.selectedObject=null))},_createEditBox:function(n,t,i,r,u,f){var o,h,e;this._svg&&(o=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],o&&(h=f.type==="text"?$(o).find("#"+f.name+"_shape_lblbg")[0]:$(o).find("#"+f.name+"_"+n.name+"_lblbg")[0],h&&(h.style.display="none")));var c=ej.datavisualization.Diagram.Util.bounds(f),s=document.createElement("div"),l={id:this.element[0].id+"_editBoxDiv","class":"edit",style:"top:"+i+"px;left:"+t+"px;width:"+r+"px;height:"+u+"px;font-family:"+n.fontFamily+";font-size:"+n.fontSize+"px;min-width: 50px;min-height:"+n.fontSize+"px;"};ej.datavisualization.Diagram.Util.attr(s,l);e=document.createElement("textarea");l={id:this.element[0].id+"_editBox","class":"editBox",style:"font-size:"+n.fontSize+"px;font-family:"+n.fontFamily+";min-height:"+n.fontSize+"px;line-height:"+n.fontSize+"px;",nodeWidth:c.width,nodeHeight:c.height,fontSize:n.fontSize,nodeOffsetX:f.offsetX,nodeOffsetY:f.offsetY,containerName:f.name};ej.datavisualization.Diagram.Util.attr(e,l);e.value=n.text;s.appendChild(e);$(this._canvas).append(s);n.text!==""&&this._updateEditor(null,s,e,c.width,n.fontSize);this._on($(e),"focusout",this._editboxfocusout);this._on($(e),"keyup",this._editBoxKeyUp);this._on($(e),"input",this._editBoxTextChange);e.focus();e.select()},_editBoxKeyUp:function(n){this._updateLabelPosition(n)},_editBoxTextChange:function(n){this._updateLabelPosition(n)},_updateEditBox:function(n,t){var i=document.getElementById(this.element[0].id+"_editBoxDiv");i&&(i.style.left=i.offsetLeft-n+"px",i.style.top=i.offsetTop-t+"px")},_editboxfocusout:function(){this._endEdit()},_updateLabelPosition:function(n){var t=50,o=this._currZoom,i=this._boundingBox,e=Number(n.target.getAttribute("fontSize")),f=Number(n.target.getAttribute("nodeWidth")),s=i.x+i.width/2,h=i.y+i.height/2,u=this._textLength(n),r;u.width===0?(r=i.width<t?t:i.width,n.target.parentNode.style.width=r+"px",n.target.parentNode.style.left=s-r/2+"px"):(r=u.width<=f*o?u.width<t?t:u.width:f<t?t:f*o,n.target.parentNode.style.width=r+"px",n.target.parentNode.style.left=s-r/2+"px");u.height===0?(n.target.style.height=e+"px",n.target.parentNode.style.top=h-e/2+"px"):this._updateEditor(n,n.target.parentNode,n.target,f,e)},_updateEditor:function(n,t,i,r,u){var s,h,f,c=this._textLength(n),e=this._currZoom,l=50,a=this._boundingBox.x,v=this._boundingBox.y,y=this._boundingBox.width,p=this._boundingBox.height,b=i.value,k=b.split("\n"),w=r*e<c.width?r*e:c.width,o=w<l?l:w;t.style.width=o+"px";s=n?(o-y)/2:(o-y*e)/2;t.style.left=a-s-u/4+"px";k.length>1||c.width>=r?(f=this._browserInfo.name==="mozilla"?i.scrollHeight-5:i.scrollHeight-4,i.style.height="auto"):f=u;i.style.height=f+"px";h=n?(f-p)/2:(f-p*e)/2;this._boundingBox=new ej.datavisualization.Diagram.Rectangle(a-s,v-h,o,f);t.style.top=v-h-u/4+"px"},_textLength:function(n){var t=document.createElement("div"),i=document.getElementById(this.element[0].id+"_editBox"),u={id:this.element[0].id+"_editBoxHiddenDiv",style:"position:absolute; width:"+i.width+"px;height:"+i.height+"px;font-size:"+i.style.fontSize+"px;font-family:"+i.style.fontFamily+";padding: 4px;word-wrap: break-word;white-space:pre-wrap;"},r;return ej.datavisualization.Diagram.Util.attr(t,u),t.innerHTML=n?n.target.value:i.value,document.body.appendChild(t),r=t.getBoundingClientRect(),document.body.removeChild(t),r},_endEdit:function(){var y,f,i,l,a,t=document.getElementById(this.element[0].id+"_editBox"),n,r,e,u,p,o,s,h,c,v;if(t){if(n=this._findNode(t.getAttribute("containerName")),this.activeTool.name==="textTool")n=this.activeTool.selectedObject;else if(!n)for(r=0;r<this.selectionList.length;r++)e=this.selectionList[r],typeof e.labels.length!="undefined"&&e.labels.length>0&&e.labels[0].mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&(n=this.selectionList[r]);n&&(this._isEditing=!1,n._type!="node"||n.width&&n.height||!this.nameTable[n.name]||(u=$.extend(!0,{},n),u.labels[0].text=t.value,this._getNodeDimension(u),l=n._width,a=n._height,n._width=u._width,n._height=u._height),y=this._raiseEvent("textChange",{element:this.getNode(n),value:t.value}),y?(n._width&&l&&(n._width=l),n._height&&a&&(n._height=a)):(n&&n.type!==undefined&&n.type==="text"?(p=n.textBlock.text,n.textBlock.text=t.value,n.textBlock.mode=ej.datavisualization.Diagram.LabelEditMode.View,this._findNode(n.name)?(ej.datavisualization.Diagram.DiagramContext.update(n,this),f={type:"labelchanged",shape:n,previousLabelValue:p,updatedLabelValue:t.value},this.addHistoryEntry(f)):(t.value!==""&&(o=Number(t.style.height.substring(0,t.style.height.length-2)),n.height<o&&(n.offsetY=n.offsetY-n.height/2+o/2,n.height=o),this.selectionList.length>0&&this._clearSelection(),this.add(n)),this.activeTool.selectedObject=null)):n==undefined||n.type=="pseudoGroup"||(i=this.activeTool.getLabelUnderMouse(),i||(i=n.labels[0]),i!=undefined?(i.text!=t.value&&(f={type:"labelchanged",shape:n,previousLabelValue:i.text,updatedLabelValue:t.value},this.addHistoryEntry(f)),i.text=t.value,i.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(n,i,this),n.isPhase&&(n.name.split("phaseStack")[1]&&(s=this.nameTable[n.name.split("phaseStack")[1]]),s&&s.label&&(s.label.text=t.value))):n.labels.length==0&&(i=ej.datavisualization.Diagram.Label(),i.text=t.value,i.mode=ej.datavisualization.Diagram.LabelEditMode.View,n.labels.push(i),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(n,i,null,this))),n._type!="node"||n.width&&n.height||!this.nameTable[n.name]||(ej.datavisualization.Diagram.DiagramContext.update(n,this),n.parent&&ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[n.parent],this))));this._off($(t),"focusout",this._editboxfocusout);this._off($(t),"keyup",this._editBoxKeyUp);this._off($(t),"input",this._editBoxTextChange);h=$("#"+this.element[0].id+"_editBoxDiv")[0];h&&h.parentNode.removeChild(h);this._svg&&(c=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],c&&(v=n.type==="text"?$(c).find("#"+n.name+"_shape_lblbg")[0]:$(c).find("#"+n.name+"_"+i.name+"_lblbg")[0],v&&(v.style.display="block")))}},_setLabelEditing:function(n){var t;if(n)return n.readOnly?(n.mode=ej.datavisualization.Diagram.LabelEditMode.View,t=!1):(this._currentLabel&&(this._currentLabel.mode=ej.datavisualization.Diagram.LabelEditMode.View),n.mode=ej.datavisualization.Diagram.LabelEditMode.Edit,this._currentLabel=n,t=!0),t},_isInternalTool:function(n){return n instanceof ej.datavisualization.Diagram.SelectTool||n instanceof ej.datavisualization.Diagram.ConnectionEditTool||n instanceof ej.datavisualization.Diagram.MoveTool||n instanceof ej.datavisualization.Diagram.ResizeTool||n instanceof ej.datavisualization.Diagram.PhaseTool||n instanceof ej.datavisualization.Diagram.RotateTool||n instanceof ej.datavisualization.Diagram.PanTool&&this.tool()&ej.datavisualization.Diagram.Tool.SingleSelect&&this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?!0:!1},_updateNodeMargin:function(n){var t,e,f;if(n.parent!=""&&(t=this.nameTable[n.parent],t&&t.container&&t.container.type=="canvas")){var r=ej.datavisualization.Diagram.Util.bounds(t),u=ej.datavisualization.Diagram.Util.bounds(n),i=ej.datavisualization.Diagram.Geometry.rect([u.topLeft,u.topRight,u.bottomRight,u.bottomLeft]);n.marginLeft=i.x-(r.x+t.paddingLeft);n.marginRight=r.x+t.width-(i.x+i.width)-t.paddingRight;n.marginTop=i.y-(r.y+t.paddingTop);n.marginBottom=r.bottom-(i.y+i.height)-t.paddingBottom}if((n.type=="pseudoGroup"||n.name=="multipleSelection")&&n.children.length>0)for(f=0;f<n.children.length;f++)e=this.nameTable[this._getChild(n.children[f])],e&&this._updateNodeMargin(e)},_translate:function(n,t,i,r,u){var o,f,e;if(n.segments)ej.datavisualization.Diagram.Util._translateLine(n,t,i,n),this._dock(n,r),ej.datavisualization.Diagram.Util.updateBridging(n,this),this._updateConnectorBridging(n);else{if(n.offsetX+=t,n.offsetY+=i,(n._type==="group"||n.type==="pseudoGroup")&&!u){for(o=this._getChildren(n.children),e=0;e<o.length;e++)f=r[o[e]],f&&(this._translate(f,t,i,r),f.parent&&f.parent!=n.name&&n.type!="pseudoGroup"&&ej.datavisualization.Diagram.Util._updateGroupBounds(r[f.parent],this));n.type!="group"&&n.container&&ej.datavisualization.Diagram.Util._updateGroupBounds(n,this)}this._updateAssociatedConnectorEnds(n,r)}this._updateQuad(n)},_translateLabel:function(n,t,i,r){t.margin.left+=i;t.margin.top+=r;t.margin.right-=i;t.margin.bottom-=r;t.horizontalAlignment=="center"&&(t.margin.right=0);t.verticalAlignment=="center"&&(t.margin.bottom=0);ej.datavisualization.Diagram.DiagramContext.updateLabel(n,t,this)},_rotate:function(n,t,i){var u,e,o,s,r,f,h;if(!n.segments){if(n.rotateAngle+=t,n.rotateAngle%=360,n.rotateAngle<0&&(n.rotateAngle+=360),n._type==="group"||n.type==="pseudoGroup"){for(u=ej.Matrix.identity(),ej.Matrix.rotate(u,t,n.offsetX,n.offsetY),s=this._getChildren(n.children),f=0;f<s.length;f++)r=i[s[f]],r&&(r.segments?(r.sourceNode||this._setEndPoint(r,ej.Matrix.transform(u,r.sourcePoint),!1),r.targetNode||this._setEndPoint(r,ej.Matrix.transform(u,r.targetPoint),!0)):(this._rotate(r,t,i),e=r.offsetX,o=r.offsetY,h=ej.Matrix.transform(u,ej.datavisualization.Diagram.Point(e,o)),this._translate(r,h.x-e,h.y-o,i),this._updateAssociatedConnectorEnds(r,i)),r.parent&&r.parent!=n.name&&n.type!="pseudoGroup"&&ej.datavisualization.Diagram.Util._updateGroupBounds(i[r.parent],this));ej.datavisualization.Diagram.Util._updateGroupBounds(n,this)}n.parent&&this._updateParentBounds(n.parent);this._updateQuad(n);this._updateAssociatedConnectorEnds(n,i)}},scale:function(n,t,i,r,u,f,e,o){var d,w,v,s,p,c,b,k,h,g,nt;if(n.container)switch(n.container.type){case"canvas":c={};h=ej.Matrix.identity();ej.Matrix.rotate(h,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(h,t,i,r.x,r.y);ej.Matrix.rotate(h,n.rotateAngle,r.x,r.y);y=ej.Matrix.transform(h,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY));a=n.width*t;l=n.height*i;e&&(n.minHeight=l,n.minWidth=a);o!=!0?c=this._getMinMaxSize(n,a,l):(c.width=a,c.height=l);c&&c.width>1&&(b=n.offsetX-n.width/2,n.width!=c.width&&(n._scaled=!0),n.width=c.width,n.offsetX=b+n.width/2);c&&c.height>1&&(k=n.offsetY-n.height/2,n.height!=c.height&&(n._scaled=!0),n.height=c.height,n.offsetY=k+n.height/2);f||ej.datavisualization.Diagram.SvgContext._alignOnCanvas1(n,this,!0);break;case"stack":h=ej.Matrix.identity();ej.Matrix.rotate(h,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(h,t,i,r.x,r.y);ej.Matrix.rotate(h,n.rotateAngle,r.x,r.y);y=ej.Matrix.transform(h,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY));g=0;nt=0;t!=0&&(g=n.marginLeft,nt=n.marginRight);a=n.width*t-(g+nt);l=n.height*i-(n.marginTop+n.marginBottom);c=this._getMinMaxSize(n,a,l);c.width>1&&(b=n.offsetX-n.width/2,n.width!=c.width&&(n._scaled=!0),n.width=c.width-n.marginLeft,n.offsetX=b+n.width/2+n.marginLeft);c.height>1&&(k=n.offsetY-n.height/2,n.height!=c.height&&(n._scaled=!0),n.height=c.height-n.marginTop,n.offsetY=k+n.height/2+n.marginTop);ej.datavisualization.Diagram.SvgContext._alignOnStack(n,this)}else{if(h=ej.Matrix.identity(),n.segments){for(ej.Matrix.scale(h,t,i,r.x,r.y),v=0;v<n.segments.length;v++){for(s=n.segments[v],p=0;p<s.points.length;p++)s.points[p]=ej.Matrix.transform(h,s.points[p]),v!=0||p!=0||n.sourceNode||(s._startPoint=s.points[0],s._endPoint=s.points[s.points.length-1],ej.datavisualization.Diagram.Util._setLineEndPoint(n,ej.Matrix.transform(h,n.sourcePoint),!1)),v!=n.segments.length-1||p!=s.points.length-1||n.targetNode||(s._startPoint=s.points[0],s._endPoint=s.points[s.points.length-1],n.targetPoint=s._endPoint);s._startPoint=s.points[0];s._endPoint=s.points[s.points.length-1];s.type=="orthogonal"?s.length||s.length===0?s.length=s._length=ej.datavisualization.Diagram.Geometry.distance(s._startPoint,s._endPoint):ej.datavisualization.Diagram.Util._addOrthogonalPoints(s,n.segments[v-1],n.segments[v+1],n.sourcePoint,n.targetPoint):s.point=s._endPoint}(n.sourceNode||n.targetNode)&&this._dock(n,u)}else{if(n._type==="group"||n.type==="pseudoGroup"){if(n.type!="bpmn"||n.width*t>=20&&n.height*i>=20){for(d=this._getChildren(n.children),v=0;v<d.length;v++)w=u[d[v]],w&&(this.scale(w,t,i,r,u),w.parent&&w.parent!=n.name&&n.type!="pseudoGroup"&&ej.datavisualization.Diagram.Util._updateGroupBounds(u[w.parent],this));if(n.children.length<=0){ej.Matrix.rotate(h,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(h,t,i,r.x,r.y);ej.Matrix.rotate(h,n.rotateAngle,r.x,r.y);var y=ej.Matrix.transform(h,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),a=n.width?n.width*t:n._width*t,l=n.height?n.height*i:n._height*i;a>1&&(n.width?(a!=n.width&&(n._scaled=!0),n.width=a,n.offsetX=y.x):(a!=n._width&&(n._scaled=!0),n.maxWidth=n.parent&&u[n.parent].width!=n.maxWidth?u[n.parent].width:a,n.offsetX=y.x-(n._width*t-n._width)/2));l>1&&(n.height?(l!=n.height&&(n._scaled=!0),n.height=l,n.offsetY=y.y):(l!=n._height&&(n._scaled=!0),n.maxHeight=n.parent&&u[n.parent].height>l?u[n.parent].height:l,n.offsetY=y.y-(n._height*i-n._height)/2))}ej.datavisualization.Diagram.Util._updateGroupBounds(n,this)}}else{ej.Matrix.rotate(h,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(h,t,i,r.x,r.y);ej.Matrix.rotate(h,n.rotateAngle,r.x,r.y);var y=ej.Matrix.transform(h,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),a=n.width*t,l=n.height*i;a>1&&(a!=n.width&&(n._scaled=!0),n.width=a,n.offsetX=y.x);l>1&&(l!=n.height&&(n._scaled=!0),n.height=l,n.offsetY=y.y)}n.parent&&this._updateParentBounds(n.parent);this._updateAssociatedConnectorEnds(n,u)}this._updateQuad(n)}ej.datavisualization.Diagram.DiagramContext.update(n,this)},_updateParentBounds:function(n){n=this.nameTable[this._getChild(n)];n&&!n.container&&(ej.datavisualization.Diagram.Util._updateGroupBounds(n,this),ej.datavisualization.Diagram.DiagramContext.update(n,this),n.parent&&this._updateParentBounds(n.parent))},_dock:function(n,t,i){var r=n.segments.length,u=n.segments[0].points.length,f=n.segments[n.segments.length-1].points.length;ej.datavisualization.Diagram.Util.dock(n,t);r!=n.segments.length&&this._svg&&(ej.datavisualization.Diagram.Util._updateConnectorSegments(n,n.sourcePort,n.targetPort,this),ej.datavisualization.Diagram.DiagramContext._refreshSegments(n,this));this.selectionList[0]==n&&(i||u!=n.segments[0].points.length||f!=n.segments[n.segments.length-1].points.length)&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._svg,this._currZoom);this._updateQuad(n)},_setEndPoint:function(n,t,i){ej.datavisualization.Diagram.Util._setLineEndPoint(n,t,i);this._updateQuad(n)},_updateAssociatedConnectorEnds:function(n,t){for(var r,i=0,u=n.inEdges.length;i<u;i++)r=t[n.inEdges[i]],r&&this._dock(r,t);for(i=0,u=n.outEdges.length;i<u;i++)r=t[n.outEdges[i]],r&&this._dock(r,t)},_updateChildBounds:function(n,t){var r,u,i,f,e,o,s;n.width==0&&n.height==0?(r=n.offsetX,u=n.offsetY,ej.datavisualization.Diagram.Util._updateGroupBounds(n,this),this._translate(n,r-n.offsetX,u-n.offsetY,t)):(r=n.offsetX,u=n.offsetY,i=ej.datavisualization.Diagram.Util._getChildrenBounds(n,this),n.offsetX=i.x+i.width/2,n.offsetY=i.y+i.height/2,f=r-n.offsetX,e=r-n.offsetY,this._translate(n,f,e,t),o=n.width/i.width,s=n.height/i.height,this._scale(n,o,s,n.pivot,t),this._translate(n,r-n.offsetX,u-n.offsetY,t))},_updateQuad:function(n){if(this._spatialSearch){var t=this.getObjectType(n),i=n.parent&&this.nameTable[n.parent]&&this.nameTable[n.parent].type=="bpmn"?!0:!1;t!="node"&&t!="connector"||i||ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,n)}},_sliceDockLines:function(n){var i=$.extend({},n),t=null;for(var r in i)t=this.nameTable[this._getChild(i[r])],t&&t.segments&&(t.sourceNode||t.targetNode)&&n.pop(t.name)}});ej.datavisualization.Diagram.Locale={};ej.datavisualization.Diagram.Locale["en-US"]={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"SelectAll",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"BringToFront",moveForward:"MoveForward",sendBackward:"SendBackward",sendToBack:"SendToBack"};$.fn.pinchDiagram=function(n,t){var i=[],f=function(n){var u=n.touches,t,f,e,r,o,s;if(u.length>=2)for(t=0;t<u.length;t++){for(f=u[t],e=!1,r=0;r<i.length;r++)if(o=i[r],f.identifier===o.identifier){e=!0;break}e||(s=$.extend({},f),i.push(s))}n.preventDefault()},r=function(n,t){var i=t.pageX-n.pageX,r=t.pageY-n.pageY;return Math.sqrt(i*i+r*r)},e=function(n){for(var e,t,u,o,f=n.changedTouches,r=0;r<f.length;r++)for(e=f[r],t=0;t<i.length;t++)u=i[t],u.identifier===e.identifier&&(o=i.indexOf(u),i.splice(o,1));n.preventDefault()},u=function(n,t){n.pageX=t.pageX;n.pageY=t.pageY},o=function(n){var f,e,l;if(n.preventDefault(),f=n.touches,f.length>=2){var o=f[0],s=f[1],h=i[0],c=i[1];e=r(o,s)/r(h,c);l=t._mousePosition(n,!1);ej.datavisualization.Diagram.ZoomUtil.zoomPan(t,e,0,0,l,!0,!0);u(h,o);u(c,s)}};this[0].addEventListener("touchstart",f,!1);this[0].addEventListener("touchend",e,!1);this[0].addEventListener("touchmove",o,!1)}})(jQuery,Syncfusion),function(n,t){"use strict";t.MatrixTypes={Identity:0,Translation:1,Scaling:2,Unknown:4};t.MatrixDefaults={m11:1,m12:0,m21:0,m22:1,offsetX:0,offsetY:0,type:t.MatrixTypes.Identity};t.Matrix={identity:function(){return n.extend(!0,{},t.MatrixDefaults)},multiply:function(n,i){var u=n.type,f=i.type,e,r,o,s;if(f!=t.MatrixTypes.Identity){if(u==t.MatrixTypes.Identity){n.m11=i.m11;n.m12=i.m12;n.m21=i.m21;n.m22=i.m22;n.offsetX=i.offsetX;n.offsetY=i.offsetY;n.type=i.type;return}if(f==t.MatrixTypes.Translation){n.offsetX+=i.offsetX;n.offsetY+=i.offsetY;u!=t.MatrixTypes.Unknown&&(n.type|=t.MatrixTypes.Translation);return}if(u!=t.MatrixTypes.Translation){e=u<<4|f;switch(e){case 34:n.m11*=i.m11;n.m22*=i.m22;return;case 35:n.m11*=i.m11;n.m22*=i.m22;n.offsetX=i.offsetX;n.offsetY=i.offsetY;n.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling;return;case 36:break;default:switch(e){case 50:n.m11*=i.m11;n.m22*=i.m22;n.offsetX*=i.m11;n.offsetY*=i.m22;return;case 51:n.m11*=i.m11;n.m22*=i.m22;n.offsetX=i.m11*n.offsetX+i.offsetX;n.offsetY=i.m22*n.offsetY+i.offsetY;return;case 52:break;default:switch(e){case 66:case 67:case 68:break;default:return}}}r=this.identity();this._setMatrix(r,n.m11*i.m11+n.m12*i.m21,n.m11*i.m12+n.m12*i.m22,n.m21*i.m11+n.m22*i.m21,n.m21*i.m12+n.m22*i.m22,n.offsetX*i.m11+n.offsetY*i.m21+i.offsetX,n.offsetX*i.m12+n.offsetY*i.m22+i.offsetY);r.m21||r.m12?r.type=t.MatrixTypes.Unknown:((r.m11&&r.m11!=1||r.m22&&r.m22!=1)&&(r.type=t.MatrixTypes.Scaling),(r.offsetX||r.offsetY)&&(r.type|=t.MatrixTypes.Translation),(r.type&(t.MatrixTypes.Translation|t.MatrixTypes.Scaling))==t.MatrixTypes.Identity&&(r.type=t.MatrixTypes.Identity));n.m11=r.m11;n.m12=r.m12;n.m21=r.m21;n.m22=r.m22;n.offsetX=r.offsetX;n.offsetY=r.offsetY;n.type=r.type;return}if(o=n.offsetX,s=n.offsetY,n.m11=i.m11,n.m12=i.m12,n.m21=i.m21,n.m22=i.m22,n.offsetX=i.offsetX,n.offsetY=i.offsetY,n.type=i.type,n.offsetX=o*i.m11+s*i.m21+i.offsetX,n.offsetY=o*i.m12+s*i.m22+i.offsetY,f==t.MatrixTypes.Unknown){n.type=t.MatrixTypes.Unknown;return}n.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling}},transform:function(n,t){var i=this._multiplyPoint(n,t.x,t.y);return{x:Math.round(i.x*100)/100,y:Math.round(i.y*100)/100}},rotate:function(n,t,i,r){t%=360;this.multiply(n,this._createRotationRadians(t*.017453292519943295,i?i:0,r?r:0))},scale:function(n,t,i,r,u){this.multiply(n,this._createScaling(t,i,r?r:0,u?u:0))},translate:function(n,i,r){if(n.type&t.MatrixTypes.Identity){this._setMatrix(n,1,0,0,1,i,r,t.MatrixTypes.Translation);return}if(n.type&t.MatrixTypes.Unknown){n.offsetX+=i;n.offsetY+=r;return}n.offsetX+=i;n.offsetY+=r;n.type|=t.MatrixTypes.Translation},_createScaling:function(n,i,r,u){var f=this.identity();return this._setMatrix(f,n,0,0,i,r-n*r,u-i*u,(r||u)?t.MatrixTypes.Scaling|t.MatrixTypes.Translation:t.MatrixTypes.Scaling),f},_createRotationRadians:function(n,i,r){var e=this.identity(),u=Math.sin(n),f=Math.cos(n),o=i*(1-f)+r*u,s=r*(1-f)-i*u;return this._setMatrix(e,f,u,-u,f,o,s,t.MatrixTypes.Unknown),e},_multiplyPoint:function(n,i,r){switch(n.type){case t.MatrixTypes.Identity:break;case t.MatrixTypes.Translation:i+=n.offsetX;r+=n.offsetY;break;case t.MatrixTypes.Scaling:i*=n.m11;r*=n.m22;break;case t.MatrixTypes.Translation|t.MatrixTypes.Scaling:i*=n.m11;i+=n.offsetX;r*=n.m22;r+=n.offsetY;break;default:var u=r*n.m21+n.offsetX,f=i*n.m12+n.offsetY;i*=n.m11;i+=u;r*=n.m22;r+=f}return{x:i,y:r}},_setMatrix:function(n,i,r,u,f,e,o,s){n.m11=i;n.m12=r;n.m21=u;n.m22=f;n.offsetX=e;n.offsetY=o;n.type=s||t.MatrixTypes.Identity}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.HitTesting={_getResizeHandleCenter:function(n,i,r){var f,u;r||(r=1);f=this.bounds(n);u=t.datavisualization.Diagram.Point(0,0);switch(i){case"topleft":u=f.topLeft;break;case"topcenter":u=f.top;break;case"topright":u=f.topRight;break;case"middleleft":u=f.left;break;case"middleright":u=f.right;break;case"bottomleft":u=f.bottomLeft;break;case"bottomcenter":u=f.bottom;break;case"bottomright":u=f.bottomRight;break;case"pivot":u=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY);break;case"rotate":var o=20/r,s=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY-n.height*n.pivot.y-10-o),e=t.Matrix.identity();t.Matrix.rotate(e,n.rotateAngle,n.offsetX,n.offsetY);u=t.Matrix.transform(e,s)}return u},findResizeHandleAtPoint:function(n,i){var e=null,u,o,f,r,s;if(n)for(f=["topleft","topcenter","topright","middleleft","middleright","bottomleft","bottomcenter","bottomright"],r=0,s=f.length;r<s;r++)if(u=this._getResizeHandleCenter(n,f[r]),u!==t.datavisualization.Diagram.Point(0,0)&&(o=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),o)){e=f[r];break}return e},findRotationHandleAtPoint:function(n,i,r){var u=this.xxx_getResizeHandleCenter(n,"rotate",r),f=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),10);return f?!0:!1},findPivotHandleAtPoint:function(n,i){var r=this._getResizeHandleCenter(n,"pivot"),u=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(r.x,r.y),7);return u?!0:!1},findEndPointHandleAtPoint:function(n,i){var f=null,r,e,u,o;return n&&(e=n.line.points,u=e[e.length-1],r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="targetEndPoint"),r||(u=e[0],r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="sourceEndPoint")),r||n.line.type!=="bezier"||(u=n.line._point1,r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="bezierpoint1"),r||(o=n.line._point2,r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(o.x,o.y),7),r&&(f="bezierpoint2")))),f}};t.datavisualization.Diagram.Util={findPortByName:function(n,t){var r,i,u;if(n.ports)for(i=0,u=n.ports.length;i<u;i++)if(r=n.ports[i],r.name===t)return r;return null},attr:function(n,t){for(var i in t)n.setAttribute(i.toString(),t[i])},removeItem:function(n,t){var i=n.indexOf(t);i>=0&&n.splice(i,1)},clear:function(n){while(n.length>0)n.pop()},randomId:function(){for(var n,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",i="",r=0;r<4;r++)n=Math.floor(Math.random()*t.length),i+=t.substring(n,n+1);return i},htmlEncode:function(n){return n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},canMove:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Drag:n.constraints&t.datavisualization.Diagram.NodeConstraints.Drag},canMoveLabel:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragLabel:n.constraints&t.datavisualization.Diagram.NodeConstraints.DragLabel},canRotate:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Rotate:n.constraints&t.datavisualization.Diagram.NodeConstraints.Rotate},canSelect:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Select:n.constraints&t.datavisualization.Diagram.NodeConstraints.Select},canBridge:function(n,i){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging:n.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritBridging?i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Bridging:void 0},canAllowPan:function(n){return n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan},canDelete:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Delete:n.constraints&t.datavisualization.Diagram.NodeConstraints.Delete},isPageEditable:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PageEditable},canDoMultipleSelection:function(n){if(n&&this.isPageEditable(n))return n.model.tool&t.datavisualization.Diagram.Tool.MultipleSelect},canDoSingleSelection:function(n){if(n&&this.isPageEditable(n))return n.model.tool&t.datavisualization.Diagram.Tool.SingleSelect},_getPseudoGroupConstraints:function(n,i,r){var u,f,o,e;if(r&&r.type==="pseudoGroup"&&(r.children.indexOf(i.name)>=0||i.name===r.name))if(n.model.selectedItems.getConstraints)u=n.model.selectedItems.getConstraints();else if(r.children)for(u=t.datavisualization.Diagram.NodeConstraints.Default,f=0;f<r.children.length;f++)o=n.nameTable[r.children[f]],e=o.constraints,e&t.datavisualization.Diagram.NodeConstraints.Resize||(u=u&~t.datavisualization.Diagram.NodeConstraints.Resize),e&t.datavisualization.Diagram.NodeConstraints.Rotate||(u=u&~t.datavisualization.Diagram.NodeConstraints.Rotate),e&t.datavisualization.Diagram.NodeConstraints.Drag||(u=u&~t.datavisualization.Diagram.NodeConstraints.Drag);return u},canPanning:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY},canZooming:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Zoomable},canUndo:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Undoable},canDragSourceEnd:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd},canDragTargetEnd:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragTargetEnd},canDragSegmentThumbs:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSegmentThumb},isTargetConnected:function(n){return n.targetNode?!0:!1},isSourceConnected:function(n){return n.sourceNode?!0:!1},bounds:function(n,i){var r,o,s,h,c,u,e,f;if(n.segments)for(o=0;o<n.segments.length;o++)s=n.segments[o],o==0?s.points&&(r=t.datavisualization.Diagram.Geometry.rect(s.points)):r=t.datavisualization.Diagram.Geometry.union(r,t.datavisualization.Diagram.Geometry.rect(s.points)),r.width=r.width==0?n.lineWidth:r.width,r.height=r.height==0?n.lineWidth:r.height;else n._type=="node"||n._type==="group"||n._type=="pseudoGroup"?(h=n.width?n.width:n._width||0,c=n.height?n.height:n._height||0,r={x:n.offsetX-h*n.pivot.x,y:n.offsetY-c*n.pivot.y,width:h,height:c}):r=n;return r?(u={},r.x=Math.round(r.x*100)/100,r.y=Math.round(r.y*100)/100,r.width=Math.round(r.width*100)/100,r.height=Math.round(r.height*100)/100,u.width=r.width,u.height=r.height,u.x=u.left=r.x,u.right=r.x+r.width,u.y=u.top=r.y,u.bottom=r.y+r.height,u.center={x:r.x+r.width/2,y:r.y+r.height/2},u.topLeft={x:r.x,y:r.y},u.topCenter={x:r.x+r.width/2,y:r.y},u.topRight={x:r.x+r.width,y:r.y},u.middleLeft={x:r.x,y:r.y+r.height/2},u.middleRight={x:r.x+r.width,y:r.y+r.height/2},u.bottomLeft={x:r.x,y:r.y+r.height},u.bottomCenter={x:r.x+r.width/2,y:r.y+r.height},u.bottomRight={x:r.x+r.width,y:r.y+r.height},n.rotateAngle&&!i&&(e=t.Matrix.identity(),t.Matrix.rotate(e,n.rotateAngle,n.offsetX,n.offsetY),u.topLeft=t.Matrix.transform(e,u.topLeft),u.topCenter=t.Matrix.transform(e,u.topCenter),u.topRight=t.Matrix.transform(e,u.topRight),u.middleLeft=t.Matrix.transform(e,u.middleLeft),u.middleRight=t.Matrix.transform(e,u.middleRight),u.bottomLeft=t.Matrix.transform(e,u.bottomLeft),u.bottomCenter=t.Matrix.transform(e,u.bottomCenter),u.bottomRight=t.Matrix.transform(e,u.bottomRight),f=t.datavisualization.Diagram.Geometry.rect([u.topLeft,u.topRight,u.bottomRight,u.bottomLeft]),u.x=u.left=f.x,u.y=u.top=f.y,u.right=f.x+f.width,u.bottom=f.y+f.height,u.center=t.datavisualization.Diagram.Point(f.x+f.width/2,f.y+f.height/2)),u.points=[u.topLeft,u.topRight,u.bottomRight,u.bottomLeft],u):r},_swapBounds:function(n,i){var n,i,u,r;return i=i,n.rotateAngle?(n.rotateAngle<45||(n.rotateAngle<=135?(u=t.Matrix.identity(),t.Matrix.rotate(u,n.rotateAngle,n.offsetX,n.offsetY),r=i.topCenter,i.topCenter=i.middleLeft,i.middleLeft=i.bottomCenter,i.bottomCenter=i.middleRight,i.middleRight=r,r=i.topLeft,i.topLeft=i.bottomLeft,i.bottomLeft=i.bottomRight,i.bottomRight=i.topRight,i.topRight=r):n.rotateAngle<=225?(u=t.Matrix.identity(),t.Matrix.rotate(u,n.rotateAngle,n.offsetX,n.offsetY),r=i.topCenter,i.topCenter=i.bottomCenter,i.bottomCenter=r,r=i.middleLeft,i.middleLeft=i.middleRight,i.middleRight=r,r=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=r,r=i.bottomRight,i.bottomRight=i.topRight,i.topRight=r):n.rotateAngle<=315&&(u=t.Matrix.identity(),t.Matrix.rotate(u,n.rotateAngle,n.offsetX,n.offsetY),r=i.topCenter,i.topCenter=i.middleRight,i.middleRight=i.bottomCenter,i.bottomCenter=i.middleLeft,i.middleLeft=r,r=i.bottomRight,i.bottomRight=i.topRight,i.topRight=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=r)),i.points=[i.topLeft,i.topRight,i.bottomRight,i.bottomLeft],i):void 0},canResize:function(n,i){if(i)switch(i){case"n-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth;case"s-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth;case"e-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast;case"w-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest;case"se-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast;case"ne-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast;case"sw-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest;case"nw-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest}else return n.constraints&t.datavisualization.Diagram.NodeConstraints.Resize},canConnect:function(n,i){var r=null;return i?r=n.constraints&t.datavisualization.Diagram.PortConstraints.Connect:n.segments||(r=n.constraints&t.datavisualization.Diagram.NodeConstraints.Connect),r},_initializeSegments:function(n,i){var u,f,r;if(n.segments&&n.segments.length<=1){n.segments.length||n.segments.push(t.datavisualization.Diagram.Segment({type:i||"straight"}));u=n.segments[0];switch(u.type){case"straight":u.point?(u.point.x!=n.targetPoint.x||u.point.y!=n.targetPoint.y)&&n.segments.push({type:i||"straight"}):u._point=n.targetPoint;break;case"orthogonal":u.length&&u.direction?(t.datavisualization.Diagram.Util._addOrthogonalPoints(u,null,null,n.sourcePoint,n.targetPoint),(u._endPoint.x!=n.targetPoint.x||u._endPoint.y!=n.targetPoint.y)&&n.segments.push({type:i||"straight"})):(u._length=u.length||20,u._direction=u.direction||"auto");break;case"bezier":u.point?(u.point.x!=n.targetPoint.x||u.point.y!=n.targetPoint.y)&&n.segments.push({type:i||"straight"}):u._point=n.targetPoint}}var e=n.sourcePoint,s=null,h=null,o;for(f=0;f<n.segments.length;f++){if(r=n.segments[f],r._startPoint=e,h=n.segments[f+1],r=n.segments[f]=t.datavisualization.Diagram.Segment(n.segments[f]),r.type=="orthogonal"){if(r._direction=r.direction||"auto",r._length=r.length||20,o=t.datavisualization.Diagram.Util._addOrthogonalPoints(n.segments[f],s,h,n.sourcePoint,n.targetPoint,o),e=n.segments[f]._endPoint,!r.length||!r.direction)break}else if(r.type=="straight"){if(r.points.push(e),r.points.push(n.segments[f].point||n.targetPoint),r._point=r._endPoint=n.segments[f].point||n.targetPoint,o=t.datavisualization.Diagram.Geometry.findAngle(e,r._endPoint),e=n.segments[f]._endPoint,!r.point)break}else if(r.type=="bezier"){if(r._point=r._endPoint=n.segments[f].point||n.targetPoint,r.points.push(e),r.points.push(n.segments[f].point||n.targetPoint),o=t.datavisualization.Diagram.Geometry.findAngle(e,r._endPoint),t.datavisualization.Diagram.Util._updateBezierPoints(r),e=n.segments[f]._endPoint,!r.point)break}else{r=t.datavisualization.Diagram.Segment({type:"orthogonal"});r._direction="auto";r._length=20;r._startPoint=e;r._endPoint=n.targetPoint;n.segments.push(r);t.datavisualization.Diagram.Util._addOrthogonalPoints(r,s,null,n.sourcePoint,n.targetPoint,o);break}s=n.segments[f]}(e.x!=n.targetPoint.x||e.y!=n.targetPoint.y)&&(r=t.datavisualization.Diagram.Segment({type:i||"straight"}),r._startPoint=e,r._endPoint=n.targetPoint,r.type=="orthogonal"?t.datavisualization.Diagram.Util._addOrthogonalPoints(r,s,null,n.sourcePoint,n.targetPoint,o):(r._point=n.targetPoint,r.points.push(e),r.points.push(n.targetPoint),r.type=="bezier"&&this._updateBezierPoints(r)),n.segments.push(r))},dock:function(n,t){var i,e=null,r,o=null,u,f;i=t[n.targetNode];i&&(e=this.findPortByName(i,n.targetPort));r=t[n.sourceNode];r&&(o=this.findPortByName(r,n.sourcePort));u=this.isSourceConnected(n);f=this.isTargetConnected(n);r&&r.type=="bpmn"&&r._type=="group"&&(r=t[r.children[0]]);i&&i.type=="bpmn"&&i._type=="group"&&(i=t[i.children[0]]);f&&u&&e&&o?this._dockPortToPort(n,i,e,r,o):f&&e?u?n.segments.length==1?(this._dockNode(n,r,null,f,u),this._dockPortToNode(n,i,e,r,o,!0)):(this._dockNode(n,r,null,f,u),this._updateIntermediateSegments(n),this._dockPortToPoint(n,i,e,!0),this._updatePreviousSegment(n)):(this._dockPortToPoint(n,i,e,!0),this._updatePreviousSegment(n)):u&&o?f?n.segments.length==1?(this._dockNode(n,i,null,f,u),this._dockPortToNode(n,r,o,i,e,!1)):(this._dockPortToPoint(n,r,o,!1),this._updateIntermediateSegments(n),this._dockNode(n,i,null,f,u),this._updatePreviousSegment(n)):(this._dockPortToPoint(n,r,o,!1),this._updateIntermediateSegments(n)):f&&u?i&&r&&this._dockNode(n,i,r,f,u):f?this._dockNode(n,i,null,f,u):u&&this._dockNode(n,r,null,f,u);this._adjustEndPoint(n,r,o,i,e)},_dockPortToPort:function(n,i,r,u,f){var o,s,h;if(n.segments.length==1){i&&(s=this.bounds(i,!0));u&&(h=this.bounds(u,!0));var e,c=n.segments[0],w=n.segments[n.segments.length-1],v=n.segments[0];if(v.type!=="orthogonal")r&&(o=this._getPortPosition(r,s),e=t.Matrix.identity(),t.Matrix.rotate(e,i.rotateAngle,i.offsetX,i.offsetY),o=t.Matrix.transform(e,o),this._setLineEndPoint(n,o,!0)),f&&(o=this._getPortPosition(f,h),e=t.Matrix.identity(),t.Matrix.rotate(e,u.rotateAngle,u.offsetX,u.offsetY),o=t.Matrix.transform(e,o),this._setLineEndPoint(n,o,!1)),v.type==="bezier"&&this._updateBezierPoints(v,i,r,s,u,f,h);else{var l=this._getPortPosition(r,s),a=this._getPortPosition(f,h),y=this._swapDirection(i.rotateAngle,this._getDirection(s,l)),p=this._swapDirection(u.rotateAngle,this._getDirection(h,a));e=t.Matrix.identity();t.Matrix.rotate(e,u.rotateAngle,u.offsetX,u.offsetY);a=t.Matrix.transform(e,a);e=t.Matrix.identity();t.Matrix.rotate(e,i.rotateAngle,i.offsetX,i.offsetY);l=t.Matrix.transform(e,l);s=this.bounds(i);h=this.bounds(u);this._constructSegements(n,c,s,l,y,h,a,p);this._setLineEndPoint(n,c.points[0],!1);this._setLineEndPoint(n,c.points[c.points.length-1],!0)}}else this._dockPortToPoint(n,u,f,!1),this._updateIntermediateSegments(n),this._dockPortToPoint(n,i,r,!0),this._updatePreviousSegment(n)},_dockPortToNode:function(n,i,r,u,f,e){var p=n.segments[0],w=n.segments[n.segments.length-1],h,l,c,b,a,o,y,s,v;i&&(h=this.bounds(i,!0));u&&(l=this.bounds(u,!0));b=e?w:p;b.type!=="orthogonal"?(a=this._getPortPosition(r,h),c=t.Matrix.identity(),t.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),a=t.Matrix.transform(c,a),this._setLineEndPoint(n,a,e)):(o=this._getPortPosition(r,h),y=this._swapDirection(i.rotateAngle,this._getDirection(h,o)),c=t.Matrix.identity(),t.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),o=t.Matrix.transform(c,o),s=e?n.sourcePoint:n.targetPoint,v=u?this._getDirection(l,s):"top",v&&(h=this.bounds(i),l=u?this.bounds(u):{left:s.x,right:s.x,top:s.y,bottom:s.y},e?(this._setLineEndPoint(n,o,!0),this._constructSegements(n,w,h,o,y,l,s,v)):(this._setLineEndPoint(n,o,!1),this._constructSegements(n,p,l,s,v,h,o,y))))},_dockPortToPoint:function(n,i,r,u){var s=n.segments[0],h=n.segments[n.segments.length-1],a=u?h:s,o,v,y;if(a.type!=="orthogonal")this._dockPortToNode(n,i,r,null,null,u);else{var e=this.bounds(i,!0),f=this._getPortPosition(r,e),c=this._swapDirection(i.rotateAngle,this._getDirection(e,f)),l=t.Matrix.identity();t.Matrix.rotate(l,i.rotateAngle,i.offsetX,i.offsetY);f=t.Matrix.transform(l,f);o=u?h._startPoint:s._endPoint;v=this.bounds(t.datavisualization.Diagram.Rectangle(o.x,o.y,0,0));e=this.bounds(i);y="top";u?(this._setLineEndPoint(n,f,!0),this._pointsFromNodeToPoint(n,h,c,e,i.rotateAngle,f,o,!0)):(this._setLineEndPoint(n,f,!1),this._pointsFromNodeToPoint(n,s,c,e,i.rotateAngle,f,o,!1))}},_dockNode:function(n,t,i,r,u){var l,a,e,f,o,s,h,c,v,y;n.segments.length==1?l=a=n.segments[0]:(l=n.segments[0],a=n.segments[n.segments.length-1]);r&&u&&!n.targetPort&&!n.sourcePort?n.segments.length==1?n.segments[0].type=="orthogonal"?(e=this.bounds(i),f=this.bounds(t),this._swapBounds(i,e),this._swapBounds(t,f),e.y>=f.bottom?(o=e.topCenter,h="top",s=f.bottomCenter,c="bottom"):e.bottom<=f.y&&(s=f.topCenter,c="top",o=e.bottomCenter,h="bottom"),e.bottom>f.y&&e.y<f.bottom&&(e.right<f.x||f.right>=e.x&&e.x>f.x?(o=e.middleRight,h="right",s=f.middleLeft,c="left"):f.right<e.x||e.right>=f.x&&e.x<f.x?(o=e.middleLeft,h="left",s=f.middleRight,c="right"):e.x<=f.x?(o=e.middleLeft,h="left",s=f.middleLeft,c="left"):e.x<=f.right?(o=e.middleRight,h="right",s=f.middleRight,c="right"):(o=e.middleLeft,h="left",s=f.middleRight,c="right")),o=this._findIntersection(i,e,n,o,e.center,!1)||o,s=this._findIntersection(t,f,n,s,f.center,!0)||s,this._setLineEndPoint(n,o,!1),this._setLineEndPoint(n,s,!0),n.segments[0].type=="orthogonal"&&(this._constructSegements(n,n.segments[0],f,n.targetPoint,c,e,n.sourcePoint,h),n.segments[0]._direction=h),v=this._adjustPoint(n.segments[0]._startPoint,n.segments[0].points[1],!0,i.connectorPadding),y=this._adjustPoint(n.segments[0].points[n.segments[0].points.length-2],n.segments[0]._endPoint,!1,t.connectorPadding),this._setLineEndPoint(n,v,!1),this._setLineEndPoint(n,y,!0)):(t&&(f=this.bounds(t),this._swapBounds(t,f),i&&(e=this.bounds(i),this._swapBounds(i,e),this._setLineEndPoint(n,e.center,!1),this._setLineEndPoint(n,f.center,!0),this._dockBounds(n,i,e,!1)),this._setLineEndPoint(n,f.center,!0),this._dockBounds(n,t,f,!0)),n.segments[0].type=="bezier"&&this._updateBezierPoints(n.segments[0])):(this._dock(n,l,i,null,!1),this._updateIntermediateSegments(n),n.segments.length==1?(this._dock(n,l,i,t,!1),this._dock(n,a,t,i,!0)):(this._dock(n,a,t,null,!0),this._updatePreviousSegment(n))):r&&!n.targetPort?(this._dock(n,a,t,i,!0),this._updatePreviousSegment(n)):u&&!n.sourcePort&&(this._dock(n,l,t,i,!1),this._updateIntermediateSegments(n))},_adjustEndPoint:function(n,t,i,r,u){var h,c,l,f,a;if(n.sourcePadding||t&&t.connectorPadding||r&&r.connectorPadding){var e=0,o=r?this.bounds(r):null,s=t?this.bounds(t):null;t&&(f=n.segments[0],h=f.type!=="orthogonal"?f.type!=="bezier"?f._endPoint:f._point1:f.points[1],f.type=="orthogonal"&&(e=n.sourcePadding+t.connectorPadding),i&&(e=n.sourcePadding+i.connectorPadding),c=this._adjustPoint(f._startPoint,h,!0,e),this._setLineEndPoint(n,c,!1),f.type=="bezier"&&this._updateBezierPoints(f,r,u,o,t,i,s));r&&(f=n.segments[n.segments.length-1],l=f.type!=="orthogonal"?f.type!=="bezier"?f._startPoint:f._point2:f.points[f.points.length-2],f.type=="orthogonal"&&(e=n.targetPadding+r.connectorPadding),u&&(e=n.targetPadding+u.connectorPadding),a=this._adjustPoint(l,f._endPoint,!1,e),this._setLineEndPoint(n,a,!0),f.type=="bezier"&&this._updateBezierPoints(f,r,u,o,t,i,s))}},_dock:function(n,i,r,u,f){var o,s,h,e,c,v;if(r){var a=r,l=f?i._startPoint:i._endPoint,o=this.bounds(r);if(this._swapBounds(r,o),f)if(i.type=="orthogonal")if(e=n.segments[n.segments.length-2],e&&e.type=="orthogonal")if(i.points.length>2&&t.datavisualization.Diagram.Geometry.containsPoint(o,i.points[i.points.length-2])){if(c=!1,e.direction=="top"||e.direction=="bottom"){if(e._endPoint.x>=o.left&&e._endPoint.x<=o.right){this._removeLastSegment(n,i,e,r,u,f);return}e._length=e.length=Math.abs(e._startPoint.y-o.middleLeft.y);e.length==0?c=!0:(e.length<0&&(e._length=e.length*=-1,e._direction=e.direction=e.direction=="top"?"bottom":"top"),n.targetPoint=e._endPoint.x>o.right?o.middleRight:o.middleLeft)}else{if(e._endPoint.y>=o.top&&e._endPoint.y<=o.bottom){this._removeLastSegment(n,i,e,r,u,f);return}e._length=e.length=Math.abs(e._startPoint.x-o.topCenter.x);e.length==0?c=!0:(e.length<0&&(e._length=e.length*=-1,e._direction=e.direction=e.direction=="left"?"right":"left"),n.targetPoint=e._endPoint.y>o.bottom?o.bottomCenter:o.topCenter)}if(c){n.segments.splice(n.segments.length-2,1);this._dock(n,i,r,u,f);return}n.targetPoint=this._findIntersection(r,o,n,n.targetPoint,o.center,f)||n.targetPoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,e);this._setLineEndPoint(n,n.targetPoint,f)}else if(t.datavisualization.Diagram.Geometry.containsPoint(o,i._startPoint)){if(v=e.direction=="left"||e.direction=="right"?a.width/2:a.height/2,e._length=e.length-=v+30,e.length==0){n.segments.splice(n.segments.length-2,1);this._dock(n,i,r,u,f);return}n.targetPoint=e.direction=="left"||e.direction=="right"?e.direction=="right"?o.middleLeft:o.middleRight:e.direction=="bottom"?o.topCenter:o.bottomCenter;n.targetPoint=this._findIntersection(r,o,n,n.targetPoint,o.center,f)||n.targetPoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,e);this._setLineEndPoint(n,n.targetPoint,f)}else this._dockNodeToPoint(n,l,r,f);else this._dockNodeToPoint(n,l,r,f);else this._dockNodeToPoint(n,l,r,f);else if(i.type=="orthogonal"&&n.segments[1]&&n.segments[1].type=="orthogonal")if(n.segments[0]._isInternal&&t.datavisualization.Diagram.Geometry.containsPoint(o,i._endPoint))this._insertSegmentAtSourceEnd(n,i,o,r,f);else if(t.datavisualization.Diagram.Geometry.containsPoint(o,i._endPoint))this._removeFirstSegment(n,i,o,r,f);else{switch(i.direction){case"left":h="left";s=o.middleLeft;break;case"right":h="right";s=o.middleRight;break;case"top":h="top";s=o.topCenter;break;case"bottom":h="bottom";s=o.bottomCenter}i.points=[];s=this._findIntersection(r,o,n,s,o.center,f)||s;i.points.push(s);i.points.push(i._endPoint);this._setLineEndPoint(n,s,f)}else this._dockNodeToPoint(n,i._endPoint,r,f)}},_removeLastSegment:function(n,t,i,r,u,f){n.segments.splice(n.segments.length-1,1);i.length=i._length=null;i.direction=null;i._direction=t._direction;this._dock(n,i,r,u,f)},_insertSegmentAtSourceEnd:function(n,t,i,r,u){var f=n.segments[1],e=n.segments[2],s,o;n.segments[0].direction=="left"||n.segments[0].direction=="right"?(s="horizontal",n.sourcePoint=f.direction=="top"?i.topCenter:i.bottomCenter,f&&(f.length||f.length===0)&&(f._length=f.length=Math.max(Math.abs(n.sourcePoint.y-f._endPoint.y),25)),e&&(e.length||e.length===0)&&(e.length=e._length=Math.abs(i.topCenter.x-e._endPoint.x))):(s="vertical",n.sourcePoint=f.direction=="left"?i.middleLeft:i.middleRight,f&&(f.length||f.length===0)&&(f._length=f.length=Math.max(Math.abs(n.sourcePoint.x-f._endPoint.x),25)),e&&(e.length||e.length===0)&&(e.length=e._length=Math.abs(i.middleRight.y-e._endPoint.y)));n.segments[3]&&(n.segments[3].length||n.segments[3].length==0)&&(o=f.direction=="bottom"||f.direction=="right"?f.length:-f.length,n.segments[3].length=n.segments[3]._length=s=="vertical"?Math.abs(n.sourcePoint.x+o-n.segments[3]._endPoint.x):Math.abs(n.sourcePoint.y+o-n.segments[3]._endPoint.y),n.segments[3].length<0&&(o=f.direction=="bottom"||f.direction=="right"?f.length:-f.length,n.segments[3].length=n.segments[3]._length=s=="vertical"?Math.abs(n.sourcePoint.x+o-n.segments[3]._endPoint.x):Math.abs(n.sourcePoint.y+o-n.segments[3]._endPoint.y)));n.segments.splice(0,1);n.sourcePoint=this._findIntersection(r,i,n,n.sourcePoint,i.center,u)||n.sourcePoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);this._setLineEndPoint(n,n.sourcePoint,u)},_removeFirstSegment:function(n,i,r,u,f){var h,c,e=n.segments[1].direction||this._getBezierDirection(n.segments[1].points[0],n.segments[1].points[1]),o,l,s,a;e=="left"||e=="right"?(o=i._endPoint.y-r.middleRight.y,n.segments[0].direction=n.segments[0]._direction=o>=0?"bottom":"top",n.segments[0].length=n.segments[0]._length=Math.abs(o),l=e=="right"?n.segments[1]._endPoint.x-r.right:r.left-n.segments[1]._endPoint.x,n.sourcePoint=e=="left"?r.middleLeft:r.middleRight,h=Math.abs(n.sourcePoint.x-n.segments[0]._startPoint.x),c=Math.abs(n.sourcePoint.y-n.segments[0]._endPoint.y)):((n.segments[0].length||n.segments[0].length==0)&&(o=i._endPoint.x-r.bottomCenter.x,n.segments[0].direction=n.segments[0]._direction=o>=0?"right":"left",n.segments[0].length=n.segments[0]._length=Math.abs(o)),l=e=="bottom"?n.segments[1]._endPoint.y-r.bottom:r.top-n.segments[1]._endPoint.y,n.sourcePoint=e=="top"?r.topCenter:r.bottomCenter,h=Math.abs(n.sourcePoint.y-n.segments[0]._startPoint.y),c=Math.abs(n.sourcePoint.x-n.segments[0]._endPoint.x));n.segments[1]&&(n.segments[1].length||n.segments[1].length===0)&&(n.segments[1]._length=n.segments[1].length=l-25,n.segments[1]._length<0&&(n.segments.splice(0,2),(n.segments[0].length||n.segments[0].length===0)&&(n.segments[0].length=n.segments[0]._length=h),s=t.datavisualization.Diagram.Segment({type:"orthogonal",length:c,direction:e})));s||(s=t.datavisualization.Diagram.Segment({type:"orthogonal",length:25,direction:e}));a=[s];s._isInternal=!0;n.segments=a.concat(n.segments);n.sourcePoint=this._findIntersection(u,r,n,n.sourcePoint,r.center,f)||n.sourcePoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);this._setLineEndPoint(n,n.sourcePoint,f)},_dockNodeToPoint:function(n,t,i,r){var l,u,v,y,h,a;if(l=r?n.segments[n.segments.length-1]:n.segments[0],l.type!="orthogonal")u=this.bounds(i),this._swapBounds(i,u),this._setLineEndPoint(n,u.center,r),this._dockBounds(n,i,u,r);else{u=this.bounds(i);this._swapBounds(i,u);var f,e,o,s=t,c=n.segments[n.segments.length-2],k=Math.abs(s.x-u.left),p=Math.abs(s.x-u.right),w=Math.abs(s.y-u.top),b=Math.abs(s.y-u.bottom);c&&r&&(v=c.direction=="left"||c.direction=="right",y=c.direction=="top"||c.direction=="bottom");l=r?n.segments[n.segments.length-1]:n.segments[0];l.points.length!=2&&c||l.type!="orthogonal"||(v=y=!1);u.bottom<s.y&&!v?(e="bottom",o="top",f=u.bottomCenter):u.y>s.y&&!v?(e="top",o="bottom",f=u.topCenter):u.right<s.x&&!y?(e="right",o="left",f=u.middleRight):u.x>s.x&&!y?(e="left",o="right",f=u.middleLeft):(h=k,f=u.middleLeft,e="left",o="right",h>=p&&p!=0&&(f=u.middleRight,e="right",o="left",h=p),h>w&&w!=0&&(f=u.topCenter,e="top",o="bottom",h=w),h>b&&b!=0&&(f=u.bottomCenter,e="bottom",o="top",h=b));f&&(r||n.segments.length==1?(a=n.segments[n.segments.length-1],a.type=="orthogonal"&&(a._direction=r?o:e)):a=n.segments[0],f=this._findIntersection(i,u,n,f,u.center,r)||f,r?n.targetPoint=f:n.sourcePoint=f,n.segments.length!=1&&this._addOrthogonalPoints(a,r?n.segments[n.segments.length-2]:null,r?null:n.segments[1],n.sourcePoint,n.targetPoint),this._setLineEndPoint(n,f,r))}},_getDockSegment:function(n,i,r,u,f,e){var o=this._getEdges(r,u),e="",s,h,c=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint);return(h=f?t.datavisualization.Diagram.LineSegment(i.points[i.points.length-2],i.points[i.points.length-1]):c>5?t.datavisualization.Diagram.LineSegment(i._startPoint,i._endPoint):t.datavisualization.Diagram.LineSegment(i._startPoint,n.segments[1]?n.segments[1]._endPoint:n.targetPoint),t.datavisualization.Diagram.Geometry.intersectSegment(h,o.left)?(s=o.left,e="left"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.top)?(s=o.top,e="top"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.right)?(s=o.right,e="right"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.bottom)&&(s=o.bottom,e="bottom"),e=this._swapDirection(r,e),s)?{dockPoint:t.datavisualization.Diagram.Geometry.midPoint(s),direction:e}:null},_dockBounds:function(n,t,i,r){var u,f,e,o;u=r?n.segments[n.segments.length-1]:n.segments[0];f=u._startPoint;e=u._endPoint||u.point;u.type=="bezier"&&(u.point1||u.point2)&&(r?f=u._point2:e=u._point1);o=this._findIntersection(t,i,n,f,e,r);o&&(this._setLineEndPoint(n,o,r),u.type==="bezier"&&this._updateBezierPoints(u))},_findIntersection:function(i,r,u,f,e,o){var l,rt=o?u.segments[u.segments.length-1]:u.segments[0],p,v,g,nt,a,w,s,k,c,y,h,tt;if(rt.type=="orthogonal"&&(f={x:f.x,y:f.y},f.x==e.x&&(f.y<e.y?f.y-=5:f.y+=5),f.y==e.y&&(f.x<e.x?f.x-=5:f.x+=5)),i._shape==="polygon")for(a=i.points.length,l=n.extend(!1,{},i.points),t.datavisualization.Diagram.Geometry.updatePolygonPoints(i,l),s=0;s<a;s++){if(c=t.datavisualization.Diagram.Point(l[s].x+(i.offsetX-i.width/2),l[s].y+(i.offsetY-i.height/2)),i.rotateAngle!=0&&(y=t.Matrix.identity(),t.Matrix.rotate(y,i.rotateAngle,i.offsetX,i.offsetY),c=t.Matrix.transform(y,c)),i.connectorPadding||u.sourcePadding||u.targetPadding){var ut=i.offsetX==c.x?0:i.offsetX<c.x?1:-1,ft=i.offsetY==c.y?0:i.offsetY<c.y?1:-1,h=i.connectorPadding;h+=o?u.targetPadding:u.sourcePadding;c=h?t.datavisualization.Diagram.Geometry.translate(c,ut*h,ft*h):c}l[s]=c}else if(i._shape==="path"){for(p=document.createElementNS("http://www.w3.org/2000/svg","svg"),p.setAttribute("xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(p),v=document.createElementNS("http://www.w3.org/2000/svg","path"),v.setAttributeNS(null,"d",i.pathData),p.appendChild(v),g=v.getBBox(),h=i.connectorPadding,h+=o?u.targetPadding:u.sourcePadding,nt=t.datavisualization.Diagram.Geometry.updatePath(-h,-h,i.width+2*h,i.height+2*h,i.pathData,p,g),v.setAttributeNS(null,"d",nt),a=v.getTotalLength(),w=[],s=0;s<a-1;s++)k=v.getPointAtLength(s),c=t.datavisualization.Diagram.Point(k.x+(i.offsetX-i.width/2),k.y+(i.offsetY-i.height/2)),i.rotateAngle!=0&&(y=t.Matrix.identity(),t.Matrix.rotate(y,i.rotateAngle,i.offsetX,i.offsetY),c=t.Matrix.transform(y,c)),w[s]=c;a=w.length;l=w;document.body.removeChild(p)}else(i.connectorPadding||u.sourcePadding||u.targetPadding)&&(h=i.connectorPadding,h+=o?u.targetPadding:u.sourcePadding,tt=t.datavisualization.Diagram.Rectangle(r.x-h,r.y-h,i.width+2*h,i.height+2*h),r=this.bounds(tt)),a=r.points.length,l=r.points;var it=t.datavisualization.Diagram.LineSegment(f,e),s,d=t.datavisualization.Diagram.LineSegment(l[a-1],l[0]),b=t.datavisualization.Diagram.Geometry.intersectSegment(it,d);if(!b)for(s=0;s<a-1;s++)if(d=t.datavisualization.Diagram.LineSegment(l[s],l[s+1]),b=t.datavisualization.Diagram.Geometry.intersectSegment(it,d),b)break;return b},_getEdges:function(n,i){var u=i.points,r={},e=n%360,f;return r.left=t.datavisualization.Diagram.LineSegment(u[3],u[0]),r.top=t.datavisualization.Diagram.LineSegment(u[0],u[1]),r.right=t.datavisualization.Diagram.LineSegment(u[1],u[2]),r.bottom=t.datavisualization.Diagram.LineSegment(u[2],u[3]),e<0&&(e+=360),e>315||e<45||(e<135?(f=r.top,r.top=r.left,r.left=r.bottom,r.bottom=r.right,r.right=f):e<225?(f=r.top,r.top=r.bottom,r.bottom=f,f=r.left,r.left=r.right,r.right=f):(f=r.bottom,r.bottom=r.left,r.left=r.top,r.top=r.right,r.right=f)),r},_pointsFromNodeToPoint:function(n,t,i,r,u,f,e,o){var s=[],l,h,c;s.push(f);l=f.y==e.y&&(i=="left"&&e.x<f.x||i=="right"&&e.x>f.x)||f.x==e.x&&(i=="top"&&e.y<f.y||i=="bottom"&&e.y>f.y);u==0&&(l||o||(l=f.x>r.left&&f.x<r.right&&f.y>r.top&&f.y<r.bottom));l||(i=="top"||i=="bottom"?i=="top"&&e.y<f.y||i=="bottom"&&e.y>f.y?s.push({x:f.x,y:e.y}):(e.x<r.left||e.x>r.right)&&e.y!=f.y?(h=i=="top"?r.top-15:r.bottom+15,s.push({x:f.x,y:h}),s.push({x:e.x,y:h})):(h=i=="top"?r.top-15:r.bottom+15,c=e.x<f.x?r.left-15:r.right+15,s.push({x:f.x,y:h}),s.push({x:c,y:h}),s.push({x:c,y:e.y})):i=="left"&&e.x<f.x||i=="right"&&e.x>f.x?s.push({x:e.x,y:f.y}):(e.y<r.top||e.y>r.bottom)&&e.x!=f.x?(c=i=="left"?r.left-15:r.right+15,s.push({x:c,y:f.y}),s.push({x:c,y:e.y})):(h=e.y<f.y?r.top-15:r.bottom+15,c=i=="left"?r.left-15:r.right+15,s.push({x:c,y:f.y}),s.push({x:c,y:h}),s.push({x:e.x,y:h})));s.push(e);o&&s.reverse();t._startPoint=s[0];t._endPoint=s[s.length-1];t.points=s;t.direction&&(t.direction=="left"||t.direction=="right"?(t.length=t._length=Math.abs(t._startPoint.x-t._endPoint.x),t._direction=t._startPoint.x<t._endPoint.x?t.direction="right":t.direction="left"):(t.length=t._length=Math.abs(t._startPoint.y-t._endPoint.y),t._direction=t._startPoint.y<t._endPoint.y?t.direction="bottom":t.direction="top"))},_constructSegements:function(n,t,i,r,u,f,e,o){var s,l,h,c;for(o==="right"&&(u==="left"?s=this._rightToLeft(i,r,f,e):u==="right"?s=this._rightToRight(i,r,f,e):u==="top"?s=this._rightToTop(i,r,f,e):u==="bottom"&&(s=this._rightToBottom(i,r,f,e))),o==="left"&&(u==="right"&&(s=this._rightToLeft(f,e,i,r),l=!0),u==="left"&&(s=this._leftToLeft(i,r,f,e)),u==="top"&&(s=this._leftToTop(i,r,f,e)),u==="bottom"&&(s=this._leftToBottom(i,r,f,e))),o==="top"&&(u==="left"&&(s=this._leftToTop(f,e,i,r),l=!0),u==="right"&&(s=this._rightToTop(f,e,i,r),l=!0),u==="top"&&(s=this._topToTop(i,r,f,e)),u==="bottom"&&(s=this._topToBottom(i,r,f,e))),o==="bottom"&&(u==="left"&&(s=this._leftToBottom(f,e,i,r),l=!0),u==="right"&&(s=this._rightToBottom(f,e,i,r),l=!0),u==="top"&&(s=this._topToBottom(f,e,i,r),l=!0),u==="bottom"&&(s=this._bottomToBottom(i,r,f,e))),l&&s.reverse(),h=s[s.length-1],c=s[s.length-2];s.length>2&&h.x==c.x&&h.y==c.y;)s.splice(s.length-1,1),h=s[s.length-1],c=s[s.length-2];for(h=s[0],c=s[1];s.length>2&&h.x==c.x&&h.y==c.y;)s.splice(0,1),h=s[0],c=s[1];t._startPoint=s[0];t._endPoint=s[s.length-1];t.points=s},_updateIntermediateSegments:function(n){var u=n.segments[0]._endPoint,r=n.segments[0],f=r.points.length,i;n.segments[1]&&(i=n.segments[1],i._startPoint=u,i.type=="orthogonal"&&(i.length||i.length===0)?(i.direction=="left"||i.direction=="right"?(n.segments[2]&&(n.segments[2].length||n.segments[2].length===0)&&(n.segments[2].direction=="top"?n.segments[2].length+=i._startPoint.y-i._endPoint.y:n.segments[2].length-=i._startPoint.y-i._endPoint.y,n.segments[2].length<0&&(n.segments[2].length*=-1,n.segments[2].direction=n.segments[2]._direction=i.direction=="right"?"left":"right"),n.segments[2]._length=n.segments[2].length),i._endPoint.y=i._startPoint.y):(n.segments[2]&&(n.segments[2].length||n.segments[2].length===0)&&(n.segments[2].direction=="left"?n.segments[2].length+=i._startPoint.x-i._endPoint.x:n.segments[2].length-=i._startPoint.x-i._endPoint.x,n.segments[2].length<0&&(n.segments[2].length*=-1,n.segments[2].direction=n.segments[2]._direction=i.direction=="bottom"?"top":"bottom"),n.segments[2]._length=n.segments[2].length),i._endPoint.x=i._startPoint.x),n.sourcePort&&r.points.length>2&&(i.direction=="left"||i.direction=="right"?r.points[r.points.length-1].y==r.points[r.points.length-2].y&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1],i.points.length==2&&(i._endPoint.y=i._startPoint.y)):r.points[r.points.length-1].x==r.points[r.points.length-2].x&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1],i.points.length==2&&(i._endPoint.x=i._startPoint.x))),(i.length||i.length===0)&&(i.length=i._length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i.points[1])),i.length>0&&(i.direction=i._direction=this._getBezierDirection(i._startPoint,i._endPoint)||i._direction),this._addOrthogonalPoints(i,r,n.segments[2],n.sourcePoint,n.targetPoint),n.segments[2]&&this._addOrthogonalPoints(n.segments[2],n.segments[1],n.segments[3],n.sourcePoint,n.targetPoint)):i.type=="orthogonal"&&i.length===null?(n.sourcePort&&r.points.length>2&&(i._direction=="left"||i._direction=="right"?r.points[r.points.length-1].y==r.points[r.points.length-2].y&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1]):r.points[r.points.length-1].x==r.points[r.points.length-2].x&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1])),i._startPoint=i.points[0]=n.segments[0]._endPoint,this._addOrthogonalPoints(n.segments[1],n.segments[0],null,n.sourcePoint,n.targetPoint)):(i._startPoint=i.points[0]=n.segments[0]._endPoint,i.type=="bezier"&&this._updateBezierPoints(i)))},_updatePreviousSegment:function(n){var i=n.segments[n.segments.length-2],r=n.segments[n.segments.length-1],u,f,e;i&&(i.type=="orthogonal"&&r.points.length>2&&(u=!1,f=i.points.length==2?i.direction:t.datavisualization.Diagram.Util._getBezierDirection(i.points[i.points.length-2],i.points[i.points.length-1]),f=="left"||f=="right"?r.points[0].y==r.points[1].y&&(u=!0,e=r.points[1].x-r.points[0].x,r.points.splice(0,1),r._startPoint=r.points[0],i._endPoint=r.points[0]):r.points[0].x==r.points[1].x&&(u=!0,r.points.splice(0,1),r._startPoint=r.points[0],i._endPoint=r.points[0])),i._endPoint=r._startPoint,i.points[i.points.length-1]=r._startPoint,i.type=="orthogonal"&&u?(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length>0&&(i._direction=i.direction=this._getBezierDirection(i._startPoint,i._endPoint)),(n.segments.length>2||!n.sourcePort)&&this._addOrthogonalPoints(i,n.segments[n.segments.length-3],r,n.sourcePoint,n.targetPoint)):i.point=r._startPoint)},_initConnectionEnds:function(n,i){var u,r,f;if(n.segments&&n.segments[0]&&n.segments[0].type=="orthogonal"&&n.segments[0].length){if(n.sourceNode)if(r=t.datavisualization.Diagram.Util.bounds(i.nameTable[n.sourceNode],!0),n.sourcePort)u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.sourceNode],n.sourcePort),n.sourcePoint=t.datavisualization.Diagram.Util._getPortPosition(u,r);else{f=n.segments[0];switch(f.direction){case"left":n.sourcePoint=r.middleLeft;break;case"right":n.sourcePoint=r.middleRight;break;case"top":n.sourcePoint=r.topCenter;break;case"bottom":n.sourcePoint=r.bottomCenter}}if(n.targetNode)if(r=t.datavisualization.Diagram.Util.bounds(i.nameTable[n.targetNode],!0),n.targetPort)u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.targetNode],n.targetPort),n.targetPoint=t.datavisualization.Diagram.Util._getPortPosition(u,r);else{f=n.segments[0];switch(f.direction){case"left":n.targetPoint=r.middleLeft;break;case"right":n.targetPoint=r.middleRight;break;case"top":n.targetPoint=r.topCenter;break;case"bottom":n.targetPoint=r.bottomCenter}}}},_swapDirection:function(n,t){var u,i=n%360,r;return i<0&&(i+=360),i>315||i<45?u=t:i<135?(r={left:"top",top:"right",right:"bottom",bottom:"left"},u=r[t]):i<225?(r={left:"right",top:"bottom",right:"left",bottom:"top"},u=r[t]):(r={left:"bottom",top:"left",right:"top",bottom:"right"},u=r[t]),u},_getIntersectionPoint:function(n,i,r){var u,o=r.length,f,e=t.datavisualization.Diagram.Segment(r[o-1],r[0]);if(n.type!="ellipse"&&(u=t.datavisualization.Diagram.Geometry.intersectSegment(i,e)),u)return u;for(f=0;f<o-1;f++)if(e=t.datavisualization.Diagram.Segment(r[f],r[f+1]),u=t.datavisualization.Diagram.Geometry.intersectSegment(i,e),u)return u},_getEllipseIntersectCoords:function(n,t){var i=[],u,s=n.width/2,h=n.height/2,v=n.offsetX-n.width/2,y=n.offsetY-n.height/2,c="M "+(n.offsetX-n.width/2)+", "+n.offsetY+" A "+s+" "+h+" 0 0 1 "+(n.offsetX+n.width/2)+", "+n.offsetY,r=document.createElementNS("http://www.w3.org/2000/svg","path"),e,o,f,l,a;for(r.setAttributeNS(null,"d",c),e=r.getTotalLength(),o=[],f=0;f<e-1;f++)l=r.getPointAtLength(f),o[f]=l;if((i=o,u=this._getIntersectionPoint(n,t,i),u)||(i=[],i[0]=r.getPointAtLength(0),a="M "+(n.offsetX-n.width/2)+", "+n.offsetY+" A "+s+" "+h+" 0 0 0 "+(n.offsetX+n.width/2)+", "+n.offsetY,r.setAttributeNS(null,"d",a),e=r.getTotalLength(),i[1]=r.getPointAtLength(0),u=this._getIntersectionPoint(n,t,i),u))return u;for(i=[],f=0;f<e-1;f++)i[f]=r.getPointAtLength(f);return(u=this._getIntersectionPoint(n,t,i),u)?u:(i=[],i[0]=r.getPointAtLength(e),r.setAttributeNS(null,"d",c),e=r.getTotalLength(),i[1]=r.getPointAtLength(e-1),u=this._getIntersectionPoint(n,t,i),u?u:void 0)},_rightToLeft:function(n,i,r,u){var o=[],e,f,h,s;return o.push(u),h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),i.x>u.x?u.y!=i.y&&(u.x+h>=n.left?(e=r.right+h,f=u.y,o.push(t.datavisualization.Diagram.Point(e,f)),f=i.y>r.top?i.y:n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f)),i.y<=r.top&&(e=n.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.top-s,o.push(t.datavisualization.Diagram.Point(e,f)),e=i.x,o.push(t.datavisualization.Diagram.Point(e,f)))):(e=r.right+(n.left-r.right)/2,f=u.y,o.push(t.datavisualization.Diagram.Point(e,f)),f=i.y,o.push(t.datavisualization.Diagram.Point(e,f)))):(Math.abs(n.top-r.bottom)<30||Math.abs(n.bottom-r.top)<30?u.x+h>n.right?(e=u.x+h,f=u.y):(e=n.right+s,f=u.y):(e=r.right+h,f=u.y),o.push(t.datavisualization.Diagram.Point(e,f)),n.top-r.bottom>=30?(f=n.top-s,o.push(t.datavisualization.Diagram.Point(e,f))):u.y>i.y?(f=r.top-n.bottom<30?n.top-s:n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))),e=n.left-s,o.push(t.datavisualization.Diagram.Point(e,f)),f=i.y,o.push(t.datavisualization.Diagram.Point(e,f))),o.push(i),o},_rightToRight:function(n,i,r,u){var o=[],f,e,h,s;return o.push(u),e=u.y,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),n.right>=r.left?u.y>=n.top&&u.y<=n.bottom?(f=u.x+h,o.push(t.datavisualization.Diagram.Point(f,e)),u.y>=n.center.y?(e=u.x>n.left?u.y>i.y?n.bottom+s:n.top-s:n.top-s,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.right+s,o.push(t.datavisualization.Diagram.Point(f,e))):(e=n.bottom+s,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.right+s,o.push(t.datavisualization.Diagram.Point(f,e)))):n.right<r.right?(f=r.right+h,o.push(t.datavisualization.Diagram.Point(f,e))):(f=i.x+s,o.push(t.datavisualization.Diagram.Point(f,e))):(f=u.x+h,o.push(t.datavisualization.Diagram.Point(f,e)),i.y>=r.top&&i.y<=r.bottom&&(i.y<=r.center.y?(e=r.top-h,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.right+s,o.push(t.datavisualization.Diagram.Point(f,e))):(e=r.bottom+h,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.right+s,o.push(t.datavisualization.Diagram.Point(f,e))))),o.push(t.datavisualization.Diagram.Point(f,i.y)),o.push(i),o},_rightToTop:function(n,i,r,u){var e=[],o,f,s,h;return e.push(u),f=u.y,s=15,h=15,r.width==0&&(s=0),n.width==0&&(h=0),i.x>=u.x?u.y+s>=i.y&&n.height!==0&&(o=n.left<=r.right?n.right+h:n.left-r.right>30?r.right+s:r.right+(n.left-r.right)/2,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.top-h,e.push(t.datavisualization.Diagram.Point(o,f))):r.bottom>=n.top?(o=u.x+s<=n.right?n.right+h:r.right+s,e.push(t.datavisualization.Diagram.Point(o,f)),f=r.top>=n.top?n.height!==0?n.top-h:i.y:r.top-s,e.push(t.datavisualization.Diagram.Point(o,f))):(o=u.x+s,e.push(t.datavisualization.Diagram.Point(o,f)),n.top-r.bottom<30&&n.height!==0?r.left-n.right>=30?(f=r.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f)),o=r.left-s,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.top-h,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.top-(n.top-r.bottom)/2,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.height!==0?n.top-h:i.y,e.push(t.datavisualization.Diagram.Point(o,f)))),e.push(t.datavisualization.Diagram.Point(i.x,f)),e.push(i),e},_rightToBottom:function(n,i,r,u){var o=[],e,f,s,h;return o.push(u),f=u.y,s=15,h=15,r.width==0&&(s=0),n.width==0&&(h=0),i.x>=u.x?u.y<=n.bottom?n.left>r.right+s?(e=u.x+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f))):(e=n.right+h,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f))):r.right+s>i.x?(e=u.x+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.top-n.bottom>30?n.bottom+h:n.bottom+(r.top-n.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f))):f=u.y:u.y<=n.bottom?(e=r.right+s>n.right?r.right+s:n.right+h,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+h,f<=r.bottom+s&&(f=r.bottom+s),o.push(t.datavisualization.Diagram.Point(e,f))):n.bottom<r.top?(e=r.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.top-n.bottom<30?n.bottom+(r.top-n.bottom)/2:n.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f))):(e=r.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))),o.push(t.datavisualization.Diagram.Point(i.x,f)),o.push(i),o},_leftToLeft:function(n,i,r,u){var o=[],f,e,h,s;return o.push(u),e=u.y,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),i.x>=u.x?(f=r.left-h,o.push(t.datavisualization.Diagram.Point(f,e)),u.y>i.y?i.y+s>=r.top?(e=r.top-h,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.left-r.right>30?n.left-s:r.right+(n.left-r.right)/2,o.push(t.datavisualization.Diagram.Point(f,e))):(e=i.y,o.push(t.datavisualization.Diagram.Point(f,e)),f=i.x):r.bottom+h<i.y?(e=i.y,o.push(t.datavisualization.Diagram.Point(f,e)),f=i.x):(e=r.bottom+h,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.left-r.right>30?n.left-s:r.right+(n.left-r.right)/2,o.push(t.datavisualization.Diagram.Point(f,e)))):(i.y>u.y?u.y>n.top-s&&(f=r.left-n.right<30?n.right+(r.left-n.right)/2:r.left-h,o.push(t.datavisualization.Diagram.Point(f,e)),e=n.top-s,o.push(t.datavisualization.Diagram.Point(f,e))):n.bottom+s>=u.y&&(f=r.left-n.right<30?n.right+(r.left-n.right)/2:r.left-h,o.push(t.datavisualization.Diagram.Point(f,e)),e=n.bottom+s,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.left-s,o.push(t.datavisualization.Diagram.Point(f,e))),f=n.left-s,o.push(t.datavisualization.Diagram.Point(f,e))),o.push(t.datavisualization.Diagram.Point(f,i.y)),o.push(i),o},_leftToTop:function(n,i,r,u){var f=[],h,e,o,s;return f.push(u),e=u.y,o=15,s=15,r.width==0&&(o=0),n.width==0&&(s=0),u.x<=i.x?(h=u.y>i.y&&n.left<=r.left?n.left-s:r.left-o,f.push(t.datavisualization.Diagram.Point(h,e)),e=r.bottom<=n.top?r.bottom+o<n.top?n.height!==0?n.top-s:i.y:i.x<r.right?r.bottom+(n.top-r.bottom)/2:r.top-o:r.top>=n.top?n.height!==0?n.top-s:i.y:r.top-o,f.push(t.datavisualization.Diagram.Point(h,e))):i.y<=u.y+o&&(h=r.left-n.right>30?r.left-o:n.right>=r.left?n.left-s:n.right+(r.left-n.right)/2,f.push(t.datavisualization.Diagram.Point(h,e)),e=n.top-s,f.push(t.datavisualization.Diagram.Point(h,e))),f.push(t.datavisualization.Diagram.Point(i.x,e)),f.push(i),f},_leftToBottom:function(n,i,r,u){var e=[],o,f,h,s;return e.push(u),f=u.y,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),u.x<=i.x?(o=n.left<=u.x&&u.y<=n.top?n.left-s:r.left-h,e.push(t.datavisualization.Diagram.Point(o,f)),n.bottom<r.top?(f=r.top-n.bottom<30?n.bottom+(r.top-n.bottom)/2:n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.bottom<r.bottom?r.bottom+h:n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f)))):u.y>i.y||(o=n.right>=r.left?n.left-s:r.left-n.right<30?r.left-(r.left-n.right)/2:r.left-h,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))),e.push(t.datavisualization.Diagram.Point(i.x,f)),e.push(i),e},_topToTop:function(n,i,r,u){var o=[],e,f,h,s;return o.push(u),e=u.x,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),i.x>=u.x?i.y>=u.y?(f=r.top-h,o.push(t.datavisualization.Diagram.Point(e,f)),i.x<=r.right&&(e=r.right+h,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.height!==0?n.top-r.bottom>30?n.top-s:r.bottom+(n.top-r.bottom)/2:i.y,o.push(t.datavisualization.Diagram.Point(e,f)))):n.left<=u.x?(f=r.top-n.bottom>30?r.top-h:n.bottom+(r.top-n.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f)),e=n.left-s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.top-s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.height!==0?n.top-s:i.y,o.push(t.datavisualization.Diagram.Point(e,f))):i.y>=u.y?(f=r.top-h,o.push(t.datavisualization.Diagram.Point(e,f)),i.x>=r.left&&(e=r.left-h,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.height!==0?n.top-r.bottom>30?n.top-s:r.bottom+(n.top-r.bottom)/2:i.y,o.push(t.datavisualization.Diagram.Point(e,f)))):n.right>=u.x?(f=r.top-n.bottom>30?r.top-h:n.bottom+(r.top-n.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f)),e=n.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.top-s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.height!==0?n.top-s:i.y,o.push(t.datavisualization.Diagram.Point(e,f))),e=i.x,o.push(t.datavisualization.Diagram.Point(e,f)),o.push(i),o},_topToBottom:function(n,i,r,u){var e=[],o,f,h,s,c;return e.push(u),o=u.x,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),c=30,i.x>u.x?(r.top>=n.bottom?r.top-n.bottom>=30?(f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.bottom+(r.top-n.bottom)/2,e.push(t.datavisualization.Diagram.Point(o,f)),o=n.left-r.right>=30?r.right+h:r.right+(n.left-r.right)/2,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.top<r.top?n.left>=r.right+15?r.top-h:n.top-s:r.top-h,e.push(t.datavisualization.Diagram.Point(o,f)),o=n.left>=r.right+15?r.right+h:n.right+s,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))),e.push(t.datavisualization.Diagram.Point(i.x,f))):i.x<u.x&&(r.top>=n.bottom?r.top-n.bottom>30?(f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.bottom+(r.top-n.bottom)/2,e.push(t.datavisualization.Diagram.Point(o,f)),o=r.left-n.right>=30?r.left-h:n.right+(r.left-n.right)/2,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=r.left>=n.right+15?r.top-h:r.top-h,e.push(t.datavisualization.Diagram.Point(o,f)),o=r.left>=n.right+15?n.right+s:r.right+h,e.push(t.datavisualization.Diagram.Point(o,f)),f=r.left>=n.right+15?n.bottom+s:n.bottom<=r.bottom?r.bottom+h:n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))),e.push(t.datavisualization.Diagram.Point(i.x,f))),e.push(i),e},_bottomToBottom:function(n,i,r,u){var o=[],e,f,h,s;return o.push(u),e=u.x,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),i.x>=u.x?r.bottom>=n.bottom?(f=r.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f)),i.x<r.right&&(e=r.right+h,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.top>=n.bottom?r.top-n.bottom>=30?n.bottom+s:n.bottom+(r.top-n.bottom)/2:n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f)))):u.x>n.left?(f=n.bottom-r.bottom>=30?r.bottom+h:r.bottom+(n.bottom-r.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f)),e=n.left-s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))):r.bottom>=n.bottom?(f=r.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f)),i.x>r.left&&(e=r.left-h,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.top>=n.bottom?r.top-n.bottom>=30?n.bottom+s:n.bottom+(r.top-n.bottom)/2:n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f)))):u.x<n.right?(f=n.bottom-r.bottom>=30?r.bottom+h:r.bottom+(n.bottom-r.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f)),e=n.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))),o.push(t.datavisualization.Diagram.Point(i.x,f)),o.push(i),o},_addOrthogonalPoints:function(n,i,r,u,f,e){var l=[],s=i?i._endPoint:u,p,o,h,y;l.push(s);n._direction||(n._direction=this._getOrthoDirection(s,f,i));var a=!e&&e!=0?this._directionToAngle(n._direction||this._getBezierDirection(s,f)):e,h=n._direction;if(h=="left"||h=="right"||h=="top"||h=="bottom")a={right:0,left:180,top:270,bottom:90,auto:90}[h];else switch(h){case"straight":a=0;break;case"clockWise90":a+=90;break;case"opposite":a+=180;break;case"antiClockWise90":a+=270}if((n.length||n.length==0)&&n.direction)o=t.datavisualization.Diagram.Geometry.transform(s,a||0,n._length),o.x=Math.round(o.x*100)/100,o.y=Math.round(o.y*100)/100,l.push(o),n._endPoint=o,r&&(r._startPoint=n._endPoint,r.points&&(r.points[0]=n._endPoint,r.type=="bezier"&&this._updateBezierPoints(r)));else{if(s.x!=f.x&&s.y!=f.y||i&&i._startPoint.x==f.x){var v=f.x-(o?o.x:s.x),c=f.y-(o?o.y:s.y);v=Math.abs(v)<=.0001?0:v;c=Math.abs(c)<=.0001?0:c;i?p=i&&i._startPoint.x==f.x?3:v==0||c==0?2:3:(o=t.datavisualization.Diagram.Geometry.transform(s,a,20),p=3);p==3&&(h=n._direction=="auto"?i?i._direction=="left"||i.direction=="right"?"left":"top":"bottom":n._direction,h=="left"||h=="right"||c==0?(c=c>0?c:-c,y=t.datavisualization.Diagram.Geometry.transform(o||s,90,f.y-(o?o.y:s.y))):(v=v>0?v:-v,y=t.datavisualization.Diagram.Geometry.transform(o||s,0,f.x-(o?o.x:s.x))));o&&(o.x=Math.round(o.x*100)/100,o.y=Math.round(o.y*100)/100,l.push(o));y&&(y.x=Math.round(y.x*100)/100,y.y=Math.round(y.y*100)/100,l.push(y))}n._direction=this._getBezierDirection(l[l.length-1],f);l.push(f);n._endPoint=f;r&&(r._startPoint=n._endPoint,r.points||(r.points=[]),r.points[0]=n._endPoint,r.type=="bezier"&&this._updateBezierPoints(r))}return n.points=l,a},_getOrthoDirection:function(n,t,i){if(i){var r=t;return Math.abs(r.x-n.x)>Math.abs(r.y-n.y)&&i&&(i._direction=="left"||i._direction=="right")?n.x<r.x?"right":"left":n.y<r.y?"bottom":"top"}return n.y<t.y?"bottom":n.y>t.y?"top":n.x<t.x?"right":n.x>t.x?"left":void 0},_directionToAngle:function(n){return{right:0,left:180,top:270,bottom:90,auto:90}[n]},_resetOrthogonalPoints:function(n){var t=[],i;t.push(n.sourcePoint);t.push(n.targetPoint);n.points=[];n.sourcePoint=t[0];n.points.push(t[0]);i=this._constructOrthogonalPoints(t[0],t[1]);n.points.push(i[0]);n.points.push(i[1]);n.targetPoint=t[1];n.points.push(t[1])},_updateBezierPoints:function(n,i,r,u,f,e,o){var c,v={right:0,left:180,top:270,bottom:90},s,h,l,a;(n.vector1||n.vector2)&&(n.vector1&&(n._point1=t.datavisualization.Diagram.Geometry.transform(n._startPoint,n.vector1.angle,n.vector1.distance)),n.vector2&&(n._point2=t.datavisualization.Diagram.Geometry.transform(n._endPoint,n.vector2.angle,n.vector2.distance)));(n.point1!=null||n.vector1)&&(n.point2!=null||n.vector2)||(s=n._endPoint,h=n._startPoint,e?(c=o,h=this._getPortPosition(e,c),f.rotateAngle!==0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,f.rotateAngle,f.offsetX,f.offsetY),h=t.Matrix.transform(a,h)),l=this._getDirection(c,h,!0)):l=this._getBezierDirection(h,s),n.vector1||(n._point1=n.point1||this._getBezierAdjPoint(v[l],n._startPoint,n._endPoint)),r?(c=u,s=this._getPortPosition(r,c),i.rotateAngle!==0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,i.rotateAngle,i.offsetX,i.offsetY),s=t.Matrix.transform(a,s)),l=this._getDirection(c,s,!0)):l=this._getBezierDirection(s,h),n.vector2||(n._point2=n.point2||this._getBezierAdjPoint(v[l],n._endPoint,n._startPoint)))},_getBezierDirection:function(n,t){return Math.abs(t.x-n.x)>Math.abs(t.y-n.y)?n.x<t.x?"right":"left":n.y<t.y?"bottom":"top"},_getDirection:function(n,i,r){var l=n.points,s=n.center,f=r?45:180/(2+2/(n.height/n.width)),h=f,e=180-f,o=e+2*f,c=360-f,u=t.datavisualization.Diagram.Geometry.findAngle(i,s);return u>h&&u<e?"top":u>e&&u<o?"right":u>o&&u<c?"bottom":"left"},_getBezierAdjPoint:function(n,i,r){var u=60,f=t.datavisualization.Diagram.Point(0,0),e=n>45&&n<135?"Bottom":n>135&&n<225?"Left":n>225&&n<315?"Top":"Right";switch(e){case"Right":u=Math.min(Math.abs(i.x-r.x)*.45,u);f=t.datavisualization.Diagram.Point(i.x+u,i.y);break;case"Bottom":u=Math.min(Math.abs(i.y-r.y)*.45,u);f=t.datavisualization.Diagram.Point(i.x,i.y+u);break;case"Left":u=Math.min(Math.abs(i.x-r.x)*.45,u);f=t.datavisualization.Diagram.Point(i.x-u,i.y);break;case"Top":u=Math.min(Math.abs(i.y-r.y)*.45,u);f=t.datavisualization.Diagram.Point(i.x,i.y-u)}return f},_setLineEndPoint:function(n,t,i){var o=n,u,r,e,f;t.x=Math.round(t.x*100)/100;t.y=Math.round(t.y*100)/100;i?(u=n.segments[n.segments.length-1],o.targetPoint=t,u.type!="orthogonal"&&(u.point=u._point=t),u.points[u.points.length-1]=t,u._endPoint=t):(o.sourcePoint=t,r=n.segments[0],r.points[0]=t,r._startPoint=t,r.type!="orthogonal"||n.sourcePort||(r.length||r.length===0)&&r.points.length==2&&(r._direction=="left"||r._direction=="right"?(r._endPoint.y=r._startPoint.y,e=Math.abs(r._startPoint.x-r._endPoint.x)):(r._endPoint.x=r._startPoint.x,e=Math.abs(r._startPoint.y-r._endPoint.y)),n.segments[0]._length=e,n.segments[0].length=n.segments[0]._length,n.segments[0].direction=n.segments[0]._direction));f=i?n.segments[n.segments.length-1]:n.segments[0];f.type!=="orthogonal"||(i||n.sourcePort)&&(!i||n.targetPort)||n.sourceNode&&n.targetNode&&!(n.segments.length>1)?f.type==="bezier"&&this._updateBezierPoints(f):(f.points=[],this._addOrthogonalPoints(f,i?n.segments[n.segments.length-2]:null,i?null:n.segments[1],n.sourcePoint,n.targetPoint))},_setBezierPoint:function(n,i,r){r==="bezierpoint1"?n.vector1?(n.vector1={distance:t.datavisualization.Diagram.Geometry.distance(n._startPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(n._startPoint,i)},n._point1=i):n.point1=n._point1=i:n.vector2?(n.vector2={distance:t.datavisualization.Diagram.Geometry.distance(n._endPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(n._endPoint,i)},n._point2=i):n.point2=n._point2=i},_setPoints:function(n,t){n.sourcePoint=n.points[0]=t[0];n.targetPoint=n.points[n.points.length-1]=t[t.length-1];n.points=t;n.type==="bezier"&&(n.point1=t[2]||n.point1,n.point2=t[3]||n.point2,n.point1||(n._point1=n.point1),n.point2||(n._point2=n.point2),this._updateBezierPoints(n))},_updateConnectorSegments:function(n,i,r,u){for(var o,s=n.sourcePoint,f=0;f<n.segments.length;f++){var e=n.segments[f],h=n.segments[f-1],c=n.segments[f+1];e._startPoint=h?h._endPoint:s;f==0&&i||f==n.segments.length-1&&r||(e.type=="orthogonal"?o=t.datavisualization.Diagram.Util._addOrthogonalPoints(e,h,c,n.sourcePoint,n.targetPoint,o):(o=t.datavisualization.Diagram.Geometry.findAngle(s,e._endPoint),e.type=="bezier"&&this._updateBezierPoints(e)));s=e._endPoint}u&&u._dock(n,u.nameTable)},_translateLine:function(n,i,r){for(var u,o,f,e=0;e<n.segments.length;e++){for(u=n.segments[e],o=n.segments[e+1],f=0;f<u.points.length;f++)f==0?(u._startPoint=u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r),e==0&&(n.sourcePoint=u._startPoint)):f==u.points.length-1?(u._endPoint=u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r),e==n.segments.length-1&&(n.targetPoint=u._endPoint)):u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r);u.type===t.datavisualization.Diagram.Segments.Bezier?(u._point1=t.datavisualization.Diagram.Geometry.translate(u._point1,i,r),u._point2=t.datavisualization.Diagram.Geometry.translate(u._point2,i,r),u.point1&&(u.point1=u._point1),u.point2&&(u.point2=u._point2),u.point=u._endPoint):u.type=="straight"&&(u.point=u._point=u._endPoint)}},_adjustPoint:function(n,i,r,u){var f=r?{x:n.x,y:n.y}:{x:i.x,y:i.y},e;return n.x==i.x?n.y<i.y&&r||n.y>i.y&&!r?f.y+=u:f.y-=u:n.y==i.y?n.x<i.x&&r||n.x>i.x&&!r?f.x+=u:f.x-=u:r?(e=t.datavisualization.Diagram.Geometry.findAngle(n,i),f=t.datavisualization.Diagram.Geometry.transform(n,e,u)):(e=t.datavisualization.Diagram.Geometry.findAngle(i,n),f=t.datavisualization.Diagram.Geometry.transform(i,e,u)),f},_getLabelPosition:function(n,i){var r=i.width*n.offset.x,u=i.height*n.offset.y;return n.horizontalAlignment=="left"?r+=n.margin.left:n.horizontalAlignment=="right"&&(r-=n.margin.right),n.verticalAlignment=="top"?u+=n.margin.top:n.verticalAlignment=="bottom"&&(u-=n.margin.bottom),t.datavisualization.Diagram.Point(r,u)},_getPortPosition:function(n,i,r){if(r)return t.datavisualization.Diagram.Point(i.width*n.offset.x,i.height*n.offset.y);var u=i.center.x-i.width/2+i.width*n.offset.x,f=i.center.y-i.height/2+i.height*n.offset.y;return t.datavisualization.Diagram.Point(u,f)},_translate:function(n,i,r,u,f,e){var h,o,s;if(t.datavisualization.Diagram.Util.canMove(n))if(n.segments)t.datavisualization.Diagram.Util._translateLine(n,i,r,n);else if(n.offsetX+=i,n.offsetY+=r,n._type==="group"&&!f){for(h=e._getChildren(n.children),s=0;s<h.length;s++)o=u[h[s]],this._translate(o,i,r,u,null,e),o.parent&&o.parent!=n.name&&n.type!="pseudoGroup"&&t.datavisualization.Diagram.Util._updateGroupBounds(u[o.parent],e);n._type!="group"&&n.container&&t.datavisualization.Diagram.Util._updateGroupBounds(n,e)}},scale:function(n,i,r,u,f,e,o,s,h){var nt,b,v,c,w,a,d,g,l;if(n.container)switch(n.container.type){case"canvas":a={};l=t.Matrix.identity();t.Matrix.rotate(l,-n.rotateAngle,u.x,u.y);t.Matrix.scale(l,i,r,u.x,u.y);t.Matrix.rotate(l,n.rotateAngle,u.x,u.y);k=t.Matrix.transform(l,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY));y=n.width*i;p=n.height*r;o&&(n.minHeight=p,n.minWidth=y);s!=!0?a=h._getMinMaxSize(n,y,p):(a.width=y,a.height=p);a&&a.width>1&&(d=n.offsetX-n.width/2,n.width=a.width,n.offsetX=d+n.width/2);a&&a.height>1&&(g=n.offsetY-n.height/2,n.height=a.height,n.offsetY=g+n.height/2);e||t.datavisualization.Diagram.SvgContext._alignOnCanvas1(n,this,!0);break;case"stack":l=t.Matrix.identity();t.Matrix.rotate(l,-n.rotateAngle,u.x,u.y);t.Matrix.scale(l,i,r,u.x,u.y);t.Matrix.rotate(l,n.rotateAngle,u.x,u.y);k=t.Matrix.transform(l,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY));y=n.width*i-(n.marginLeft+n.marginRight);p=n.height*r-(n.marginTop+n.marginBottom);a=h._getMinMaxSize(n,y,p);a.width>1&&(d=n.offsetX-n.width/2,n.width=a.width-n.marginLeft,n.offsetX=d+n.width/2+n.marginLeft);a.height>1&&(g=n.offsetY-n.height/2,n.height=a.height-n.marginTop,n.offsetY=g+n.height/2+n.marginTop);t.datavisualization.Diagram.SvgContext._alignOnStack(n,h)}else if(l=t.Matrix.identity(),n.segments)for(t.Matrix.scale(l,i,r,u.x,u.y),v=0;v<n.segments.length;v++){for(c=n.segments[v],w=0;w<c.points.length;w++)c.points[w]=t.Matrix.transform(l,c.points[w]),v!=0||w!=0||n.sourceNode||(c._startPoint=c.points[0],c._endPoint=c.points[c.points.length-1],t.datavisualization.Diagram.Util._setLineEndPoint(n,t.Matrix.transform(l,n.sourcePoint),!1)),v!=n.segments.length-1||w!=c.points.length-1||n.targetNode||(c._startPoint=c.points[0],c._endPoint=c.points[c.points.length-1],n.targetPoint=c._endPoint);c._startPoint=c.points[0];c._endPoint=c.points[c.points.length-1];c.type=="orthogonal"?c.length||c.length===0?c.length=c._length=t.datavisualization.Diagram.Geometry.distance(c._startPoint,c._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(c,n.segments[v-1],n.segments[v+1],n.sourcePoint,n.targetPoint):c.point=c._endPoint}else if(n._type==="group"){for(nt=h._getChildren(n.children),v=0;v<nt.length;v++)b=f[nt[v]],b&&(this.scale(b,i,r,u,f),b.parent&&b.parent!=n.name&&n.type!="pseudoGroup"&&t.datavisualization.Diagram.Util._updateGroupBounds(f[b.parent],h));t.datavisualization.Diagram.Util._updateGroupBounds(n,h)}else{t.Matrix.rotate(l,-n.rotateAngle,u.x,u.y);t.Matrix.scale(l,i,r,u.x,u.y);t.Matrix.rotate(l,n.rotateAngle,u.x,u.y);var k=t.Matrix.transform(l,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),y=n.width*i,p=n.height*r;y>1&&(n.width=y,n.offsetX=k.x);p>1&&(n.height=p,n.offsetY=k.y)}},_getIntersectingElement:function(n,i){for(var u,f,r,h,o=t.datavisualization.Diagram.SpatialUtil.findQuads(n._spatialSearch,i),s=[],e=0;e<o.length;e++)if(u=o[e],u.objects.length>0)for(f=0;f<u.objects.length;f++)r=u.objects[f],r.visible&&(h=t.datavisualization.Diagram.Util.bounds(r),t.datavisualization.Diagram.Geometry.intersectsRect(i,h)&&(r=n._sortByZIndex(r,!0),s.push(r)));return s},_updateChildBounds:function(n,i){var u,f,e,o,r,s,h;e=n.width;o=n.height;u=n.offsetX;f=n.offsetY;r=t.datavisualization.Diagram.Util._getChildrenBounds(n,i);n.offsetX=r.x+r.width/2;n.offsetY=r.y+r.height/2;n.height=r.height;n.width=r.width;s=e/n.width;h=o/n.height;this.scale(n,s,h,n.pivot,i.nameTable,null,null,null,i);this._translate(n,u-n.offsetX,f-n.offsetY,i.nameTable,null,i)},_updateGroupBounds:function(n,i,r){var s,h,e,c,l,f,o;if(n&&!n.container&&n&&(n.type==="pseudoGroup"||n.children&&n.children.length>0)){s=n.width;h=n.height;e=n.offsetX;c=n.offsetY;this._updateRotateAngle(n,i.nameTable);var u=this._getChildrenBounds(n,i,r),v=u.x+u.width*n.pivot.x,y=u.y+u.height*n.pivot.y,a=t.Matrix.identity();if(t.Matrix.rotate(a,n.rotateAngle),l=t.Matrix.transform(a,{x:v,y:y}),u&&(n.offsetX=l.x,n.offsetY=l.y,n.width=u.width,n.height=u.height),r){if(f=null,n.children&&n.children.length>0)for(o=0;o<n.children.length;o++)i._getChild(n.children[o])&&(f=i.nameTable[i._getChild(n.children[o])]),f&&(f._type==="group"||f.children&&f.children.length>0)&&this._updateGroupBounds(f,i,r);s&&s!=n.width&&i.scale(n,s/n.width,1,new t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),i.nameTable);h&&h!=n.height&&i.scale(n,1,h/n.height,new t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),i.nameTable);e&&e!=n.offsetX&&i._translate(n,e-n.offsetX,1,i.nameTable);e&&c!=n.offsetY&&i._translate(n,1,c-n.offsetY,i.nameTable)}}},_getChildrenBounds:function(n,i,r){var f=i._getChildren(n.children),e,o=t.datavisualization.Diagram.Rectangle(),u,s,h;for(f.length>0&&(u=i.nameTable[f[0]],u&&(o=this._rotateChildBounds(u,n))),s=0,h=f.length;s<h;s++)u=i.nameTable[f[s]],u&&(u._type==="group"?(this._updateGroupBounds(u,i,r),e=this._rotateChildBounds(u,n)):e=this._rotateChildBounds(u,n)),e&&(o=t.datavisualization.Diagram.Geometry.union(o,e));return o},_updateRotateAngle:function(n,t){var i,r;if(n.offsetX==0&&n.offsetY==0&&n.width==0&&n.height==0)for(i=0;i<n.children.length;i++)if(r=t[n.children[i]],r&&!r.segments&&!n.rotateAngle){n.rotateAngle=r.rotateAngle;return}},_rotateChildBounds:function(n,i){var r=t.Matrix.identity();t.Matrix.rotate(r,-i.rotateAngle);var u=this.bounds(n),f=t.Matrix.transform(r,u.topLeft),e=t.Matrix.transform(r,u.topRight),o=t.Matrix.transform(r,u.bottomLeft),s=t.Matrix.transform(r,u.bottomRight),h=Math.min(f.x,e.x,o.x,s.x),c=Math.min(f.y,e.y,o.y,s.y);return{x:h,width:Math.max(f.x,e.x,o.x,s.x)-h,y:c,height:Math.max(f.y,e.y,o.y,s.y)-c}},updateBridging:function(i,r){var st=this.getPoints(i),s=i.bridgeSpace,f=[],ht=-1,g,vt,ct,nt,tt,it,w,yt,pt,wt,rt,h,l,bt,kt,ft,at,gt,ot,a,e,o,ti,p,d,c,v,y,ii,ri;if(i.segments.length>0)for(g=0;g<i.segments.length;g++)i.segments[g]._bridges=[];if(t.datavisualization.Diagram.Util.canBridge(i,r)){for(vt=t.datavisualization.Diagram.Util.bounds(i),ct=t.datavisualization.Diagram.SpatialUtil.findQuads(r._spatialSearch,vt),nt=0;nt<ct.length;nt++)if(tt=ct[nt],tt.objects.length>0)for(it=0;it<tt.objects.length;it++)if(w=tt.objects[it],w.segments&&w.visible&&(yt=t.datavisualization.Diagram.Util.bounds(i),pt=t.datavisualization.Diagram.Util.bounds(w),t.datavisualization.Diagram.Geometry.intersectsRect(yt,pt)&&(wt=this.getPoints(w),rt=this.interSect(st,wt,!1,r,i.zOrder>w.zOrder?!0:!1),rt.length>0)))for(a=0;a<rt.length;a++){var lt=0,u=0,b=0,k=0,ut=this.getLengthAtFractionPoint(i,rt[a]);if((b=ut.lengthAtFractionPt,lt=ut.fullLength,u=ut.segmentIndex,k=ut.pointIndex,!(u<0))&&i.segments[0])if(bt=(b-s/2)/lt,h=this.getPointAtLength(b-s/2,st),bt=(b+s/2)/lt,l=this.getPointAtLength(b+s/2,st),t.datavisualization.Diagram.Geometry.isEmptyPoint(l)&&(l=h),kt=u===0?i.sourcePoint:i.segments[u-1]._endPoint,v=i.segments[u].type==="straight"?i.segments[u]._point:i.segments[u].points[k],ft=this._findAngle(kt,v),f.length>u&&f[u]!=null){at=u===0?i.sourcePoint:i.segments[u-1]._endPoint;var ui=Math.abs(this.findLength(at,l)),dt=0,et=-1;for(ht=-1,o=0;o<f[u].bridges.length;o++)if(ht++,gt=f[u].bridges[o],dt=Math.abs(this.findLength(at,gt.endPoint)),ui<dt){et=ht;break}et>=0?(ot=this.createSegment(h,l,ft,k,i,r),f[u].bridges.splice(et,0,ot),f[u].bridges.join(),f[u].bridgeStartPoint.splice(et,0,h),f[u].bridgeStartPoint.join(),f[u].segmentIndex=u):(ot=this.createSegment(h,l,ft,k,i,r),f[u].bridges.push(ot),f[u].bridgeStartPoint.push(h),f[u].segmentIndex=u)}else if(!isNaN(h.x)&&!isNaN(h.y)&&!t.datavisualization.Diagram.Geometry.isEmptyPoint(l)){var fi=this.createSegment(h,l,ft,k,i,r),ni=[];ni.push(h);[].push(l);f.length<u+1;f[u]=n.extend(!0,{},t.datavisualization.Diagram.BridgeSegments,{});f[u].bridges.push(fi);f[u].bridgeStartPoint=ni;f[u].segmentIndex=u}}if(f.length!=0)for(a=0;a<f.length;a++)if(e=f[a],e){for(o=1;o<e.bridges.length;o++)this.findLength(e.bridges[o].endPoint,e.bridges[o-1].endPoint)<s&&(e.bridges[o-1].endPoint=e.bridges[o].endPoint,c=e.bridges[o-1],ti=r.getBridgeSegment(c.startPoint,c.endPoint,c.angle,s,c.sweep),e.bridges[o-1].path=ti,e.bridges.splice(o,1),e.bridgeStartPoint.splice(o,1),o--);for(p=i.sourcePoint,d=0;d<e.bridges.length;d++)c=e.bridges[d],i.segments[e.segmentIndex].type==="straight"?v=i.segments[e.segmentIndex]._endPoint:i.segments[e.segmentIndex].type==="orthogonal"&&(v=i.segments[e.segmentIndex].points[c.segmentPointIndex]),u!=0&&(p=i.segments[e.segmentIndex]._endPoint),y=[],y.push(t.datavisualization.Diagram.Point(v.x-s,v.y-s)),y.push(t.datavisualization.Diagram.Point(v.x+s,v.y+s)),ii=t.datavisualization.Diagram.Geometry.rect(y),y=[],y.push(t.datavisualization.Diagram.Point(p.x-s,p.y-s)),y.push(t.datavisualization.Diagram.Point(p.x+s,p.y+s)),ri=t.datavisualization.Diagram.Geometry.rect(y),t.datavisualization.Diagram.Geometry.containsPoint(ii,e.bridgeStartPoint[d])||t.datavisualization.Diagram.Geometry.containsPoint(ri,c.endPoint)||(i.segments[e.segmentIndex]._bridges.push(c),p=c.endPoint)}}},createSegment:function(i,r,u,f,e,o){var s=n.extend(!0,{},t.datavisualization.Diagram.PathSegment,{}),c,h;return h=this.sweepDirection(u,e,o),c=o.getBridgeSegment(i,r,u,e.bridgeSpace,h),s.path=c,s.startPoint=i,s.endPoint=r,s.angle=u,s.segmentPointIndex=f,s.sweep=h,s},sweepDirection:function(n,t,i){var u=Math.abs(n),r;return i.bridgeDirection()==="top"||i.bridgeDirection()==="bottom"?(r=1,u>=0&&u<=90&&(r=0)):(i.bridgeDirection()==="right"||i.bridgeDirection()==="left")&&(r=1,n<0&&n>=-180&&(r=0)),(i.bridgeDirection()==="right"||i.bridgeDirection()==="bottom")&&(r=r===0?1:0),r},getPointAtLength:function(n,i){for(var u,o,f=0,r=null,s=t.datavisualization.Diagram.Point(0,0),e=0;e<i.length;e++){if(u=i[e],r)if(o=this.findLength(r,u),f+o>n){var h=n-f,c=this.findAngle(r,u),l=h*Math.cos(c*Math.PI/180),a=h*Math.sin(c*Math.PI/180);s=t.datavisualization.Diagram.Point(r.x+l,r.y+a);break}else f+=o;else{r=u;continue}r=u}return s},getLengthAtFractionPoint:function(n,t){var c=100,o=0,l=-1,a=0,v=0,y=-1,f,e,s,w,i,r,h;if(n.segments===null)return 0;var b=n.segments,u=n.sourcePoint,p=u;for(f=0;f<n.segments.length;f++){for(e=[],s=n.segments[f],i=0;i<s.points.length;i++)w=s.points[i],e.push(w);for(i=0;i<e.length;i++)r=e[i],h=this.getSlope(r,u,t,n),h<c&&(c=h,v=o+this.findLength(t,p),l=a,y=i),o+=this.findLength(r,u),u=r,p=r;a++}return{lengthAtFractionPt:v,fullLength:o,segmentIndex:l,pointIndex:y}},getSlope:function(n,t,i,r){var e=3,o=Math.abs(n.x-t.x),s=Math.abs(n.y-t.y),u=(i.y-n.y)/(t.y-n.y),f=(i.x-n.x)/(t.x-n.x);return!isFinite(u)||!isFinite(f)||isNaN(u)||isNaN(f)?n.x===t.x?n.y===t.y?1e4:n.y>i.y&&i.y>t.y||n.y<i.y&&i.y<t.y?Math.abs(n.x-i.x):1e4:n.y==t.y?n.x>i.x&&i.x>t.x||n.x<i.x&&i.x<t.x?Math.abs(n.y-i.y):1e4:1e4:r.segments.length>0?n.x>=i.x&&i.x>=t.x||n.x<=i.x&&i.x<=t.x||o<e?n.y>=i.y&&i.y>=t.y||n.y<=i.y&&i.y<=t.y||s<e?Math.abs(u-f):1e4:1e4:1e4},getPoints:function(n){var r=[],t,i,u;if(n.segments.length>0)for(t=0;t<n.segments.length;t++)if(i=n.segments[t],i.type==="straight"||i.type==="bezier")t===0&&r.push(n.sourcePoint),r.push(i._point);else if(i.type==="orthogonal")for(u=0;u<n.segments[t].points.length;u++)r.push(n.segments[t].points[u]);return r},interSect:function(n,t,i,r,u){var s,f,e,o;for(i&&t.length>=2&&(t.splice(0,1),t.splice(0,1)),s=[],f=0;f<n.length-1;f++){if(e=this.interSect1(n[f],n[f+1],t,r,u),e.length>0)for(o=0;o<e.length;o++)s.push(e[o]);i&&t.length>=1&&t.splice(0,1)}return s},checkforHorizontalLine:function(n){var t=Math.abs(n);return t>90?180-t:t},interSect1:function(n,i,r,u,f){for(var h,o,s,c=[],e=0;e<r.length-1;e++)h=this.interSect2(n,i,r[e],r[e+1]),t.datavisualization.Diagram.Geometry.isEmptyPoint(h)||(o=this._findAngle(n,i),s=this._findAngle(r[e],r[e+1]),o=this.checkforHorizontalLine(o),s=this.checkforHorizontalLine(s),u.bridgeDirection()==="left"||u.bridgeDirection()==="right"?o>s&&c.push(h):(u.bridgeDirection()==="top"||u.bridgeDirection()==="bottom")&&o<s&&c.push(h),o===s&&f&&c.push(h));return c},interSect2:function(n,i,r,u){var e=t.datavisualization.Diagram.LineUtil(n.x,n.y,i.x,i.y),o=t.datavisualization.Diagram.LineUtil(r.x,r.y,u.x,u.y),f=this.interSect3(e,o);return f.enabled?f.intersectPt:t.datavisualization.Diagram.Point(0,0)},interSect3:function(n,i){var f=t.datavisualization.Diagram.Point(0,0),r=n,u=i,o=(u.y2-u.y1)*(r.x2-r.x1)-(u.x2-u.x1)*(r.y2-r.y1),h=(u.x2-u.x1)*(r.y1-u.y1)-(u.y2-u.y1)*(r.x1-u.x1),c=(r.x2-r.x1)*(r.y1-u.y1)-(r.y2-r.y1)*(r.x1-u.x1),e,s;return o==0?{enabled:!1,intersectPt:f}:(e=h/o,s=c/o,e>=0&&e<=1&&s>=0&&s<=1)?(f.x=r.x1+e*(r.x2-r.x1),f.y=r.y1+e*(r.y2-r.y1),{enabled:!0,intersectPt:f}):{enabled:!1,intersectPt:f}},findLength:function(n,t){try{return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}catch(i){throw i;}},_findAngle:function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)*(180/Math.PI)},findAngle:function(n,i){if(t.datavisualization.Diagram.Geometry.isEqualPoint(n,i))return 0;var u=t.datavisualization.Diagram.Point(i.x,n.y),o=this.findLength(n,u),f=this.findLength(u,i),e=this.findLength(i,n),r=Math.asin(f/e);return r=r*180/Math.PI,n.x<i.x?n.y<i.y||(r=360-r):r=n.y<i.y?180-r:180+r,r},_mapPalettePhase:function(n){var i,r;return n.orientation&&n.orientation=="horizontal"?(i={x:0,y:0},r={x:40,y:0}):(i={x:0,y:0},r={x:0,y:40}),t.datavisualization.Diagram.Connector({name:n?n.name:t.datavisualization.Diagram.Util.randomId(),segments:[{type:"straight"}],sourcePoint:{x:i.x,y:i.y},targetPoint:{x:r.x,y:r.y},lineWidth:n.lineWidth?n.lineWidth:1,lineDashArray:n.lineDashArray?n.lineDashArray:null,lineColor:n.lineColor?n.lineColor:"#606060",targetDecorator:{shape:"none"},isPhase:!0,orientation:n.orientation?n.orientation:"horizontal"})},_updateShapeProperties:function(n){n._type="node";switch(n.shape.type){case"rectangle":n.type="basic";n._shape=n.shape.type;n.cornerRadius=n.shape.cornerRadius;break;case"ellipse":n.type="basic";n._shape=n.shape.type;break;case"path":n.type="basic";n._shape=n.shape.type;n.pathData=n.shape.pathData;break;case"polygon":n.type="basic";n._shape=n.shape.type;n.points=n.shape.points;break;case"image":n.type="image";n._shape=n.shape.type;n.source=n.shape.src;break;case"native":n.type="native";n._shape=n.shape.type;n.templateId=n.shape.templateId;break;case"text":n.type="text";n._shape=n.shape.type;n.templateId=n.shape.textBlock;break;case"html":n.type="html";n._shape=n.shape.type;n.templateId=n.shape.templateId}}};t.datavisualization.Diagram.BridgeSegments={bridges:[],bridgeStartPoint:[],segmentIndex:-1};t.datavisualization.Diagram.PathSegment={path:"",startPoint:{x:0,y:0},endPoint:{x:0,y:0},angle:0,segmentPointIndex:-1,sweep:1};t.datavisualization.Diagram.LineUtil=function(n,t,i,r){return{x1:Number(n)||0,y1:Number(t)||0,x2:Number(i)||0,y2:Number(r)||0}};t.datavisualization.Diagram.Geometry={checkPointOnCircle:function(n,t,i){var r=Math.pow(i,2),u=Math.pow(n.x-t.x,2),f=Math.pow(n.y-t.y,2);return u+f<=r?!0:!1},rect:function(n){var c=t.datavisualization.Diagram.Rectangle(),e,i,r,h;if(arguments.length===1){var o=Number.MAX_VALUE,s=Number.MAX_VALUE,l=-Number.MAX_VALUE,a=-Number.MAX_VALUE,v=n.length,u,f;for(e=0;e<v;e++)u=n[e].x,f=n[e].y,u<o&&(o=u),u>l&&(l=u),f<s&&(s=f),f>a&&(a=f);c=t.datavisualization.Diagram.Rectangle(o,s,l-o,a-s)}else arguments.length===2&&(i=t.datavisualization.Diagram.Point(arguments[0]),r=t.datavisualization.Diagram.Point(arguments[1]),i.x>r.x&&(h=i.x,i.x=r.x,r.x=h),i.y>r.y&&(h=i.y,i.y=r.y,r.y=h),c=t.datavisualization.Diagram.Rectangle(i.x,i.y,r.x-i.x,r.y-i.y));return c},union:function(n,i){var r=Math.min(n.x,i.x),u=Math.min(n.y,i.y),f=Math.max(n.x+n.width,i.x+i.width),e=Math.max(n.y+n.height,i.y+i.height);return t.datavisualization.Diagram.Rectangle(r,u,f-r,e-u)},distance:function(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))},translate:function(n,i,r){return t.datavisualization.Diagram.Point(n.x+i,n.y+r)},intersectsRect:function(n,t){return t.x<n.x+n.width&&n.x<t.x+t.width&&t.y<n.y+n.height&&n.y<t.y+t.height},findAngle:function(n,t){var i=Math.atan2(t.y-n.y,t.x-n.x);return i=180*i/Math.PI,i%=360,i<0&&(i+=360),i},intersectSegment:function(n,i){var a=n.point1.x,v=n.point1.y,y=n.point2.x,p=n.point2.y,w=i.point1.x,b=i.point1.y,k=i.point2.x,d=i.point2.y,e,o,s,h,c,l,rt,ut,g,nt,tt,it,r,f,u;return(e=p-v,s=a-y,c=y*v-a*p,tt=e*w+s*b+c,it=e*k+s*d+c,tt!==0&&it!==0&&this.sameSign(tt,it))?null:(o=d-b,h=w-k,l=k*b-w*d,g=o*a+h*v+l,nt=o*y+h*p+l,g!==0&&nt!==0&&this.sameSign(g,nt))?null:(r=e*h-o*s,r===0)?null:(f=r<0?-r/2:r/2,f=0,u=s*l-h*c,rt=u<0?(u-f)/r:(u+f)/r,u=o*c-e*l,ut=u<0?(u-f)/r:(u+f)/r,t.datavisualization.Diagram.Point(rt,ut))},updatePath:function(n,i,r,u,f,e,o){var s,h;e&&e.pathBounds?(h=!0,s=e.pathBounds(f)):(h=!1,s=o);var c=0,l=0,a=!1;return(n.toString()!==s.x||i.toString()!==s.y)&&(c=n-Number(s.x),l=i-Number(s.y)),(r!==s.width||u!==s.height)&&(c=r/Number(s.width),l=u/Number(s.height),a=!0),t.datavisualization.Diagram.Geometry.processPathData(f,c,l,a,s.x,s.y,n,i,h,e)},processPathData:function(n,i,r,u,f,e,o,s,h,c){var y=document.createElementNS("http://www.w3.org/2000/svg","path"),rt,ut,b,k,d,g,p,l,nt,tt,it;y.setAttribute("d",n);h&&c&&(n=c.absolutePath(y).getAttribute("d"),y.setAttribute("d",n));p=y.pathSegList;for(var a=0,v=0,w=0,ft=p.numberOfItems;w<ft;++w){l=p.getItem(w);nt=l.pathSegTypeAsLetter;"x1"in l&&(b=l.x1);"x2"in l&&(d=l.x2);"y1"in l&&(k=l.y1);"y2"in l&&(g=l.y2);"x"in l&&(a=l.x);"y"in l&&(v=l.y);u?(a!=undefined&&(a=t.datavisualization.Diagram.Geometry.scalePathData(a,i,f,o)),v!=undefined&&(v=t.datavisualization.Diagram.Geometry.scalePathData(v,r,e,s)),b!=undefined&&(b=t.datavisualization.Diagram.Geometry.scalePathData(b,i,f,o)),k!=undefined&&(k=t.datavisualization.Diagram.Geometry.scalePathData(k,r,e,s)),d!=undefined&&(d=t.datavisualization.Diagram.Geometry.scalePathData(d,i,f,o)),g!=undefined&&(g=t.datavisualization.Diagram.Geometry.scalePathData(g,r,e,s))):(a!=undefined&&(a=a+i),v!=undefined&&(v=v+r),b!=undefined&&(b=b+i),k!=undefined&&(k=k+r),d!=undefined&&(d=d+i),g!=undefined&&(g=g+r));switch(nt){case"M":p.replaceItem(y.createSVGPathSegMovetoAbs(a,v),w);break;case"L":p.replaceItem(y.createSVGPathSegLinetoAbs(a,v),w);break;case"H":p.replaceItem(y.createSVGPathSegLinetoHorizontalAbs(a),w);break;case"V":p.replaceItem(y.createSVGPathSegLinetoVerticalAbs(v),w);break;case"C":p.replaceItem(y.createSVGPathSegCurvetoCubicAbs(a,v,b,k,d,g),w);break;case"S":p.replaceItem(y.createSVGPathSegCurvetoCubicSmoothAbs(a,v,d,g),w);break;case"Q":p.replaceItem(y.createSVGPathSegCurvetoQuadraticAbs(a,v,b,k),w);break;case"T":p.replaceItem(y.createSVGPathSegCurvetoQuadraticSmoothAbs(a,v),w);break;case"A":tt=l.r1;it=l.r2;u&&(tt=tt*i,it=it*r);p.replaceItem(y.createSVGPathSegArcAbs(a,v,tt,it,l.angle,l.largeArcFlag,l.sweepFlag),w);break;case"Z":a=rt;v=ut}(nt==="M"||nt==="m")&&(rt=a,ut=v)}return y.getAttribute("d")},scalePathData:function(n,t,i,r){return n!==i?n=r!==i?n*t-(Number(i)*t-Number(i))+(r-Number(i)):Number(n)*t-(Number(i)*t-Number(i)):r!==i&&(n=r),n},updatePolygonPoints:function(n,i){var f,r,e,u;if(n.points)for(i||(i=n.points),t.datavisualization.Diagram.Geometry.scalePoints(i,n),f=t.datavisualization.Diagram.Geometry.rect(n.points),r=0,e=n.points.length;r<e;++r)u=t.datavisualization.Diagram.Geometry.translate(i[r],-f.x,-f.y),u=t.datavisualization.Diagram.Geometry.translate(u,0,0),i[r]=u},scalePoints:function(n,i){var u=t.datavisualization.Diagram.Geometry.rect(i.points),f,e,r,o;if(u.width>0&&u.height>0)for(f=i.width/u.width,e=i.height/u.height,r=0,o=i.points.length;r<o;++r)n[r].x=n[r].x*f,n[r].y=n[r].y*e},sameSign:function(n,t){return n*t>=0},containsPoint:function(n,t){return n.x<=t.x&&t.x<=n.x+n.width&&n.y<=t.y&&t.y<=n.y+n.height},containsRect:function(n,t){return n.x<=t.x&&t.x+t.width<=n.x+n.width&&n.y<=t.y&&t.y+t.height<=n.y+n.height},inflate:function(n,t,i){n.x-=t;n.y-=i;n.width+=2*t;n.height+=2*i},isEmptyRect:function(n){return n.x===0&&n.y===0&&n.width===0&&n.height===0},isEmptyPoint:function(n){return n.x===0&&n.y===0},isEqualPoint:function(n,t){return n.x===t.x&&n.y===t.y},isEmptySize:function(n){return n.width===0&&n.height===0},length:function(n){return t.datavisualization.Diagram.Geometry.distance(n.point1,n.point2)},midPoint:function(n){return t.datavisualization.Diagram.Point((n.point1.x+n.point2.x)/2,(n.point1.y+n.point2.y)/2)},transform:function(n,t,i){var r={};return r.x=Math.round((n.x+i*Math.cos(t*Math.PI/180))*100)/100,r.y=Math.round((n.y+i*Math.sin(t*Math.PI/180))*100)/100,r}};t.datavisualization.Diagram.LineSegment=function(n,t){return{point1:n,point2:t}};t.datavisualization.Diagram.Point=function(n,t){return{x:Number(n)||0,y:Number(t)||0}};t.datavisualization.Diagram.Size=function(n,t){return{width:Number(n)||0,height:Number(t)||0}};t.datavisualization.Diagram.Rectangle=function(n,t,i,r){return{x:Number(n)||0,y:Number(t)||0,width:Number(i)||0,height:Number(r)||0}};t.datavisualization.Diagram.DecoratorShapes={None:"none",Arrow:"arrow",OpenArrow:"openarrow",Circle:"circle",Diamond:"diamond",Path:"path"};t.datavisualization.Diagram.dependentconnector={dependent:1,independent:2};t.datavisualization.Diagram.ContainerType={Canvas:"canvas",Stack:"stack"};t.datavisualization.Diagram.PortShapes={X:"x",Circle:"circle",Square:"square",Path:"path"};t.datavisualization.Diagram.PortVisibility={Visible:1,Hidden:2,Hover:4,Connect:8,Default:8};t.datavisualization.Diagram.TextAlign={Left:"left",Center:"center",Right:"right"};t.datavisualization.Diagram.HorizontalAlignment={Left:"left",Center:"center",Right:"right"};t.datavisualization.Diagram.LabelEditMode={Edit:"edit",View:"view"};t.datavisualization.Diagram.TextWrapping={NoWrap:"nowrap",Wrap:"wrap",WrapWithOverflow:"wrapwithoverflow"};t.datavisualization.Diagram.VerticalAlignment={Top:"top",Center:"center",Bottom:"bottom"};t.datavisualization.Diagram.TextDecorations={Underline:"underline",Overline:"overline",LineThrough:"line-through",None:"none"};t.datavisualization.Diagram.NodeConstraints={None:1,Select:2,Delete:4,Drag:8,Rotate:16,Connect:32,ResizeNorthEast:64,ResizeEast:128,ResizeSouthEast:256,ResizeSouth:512,ResizeSouthWest:1024,ResizeWest:2048,ResizeNorthWest:4096,ResizeNorth:8192,Resize:16320,Shadow:16384,DragLabel:32768,AllowPan:65536,AspectRatio:131072,Default:16382};t.datavisualization.Diagram.ConnectorConstraints={None:1,Select:2,Delete:4,Drag:8,DragSourceEnd:16,DragTargetEnd:32,DragSegmentThumb:64,Bridging:128,DragLabel:256,InheritBridging:512,Default:638};t.datavisualization.Diagram.PortConstraints={None:1,Connect:2};t.datavisualization.Diagram.SelectorConstraints={None:1,Rotator:2,Resizer:4,UserHandles:8,All:14};t.datavisualization.Diagram.UserHandlePositions={TopLeft:"topleft",TopCenter:"topcenter",TopRight:"topright",MiddleLeft:"middleleft",MiddleRight:"middleright",BottomLeft:"bottomleft",BottomCenter:"bottomcenter",BottomRight:"bottomright"};t.datavisualization.Diagram.SnapConstraints={None:0,SnapToHorizontalLines:1,SnapToVerticalLines:2,SnapToLines:3,ShowHorizontalLines:4,ShowVerticalLines:8,ShowLines:12,All:15};t.datavisualization.Diagram.PageOrientations={Landscape:"landscape",Portrait:"portrait"};t.datavisualization.Diagram.ScrollLimit={Infinity:"infinity",Diagram:"diagram",Limited:"limited"};t.datavisualization.Diagram.LayoutOrientations={TopToBottom:"toptobottom",BottomToTop:"bottomtotop",LeftToRight:"lefttoright",RightToLeft:"righttoleft"};t.datavisualization.Diagram.PaletteDefaults={name:"",expanded:!1,subControlId:null,items:[]};t.datavisualization.Diagram.Palette=function(i,r){if(i.items)for(var u=0;u<i.items.length;u++)i.items[u].shape&&typeof i.items[u].shape=="object"?t.datavisualization.Diagram.Util._updateShapeProperties(i.items[u]):i.items[u]=t.datavisualization.Diagram.NodeType(i.items[u],r),i.items[u].isLane?i.items[u]=t.datavisualization.Diagram.SwimLaneHelper._createPaletteLane(i.items[u],r.nameTable):i.items[u].segments?i.items[u]=t.datavisualization.Diagram.Connector(i.items[u]):i.items[u]._type==="group"?(i.items[u]=t.datavisualization.Diagram.Group(i.items[u]),r._initGroupNode(i.items[u],r)):i.items[u]=i.items[u].type=="phase"?t.datavisualization.Diagram.Util._mapPalettePhase(i.items[u]):t.datavisualization.Diagram.Node(i.items[u]);return n.extend(!0,{},t.datavisualization.Diagram.PaletteDefaults,i)};t.datavisualization.Diagram.Shapes={Image:"image",Text:"text",Html:"html",Native:"native",Basic:"basic",Flow:"flow",Arrow:"arrow",BPMN:"bpmn"};t.datavisualization.Diagram.ShapeDefaults={shape:"",source:"",pathData:"",textBlock:null,points:[],templateId:null};t.datavisualization.Diagram.Shape=function(i){return i&&(i.type==="html"&&typeof i.html=="string"&&(i.html=t.datavisualization.Diagram.Util.htmlEncode(i.html)),i.type==="text"&&i.textBlock&&(i.textBlock=t.datavisualization.Diagram.TextBlock(i.textBlock)),(i.type=="image"||i.type=="native"||i.type==="text"||i.type==="html")&&(i._shape=i.type),i._type||(i._type=i.type?i.type:"node"),i._shape||(i._shape=i.shape?i.shape:"rectangle")),n.extend(!0,{},t.datavisualization.Diagram.ShapeDefaults,i)};t.datavisualization.Diagram.Segments={Straight:"straight",Orthogonal:"orthogonal",Bezier:"bezier"};t.datavisualization.Diagram.SegmentDefaults={type:t.datavisualization.Diagram.Segments.Straight,point:null,point1:null,point2:null,vector1:null,vector2:null,_point1:t.datavisualization.Diagram.Point(),_point2:t.datavisualization.Diagram.Point(),length:null,_length:null,_bridges:[],direction:null,_direction:null};t.datavisualization.Diagram.Segment=function(i){var r=n.extend(!0,{},t.datavisualization.Diagram.SegmentDefaults,i);return r.points=[],r.type=="orthogonal"?(r._length=r.length,r._direction=r.direction):(r.type=="bezier"&&(r._point1=r.point1,r._point2=r.point2),r._point=r.point),r};t.datavisualization.Diagram.MarginDefaults={top:0,left:0,right:0,bottom:0};t.datavisualization.Diagram.Margin=function(i){return n.extend(!0,{},t.datavisualization.Diagram.MarginDefaults,i)};t.datavisualization.Diagram.Path=function(){this._path=""};t.datavisualization.Diagram.Path.prototype={moveTo:function(n,t){return this._path+="M"+n+","+t,this},lineTo:function(n,t){return this._path+="L"+n+","+t,this},cubicBezierTo:function(n,t){return this._path+=t?"S":"C",this._addPoints(n),this},quadraticBezierTo:function(n,t){return this._path+=t?"T":"Q",this._addPoints(n),this},ellipticalArcTo:function(n,t,i,r,u,f,e){return this._path+="A"+n+","+t+" "+i+" "+r+","+u+" "+f+","+e,this},close:function(){return this._path+="Z",this},toString:function(){return this._path},_addPoints:function(n){for(var i,t=0;t<n.length;t++)i=n[t],this._path+=i.x+", "+i.y,t!==n.length-1&&(this._path+=" ")}};t.datavisualization.Diagram.DecoratorDefaults={shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",borderWidth:1,fillColor:"black",pathData:""};t.datavisualization.Diagram.Decorator=function(i){return n.extend(!0,{},t.datavisualization.Diagram.DecoratorDefaults,i)};t.datavisualization.Diagram.TextBlockDefaults={readOnly:!1,bold:!1,italic:!1,text:"",textDecoration:t.datavisualization.Diagram.TextDecorations.None,fontSize:12,fontFamily:"Arial",fontColor:"black",offset:t.datavisualization.Diagram.Point(.5,.5),textAlign:t.datavisualization.Diagram.TextAlign.Center,horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Center,wrapping:t.datavisualization.Diagram.TextWrapping.WrapWithOverflow,margin:t.datavisualization.Diagram.Margin(),mode:t.datavisualization.Diagram.LabelEditMode.Edit,width:50,rotateAngle:0};t.datavisualization.Diagram.TextBlock=function(i){return i.wrapText!==undefined&&(i.wrapping=i.wrapText?"wrapwithoverflow":"nowrap"),n.extend(!0,{},t.datavisualization.Diagram.TextBlockDefaults,i)};t.datavisualization.Diagram.LabelDefaults=n.extend(!0,{},t.datavisualization.Diagram.TextBlockDefaults,{name:"",visible:!0,borderColor:"transparent",borderWidth:0,fillColor:"transparent"});t.datavisualization.Diagram.Label=function(i){return n.extend(!0,{},t.datavisualization.Diagram.LabelDefaults,i)};t.datavisualization.Diagram.PortDefaults={name:"",visibility:t.datavisualization.Diagram.PortVisibility.Default,constraints:t.datavisualization.Diagram.PortConstraints.Connect,size:8,offset:t.datavisualization.Diagram.Point(0,0),borderColor:"#1a1a1a",borderWidth:1,fillColor:"white",shape:t.datavisualization.Diagram.PortShapes.Square,pathData:"",connectorPadding:0};t.datavisualization.Diagram.ShadowDefaults={distance:5,angle:45,opacity:.7};t.datavisualization.Diagram.Shadow=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ShadowDefaults,i)};t.datavisualization.Diagram.Port=function(i){return n.extend(!0,{},t.datavisualization.Diagram.PortDefaults,i)};t.datavisualization.Diagram.StopDefaults={color:"",offset:0,opacity:1};t.datavisualization.Diagram.Stop=function(i){return n.extend(!0,{},t.datavisualization.Diagram.StopDefaults,i)};t.datavisualization.Diagram.LinearGradientDefaults={type:"linear",x1:0,x2:0,y1:0,y2:0,stops:[]};t.datavisualization.Diagram.LinearGradient=function(i){for(var r=0;r<i.stops.length;r++)i.stops[r]=t.datavisualization.Diagram.Stop(i.stops[r]);return n.extend(!0,{},t.datavisualization.Diagram.LinearGradientDefaults,i)};t.datavisualization.Diagram.RadialGradientDefaults={type:"radial",cx:0,cy:0,fx:0,fy:0,r:50,stops:[]};t.datavisualization.Diagram.RadialGradient=function(i){for(var r=0;r<i.stops.length;r++)i.stops[r]=t.datavisualization.Diagram.Stop(i.stops[r]);return n.extend(!0,{},t.datavisualization.Diagram.RadialGradientDefaults,i)};t.datavisualization.Diagram.NodeBaseDefaults={name:"",width:0,height:0,offsetX:0,offsetY:0,visible:!0,zOrder:-1,excludeFromLayout:!1,constraints:t.datavisualization.Diagram.NodeConstraints.Default,parent:"",labels:[],ports:[],inEdges:[],outEdges:[],rotateAngle:0,pivot:t.datavisualization.Diagram.Point(.5,.5),addInfo:{},marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,connectorPadding:0,cornerRadius:0};t.datavisualization.Diagram.NodeBase=function(i){var r;if(i.labels)for(r=0;r<i.labels.length;r++)i.labels[r]=t.datavisualization.Diagram.Label(i.labels[r]);if(i.ports)for(r=0;r<i.ports.length;r++)i.ports[r]=t.datavisualization.Diagram.Port(i.ports[r]);return n.extend(!0,{},t.datavisualization.Diagram.NodeBaseDefaults,i)};t.datavisualization.Diagram.NodeDefaults={fillColor:"white",borderColor:"black",borderWidth:1,borderDashArray:"",opacity:1,gradient:null,type:t.datavisualization.Diagram.Shapes.Basic,isExpanded:!0,shadow:t.datavisualization.Diagram.Shadow()};t.datavisualization.Diagram.Node=function(i){return i.gradient&&(i.gradient.type==="linear"?i.gradient=t.datavisualization.Diagram.LinearGradient(i.gradient):i.gradient.type==="radial"&&(i.gradient=t.datavisualization.Diagram.RadialGradient(i.gradient))),i.shadow&&(i.shadow=t.datavisualization.Diagram.Shadow(i.shadow)),i.minWidth=i.minWidth?i.minWidth:0,i.minHeight=i.minHeight?i.minHeight:0,i.maxWidth=i.maxWidth?i.maxWidth:0,i.maxHeight=i.maxHeight?i.maxHeight:0,i.width||i._width||(i._width=i.minWidth?i.minWidth:i.maxWidth),i.height||i._height||(i._height=i.minHeight?i.minHeight:i.maxHeight),n.extend(!0,{},t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.NodeBase(i),t.datavisualization.Diagram.Shape(i))};t.datavisualization.Diagram.ConnectorDefaults={name:"",visible:!0,lineDashArray:"",targetDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},sourceDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},segments:[t.datavisualization.Diagram.Segment({type:"straight"})],sourcePoint:t.datavisualization.Diagram.Point(),targetPoint:t.datavisualization.Diagram.Point(),lineColor:"black",lineWidth:1,constraints:t.datavisualization.Diagram.ConnectorConstraints.Default,opacity:1,parent:"",labels:[],zOrder:-1,lineHitPadding:10,addInfo:{},targetNode:null,targetPort:null,sourceNode:null,sourcePort:null,marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,cornerRadius:0,bridgeSpace:10,sourcePadding:0,targetPadding:0,type:"connector"};t.datavisualization.Diagram.Connector=function(i){if(i.name=i.name?i.name:t.datavisualization.Diagram.Util.randomId(),i.targetDecorator=t.datavisualization.Diagram.Decorator(i.targetDecorator||{}),i.sourceDecorator=t.datavisualization.Diagram.Decorator(i.sourceDecorator||{shape:t.datavisualization.Diagram.DecoratorShapes.None}),i.segments=i.segments||[t.datavisualization.Diagram.Segment({type:"straight"})],i.segments.length&&(i.sourcePoint=i.sourcePoint||t.datavisualization.Diagram.Point(),i.targetPoint=i.targetPoint||t.datavisualization.Diagram.Point(),t.datavisualization.Diagram.Util._initializeSegments(i,i.defaultType)),i.labels)for(var r=0;r<i.labels.length;r++)i.labels[r]=t.datavisualization.Diagram.Label(i.labels[r]);return n.extend(!0,{},t.datavisualization.Diagram.ConnectorDefaults,i)};t.datavisualization.Diagram.ContainerDefaults={type:t.datavisualization.Diagram.ContainerType.Canvas,orientation:"vertical"};t.datavisualization.Diagram.Container=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ContainerDefaults,i)};t.datavisualization.Diagram.GroupDefaults={children:[],canUngroup:!0,allowDrop:!0,container:null,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,type:"group"};t.datavisualization.Diagram.Group=function(i){return i=i?i:null,i.minWidth=i.minWidth?i.minWidth:0,i.minHeight=i.minHeight?i.minHeight:0,i.maxWidth=i.maxWidth?i.maxWidth:0,i.maxHeight=i.maxHeight?i.maxHeight:0,i.container=i.container?t.datavisualization.Diagram.Container(i.container):null,i.fillColor=i.fillColor?i.fillColor:"transparent",i.borderColor=i.borderColor?i.borderColor:"transparent",i._type||(i._type=i.type?i.type:"group"),n.extend(!0,{},t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.GroupDefaults,t.datavisualization.Diagram.NodeBase(i))};t.datavisualization.Diagram.ZoomCommand={ZoomIn:1,ZoomOut:2};t.datavisualization.Diagram.Zoom=function(i){return n.extend(!0,{},{zoomFactor:.2,focusPoint:null,zoomCommand:t.datavisualization.Diagram.ZoomCommand.ZoomIn},i)};t.datavisualization.Diagram.DragState={Starting:"starting",Dragging:"dragging",Completed:"completed"};t.datavisualization.Diagram.DiagramConstraints={None:1,PageEditable:2,Bridging:4,Zoomable:8,PannableX:16,PannableY:32,Pannable:48,Undoable:64,Default:122};t.datavisualization.Diagram.Tool={None:1,SingleSelect:2,MultipleSelect:4,ZoomPan:8,DrawOnce:16,ContinuesDraw:32};t.datavisualization.Diagram.Region={Content:"content",PageSettings:"pageSettings"};t.datavisualization.Diagram.FileFormats={JPG:"jpg",PNG:"png",BMP:"bmp",SVG:"svg"};t.datavisualization.Diagram.ExportModes={Download:"download",Data:"data"};t.datavisualization.Diagram.FitMode={Page:"page",Width:"width",Height:"height"};t.datavisualization.Diagram.UserHandleDefaults={name:"",pathData:"",borderColor:"",backgroundColor:"#2382c3",position:t.datavisualization.Diagram.UserHandlePositions.BottomCenter,pathColor:"white",tool:"",size:20,visible:!0,enableMultiSelection:!1};t.datavisualization.Diagram.UserHandle=function(i){return n.extend(!0,{},t.datavisualization.Diagram.UserHandleDefaults,i)};t.datavisualization.Diagram.SwimLaneDefaults={header:{width:30,text:"",fontColor:"black",fontSize:11,fontFamily:"Arial",bold:!1,italic:!1,textDecoration:"none"},fillColor:"transparent",orientation:"vertical",type:"group",isSwimlane:!0,offsetX:100,offsetY:100,minHeight:100,maxHeight:100,minWidth:100,maxWidth:100,lanes:[],phases:[],phaseSize:20,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest,addInfo:{}};t.datavisualization.Diagram.SwimLane=function(i){return n.extend(!0,{},t.datavisualization.Diagram.SwimLaneDefaults,i)};t.datavisualization.Diagram.LaneDefaults={header:{width:30,text:"",fontColor:"black",fontSize:11,fontFamily:"Arial",bold:!1,italic:!1,textDecoration:"none"},name:"",children:[],isLane:!0,orientation:"horizontal",fillColor:"white",labels:[],addInfo:{}};t.datavisualization.Diagram.Lane=function(i){return n.extend(!0,{},t.datavisualization.Diagram.LaneDefaults,i)};t.datavisualization.Diagram.phaseDefaults={name:"",type:"phase",offset:0,lineWidth:1,lineDashArray:"3,3",lineColor:"#606060",parent:"",orientation:"horizontal",label:null};t.datavisualization.Diagram.phase=function(i){return i.label&&(i.label=t.datavisualization.Diagram.Label(i.label),i.label.text=i.label.text?i.label.text:"Phase"),n.extend(!0,{},t.datavisualization.Diagram.phaseDefaults,i)};t.datavisualization.Diagram.SwimLaneHelper={_initSwimLane:function(n,i,r){var u=null,w=null,k=this._initphases(n,i),o,f,l,a,e;w=this._initLanes(n,i,r);o=[];f=null;n.header||(n.header={text:"",height:0,fillColor:"white"});n.orientation=="vertical"?l=n.header.height:a=n.header.width;n.header&&(f=t.datavisualization.Diagram.Node({_type:"node",name:n.name+"_header_swimlane",labels:[{text:n.header.text?n.header.text:"",offset:{x:.5,y:.5},fontColor:n.header.fontColor?n.header.fontColor:"black",fontSize:n.header.fontSize?n.header.fontSize:11,fontFamily:n.header.fontFamily?n.header.fontFamily:"Arial",bold:n.header.bold?n.header.bold:!1,italic:n.header.italic?n.header.italic:!1,textDecoration:n.header.textDecoration?n.header.textDecoration:"none"},],height:l?l:50,width:a?a:50,fillColor:n.header.fillColor?n.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:n.name}));f&&(i.nodes().push(f),i.nameTable[f.name]=f,o.push(f.name));e=null;e=n.phaseSize==0?.001:n.phaseSize?n.phaseSize:20;var nt=this._initPhaseStack(n,i,o,e),d=null,g=null;n.orientation=="vertical"?g="stretch":d="stretch";var v,b=0,y=0,p=0;n.orientation=="horizontal"?(v="vertical",y=(n.header?n.header.height:50)+e,p=0):(v="horizontal",y=n.header?n.header.height:50,b=n.phaseSize?n.phaseSize:20,p=(n.header?n.header.height:50)+e);var s=t.datavisualization.Diagram.Group({name:n.name+"_stack",children:w,parent:n.name,container:{type:t.datavisualization.Diagram.ContainerType.Stack,orientation:v},horizontalAlign:"stretch",verticalAlign:"stretch",marginTop:y,width:10,height:10,marginLeft:b,minHeight:p}),h=0,c=0;return n.orientation=="horizontal"?(h=n.width,c=n.height):n.orientation=="vertical"&&(h=n.width,c=n.height-f.height),i.nodes().push(s),i.nameTable[s.name]=s,o.push(s.name),u=t.datavisualization.Diagram.Group({name:n.name?n.name:"",type:"group",addInfo:n.addInfo?n.addInfo:{},parent:"",offsetX:n.offsetX?n.offsetX:100,offsetY:n.offsetY?n.offsetY:100,children:o,fillColor:"transparent",container:{type:t.datavisualization.Diagram.ContainerType.Canvas},minHeight:c?c:100,maxHeight:n.maxHeight?n.maxHeight:Number.POSITIVE_INFINITY,minWidth:h?h:100,maxWidth:n.maxWidth?n.maxWidth:Number.POSITIVE_INFINITY,constraints:n.constraints?n.constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest,phaseSize:e}),u.isSwimlane=!0,u.phases=k,u.orientation=n.orientation,u.constraints=u.orientation=="horizontal"?u.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast:u.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeSouth^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast,u},_initPhaseStack:function(n,i,r,u){var h="horizontal",v="left",y="top",c,f,e;h&&(n.orientation=="horizontal"?(h="horizontal",v="stretch",c=!0):(h="vertical",y="stretch",c=!1));var o=t.datavisualization.Diagram.Group({name:n.name+"phaseStack",container:{type:"stack",orientation:h},type:"group",isLane:!0,parent:n.name,offsetX:0,offsetY:0,minHeight:u,maxHeight:u,minWidth:u,maxWidth:u,marginTop:n.header?n.header.height:50,isPhaseStack:!0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect}),l=0,s,a;for(f=0;f<n.phases.length;f++)c?(s=n.phaseSize?n.phaseSize:20,a=n.phases[f].offset-l):(s=n.phases[f].offset-l,f==0&&(s=s-(n.header?n.header.height:50)),a=n.phaseSize?n.phaseSize:20,n.phases[f].label.rotateAngle=270),e=t.datavisualization.Diagram.Node({parent:n.name+"phaseStack",name:"phaseStack"+n.phases[f].name,height:s,width:a,labels:[n.phases[f].label],constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect}),e.labels[0].name="phaseStack"+n.phases[f].name+"label",e.labels[0].mode=t.datavisualization.Diagram.LabelEditMode.View,e.isPhase=!0,l=n.phases[f].offset,i.nameTable[e.name]=e,o.children.push(e.name),i.nodes().push(e);i.nodes().push(o);r.push(o);i.nameTable[o.name]=o},_initLanes:function(n,t,i){var f=[],u=null,r;if(n.lanes)for(r=0;r<n.lanes.length;r++)n.lanes[r]._laneHeader=n.lanes[r]._laneHeader?n.lanes[r]._laneHeader:n.lanes[r].header,u=this._initLane(n.lanes[r],n,t,i),f.push(u.name),t.nodes().push(u),t.nameTable[u.name]=u;return f},_initLane:function(n,i,r,u){var h=null,c=null,v,f,o,a,e,l,s;if(i.orientation=="horizontal"?h="stretch":c="stretch",v=!1,f=t.datavisualization.Diagram.Group({name:n.name,addInfo:n.addInfo?n.addInfo:{},type:"group",isLane:!0,parent:i.name+"_stack",offsetX:0,offsetY:0,borderColor:n.borderColor?n.borderColor:"black",orientation:i.orientation?i.orientation:"horizontal",fillColor:n.fillColor,container:{type:t.datavisualization.Diagram.ContainerType.Canvas},horizontalAlign:h?h:"left",verticalAlign:c?c:"top",minHeight:n.height?n.height:100,maxHeight:n.maxHeight?n.maxHeight:Number.POSITIVE_INFINITY,minWidth:n.width?n.width:100,maxWidth:n.maxWidth?n.maxWidth:Number.POSITIVE_INFINITY,paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest^t.datavisualization.Diagram.NodeConstraints.Connect}),f.constraints=i.orientation=="horizontal"?f.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast^t.datavisualization.Diagram.NodeConstraints.Connect:f.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeSouth^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast^t.datavisualization.Diagram.NodeConstraints.Connect,n.labels&&n.labels.length>0){for(o=0;o<n.labels.length;o++)n.labels[o]=t.datavisualization.Diagram.Label(n.labels[o]);f.labels=n.labels}for(u||(a=n._laneHeader?n._laneHeader:null,e=this._iniLaneHeader(n,f.name,i,r,a),e&&(r.nodes().push(e),r.nameTable[e.name]=e,f.children.push(e.name))),l=this._initChildren(n,f.name,r),s=0;s<l.length;s++)f.children.push(l[s]);return f},_iniLaneHeader:function(n,i,r,u,f){var e=null;return n.header&&(e=t.datavisualization.Diagram.Node({name:i+n.header.text+"_Headerr_",type:"node",labels:[{text:n.header.text?n.header.text:"",offset:{x:.5,y:.5},width:100,rotateAngle:270,marginLeft:-10,fontColor:n.header.fontColor?n.header.fontColor:"black",fontSize:n.header.fontSize?n.header.fontSize:11,fontFamily:n.header.fontFamily?n.header.fontFamily:"Arial",bold:n.header.bold?n.header.bold:!1,italic:n.header.italic?n.header.italic:!1,textDecoration:n.header.textDecoration?n.header.textDecoration:"none"}],height:f.height?f.height:50,width:f.width?f.width:50,fillColor:n.header.fillColor?n.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20,parent:i}),r.orientation&&r.orientation=="horizontal"?(e.verticalAlign="stretch",e.height=1,e.width=f.width?f.width:50):r.orientation&&r.orientation=="vertical"&&(e.horizontalAlign="stretch",e.labels[0].rotateAngle=0,e.height=f.width?f.width:50,e.width=1)),e},_initChildren:function(n,t,i){var f=[],r=null,u;if(n.children)for(u=0;u<n.children.length;u++)r=this._initChild(n.children[u],t,i),r.segments?i.connectors().push(r):i.nodes().push(r),f.push(r.name),i.nameTable[r.name]=r;return f},_initChild:function(n,t,i){var r=null;return r=i._getNewNode(n),r.parent=t,r},_initphases:function(n,i){var e=[],r=null,f,o,u;if(i.model.phases||(i.model.phases=[]),f=0,f=n.orientation=="vertical"?n.height:n.width,o=t.datavisualization.Diagram.phase({name:n.name+"defPhase",offset:f,label:{text:"Phase"}}),n.phases.push(o),n.phases&&n.phases.length>0)for(u=0;u<n.phases.length;u++)r=t.datavisualization.Diagram.phase(n.phases[u]),r.parent=n.name,r.orientation=n.orientation,i.model.phases.push(r),i.nameTable[r.name]=r,e.push(r.name);return e},_createSwimlane:function(n,i){for(var r,c,l,e=[],o=null,s=0;s<n.children.length;s++)o=i.nameTable[n.children[s]],o&&e.push(o);var a=i.nameTable,u=500,f=500,h=null;return n.children[0]?(r=a[n.children[0]],h={text:"Title",width:50,fillColor:r.fillColor,height:50}):h={text:"Title",width:50,fillColor:"white",height:50},n.orientation||n.container&&(n.orientation=n.container.orientation),n.orientation=="horizontal"&&i._selectedSymbol?(u=n.height?Math.round(i._selectedSymbol.height):100,f=n.width?Math.round(i._selectedSymbol.width):650):(u=n.height?n.height:650,f=n.width?n.width:100),c={name:n.name,header:h,fillColor:"white",minWidth:f,minHeight:u,height:u+1,width:f+1,maxHeight:u+Number.POSITIVE_INFINITY,maxWidth:f+Number.POSITIVE_INFINITY,offsetX:n.offsetX,offsetY:n.offsetY,orientation:n.orientation?n.orientation:"horizontal",lanes:[{name:n.name+"_canvas",addInfo:n.addInfo?n.addInfo:{},header:{text:r.labels[0].text?r.labels[0].text:"HEADER",fontSize:r.labels[0].fontSize?r.labels[0].fontSize:11,width:50,fillColor:r.fillColor,bold:r.labels[0].bold?!0:!1,italic:r.labels[0].italic?!0:!1,fontFamily:r.labels[0].fontFamily?r.labels[0].fontFamily:"Arial",fontColor:r.labels[0].fontColor?r.labels[0].fontColor:"black"},fillColor:n.fillColor?n.fillColor:"white",height:u,width:f,children:e?e:[],_laneHeader:n._laneHeader?n._laneHeader:null},]},l=this._initSwimLane(t.datavisualization.Diagram.SwimLane(c),i,!1),l},_createDiagramLane:function(n,i){var e=0,o=0,s,h,l=0,u,r;n.orientation=="horizontal"?(e=n.height?n.height:1,o=n.width?n.width:150,s="stretch",h="top",l=50):n.orientation=="vertical"&&(e=n.height?n.height:1,o=n.width?n.width:120,s="left",h="stretch",l=50);u=i[n.children[1]];r=t.datavisualization.Diagram.Group({name:n.name,type:"group",isLane:!0,addInfo:n.addInfo?n.addInfo:{},borderColor:"black",offsetX:n.offsetX,offsetY:n.offsetY,fillColor:u.fillColor,container:{type:t.datavisualization.Diagram.ContainerType.Canvas},horizontalAlign:s?s:"left",verticalAlign:h?h:"top",minHeight:e?e:100,maxHeight:Number.POSITIVE_INFINITY,minWidth:o?o:100,orientation:n.orientation?n.orientation:"horizontal",maxWidth:Number.POSITIVE_INFINITY,paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest^t.datavisualization.Diagram.NodeConstraints.Connect});r.constraints=n.orientation=="horizontal"?r.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast:r.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeSouth^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast;r._laneHeader=u._laneHeader?u._laneHeader:null;var f=i[n.children[0]],a={header:{text:f.labels[0].text?f.labels[0].text:"Function",fontSize:f.labels[0].fontSize?f.labels[0].fontSize:11,width:l,fillColor:f.fillColor}},c=this._iniLaneHeader(a,r.name,{orientation:n.orientation},null,u._laneHeader);return c.name=r.name+"_Headerr_",i[c.name]=c,r.children.push(c.name),r},_createPaletteLane:function(n,i){var r=0,u=0,f=0,e=0,c=0,l="left",a,s,o,h;return n.orientation=="horizontal"?(r=n.height?n.height:50,u=25,f=15,e=r/2,c=270,l="left"):n.orientation=="vertical"&&(r=25,u=n.width?n.width:50,f=u/2,e=15,l="left"),a=n.header.text?n.header.text:"",s=t.datavisualization.Diagram.Node({name:n.name+"_"+a,_type:"node",labels:[{text:n.header.text?n.header.text:"Function",fontSize:n.header.fontSize?n.header.fontSize:11,offset:{x:.5,y:.5},width:100,rotateAngle:c}],height:r,width:u,fillColor:n.header.fillColor?n.header.fillColor:"white",parent:n.name,offsetX:f,offsetY:e,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Connect}),i[s.name]=s,n.orientation=="horizontal"?(r=n.height,u=n.width-25,f=25+u/2,e=r/2):n.orientation=="vertical"&&(r=n.height-25,u=n.width,f=u/2,e=25+r/2),o=t.datavisualization.Diagram.Node({name:n.name+"content",_type:"node",height:r,width:u,fillColor:n.fillColor?n.fillColor:"white",parent:n.name,offsetX:f,offsetY:e}),o._laneHeader=n.header,i[o.name]=o,h=t.datavisualization.Diagram.Group({name:n.name+"_group",addInfo:n.addInfo?n.addInfo:{},height:n.height,width:n.width,offsetX:n.offsetX,offsetY:n.offsetY,children:[s.name,o.name,]}),h.isLane=!0,h.orientation=n.orientation,h},_mapObject:function(n,t,i,r){var u;switch(i){case"lane":u=this._mapLane(n,t);break;case"phase":u=this._mapPhase(n,t);break;case"swimlane":u=this._mapSwimlane(n,t,r)}return u},_mapLane:function(n,i,r){var u=t.datavisualization.Diagram.Lane();return this._mapLaneHeader(n,i,u,r),this._mapChildren(n,i,u,r),u.name=i.name,u.labels=i.labels,u.fillColor=i.fillColor,u.orientation=i.orientation,u.addInfo=i.addInfo?i.addInfo:{},i.orientation==="horizontal"?(u.height=i.height,u.width=null):(u.height=null,u.width=i.width),u},_mapLaneHeader:function(n,t,i,r){var u;t.children[0]&&(u=n.nameTable[n._getChild(t.children[0])]);!u&&r&&(u=r[n._getChild(t.children[0])]);u&&(u.labels&&u.labels[0]&&(i.header.text=u.labels[0].text,i.header.fontColor=u.labels[0].fontColor,i.header.fontSize=u.labels[0].fontSize,i.header.fontFamily=u.labels[0].fontFamily,i.header.bold=u.labels[0].bold,i.header.italic=u.labels[0].italic,i.header.textDecoration=u.labels[0].textDecoration),i.header.fillColor=u.fillColor,t.orientation==="vertical"?(i.header.height=u.height,i.header.width=null):(i.header.height=null,i.header.width=u.width))},_mapChildren:function(n,t,i,r){var f,u;if(t.children&&t.children.length>=2)for(u=1;u<t.children.length;u++)n._getChild(t.children[u])&&(f=n.nameTable[n._getChild(t.children[u])]),r&&!f&&(f=r[n._getChild(t.children[u])]),f&&i.children.push(f)},_mapSwimlane:function(n,i,r){var u=t.datavisualization.Diagram.SwimLane();return this._mapSwimlaneHeader(n,i,u,r),this._mapLanes(n,i,u,r),this._mapPhases(n,i,u,r),u.name=i.name,u.orientation=i.orientation,u.offsetX=i.offsetX,u.offsetY=i.offsetY,u.maxHeight=i.maxHeight,u.maxWidth=i.maxWidth,u.minHeight=i.minHeight,u.minWidth=i.minWidth,u.phaseSize=i.phaseSize,u.constraints=i.constraints,u.addInfo=i.addInfo?i.addInfo:{},u.height=this._mapSwimlaneSize(i,u).height,u.width=this._mapSwimlaneSize(i,u).width,u},_mapSwimlaneSize:function(n,t){var i=0,r=0;return n.orientation=="horizontal"?(i+=t.header?t.header.height:0,i+=n.phaseSize?n.phaseSize:20,i=n.height-i,r=n.width,{height:i,width:r}):(i=n.height-i,r=n.width,r-=n.phaseSize?n.phaseSize:20,{height:i,width:r})},_mapSwimlaneHeader:function(n,t,i,r){if(t.children[0])var u=n.nameTable[n._getChild(t.children[0])];!u&&r&&(u=r[n._getChild(t.children[0])]);u&&(u.labels&&u.labels[0]&&(i.header.text=u.labels[0].text,i.header.fontColor=u.labels[0].fontColor,i.header.fontSize=u.labels[0].fontSize,i.header.fontFamily=u.labels[0].fontFamily,i.header.bold=u.labels[0].bold,i.header.italic=u.labels[0].italic,i.header.textDecoration=u.labels[0].textDecoration),i.header.fillColor=u.fillColor,i.header.height=u.height,i.header.width=null)},_mapLanes:function(n,t,i,r){var u,e,o,f;if(t.children[2]&&n._getChild(t.children[2])&&(u=n.nameTable[n._getChild(t.children[2])]),u&&u.children&&u.children.length>0)for(f=0;f<u.children.length;f++)n._getChild(u.children[f])&&(e=n.nameTable[n._getChild(u.children[f])]),e&&(o=this._mapLane(n,e,r),o&&i.lanes.push(o))},_mapPhases:function(n,t,i){var r,u;if(t.phases&&t.phases.length>1)for(r=0;r<t.phases.length-1;r++)u=this._mapPhase(n,n.nameTable[t.phases[r]]),u&&i.phases.push(u)},_mapPhase:function(n,t){var i=n.nameTable[t.name];return i?i:null}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.BasicShapes={Rectangle:"rectangle",Ellipse:"ellipse",Path:"path",Polygon:"polygon",Triangle:"triangle",Plus:"plus",Star:"star",Pentagon:"pentagon",Heptagon:"heptagon",Octagon:"octagon",Trapezoid:"trapezoid",Decagon:"decagon",RightTriangle:"righttriangle",Cylinder:"cylinder"};t.datavisualization.Diagram.FlowShapes={Process:"process",Decision:"decision",Document:"document",PreDefinedProcess:"predefinedprocess",Terminator:"terminator",PaperTap:"papertap",DirectData:"directdata",SequentialData:"sequentialdata",Sort:"sort",MultiDocument:"multidocument",Collate:"collate",SummingJunction:"summingjunction",Or:"or",InternalStorage:"internalstorage",Extract:"extract",ManualOperation:"manualoperation",Merge:"merge",OffPageReference:"offpagereference",SequentialAccessStorage:"sequentialaccessstorage",Annotation1:"annotation1",Annotation2:"annotation2"};t.datavisualization.Diagram.ArrowShapes={None:"none",CircularArrow:"circulararrow",CurvedRightArrow:"curvedrightarrow",CurvedUpArrow:"curveduparrow",CurvedLeftArrow:"curvedleftarrow",CurvedDownArrow:"curveddownarrow",JumpingRightArrow:"jumpingrightarrow",JumpingLeftArrow:"jumpingleftarrow"};t.datavisualization.Diagram.BPMNShapes={Event:"event",Gateway:"gateway",SequentialFlow:"sequentialflow",AssociationFlow:"associationflow",MessageFlow:"messageflow",Message:"message",DataObject:"dataobject",DataSource:"datasource",Activity:"activity"};t.datavisualization.Diagram.BPMNEvents={Start:"start",Intermediate:"intermediate",End:"end",NonInterruptingStart:"noninterruptingstart",NonInterruptingIntermediate:"noninterruptingintermediate"};t.datavisualization.Diagram.BPMNActivity={None:"none",Task:"task",SubProcess:"subprocess"};t.datavisualization.Diagram.BPMNGateways={None:"none",Exclusive:"exclusive",Inclusive:"inclusive",Parallel:"parallel",Complex:"complex",EventBased:"eventbased"};t.datavisualization.Diagram.BPMNTriggers={None:"none",Message:"message",Timer:"timer",Escalation:"escalation",Link:"link",Error:"error",Compensation:"compensation",Signal:"signal",Multiple:"multiple",Parallel:"parallel"};t.datavisualization.Diagram.BPMNLoops={None:"none",Standard:"standard",ParallelMultiInstance:"parallelmultiinstance",SequenceMultiInstance:"sequencemultiinstance"};t.datavisualization.Diagram.BPMNTasks={None:"none",Service:"service",Receive:"receive",Send:"send",InstantiatingReceive:"instantiatingreceive",Manual:"manual",BusinessRule:"businessrule",User:"user",Script:"script",Parallel:"parallel"};t.datavisualization.Diagram.BPMNBoundary={Default:"default",Call:"call",Event:"event"};t.datavisualization.Diagram.BPMNDirections={None:"none",UniDirectional:"unidirectional",BiDirectional:"bidirectional"};t.datavisualization.Diagram.BPMNTask=function(i){return n.extend(!0,{},t.datavisualization.Diagram.BPMNTaskDefaults,i)};t.datavisualization.Diagram.BPMNSubProcess=function(i){return n.extend(!0,{},t.datavisualization.Diagram.BPMNSubProcessDefaults,i)};t.datavisualization.Diagram.BPMNTaskDefaults={loop:t.datavisualization.Diagram.BPMNLoops.None,type:t.datavisualization.Diagram.BPMNTasks.None,call:!1,compensation:!1};t.datavisualization.Diagram.BPMNSubProcessDefaults={loop:t.datavisualization.Diagram.BPMNLoops.None,boundary:t.datavisualization.Diagram.BPMNBoundary.Default,adhoc:!1,compensation:!1};t.datavisualization.Diagram.BPMNEventDefaults={event:t.datavisualization.Diagram.BPMNEvents.Start,trigger:t.datavisualization.Diagram.BPMNTriggers.None};t.datavisualization.Diagram.BPMNActivityDefaults={activity:t.datavisualization.Diagram.BPMNActivity.Task,task:t.datavisualization.Diagram.BPMNTask(),subProcess:t.datavisualization.Diagram.BPMNSubProcess()};t.datavisualization.Diagram.BPMNGatewayDefaults={gateway:t.datavisualization.Diagram.BPMNGateways.None};t.datavisualization.Diagram.BPMNFlowDefaults={direction:t.datavisualization.Diagram.BPMNDirections.None};t.datavisualization.Diagram.BPMNDataObjectDefaults={collection:!1};t.datavisualization.Diagram.NodeType=function(n,i){return n.type||n.segments||n.children||n.isLane||n.isSwimlane||n.isPhase||n.isPhaseStack||(n.type="basic"),(n.type=="basic"||n.type=="flow"||n.type=="arrow"||n.type=="bpmn"||n.type=="image"||n.type=="native"||n.type==="html"||n.type==="text")&&(n._type="node"),n.type=="basic"?n=t.datavisualization.Diagram.BasicShape(n):n.type=="flow"?n=t.datavisualization.Diagram.FlowShape(n):n.type=="arrow"?n=t.datavisualization.Diagram.ArrowShape(n):n.type=="bpmn"&&(n=t.datavisualization.Diagram.BPMNShape(n,i)),n};t.datavisualization.Diagram.BasicShape=function(n){n._shape="path";n.shape||(n.shape="rectangle");switch(n.shape){case"rectangle":n._shape="rectangle";break;case"ellipse":n._shape="ellipse";break;case"path":n._shape="path";break;case"polygon":n._shape="polygon";break;case"triangle":n.pathData="M81.1582,85.8677L111.1582,33.9067L141.1582,85.8677L81.1582,85.8677z";break;case"plus":n.pathData="M696.6084,158.2656L674.8074,158.2656L674.8074,136.4656L658.4084,136.4656L658.4084,158.2656L636.6084,158.2656L636.6084,174.6646L658.4084,174.6646L658.4084,196.4656L674.8074,196.4656L674.8074,174.6646L696.6084,174.6646L696.6084,158.2656z";break;case"star":n.pathData="M540.3643,137.9336L546.7973,159.7016L570.3633,159.7296L550.7723,171.9366L558.9053,194.9966L540.3643,179.4996L521.8223,194.9966L529.9553,171.9366L510.3633,159.7296L533.9313,159.7016L540.3643,137.9336z";break;case"pentagon":n.pathData="M370.9702,194.9961L359.5112,159.7291L389.5112,137.9341L419.5112,159.7291L408.0522,194.9961L370.9702,194.9961z";break;case"heptagon":n.pathData="M223.7783,195.7134L207.1303,174.8364L213.0713,148.8034L237.1303,137.2174L261.1883,148.8034L267.1303,174.8364L250.4813,195.7134L223.7783,195.7134z";break;case"octagon":n.pathData="M98.7319,196.4653L81.1579,178.8923L81.1579,154.0393L98.7319,136.4653L123.5849,136.4653L141.1579,154.0393L141.1579,178.8923L123.5849,196.4653L98.7319,196.4653z";break;case"trapezoid":n.pathData="M127.2842,291.4492L95.0322,291.4492L81.1582,256.3152L141.1582,256.3152L127.2842,291.4492z";break;case"decagon":n.pathData="M657.3379,302.4141L642.3369,291.5161L636.6089,273.8821L642.3369,256.2481L657.3379,245.3511L675.8789,245.3511L690.8789,256.2481L696.6089,273.8821L690.8789,291.5161L675.8789,302.4141L657.3379,302.4141z";break;case"righttriangle":n.pathData="M836.293,292.9238L776.293,292.9238L776.293,254.8408L836.293,292.9238z";break;case"cylinder":n.pathData="M 542.802,362.009C 542.802,368.452 525.341,373.676 503.802,373.676C 482.263,373.676 464.802,368.452 464.802,362.009L 464.802,466.484C 464.802,472.928 482.263,478.151 503.802,478.151C 525.341,478.151 542.802,472.928 542.802,466.484L 542.802,362.016C 542.802,368.459 525.341,373.534 503.802,373.534C 482.263,373.534 464.802,368.31 464.802,361.867L 464.802,362.016C 464.802,355.572 482.263,350.349 503.802,350.349C 525.341,350.349 542.802,355.572 542.802,362.016"}return n};t.datavisualization.Diagram.FlowShape=function(n){n._shape="path";n.shape||(n.shape="process");var i=n.constraints?n.constraints:t.datavisualization.Diagram.NodeConstraints.Default;n.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio||(i=i|t.datavisualization.Diagram.NodeConstraints.AspectRatio);switch(n.shape){case"process":n.pathData="M419.511,76.687L359.511,76.687L359.511,43.086L419.511,43.086z";break;case"decision":n.pathData="M 253.005,115.687L 200.567,146.071L 148.097,115.687L 200.534,85.304L 253.005,115.687 Z";break;case"document":n.pathData="M 60 31.9 c 0 0 -11 -7.7 -30 0 s -30 0 -30 0 V 0 h 60 V 31.9 Z";break;case"predefinedprocess":n.pathData="M 0,0 L 50,0 L 50,50 L 0,50 Z  M 8.333333333333334,0 L 8.333333333333334,50 M 41.66666666666667,0 L 41.66666666666667,50";break;case"terminator":n.pathData="M 269.711,29.3333C 269.711,44.061 257.772,56 243.044,56L 158.058,56C 143.33,56 131.391,44.061 131.391,29.3333L 131.391,29.3333C 131.391,14.6057 143.33,2.66669 158.058,2.66669L 243.044,2.66669C 257.772,2.66669 269.711,14.6057 269.711,29.3333 Z";break;case"papertap":n.pathData="M0.000976562,17.2042 L0.000976562,47.1654 C0.000976562,47.1654 14.403,53.5455 25.001,47.1654 C35.599,40.7852 44.403,43.5087 50.001,47.1654 L50.001,17.2042 M50.001,32.7987 L50.001,2.84052 C50.001,2.84052 35.599,-3.54271 25.001,2.84052 C14.403,9.22376 5.599,6.49418 0.000976562,2.84052 L0.000976562,32.7987";break;case"directdata":n.pathData="M 1477 613 L 1619 613 C 1627 613 1634 636 1634 665 C 1634 694 1627 717 1619 717 L 1477 717 C 1469 717 1461 694 1461 665 C 1461 636 1469 613 1477 613 ZM 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717M 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717";break;case"sequentialdata":n.pathData="M0.00297546,24.999 C0.00297546,11.1922 10.433,0.00216177 23.295,0.00216177 C36.159,0.00216177 46.585,11.1922 46.585,24.999 C46.585,38.8057 36.159,49.9979 23.295,49.9979 C10.433,49.9979 0.00297546,38.8057 0.00297546,24.999 z M23.294,49.999 L50.002,49.999";break;case"sort":n.pathData="M50.001,24.9971 L25.001,49.9971 L0.000976562,24.9971 L25.001,-0.00286865 L50.001,24.9971 z M0.000976562,24.9971 L50.001,24.9971";break;case"multidocument":n.pathData="M43.6826,40 C44.8746,40.6183 45.8586,41.3502 46.8366,42.1122 L46.8366,4.74487 L3.09857,4.74487 L3.09857,10.9544 M46.837,35.1437 C48.027,35.7653 49.025,36.6042 50.003,37.3695 L50.003,0.0021928 L6.26497,0.0021928 L6.26497,4.74451 M43.6826,47.1132 L43.6826,10.7652 L0.00257874,10.7652 L0.00257874,47.1132 C0.00257874,47.1132 12.5846,53.6101 21.8426,47.1132 C31.1006,40.6163 38.7926,43.3935 43.6826,47.1132 z";break;case"collate":n.pathData="M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z";break;case"summingjunction":n.constraints=i;n.pathData="M7.3252,42.6768 L42.6772,7.32477 M42.6768,42.6768 L7.3248,7.32477 M0.000976562,25.001 C0.000976562,11.193 11.197,0.000976562 25.001,0.000976562 C38.809,0.000976562 50.001,11.193 50.001,25.001 C50.001,38.809 38.809,50.001 25.001,50.001 C11.197,50.001 0.000976562,38.809 0.000976562,25.001 z";break;case"or":n.pathData="M 0 50 L 100 50 M 50 100 L 50 0.0 M 0 50 C 0 22.384 22.392 0 50 0 C 77.616 0 100 22.384 100 50 C 100 77.616 77.616 100 50 100 C 22.392 100 0 77.616 0 50 Z";break;case"internalstorage":n.pathData="M 0 3.8194444444444446A 2.5,3.8194444444444446 0 0,1 2.5,0L 47.5 0A 2.5,3.8194444444444446 0 0,1 50,3.8194444444444446L 50 45.833333333333336A 2.5,3.8194444444444446 0 0,1 47.5,49.65277777777778L 2.5 49.65277777777778A 2.5,3.8194444444444446 0 0,1 0,45.833333333333336L 0 3.8194444444444446ZM 0 11.458333333333334L 50 11.458333333333334M 12.5 0L 12.5 49.65277777777778";break;case"extract":n._shape="polygon";n.constraints=i;n.points=[{x:0,y:35},{x:30,y:0},{x:60,y:35}];break;case"manualoperation":n._shape="polygon";n.points=[{x:46.4,y:28.8},{x:14.8,y:28.8},{x:0,y:0},{x:60,y:0}];break;case"merge":n._shape="polygon";n.constraints=i;n.points=[{x:60,y:0},{x:30,y:35},{x:0,y:0}];break;case"offpagereference":n._shape="polygon";n.points=[{x:60,y:33.3},{x:30.1,y:39},{x:0,y:33.3},{x:0,y:0},{x:60,y:0}];break;case"sequentialaccessstorage":n.constraints=i;n.pathData="M 60 30 C 60 13.4 46.6 0 30 0 S 0 13.4 0 30 s 13.4 30 30 30 h 28.6 v -6.5 h -9.9 C 55.5 48 60 39.5 60 30 Z";break;case"annotation1":n.pathData="M49.9984,50.0029 L-0.00271199,50.0029 L-0.00271199,0.00286865 L49.9984,0.00286865";break;case"annotation2":n.pathData="M49.9977,50.0029 L25.416,50.0029 L25.416,0.00286865 L49.9977,0.00286865 M25.4166,25.0029 L-0.00227869,25.0029"}return n};t.datavisualization.Diagram.ArrowShape=function(n){n._shape="path";n.shape||(n.shape="circulararrow");switch(n.shape){case"circulararrow":n.pathData="M433.4624,503.8848C429.4244,493.2388,419.1354,485.6678,407.0734,485.6678C391.4884,485.6678,378.8544,498.3018,378.8544,513.8868L384.4984,513.8868C384.4984,501.4178,394.6054,491.3108,407.0734,491.3108C415.9494,491.3108,423.6264,496.4338,427.3144,503.8848L422.9114,503.8848L426.8974,508.8848L430.8824,513.8868L434.8684,508.8848L438.8544,503.8848L433.4624,503.8848z";break;case"curvedrightarrow":n.pathData="M0.83006144,28.226993 C2.4030598,37.092016 9.5750604,44.49601 19.365042,48.044014 L19.365042,43.129004 25.376032,47.706001 31.386044,52.282999 25.376032,56.858988 19.365042,61.436991 19.365042,55.399027 C8.24608,51.372995 0.50004381,42.368995 0.50004357,31.905003 0.50004381,30.65601 0.6160717,29.429996 0.83006144,28.226993 z M31.402985,0.5 L31.402985,7.4419994 C15.834992,7.4419994 2.9619988,16.497999 0.81800008,28.275999 0.61199981,27.139999 0.49999988,25.981999 0.5,24.803999 0.49999988,11.379999 14.334993,0.5 31.402985,0.5 z";break;case"curveduparrow":n.pathData="M52.283021,0.51798058 L56.859025,6.5279841 61.436024,12.537989 55.399022,12.537989 C51.373021,23.656996 42.369015,31.403002 31.905011,31.403002 30.65601,31.403002 29.430011,31.288002 28.22701,31.073002 37.092015,29.500999 44.496018,22.328995 48.044018,12.537989 L43.129018,12.537989 47.706021,6.5279841 z M0.5,0.5 L7.4420163,0.5 C7.4420163,16.067989 16.497985,28.940971 28.276,31.083977 27.140013,31.290977 25.981993,31.402 24.804015,31.402 11.380005,31.402 0.5,17.567989 0.5,0.5 z";break;case"curvedleftarrow":n.pathData="M31.073116,28.227982 C31.287107,29.429977 31.403074,30.65599 31.403074,31.905989 31.403074,42.368966 23.657099,51.372959 12.538074,55.399935 L12.538074,61.436979 6.5270846,56.85898 0.51707193,52.282993 6.5270846,47.706976 12.538074,43.129983 12.538074,48.044958 C22.328056,44.496956 29.500118,37.091961 31.073116,28.227982 z M0.5,0.5 C17.568025,0.5 31.403045,11.380997 31.403045,24.803993 31.403045,25.981992 31.291046,27.139992 31.085045,28.276992 28.941042,16.497995 16.068023,7.442997 0.5,7.442997 z";break;case"curveddownarrow":n.pathData="M24.804015,0.50000453 C25.981993,0.50000453 27.140013,0.61301103 28.276,0.8180277 16.498045,2.9630154 7.4420161,15.836023 7.4420156,31.404005 L0.5,31.404005 C0.5,14.336024 11.380004,0.50000453 24.804015,0.50000453 z M31.90502,0.5 C42.369025,0.49999976 51.37303,8.2460016 55.399031,19.365004 L61.436034,19.365004 56.859034,25.377005 52.28303,31.387007 47.70603,25.377005 43.129027,19.365004 48.044028,19.365004 C44.496027,9.5760015 37.092024,2.4040001 28.227019,0.82999995 29.43002,0.61699978 30.65602,0.49999976 31.90502,0.5 z";break;case"jumpingrightarrow":n.pathData="M571.7207,727.7451L563.4507,716.8841L572.3297,716.8841C565.9217,699.1961,552.5427,686.2371,536.5277,683.3951C538.6997,683.0091,540.9157,682.8001,543.1717,682.8001C562.0777,682.8001,578.3457,696.7961,585.6187,716.8841L596.5277,716.8841L588.2577,727.7451L579.9907,738.6041L571.7207,727.7451z";break;case"jumpingleftarrow":n.pathData="M688.4209,727.7441L696.6889,716.8851L687.8119,716.8851C694.2179,699.1971,707.5989,686.2381,723.6119,683.3941C721.4409,683.0101,719.2259,682.8011,716.9679,682.8011C698.0639,682.8011,681.7959,696.7951,674.5209,716.8851L663.6119,716.8851L671.8839,727.7441L680.1509,738.6031L688.4209,727.7441z"}return n};t.datavisualization.Diagram.BPMNShape=function(i,r){if(i.shape||(i.shape="event"),r){r.nameTable[i.name]||(i.labels||(i.labels=[{margin:{}}]),i.fillColor||(i.fillColor="white"),i.borderColor||(i.borderColor="black"),i.borderWidth||(i.borderWidth=1),i.opacity||(i.opacity=1),i.gradient||(i.gradient=null),i.name&&i.children&&i.children.length&&r.nameTable[i.children[0]]&&r.nameTable[i.children[0]].parent!=i.name&&delete i.children);switch(i.shape){case"event":i=t.datavisualization.Diagram.DefautShapes._getBPMNEventShape(i,r);break;case"gateway":i=t.datavisualization.Diagram.DefautShapes._getBPMNGatewayShape(i,r);break;case"dataobject":i=t.datavisualization.Diagram.DefautShapes._getBPMNDataShape(i,r);break;case"activity":i=t.datavisualization.Diagram.DefautShapes._getBPMNActivityShape(i,r);break;case"message":i=n.extend(!0,{},i,{_shape:"polygon",labels:[{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}}],points:[{x:0,y:0},{x:19.8,y:12.8},{x:40,y:0},{x:0,y:0},{x:0,y:25.5},{x:40,y:25.5},{x:40,y:0}]});break;case"datasource":i=n.extend(!0,{},i,{_shape:"path",labels:[{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}}],pathData:"M 0 10.6 c 0 5.9 16.8 10.6 37.5 10.6 S 75 16.4 75 10.6 v 0 v 68.9 v -0.1 C 75 85.3 58.2 90 37.5 90 S 0 85.3 0 79.4 l 0 0.1 V 56 V 40.6 L 0 10.6 C 0 4.7 16.8 0 37.5 0 S 75 4.7 75 10.6 S 58.2 21.2 37.5 21.2 S 0 16.5 0 10.6 l 0 6.7 v -0.2 c 0 5.9 16.8 10.6 37.5 10.6 S 75 22.9 75 17.1 v 6.8 v -0.1 c 0 5.9 -16.8 10.6 -37.5 10.6 S 0 29.6 0 23.8"});break;case"sequentialflow":i=n.extend(!0,{},i,{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2});break;case"associationflow":i=t.datavisualization.Diagram.DefautShapes._getBPMNAssociationShape(i,r);break;case"messageflow":i=n.extend(!0,{},i,{segments:[{type:"straight"}],sourceDecorator:{shape:"circle",fillColor:"white"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"})}}return i};t.datavisualization.Diagram.DefautShapes={_getBPMNEventShape:function(i,r){var u=[],f,e,o;if(i._type="group",i.canUngroup=!1,i=n.extend(!0,{},t.datavisualization.Diagram.BPMNEventDefaults,i),i.children)for(f=0;f<i.children.length;f++)r.nameTable[i.children[f].name||i.children[f]]&&u.push(r.nameTable[i.children[f].name||i.children[f]]);else{for(e=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.Connect),o={parent:i.name,type:"node",shape:"path",offsetX:i.offsetX,offsetY:i.offsetY,ports:[]},u.push({name:i.name+"_0",width:i.width,height:i.height,pathData:"M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001",constraints:e,_isDisabled:!0}),u.push({name:i.name+"_1",width:i.width*.85,height:i.height*.85,pathData:"M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001",constraints:e,_isDisabled:!0}),u.push({name:i.name+"_2",width:i.width*.5,height:i.height*.5,pathData:"M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001",constraints:e,_isDisabled:!0}),f=0;f<u.length;f++)u[f]=t.datavisualization.Diagram.Node(n.extend(!0,{},o,u[f]));i.children=u;i.labels[0]=n.extend(!0,{},i.labels[0],{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}});i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default}u[0].fillColor="white";u[1].fillColor=i.fillColor;u[2].fillColor="white";u[0].borderColor=i.borderColor;u[1].borderColor=i.borderColor;u[2].borderColor=i.borderColor;u[0].borderDashArray="1 0";u[1].borderDashArray="1 0";u[1].visible=!0;u[2].visible=!0;u[1].borderWidth=i.borderWidth;u[0].opacity=i.opacity;u[1].opacity=i.opacity;u[2].opacity=i.opacity;u[0].gradient=null;u[1].gradient=i.gradient;u[2].height=i.height*.5;switch(i.event){case"start":u[0].fillColor=u[1].fillColor;u[0].gradient=i.gradient;u[1].visible=!1;break;case"noninterruptingstart":u[0].fillColor=u[1].fillColor;u[0].gradient=i.gradient;u[0].borderDashArray="2 3";u[1].visible=!1;break;case"noninterruptingintermediate":u[0].borderDashArray="2 3";u[1].borderDashArray="2 3";break;case"end":u[0].fillColor="black";u[2].fillColor="black"}switch(i.trigger){case t.datavisualization.Diagram.BPMNTriggers.None:u[2].visible=!1;break;case t.datavisualization.Diagram.BPMNTriggers.Message:u[2].pathData="M0,0  L19.8,12.8 L40,0 L0, 0 L0, 25.5  L40, 25.5 L 40, 0";u[2].height=3*u[2].width/4;break;case t.datavisualization.Diagram.BPMNTriggers.Timer:u[2].pathData="M40,20c0,8.654-5.496,16.024-13.189,18.81C24.685,39.58,22.392,40,20,40C8.954,40,0,31.046,0,20S8.954,0,20,0S40,8.954,40,20z M20,0 L20,2.583 L20,5.283 M10.027,2.681 L11.659,5.507 L12.669,7.257 M2.731,9.989 L6.014,11.885 L7.307,12.631 M0.067,19.967 L2.667,19.967 L5.35,19.967M2.748,29.939 L5.731,28.217 L7.323,27.298 M10.056,37.236 L11.292,35.095 L12.698,32.66 M20.033,39.9 L20.033,36.417 L20.033,34.617 M30.006,37.219 L28.893,35.292 L27.364,32.643 M37.302,29.911 L34.608,28.355 L32.727,27.269M39.967,19.933 L37.417,19.933 L34.683,19.933 M37.286,9.961 L34.583,11.521 L32.71,12.602 M29.977,2.664 L28.653,4.957 L27.336,7.24 M22.104,8.5 L19.688,20 L24.75,20 L31.604,20 L24.75,20 L19.688,20z";break;case t.datavisualization.Diagram.BPMNTriggers.Escalation:u[2].pathData="M 30.001 8.098 L 11.842 43.543 l 18.159 -18.882 l 18.162 18.882 L 30.001 8.098 Z ";break;case t.datavisualization.Diagram.BPMNTriggers.Link:u[2].pathData="M 32.014 19.258 v 5.992 H 9.373 v 9.504 h 22.641 v 5.988 L 50.622 30 L 32.014 19.258 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Error:u[2].pathData="M 23.77 18.527 l -7.107 27.396 l 8.507 -17.247 L 36.94 40.073 l 6.394 -25.997 l -8.497 15.754 L 23.77 18.527 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Compensation:u[2].pathData="M 25.7086 0 L 0 25 L 25.7086 50 V 26.3752 L 50 50 V 0 L 25.7086 23.6248 V 0 Z ";break;case t.datavisualization.Diagram.BPMNTriggers.Signal:u[2].pathData="M 50 50 H 0 L 25.0025 0 L 50 50 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Multiple:u[2].pathData="M 17.784 48.889 H 42.21 l 7.548 -23.23 L 29.997 11.303 L 10.236 25.658 L 17.784 48.889 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Parallel:u[2].pathData="M 27.276 49.986 h 5.58 v -17.15 h 17.146 V 27.17 h -17.15 l 0.004 -17.15 h -5.58 l -0.004 17.15 H 9.994 v 5.666 h 17.278 L 27.276 49.986 Z"}return i},_getBPMNGatewayShape:function(i,r){var u=[],f,e,o;if(i._type="group",i.canUngroup=!1,i=n.extend(!0,{},t.datavisualization.Diagram.BPMNGatewayDefaults,i),i.children)for(f=0;f<i.children.length;f++)r.nameTable[i.children[f].name||i.children[f]]&&u.push(r.nameTable[i.children[f].name||i.children[f]]);else{for(e=t.datavisualization.Diagram.NodeConstraints.Default^(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.Connect),o={parent:i.name,type:"node",shape:"path",offsetX:i.offsetX,offsetY:i.offsetY,ports:[]},u.push({name:i.name+"_0",width:i.width,height:i.height,pathData:"M 40 20 L 20 40 L 0 20 L 20 0 L 40 20 Z",constraints:e,_isDisabled:!0}),u.push({name:i.name+"_1",width:i.width*.45,height:i.height*.45,borderColor:"white",fillColor:"black",constraints:e,_isDisabled:!0}),f=0;f<u.length;f++)u[f]=t.datavisualization.Diagram.Node(n.extend(!0,{},o,u[f]));i.children=u;i.labels[0]=n.extend(!0,{},i.labels[0],{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}});i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default}u[0].fillColor=i.fillColor;u[0].borderColor=i.borderColor;u[0].borderWidth=i.borderWidth;u[0].opacity=i.opacity;u[1].opacity=i.opacity;u[0].gradient=i.gradient;u[1].visible=!0;u[1].shape=u[1]._shape="path";switch(i.gateway){case"none":u[1].visible=!1;break;case"exclusive":u[1].pathData="M 11.196 29.009 l 6.36 -9.712 l -5.764 -8.899 h 4.393 l 3.732 5.979 l 3.656 -5.979 h 4.354 l -5.789 9.039 l 6.36 9.572 h -4.532 l -4.126 -6.437 l -4.139 6.437 H 11.196 Z";break;case"inclusive":u[1].pathData="M 20.323 31.333 c -6.625 0 -12.015 -5.39 -12.015 -12.015 s 5.39 -12.015 12.015 -12.015 s 12.016 5.39 12.016 12.015 S 26.948 31.333 20.323 31.333 Z M 20.323 9.303 c -5.522 0 -10.015 4.493 -10.015 10.015 s 4.492 10.015 10.015 10.015 s 10.016 -4.493 10.016 -10.015 S 25.846 9.303 20.323 9.303 Z";break;case"parallel":u[1].pathData="M 18.394 29.542 v -8.833 H 9.626 v -3.691 h 8.768 V 8.251 h 3.734 v 8.767 h 8.768 v 3.691 h -8.768 v 8.833 H 18.394 Z";break;case"eventbased":u[1].pathData="M 20.322 29.874 c -5.444 0 -9.873 -4.43 -9.873 -9.874 s 4.429 -9.874 9.873 -9.874 s 9.874 4.429 9.874 9.874 S 25.767 29.874 20.322 29.874 Z M 20.322 10.876 c -5.03 0 -9.123 4.093 -9.123 9.124 s 4.093 9.124 9.123 9.124 c 5.031 0 9.124 -4.093 9.124 -9.124 S 25.354 10.876 20.322 10.876 ZM 20.322 32.891 c -7.107 0 -12.89 -5.783 -12.89 -12.891 c 0 -7.107 5.782 -12.89 12.89 -12.89 c 7.108 0 12.891 5.783 12.891 12.89 C 33.213 27.108 27.431 32.891 20.322 32.891 Z M 20.322 7.86 c -6.693 0 -12.14 5.446 -12.14 12.14 s 5.446 12.141 12.14 12.141 c 6.694 0 12.141 -5.446 12.141 -12.141 S 27.017 7.86 20.322 7.86 ZM 24.191 25.386 h -7.984 l -2.469 -7.595 l 6.461 -4.693 l 6.461 4.693 L 24.191 25.386 Z M 16.934 24.386 h 6.531 l 2.02 -6.213 l -5.285 -3.839 l -5.285 3.839 L 16.934 24.386 Z";break;case"complex":u[1].shape=u[1]._shape="polygon";u[1].points=[{x:29.198,y:19.063},{x:23.089,y:19.063},{x:27.794,y:14.358},{x:26.38,y:12.944},{x:21.223,y:18.101},{x:21.223,y:10.443},{x:19.223,y:10.443},{x:19.223,y:17.976},{x:14.022,y:12.776},{x:12.608,y:14.19},{x:17.48,y:19.063},{x:10.365,y:19.063},{x:10.365,y:21.063},{x:18.261,y:21.063},{x:12.392,y:26.932},{x:13.806,y:28.346},{x:19.223,y:22.929},{x:19.223,y:30.225},{x:21.223,y:30.225},{x:21.223,y:22.805},{x:25.925,y:27.507},{x:27.339,y:26.093},{x:22.309,y:21.063},{x:29.198,y:21.063}]}return i},_getBPMNDataShape:function(i,r){var u=[],f,e,o;if(i._type="group",i.canUngroup=!1,i=n.extend(!0,{},t.datavisualization.Diagram.BPMNDataObjectDefaults,i),i.children)for(f=0;f<i.children.length;f++)r.nameTable[i.children[f].name||i.children[f]]&&u.push(r.nameTable[i.children[f].name||i.children[f]]);else{for(e=t.datavisualization.Diagram.NodeConstraints.Default^(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.Connect),o={parent:i.name,type:"node",shape:"path",offsetX:i.offsetX,ports:[]},u.push({name:i.name+"_0",width:i.width,height:i.height,offsetY:i.offsetY,shape:"polygon",points:[{x:29.904,y:5},{x:7.853,y:5},{x:7.853,y:45},{x:42.147,y:45},{x:42.147,y:17.242},{x:29.932,y:5},{x:29.932,y:17.242},{x:42.147,y:17.242}],constraints:e,_isDisabled:!0}),u.push({name:i.name+"_1",width:i.width*.075,height:i.height*.15,offsetY:i.height*.85+(i.offsetY-i.height/2),fillColor:"black",pathData:"M 0 0 L 0.1 0 L 0.1 2 L 0 2 Z M 0.4 0 L 0.6 0 L 0.6 2 L0.4 2 Z M 0.9 0 L 1 0 L 1 2 L 0.9 2 Z ",constraints:e,_isDisabled:!0}),f=0;f<u.length;f++)u[f]=t.datavisualization.Diagram.Node(n.extend(!0,{},o,u[f]));i.children=u;i.labels[0]=n.extend(!0,{},i.labels[0],{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}});i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default}return u[0].fillColor=i.fillColor,u[0].borderColor=i.borderColor,u[0].borderWidth=i.borderWidth,u[0].opacity=i.opacity,u[1].opacity=i.opacity,u[0].gradient=i.gradient,u[1].visible=i.collection?!0:!1,i},_getBPMNActivityShape:function(i,r){var u=[],f,o,s,e,h,c,l;if(i._type="group",i.canUngroup=!1,i=n.extend(!0,{},t.datavisualization.Diagram.BPMNActivityDefaults,i),o=i.offsetX-i.width/2,s=i.offsetY-i.height/2,i.children)for(f=0;f<i.children.length;f++)r.nameTable[i.children[f].name||i.children[f]]&&u.push(r.nameTable[i.children[f].name||i.children[f]]);else{for(e=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.Connect),h={parent:i.name,type:"node",shape:"path",ports:[]},u.push({name:i.name+"_0",width:i.width,height:i.height,offsetX:i.offsetX,offsetY:i.offsetY,pathData:"M 90 82.895 C 90 86.819 86.776 90 82.8 90 H 7.2 C 3.224 90 0 86.819 0 82.895 V 7.105 C 0 3.181 3.224 0 7.2 0 h 75.6 C 86.776 0 90 3.181 90 7.105 V 82.895 Z",constraints:e,_isDisabled:!0}),u.push({name:i.name+"_1",width:i.width*.075,height:i.height*.075,offsetX:o+i.width*.9,offsetY:s+i.height*.9,borderColor:"black",fillColor:"black",constraints:e,_isDisabled:!0}),u.push({name:i.name+"_2",width:i.width*.14,height:i.height*.14,offsetX:o+i.width*.14,offsetY:s+i.height*.14,borderColor:"black",constraints:e,_isDisabled:!0}),u.push({name:i.name+"_3",width:i.width*.125,height:i.height*.125,offsetX:o+i.width*.6,offsetY:s+i.height*.9,borderColor:"black",fillColor:"black",constraints:e,_isDisabled:!0}),u.push({name:i.name+"_4",width:i.width*.15,height:i.height*.15,offsetX:o+i.width*.7,offsetY:s+i.height*.9,borderColor:"black",fillColor:"black",constraints:e,_isDisabled:!0}),f=0;f<u.length;f++)u[f]=t.datavisualization.Diagram.Node(n.extend(!0,{},h,u[f]));i.children=u;i.labels[0]=n.extend(!0,{},i.labels[0],{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}});i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default}u[0].fillColor=i.fillColor;u[0].borderColor=i.borderColor;u[0].borderWidth=i.borderWidth;u[1].visible=!0;u[2].visible=!0;u[3].visible=!0;u[4].visible=!1;u[0].borderWidth=1;u[0].borderDashArray="1 0";u[2].width=i.width*.14;u[2].height=i.height*.14;u[0].opacity=u[1].opacity=u[2].opacity=u[3].opacity=u[4].opacity=i.opacity;u[0].gradient=i.gradient;c=i.activity=="task"?i.task.loop:i.subProcess.loop;l=i.activity=="task"?i.task.compensation:i.subProcess.compensation;switch(c){case"none":u[1].visible=!1;break;case"standard":u[1].pathData="M 52.002 73.379 c -2.494 -2.536 -6.55 -2.534 -9.043 0 c -1.208 1.228 -1.874 2.861 -1.874 4.598 c 0 1.225 0.337 2.395 0.957 3.411 l -1.167 1.186 l 2.071 0.458 l 2.071 0.458 l -0.45 -2.106 l -0.45 -2.106 l -1.292 1.314 c -1.119 -2.065 -0.842 -4.709 0.877 -6.458 c 2.084 -2.119 5.475 -2.117 7.557 0 c 2.083 2.119 2.083 5.565 0 7.685 c -0.976 0.992 -2.272 1.557 -3.65 1.59 l 0.025 1.068 c 1.65 -0.041 3.2 -0.716 4.368 -1.903 c 1.208 -1.228 1.874 -2.861 1.874 -4.597 C 53.875 76.24 53.209 74.607 52.002 73.379 Z";break;case"parallelmultiinstance":u[1].pathData="M 51.5,69.5 L52.5,69.5 L52.5,84.5 L51.5 84.5 Z M 46.5,69.5 L47.5,69.5 L47.5,84.5 L46.5 84.5 Z M 41.5,69.5 L42.5,69.5 L42.5,84.5 L41.5 84.5 Z  ";break;case"sequencemultiinstance":u[1].pathData="M 40.375,71.5 L 55.375,71.5 L 55.375,72.5 L 40.375,72.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,81.5 L 55.375,81.5 L 55.375,82.5 L 40.375,82.5 Z"}if(l?u[3].pathData="M 22.462 18.754 l -6.79 3.92 l 6.79 3.92 V 22.89 l 6.415 3.705 v -7.841 l -6.415 3.705 V 18.754 Z M 28.331 19.701 v 5.947 l -5.149 -2.973 L 28.331 19.701 Z M 21.916 25.647 l -5.15 -2.973 l 5.15 -2.973 V 25.647 Z M 22.275 12.674 c -5.513 0 -9.999 4.486 -9.999 9.999 c 0 5.514 4.486 10.001 9.999 10.001 c 5.514 0 9.999 -4.486 9.999 -10.001 C 32.274 17.16 27.789 12.674 22.275 12.674 Z M 22.275 32.127 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 c 5.212 0 9.453 4.241 9.453 9.453 C 31.728 27.887 27.487 32.127 22.275 32.127 Z":u[3].visible=!1,i.activity==t.datavisualization.Diagram.BPMNActivity.Task){switch(i.task.type){case"none":u[2].visible=!1;break;case"service":u[2].pathData="M 32.699 20.187 v -4.005 h -3.32 c -0.125 -0.43 -0.292 -0.83 -0.488 -1.21 l 2.373 -2.375 l -2.833 -2.83 l -2.333 2.333 c -0.44 -0.253 -0.9 -0.448 -1.387 -0.595 v -3.32 h -4.003 v 3.32 c -0.46 0.137 -0.89 0.322 -1.3 0.537 l -2.285 -2.275 l -2.833 2.83 l 2.285 2.278 c -0.235 0.42 -0.41 0.847 -0.547 1.307 h -3.33 v 4.005 h 3.33 c 0.148 0.488 0.343 0.955 0.588 1.395 l -2.325 2.325 l 2.822 2.832 l 2.373 -2.382 c 0.392 0.205 0.792 0.37 1.212 0.497 v 3.33 h 4.003 v -3.33 c 0.46 -0.138 0.89 -0.323 1.3 -0.547 l 2.43 2.432 l 2.822 -2.832 l -2.42 -2.422 c 0.222 -0.41 0.4 -0.85 0.535 -1.297 H 32.699 Z M 22.699 21.987 c -2.1 0 -3.803 -1.703 -3.803 -3.803 c 0 -2.1 1.703 -3.803 3.803 -3.803 c 2.1 0 3.803 1.703 3.803 3.803 C 26.502 20.285 24.8 21.987 22.699 21.987 Z";break;case"receive":u[2].pathData="M 12.217 12.134 v 13.334 h 20 V 12.134 H 12.217 Z M 30.44 13.007 l -8.223 5.35 l -8.223 -5.35 H 30.44 Z M 13.09 24.594 V 13.459 l 9.127 5.94 l 9.127 -5.94 v 11.135 H 13.09 Z";u[2].height=i.height*.12;break;case"send":u[2].pathData="M 45.7256 3.16055 L 25 23.4017 L 4.27442 3.16055 H 45.7256 Z M 47.8963 46.8413 H 2.10375 V 4.80813 L 25 27.1709 L 47.8963 4.80813 V 46.8413 Z";u[2].height=i.height*.12;break;case"instantiatingreceive":u[2].pathData="M 16.306 17.39 v 8.79 h 13.198 v -8.79 H 16.306 Z M 28.375 17.946 l -5.47 3.558 l -5.47 -3.558 H 28.375 Z M 28.948 25.625 H 16.861 v -7.389 l 6.043 3.931 l 6.043 -3.931 V 25.625 Z M 22.905 11.785 c -5.514 0 -9.999 4.486 -9.999 10 c 0 5.514 4.485 10 9.999 10 s 9.999 -4.486 9.999 -10 C 32.904 16.272 28.419 11.785 22.905 11.785 Z M 22.905 31.239 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 s 9.452 4.241 9.452 9.453 C 32.357 26.998 28.117 31.239 22.905 31.239 Z";u[2].width=i.width*.2;u[2].height=i.height*.2;break;case"manual":u[2].pathData="M 13.183 15.325 h 2.911 c 0.105 0 0.207 -0.043 0.281 -0.117 c 0.078 -0.074 0.117 -0.176 0.117 -0.281 c 0 -0.753 0.718 -1.362 1.596 -1.362 h 2.579 c -0.117 0.227 -0.191 0.48 -0.195 0.757 c 0 0.433 0.168 0.851 0.46 1.144 c 0.008 0.004 0.015 0.011 0.019 0.015 c -0.289 0.285 -0.475 0.691 -0.479 1.148 c 0 0.433 0.168 0.846 0.46 1.139 c 0.011 0.012 0.023 0.02 0.035 0.032 c -0.301 0.281 -0.491 0.694 -0.495 1.155 c 0 0.432 0.168 0.847 0.46 1.143 c 0.265 0.266 0.612 0.414 0.975 0.414 h 0.839 c 0.027 0.004 0.051 0.012 0.074 0.012 h 8.443 c 0.352 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.285 0.753 -0.636 0.753 h -6.687 c -0.019 0 -0.035 -0.008 -0.051 -0.008 h -2.27 c -0.121 -0.835 -0.667 -1.187 -1.795 -1.187 h -2.158 c -0.223 0 -0.402 0.18 -0.402 0.403 c 0 0.219 0.179 0.398 0.402 0.398 h 2.158 c 0.972 0 1.019 0.203 1.019 0.784 c 0 0.219 0.179 0.399 0.402 0.399 c 0.008 0 0.016 -0.004 0.027 -0.004 c 0.028 0.004 0.055 0.016 0.082 0.016 h 2.56 c 0.34 0.015 0.616 0.343 0.616 0.752 c 0 0.418 -0.285 0.757 -0.636 0.761 h -0.004 h -6.442 c -0.878 0 -1.595 -0.639 -1.595 -1.427 v -0.683 c 0 -0.109 -0.043 -0.211 -0.114 -0.285 c -0.078 -0.074 -0.179 -0.117 -0.285 -0.117 h -0.004 l -2.989 0.027 c -0.223 0 -0.398 0.184 -0.398 0.402 c 0 0.219 0.179 0.395 0.398 0.395 h 0.004 l 2.591 -0.02 v 0.282 c 0 1.229 1.073 2.223 2.391 2.223 h 3.895 c 0.004 0 0.007 0.004 0.011 0.004 h 2.536 c 0.792 0 1.436 -0.698 1.436 -1.561 c 0 -0.273 -0.07 -0.53 -0.188 -0.752 h 5.49 c 0.792 0 1.436 -0.695 1.436 -1.553 c 0 -0.858 -0.644 -1.557 -1.436 -1.557 h -3.566 c 0.121 -0.226 0.199 -0.487 0.199 -0.768 c 0 -0.468 -0.195 -0.882 -0.495 -1.167 c 0.301 -0.285 0.495 -0.698 0.495 -1.163 c 0 -0.456 -0.191 -0.866 -0.483 -1.152 c 0.293 -0.285 0.483 -0.694 0.483 -1.151 c 0 -0.858 -0.647 -1.557 -1.439 -1.557 h -8.373 c -1.167 0 -2.142 0.757 -2.352 1.76 l -2.548 -0.004 c -0.219 0 -0.399 0.18 -0.399 0.403 C 12.784 15.145 12.964 15.325 13.183 15.325 L 13.183 15.325 Z M 21.907 19.707 c -0.191 0 -0.328 -0.094 -0.41 -0.176 c -0.144 -0.145 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.418 0.289 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.008 h 0.051 c 0.351 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.286 0.753 -0.636 0.753 H 21.907 Z M 27.097 16.629 c 0 0.414 -0.286 0.753 -0.64 0.753 h -4.464 c -0.004 0 -0.004 0 -0.004 0 h -0.082 c -0.191 0 -0.328 -0.098 -0.414 -0.18 c -0.14 -0.145 -0.222 -0.352 -0.222 -0.573 c 0 -0.413 0.285 -0.749 0.631 -0.753 h 3.434 c 0 0 0 0 0.004 0 h 1.116 c 0.008 0 0.012 -0.004 0.02 -0.004 C 26.819 15.887 27.097 16.215 27.097 16.629 L 27.097 16.629 Z M 27.097 14.322 c 0 0.41 -0.278 0.737 -0.62 0.749 c -0.008 0 -0.012 0 -0.016 0 h -3.637 c -0.008 0 -0.015 0.004 -0.023 0.004 h -0.886 c -0.004 0 -0.008 0 -0.012 0 c -0.187 0 -0.324 -0.094 -0.406 -0.176 c -0.144 -0.144 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.414 0.293 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.004 h 0.051 C 26.811 13.565 27.097 13.905 27.097 14.322 L 27.097 14.322 Z M 27.097 14.322";u[2].width=i.width*.2;break;case"businessrule":u[2].pathData="M 32.844 13.245 h -0.089 v 0 H 13.764 v -0.015 h -1.009 v 16.989 h 0.095 v 0.011 h 19.716 v -0.011 h 0.278 V 13.245 Z M 31.844 14.229 v 4.185 h -18.08 v -4.185 H 31.844 Z M 18.168 25.306 v 3.938 h -4.404 v -3.938 H 18.168 Z M 13.764 24.322 v -4.923 h 4.404 v 4.923 H 13.764 Z M 19.177 25.306 h 12.667 v 3.938 H 19.177 V 25.306 Z M 19.177 24.322 v -4.923 h 12.667 v 4.923 H 19.177 Z";break;case"user":u[2].pathData="M 21.762 21.935 c 2.584 0 4.687 -2.561 4.687 -5.703 c 0 -3.147 -2.103 -5.703 -4.687 -5.703 c -1.279 0 -2.475 0.61 -3.363 1.721 c -0.855 1.071 -1.327 2.484 -1.324 3.983 C 17.075 19.374 19.178 21.935 21.762 21.935 L 21.762 21.935 Z M 21.762 11.779 c 1.894 0 3.436 1.995 3.436 4.452 c 0 2.453 -1.541 4.452 -3.436 4.452 c -1.895 0 -3.44 -1.999 -3.44 -4.452 C 18.323 13.774 19.864 11.779 21.762 11.779 L 21.762 11.779 Z M 25.699 21.309 c -0.348 0 -0.626 0.277 -0.626 0.626 c 0 0.344 0.277 0.622 0.626 0.622 c 2.136 0 3.875 1.74 3.875 3.879 c 0 0.272 -0.227 0.498 -0.501 0.498 H 14.447 c -0.274 0 -0.497 -0.223 -0.497 -0.498 c 0 -2.139 1.736 -3.879 3.872 -3.879 c 0.344 0 0.625 -0.277 0.625 -0.622 c 0 -0.348 -0.28 -0.626 -0.625 -0.626 c -2.826 0 -5.124 2.297 -5.124 5.126 c 0 0.965 0.784 1.749 1.748 1.749 h 14.626 c 0.964 0 1.748 -0.784 1.748 -1.749 C 30.822 23.606 28.524 21.309 25.699 21.309 L 25.699 21.309 Z M 22.217 9.832 c 0.448 -0.263 0.924 -0.396 1.419 -0.396 c 1.895 0 3.436 1.995 3.436 4.452 c 0 0.439 -0.048 0.873 -0.143 1.284 c -0.08 0.336 0.128 0.672 0.464 0.751 c 0.048 0.012 0.098 0.019 0.143 0.019 c 0.284 0 0.541 -0.195 0.608 -0.483 c 0.119 -0.506 0.18 -1.034 0.18 -1.571 c 0 -3.147 -2.102 -5.703 -4.687 -5.703 c -0.711 0 -1.419 0.198 -2.054 0.573 c -0.296 0.174 -0.397 0.559 -0.219 0.855 C 21.536 9.911 21.921 10.009 22.217 9.832 L 22.217 9.832 Z M 27.697 18.81 c -0.345 0 -0.626 0.277 -0.626 0.622 c 0 0.348 0.281 0.626 0.626 0.626 c 2.137 0 3.75 1.782 3.75 3.918 c 0 0.07 -0.013 0.141 -0.043 0.205 c -0.14 0.314 0.003 0.684 0.318 0.823 c 0.082 0.037 0.167 0.055 0.253 0.055 c 0.241 0 0.466 -0.141 0.57 -0.373 c 0.101 -0.226 0.153 -0.464 0.153 -0.714 C 32.699 21.15 30.523 18.81 27.697 18.81 L 27.697 18.81 Z M 27.697 18.81";break;case"script":u[2].pathData="M 22.453 15.04 c 0 0 -1.194 -3.741 2.548 -3.774 c 0 0 2.497 0.126 1.766 4.321 c -0.008 0.043 -0.015 0.086 -0.024 0.13 c -0.806 4.323 -2.516 8.42 -3.193 10.581 h 3.904 c 0 0 0.983 4.581 -2.549 4.968 H 13.292 c 0 0 -3.097 -1.42 -1.517 -5.323 l 3 -10.839 H 11.84 c 0 0 -1.129 -2.902 1.709 -3.806 l 11.425 -0.032 l -0.73 0.355 l -1.193 1.726 L 22.453 15.04 Z M 22.409 12.597 c 0 0 -0.242 0.483 -0.278 0.98 h -9.098 c 0 0 -0.06 -0.871 0.714 -1.041 L 22.409 12.597 Z M 26.341 27.734 c 0 0 -0.13 2.678 -2.226 1.871 c 0 0 -0.823 -0.565 -0.758 -1.855 L 26.341 27.734 Z M 22.905 15.008 c 0 0 0.653 -0.258 0.709 -1.501 c 0 0 0.145 -1.144 1.483 -0.693 c 0 0 0.808 0.355 0.259 2.404 c 0 0 -2.226 8.5 -3.032 10.339 c 0 0 -1.064 2.646 0.096 4.226 h -8.581 c 0 0 -1.806 -0.452 -0.741 -3.613 c 0 0 2.935 -9.549 3.193 -11.162 L 22.905 15.008 Z"}i.task.call&&(u[0].borderWidth=4);i.task.compensation&&i.task.loop!="none"?(u[1].offsetX=i.offsetX-u[1].width/2-2,u[1].visible=!0,u[3].visible=!0,u[3].offsetX=i.offsetX+u[1].width/2+2,u[4].visible=!1):i.task.loop!="none"?(u[1].offsetX=i.offsetX,u[1].visible=!0):i.task.compensation&&(u[3].offsetX=i.offsetX,u[3].visible=!0)}else if(i.activity==t.datavisualization.Diagram.BPMNActivity.SubProcess){u[2].visible=!1;switch(i.subProcess.boundary){case"default":u[0].borderWidth=1;u[0].borderDashArray="0 0";break;case"call":u[0].borderWidth=4;u[0].borderDashArray="0 0";break;case"event":u[0].borderWidth=1;u[0].borderDashArray="2 2"}u[4].pathData=i.subProcess.adhoc?"M 47.04 81.045 h -13 v -12 h 13 V 81.045 Z M 35.04 80.045 h 11 v -10 h -11 V 80.045 Z M 37.524 74.67 L 43.555 74.67 L43.555 75.02 L37.524 75.02 Z M 40.165 72.029 L 40.915 72.029 L40.915 78.060 L40.165 78.060 Z     M 49.832 76.811 v -2.906 c 0 0 0.466 -1.469 1.931 -1.5 c 1.465 -0.031 2.331 1.219 2.897 1.688 s 1.06 0.75 1.526 0.75 c 0.466 0 1.548 -0.521 1.682 -1.208 s 0.083 3.083 0.083 3.083 s -0.76 0.969 -1.859 0.969 c -1.066 0 -1.865 -0.625 -2.464 -1.438 s -1.359 -0.998 -2.064 -0.906 C 50.598 75.467 49.832 76.811 49.832 76.811 Z":"M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z";i.subProcess.compensation&&i.subProcess.loop!="none"?(u[1].visible=!0,u[3].visible=!0,u[4].visible=!0,u[1].offsetX=i.offsetX-u[3].width/2-u[1].width/2-2,u[3].offsetX=i.offsetX,u[4].offsetX=i.offsetX+u[3].width/2+u[4].width/2+2):i.subProcess.loop!="none"?(u[3].visible=!1,u[1].visible=!0,u[4].visible=!0,u[1].offsetX=i.offsetX-u[1].width/2-2,u[4].offsetX=i.offsetX+u[4].width/2+2):i.subProcess.compensation?(u[1].visible=!1,u[3].visible=!0,u[4].visible=!0,u[3].offsetX=i.offsetX-u[3].width/2-2,u[4].offsetX=i.offsetX+u[4].width/2+2):(u[3].visible==!0&&(u[3].visible=!1),u[4].offsetX=i.offsetX,u[4].visible=!0)}return i},_getBPMNAssociationShape:function(i){var r={segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{},sourceDecorator:{}};i=n.extend(!0,{},t.datavisualization.Diagram.BPMNFlowDefaults,i);i.constraints=t.datavisualization.Diagram.ConnectorConstraints.Default;i._type="connector";switch(i.direction){case"none":r.targetDecorator.shape="none";r.sourceDecorator.shape="none";break;case"unidirectional":r.targetDecorator.shape="arrow";r.sourceDecorator.shape="none";break;case"bidirectional":r.targetDecorator.shape="arrow";r.sourceDecorator.shape="arrow"}return n.extend(!0,{},r,i)}}}(jQuery,Syncfusion),function(n,t){"use strict";var i=function(){function n(n){return this.xmlns="http://www.w3.org/2000/svg",this.document=document.createElementNS(this.xmlns,"svg"),this.id=n.id,n&&t.datavisualization.Diagram.Util.attr(this.document,n),this}return n.prototype.element=function(n,i){var r;return n&&n.id&&(r=this.document.getElementById(n.id)),r||(r=document.createElementNS(this.xmlns,i)),n&&t.datavisualization.Diagram.Util.attr(r,n),r},n.prototype.g=function(n){return this.element(n,"g")},n.prototype.defs=function(n){return this.element(n,"defs")},n.prototype.image=function(n){return this.element(n,"image")},n.prototype.path=function(n){return this.element(n,"path")},n.prototype.text=function(n){return this.element(n,"text")},n.prototype.textPath=function(n){return this.element(n,"textPath")},n.prototype.tspan=function(n){return this.element(n,"tspan")},n.prototype.rect=function(n){return this.element(n,"rect")},n.prototype.ellipse=function(n){return this.element(n,"ellipse")},n.prototype.circle=function(n){return this.element(n,"circle")},n.prototype.line=function(n){return this.element(n,"line")},n.prototype.polyline=function(n){return this.element(n,"polyline")},n.prototype.polygon=function(n){return this.element(n,"polygon")},n.prototype.foreignObject=function(n){return this.element(n,"foreignObject")},n.prototype.linearGradient=function(n){return this.element(n,"linearGradient")},n.prototype.radialGradient=function(n){return this.element(n,"radialGradient")},n.prototype.stop=function(n){return this.element(n,"stop")},n.prototype.pattern=function(n){return this.element(n,"pattern")},n.prototype.appendChild=function(n){this.document.appendChild(n)},n.prototype.removeChild=function(n,t){t?t.removeChild(n):this.document.removeChild(n)},n.prototype.getElementById=function(n){return this.document.getElementById(n)},n.prototype.getElementsByClassName=function(n){return this.document.getElementsByClassName(n)},n.prototype.getElementsByTagName=function(n){return this.document.getElementsByTagName(n)},n.prototype.pathBounds=function(n){var f={d:n},r=this.path(f),i=new t.datavisualization.Diagram.Svg({id:"TempSvg"}),u;return document.body.appendChild(i.document),i.document.appendChild(r),u=r.getBBox(),document.body.removeChild(i.document),u},n.prototype.textBounds=function(n,t,i){var u=null,r;return n&&t?(r=this.text(t),r.appendChild(document.createTextNode(n)),this.document.appendChild(r),u=r.getBBox(),this.document.removeChild(r)):i&&(this.document.appendChild(i),u=i.getBBox(),this.document.removeChild(i)),u},n.prototype.absolutePath=function(n){for(var t,e,l,a,o,s,h,c,f=n.pathSegList,i=0,r=0,u=0,v=f.numberOfItems;u<v;++u){if(t=f.getItem(u),e=t.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(e))"x"in t&&(i=t.x),"y"in t&&(r=t.y);else{"x1"in t&&(o=i+t.x1);"x2"in t&&(h=i+t.x2);"y1"in t&&(s=r+t.y1);"y2"in t&&(c=r+t.y2);"x"in t&&(i+=t.x);"y"in t&&(r+=t.y);switch(e){case"m":f.replaceItem(n.createSVGPathSegMovetoAbs(i,r),u);break;case"l":f.replaceItem(n.createSVGPathSegLinetoAbs(i,r),u);break;case"h":f.replaceItem(n.createSVGPathSegLinetoHorizontalAbs(i),u);break;case"v":f.replaceItem(n.createSVGPathSegLinetoVerticalAbs(r),u);break;case"c":f.replaceItem(n.createSVGPathSegCurvetoCubicAbs(i,r,o,s,h,c),u);break;case"s":f.replaceItem(n.createSVGPathSegCurvetoCubicSmoothAbs(i,r,h,c),u);break;case"q":f.replaceItem(n.createSVGPathSegCurvetoQuadraticAbs(i,r,o,s),u);break;case"t":f.replaceItem(n.createSVGPathSegCurvetoQuadraticSmoothAbs(i,r),u);break;case"a":f.replaceItem(n.createSVGPathSegArcAbs(i,r,t.r1,t.r2,t.angle,t.largeArcFlag,t.sweepFlag),u);break;case"z":case"Z":i=l;r=a}}(e==="M"||e==="m")&&(l=i,a=r)}return n},n}();t.datavisualization.Diagram.Svg=i;t.datavisualization.Diagram.SvgContext={_renderDocument:function(n,i,r){var f,u;window.SVGSVGElement&&(f={id:n.canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute"},u=r?i._svg:new t.datavisualization.Diagram.Svg(f),n.svg=u,i&&(i._svg=u,r||n.canvas.appendChild(u.document),i._view=this._renderView(n.canvas,n.svg,r),i._page=this._renderPage(n.canvas,n.svg,i._view,r),i._htmlLayer=this._renderHtmlLayer(n.canvas,r),this._renderBackground(n.canvas,n.svg,i._page,i.model,r),i._pageBackgroundLayer=this._renderBackgroundLayer(n.canvas,n.svg,i._page,r),this._renderGrid(n.canvas,n.svg,i._page,i),i._diagramLayer=n.diagramLayer=this._renderDiagramLayer(n.canvas,n.svg,i._page),i._adornerLayer=this._renderAdornerLayer(n.canvas,n.svg,i._page)))},_renderView:function(n,t,i){var u={id:n.id+"_view"},r=t.g(u);return i||t.appendChild(r),r},_renderHtmlLayer:function(n,i){var r=document.createElement("div"),f={id:n.id+"_htmlLayer","class":"htmlLayer"},u;return t.datavisualization.Diagram.Util.attr(r,f),u=r,r.style.pointerEvents="none",i||n.appendChild(u),u},_renderPage:function(n,t,i,r){var f={id:n.id+"_page","class":"page"},u=t.g(f);return r||i.appendChild(u),u},_renderDiagramLayer:function(n,t,i){var u={id:n.id+"_diagramLayer","class":"DiagramLayer"},r=t.g(u);return i.appendChild(r),r},_renderAdornerLayer:function(n,t,i){var u={id:n.id+"_adornerLayer","class":"AdornerLayer"},r=t.g(u);return i.appendChild(r),r},_renderBackgroundLayer:function(n,t,i,r){var f={id:n.id+"_pageBackground","class":"PageBackgroundLayer",style:"pointer-events:none;"},u=t.g(f);return r||i.appendChild(u),u},_renderBackground:function(n,t,i,r){var e,u,f,o;t.document.style.msTouchAction="none";t.document.style.display="block";t.document.style.backgroundColor="white";e={id:n.id+"_backgroundLayer"};u=t.g(e);e={id:n.id+"_background",x:"0",y:"0",width:"100%",height:"100%",preserveAspectRatio:"none","pointer-events":"none"};f=t.image(e);r.backgroundImage?(f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r.backgroundImage),t.getElementById(n.id+"_background")||u.appendChild(f)):t.getElementById(f.id)&&u.removeChild(t.getElementById(f.id));o=t.rect({id:n.id+"_backgroundColor",x:"0",y:"0",width:"100%",height:"100%",fill:r.backgroundColor,preserveAspectRatio:"none","pointer-events":"none"});r.backgroundColor?t.getElementById(n.id+"_backgroundColor")||u.appendChild(o):t.getElementById(o.id)&&u.removeChild(t.getElementById(o.id));t.getElementById(u.id)||i.appendChild(u)},_renderGrid:function(n,i,r,u){var s=u._svg.document.getElementById(n.id+"patterndefinition"),e,c,l,a,f,o,v,h;if(s||(s=i.defs({id:n.id+"patterndefinition"}),i.appendChild(s)),u.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines||u.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines){var h=document.getElementById(n.id+"_grid"),v=document.getElementById(n.id+"pattern_gridline"),o=document.getElementById(n.id+"pattern_grid");o&&s.removeChild(o);c={id:n.id+"_grid","pointer-events":"none"};e=i.g(c);l=0;u.model.snapSettings.horizontalGridLines.linesInterval&&u.model.snapSettings.horizontalGridLines.linesInterval.forEach(function(n){l+=n});a=0;u.model.snapSettings.verticalGridLines.linesInterval&&u.model.snapSettings.verticalGridLines.linesInterval.forEach(function(n){a+=n});f=u._currZoom;c={id:n.id+"pattern_grid",x:0,y:0,width:a*f,height:l*f,patternUnits:"userSpaceOnUse"};o=i.pattern(c);f=this._scaleSnapInterval(u.model,f);this._renderHorizontalGridlines(f,o,a,u.model,i);this._renderVerticalGridlines(f,o,l,u.model,i);s.appendChild(o);v=i.rect({id:n.id+"pattern_gridline",x:u._hScrollOffset,y:u._vScrollOffset,width:"100%",height:"100%",fill:"url(#"+n.id+"pattern_grid)"});e.appendChild(v);h||r.appendChild(e)}else e=document.getElementById(n.id+"_grid"),e&&(h=document.getElementById(n.id+"pattern_gridline"),h&&e.removeChild(h))},_updateBackground:function(n,i,r,u){var o={x:n,y:i},e=document.getElementById(u._id+"_canvas_backgroundColor"),f;e&&t.datavisualization.Diagram.Util.attr(e,o);f=document.getElementById(u._id+"_canvas_background");f&&t.datavisualization.Diagram.Util.attr(f,{transform:"scale("+r+")"})},_updateGrid:function(n,i,r,u){var l=document.getElementById(u._canvas.id+"pattern_gridline"),f,e,o,s,a,c,h;if(l){if(e=document.getElementById(u._canvas.id+"pattern_grid"),o=0,u.model.snapSettings.horizontalGridLines.linesInterval)for(f=0;f<u.model.snapSettings.horizontalGridLines.linesInterval.length;f++)o+=u.model.snapSettings.horizontalGridLines.linesInterval[f];if(s=0,u.model.snapSettings.verticalGridLines.linesInterval)for(f=0;f<u.model.snapSettings.verticalGridLines.linesInterval.length;f++)s+=u.model.snapSettings.verticalGridLines.linesInterval[f];h={x:n,y:i};t.datavisualization.Diagram.Util.attr(l,h);r=this._scaleSnapInterval(u.model,r);a=u._svg;c=a.defs({id:u._canvas.id+"patterndefinition"});e&&c.removeChild(e);h={id:u._canvas.id+"pattern_grid",x:0,y:0,width:s*r,height:o*r,patternUnits:"userSpaceOnUse"};e=u._svg.pattern(h);this._renderHorizontalGridlines(r,e,s,u.model,u._svg);this._renderVerticalGridlines(r,e,o,u.model,u._svg);c.appendChild(e)}},_scaleSnapInterval:function(n,t){if(t>=2)while(t>=2)t/=2;else if(t<=.5)while(t<=.5)t*=2;var i;if(t!==1){for(n.snapSettings.horizontalGridLines._snapinterval=[],i=0;i<n.snapSettings.horizontalGridLines.snapInterval.length;i++)n.snapSettings.horizontalGridLines._snapinterval[i]=n.snapSettings.horizontalGridLines.snapInterval[i]*t;for(n.snapSettings.verticalGridLines._snapinterval=[],i=0;i<n.snapSettings.verticalGridLines.snapInterval.length;i++)n.snapSettings.verticalGridLines._snapinterval[i]=n.snapSettings.verticalGridLines.snapInterval[i]*t}return t},_renderHorizontalGridlines:function(n,i,r,u,f){var o=u.snapSettings,s,c,e,h,l;if(o.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines)for(s=0,c=0,e=0;e<o.horizontalGridLines.linesInterval.length;e=e+2)h=o.horizontalGridLines.linesInterval[e],l=f.line({x1:0,y1:s*n,x2:r*n,y2:s*n,stroke:o.horizontalGridLines.lineColor,"stroke-width":h}),s+=o.horizontalGridLines.linesInterval[e+1]+h,i.appendChild(l),c++},_renderVerticalGridlines:function(n,i,r,u,f){var o=u.snapSettings,s,c,e,h,l;if(o.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines)for(s=0,c=0,e=0;e<o.verticalGridLines.linesInterval.length;e=e+2)h=u.snapSettings.verticalGridLines.linesInterval[e],l=f.line({x1:s*n,y1:0,x2:s*n,y2:r*n,stroke:o.verticalGridLines.lineColor,"stroke-width":h,"stroke-dasharray":o.verticalGridLines.lineDashArray}),s+=o.verticalGridLines.linesInterval[e+1]+h,i.appendChild(l),c++},transformView:function(n,i,r){var u=n._view,f={transform:"translate("+i+","+r+")"};t.datavisualization.Diagram.Util.attr(u,f);n._htmlLayer&&n._htmlLayer.children.length>0&&(n._htmlLayer.style.left=i+"px",n._htmlLayer.style.top=r+"px",n._htmlLayer.style.position="absolute")},scaleContent:function(n,i){var u=n._diagramLayer,r;t.datavisualization.Diagram.Util.attr(u,{transform:"scale("+i+")"});n._htmlLayer&&n._htmlLayer.children.length>0&&(n._htmlLayer.style.webkitTransform="scale("+i+")",n._htmlLayer.style.MozTransform="scale("+i+")",n._htmlLayer.style.OTransform="scale("+i+")",n._htmlLayer.style.msTransform="scale("+i+")",n._htmlLayer.style.transform="scale("+i+")");n.selectionList.length>0&&this.updateSelector(n.selectionList[0],n._svg,i,n,n.model.selectedItems.constraints);n.selectionList[0]&&n.model.selectedItems.userHandles&&n.model.selectedItems.userHandles.length>0&&(r=!1,n.selectionList[0].type=="pseudoGroup"&&(r=!0),n.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&t.datavisualization.Diagram.SvgContext.updateUserHandles(n.model.selectedItems.userHandles,n.selectionList[0],n._svg,r,!1,i))},setSize:function(n,i,r){t.datavisualization.Diagram.Util.attr(n.document,{width:i+"px",height:r+"px"})},_findIndex:function(t,i){var r,f=1,e,u;return u=i.parent?n("#"+i.parent.name).find(">.node,>.connector,>.group"):n("#DiagramContent_canvas_svg").find(">.node,>.connector,>.group"),i.name!="helper"&&(r=u[u.length-1],r&&r.id=="helper"&&(r=u[u.length-2]),r&&(e=0,r.className.animVal=="ej-d-node"||r.className.animVal=="ej-d-group"?f=e+1:r.className.animVal=="ej-d-connector"&&(f=e+1))),f},renderNode:function(n,i,r){var u,f=n.width?n.width:n._width||0,e=n.height?n.height:n._height||0,o=n.name,s=n.visible?"visible":"hidden",h=n.offsetX-f*n.pivot.x,c=n.offsetY-e*n.pivot.y;return u=i.g({id:o,"class":"ej-d-node",transform:"rotate("+n.rotateAngle+","+n.offsetX+","+n.offsetY+"),translate("+h+","+c+")",visibility:s}),r?r.appendChild(u):i.appendChild(u),n._isDisabled&&t.datavisualization.Diagram.Util.attr(u,{style:"pointer-events:none;"}),this._renderNode(n,i,u),u},_renderNode:function(n,t,i){this._renderShape(n,t,i);this._renderLabels(n,t);this._renderPorts(n,t,i)},_renderShadow:function(n,i){var f,u,r;if(!n.segments&&(f=i.document.getElementById(n.name),n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow)){u=n.fillColor;n.type!="text"&&n.type!="image"?r=i.document.getElementById(n.name+"_shape"):n.type==="image"&&(r=i.document.getElementById(n.name+"_backRect"));var e=r.cloneNode(!0),o=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),s={id:n.name+"_shadow",transform:"translate("+o.x+","+o.y+")",stroke:"lightgrey",fill:u!="none"||u!="transparent"?"lightgrey":"none",opacity:n.shadow.opacity};f.insertBefore(e,r);t.datavisualization.Diagram.Util.attr(e,s)}},_updateShadow:function(n,i){var f=i.document.getElementById(n.name),r=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),u={id:n.name+"_shadow",transform:"translate("+r.x+","+r.y+")",opacity:n.shadow.opacity};i.g(u)},_removeShadow:function(n,t){if(n.type!="text"){var r=t.document.getElementById(n.name),i=t.document.getElementById(n.name+"_shadow");i&&r.removeChild(i)}},renderphase:function(n,i,r,u){var e,p,c,a,v;e=i.g({id:n.name,"class":"ej-d-seperator"});n.parent?r.appendChild(e):i.appendChild(e);var w="visible",s=0,h=0,y=u.nameTable[n.parent];if(y){p=u._getChildren(y.children);p.length>1&&(c=u.nameTable[p[0]]);var f=t.datavisualization.Diagram.Util.bounds(y),o=[],l,b=f.top+50,k=f.left+50;n.orientation=="vertical"?(o.push({x:0,y:0}),o.push({x:f.width,y:0}),l=this._convertToSVGPoints(o),s=f.x,h=f.y+n.offset,c&&(b+=c.height),h<f.bottom&&h>b||(w="hidden")):(o.push({x:0,y:c.height?c.height:0}),o.push({x:0,y:f.height}),l=this._convertToSVGPoints(o),s=f.x+n.offset,h=f.y,s<f.right&&s>k||(w="hidden"));a={id:n.name+"_phase",stroke:n.lineColor,"stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,points:l};v=i.polyline(a);e.appendChild(v);a={id:n.name+"_phase_hitTest","class":"hitTest","stroke-width":10,points:l,stroke:"transparent"};v=i.polyline(a);e.appendChild(v);e.setAttribute("transform","translate("+s+","+h+")")}},_renderGroupBackground:function(n,i,r){if(n.fillColor!="none"){var u=n.offsetX-n.width/2,f=n.offsetY-n.height/2,e=n.fillColor,o=n.borderColor;n.type=="bpmn"&&(e="transparent",o="transparent");var h=n.rotateAngle,s=new t.datavisualization.Diagram.Point(u+n.width/2,f+n.height/2),c={id:n.name+"_shape",rx:n.cornerRadius,ry:n.cornerRadius,width:Math.round(n.width<0?0:n.width),height:Math.round(n.height<0?0:n.height),fill:e,stroke:o,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,transform:"rotate("+h+","+s.x+","+s.y+"),translate("+u+","+f+")"};i.appendChild(r.rect(c))}},renderGroup:function(n,i,r,u,f,e,o){var s,v=n.visible?"visible":"hidden",c,l,a,h;if(s=i.g({id:n.name,"class":"ej-d-group",visibility:v}),r?r.appendChild(s):i.appendChild(s),n.parent==""&&n.container&&((e||o)&&(n.height=0,n.width=0),this._alignOnContainer(n,f)),this._renderGroupBackground(n,s,i),c=f._getChildren(n.children),c&&c.length>0)for(l=0,a=c.length;l<a;l++)h=u[c[l]],h&&(h._type==="group"?(this.renderGroup(h,i,s,u,f,e,o),t.datavisualization.Diagram.Util._updateGroupBounds(h,f),t.datavisualization.Diagram.DiagramContext.update(h,f)):h.segments?this.renderConnector(h,i,s,f):this.renderNode(h,i,s));return this._renderLabels(n,i),this._renderPorts(n,i,s),n.container&&n.phases&&n.phases.length>0&&(f._needUpdate===undefined?f._needUpdate=!0:"",f._updatePhase(n)),s},_alignOnContainer:function(n,t,i){switch(n.container&&n.container.type){case"canvas":var r=n.rotateAngle;n.rotateAngle==0&&r==0||(n.parent==""?n.rotateAngle=0:t._rotate(n,-r,t.nameTable));this._alignOnCanvasContainer1(n,t,i);n.rotateAngle==0&&r==0||t._rotate(n,r,t.nameTable);break;case"stack":this._alignOnStackContainer(n,t)}},_removeFromContainer:function(t,i){var f=i.getElementById(t.name),u=i.document.parentNode.getElementsByClassName("htmlLayer")[0],r,o,e;if(f&&f.parentNode.removeChild(f),t._type=="group")for(r=0;r<t.children.length;r++)o=typeof t.children[r]=="object"?t.children[r].name:t.children[r],e=n(u).find("#"+o)[0],e&&u.removeChild(e);else u.removeChild(n(u).find("#"+t.name)[0])},_childrenBounds:function(n,i){var f=i._getChildren(n.children),r=new t.datavisualization.Diagram.Rectangle,u,o,e;for(r=t.datavisualization.Diagram.Util.bounds(i.nameTable[f[0]]),u=1,o=f.length;u<o;u++)e=t.datavisualization.Diagram.Util.bounds(i.nameTable[f[u]],i),e&&(r=i._union(r,e));return r},_alignOnCanvasContainer1:function(n,t,i){var r=this._measureCanvasSize1(n,t),u=t._getMinMaxSize(n,r.width,r.height,i);n.width=u.width;n.height=u.height;this._alignOnCanvas1(n,t)},_alignOnCanvas1:function(n,i,r){for(var e,u=null,o=i._getChildren(n.children),f=0;f<o.length;f++)u=i.nameTable[o[f]],u&&(e=this._getCanvasPosition1(n,u,i,r),i._translate(u,e.x,e.y,i.nameTable),t.datavisualization.Diagram.SpatialUtil._updateQuad(i,i._spatialSearch,u))},_getCanvasPosition1:function(n,i,r,u){var c=null,s=null,e=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Util.bounds(i),v,g,h,p,nt,w,k;switch(i.horizontalAlign){case"left":c=e.x-o.x+i.marginLeft+n.paddingLeft;r.isPhaseResize&&(c=0);break;case"center":c=e.x+e.width/2-(o.x+o.width/2);i.marginLeft&&(s=e.x-o.x+i.marginLeft+n.paddingLeft);break;case"right":c=e.x+e.width-(o.x+o.width+n.paddingRight);break;case"stretch":if(h=i.rotateAngle,i.rotateAngle==0||h!=0||r._rotate(i,-i.rotateAngle,r.nameTable),v=(n.width-n.paddingLeft-n.paddingRight-i.marginLeft-i.marginRight)/i.width,r.scale(i,v,0,n.pivot,r.nameTable),e=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Util.bounds(i,r),c=e.x+n.paddingLeft-o.x+i.marginLeft,i.rotateAngle==0||h!=0||r._rotate(i,h,r.nameTable),i.container&&i.container.type=="stack"){var a=t.datavisualization.Diagram.Util._getChildrenBounds(i,r),d=r.nameTable[i.name].width,y=d-a.width-n.paddingLeft-n.paddingRight,l=r._getChildren(i.children),f=r.nameTable[l[l.length-1]];f&&(g=f.width,f.width+=y,f.offsetX+=y/2,f.minWidth=f.width,this._updateCanvasChildren(f,r),u&&f.container&&f.container.type=="canvas"&&this._alignOnCanvas1(f,r))}}switch(i.verticalAlign){case"top":s=e.y-o.y+i.marginTop+n.paddingTop;r.isPhaseResize&&(s=0);break;case"center":s=e.y+e.height/2-(o.y+o.height/2)+i.marginTop;i.marginTop&&(s=e.y-o.y+i.marginTop+n.paddingTop);break;case"bottom":s=e.y+e.height-(o.y+o.height+n.paddingBottom);break;case"stretch":if(h=i.rotateAngle,nt=t.datavisualization.Diagram.Util.bounds(i),i.rotateAngle==0||h!=0||r._rotate(i,-i.rotateAngle,r.nameTable),p=i.height==0?1:i.height,w=(n.height-n.paddingTop-n.paddingBottom-i.marginTop-i.marginBottom)/p,r.scale(i,0,w,n.pivot,r.nameTable),e=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Util.bounds(i,r),s=e.y+n.paddingTop-o.y+i.marginTop,i.rotateAngle==0||h!=0||r._rotate(i,h,r.nameTable),i.container&&i.container.type=="stack"){a=t.datavisualization.Diagram.Util._getChildrenBounds(i,r);var tt=r.nameTable[i.name].height,b=tt-a.height-n.paddingTop-n.paddingBottom,l=r._getChildren(i.children);f=r.nameTable[l[l.length-1]];f&&(k=f.height,f.height+=b,f.offsetY+=b/2,f.minHeight=f.height,k!=f.height&&this._updateCanvasChildren(f,r),u&&f.container&&f.container.type=="canvas"&&this._alignOnCanvas1(f,r))}}return{x:c,y:s}},_updateCanvasChildren:function(n,t){var r=t._getChildren(n.children),i,u,f,e;if(r&&r.length>0)for(u=0;u<r.length;u++)i=t.nameTable[r[u]],i&&(i.horizontalAlign=="stretch"?(f=n.width-i.width,i.width+=f,i.offsetX+=f/2):i.verticalAlign=="stretch"&&(e=n.height-i.height,i.height+=e,i.offsetY+=e/2))},_measureCanvasSize1:function(n,i){for(var f,r=null,u=t.datavisualization.Diagram.Rectangle(0,0,0,0),e=t.datavisualization.Diagram.Rectangle(0,0,0,0),s=i._getChildren(n.children),o=0;o<s.length;o++)r=i.nameTable[s[o]],r&&(r._type!="group"?(f=t.datavisualization.Diagram.Util.bounds(r),u=!f.left<0?t.datavisualization.Diagram.Geometry.rect([f.topLeft,f.topRight,f.bottomRight,f.bottomLeft]):f,u.y=0,u.x=0):(this._alignOnContainer(r,i),f=t.datavisualization.Diagram.Util.bounds(r),u=t.datavisualization.Diagram.Geometry.rect([f.topLeft,f.topRight,f.bottomRight,f.bottomLeft]),u.y=0,u.x=0,r.rotateAngle==0&&(u.width=f.width,u.height=f.height))),r&&(r.container&&r.container.type=="stack"?(u.width+=r.marginLeft,u.height+=r.marginTop):(u.width+=r.marginLeft+r.marginRight,u.height+=r.marginTop+r.marginBottom)),u&&(e=i._union(u,e));return e.width+=n.paddingLeft+n.paddingRight,e.height+=n.paddingTop+n.paddingBottom,e},_updateMargin:function(n,i){if(i&&i.container&&i.container.type=="canvas"){var u=t.datavisualization.Diagram.Util.bounds(i),r=t.datavisualization.Diagram.Util.bounds(n);n.marginLeft=r.x-(u.x+i.paddingLeft);n.marginRight=u.x+i.width-(r.x+r.width)-i.paddingRight;n.marginTop=r.y-(u.y+i.paddingTop);n.marginBottom=u.y+i.height-(r.y+r.height)-i.paddingBottom}},_alignOnStackContainer:function(n,t){var u=n.rotateAngle,i,r;n.parent==""?n.rotateAngle=0:t._rotate(n,-u,t.nameTable);i=this._measureStackSize(n,t);r=t._getMinMaxSize(n,i.width,i.height);n.width=r.width;n.height=r.height;this._alignOnStack(n,t);t._rotate(n,u,t.nameTable)},_alignOnStack:function(n,i){for(var u,e,r=null,o=0,s=0,h=i._getChildren(n.children),f=0;f<h.length;f++)r=i.nameTable[h[f]],r&&(u=r.rotateAngle,r.rotateAngle==0&&u==0||i._rotate(r,-r.rotateAngle,i.nameTable),e=this._getStackPosition(n,r,o,s,i),i._translate(r,e.x,e.y,i.nameTable),n.container.orientation=="vertical"?s+=(r.height?r.height:r._height)+r.marginTop+r.marginBottom:o+=(r.width?r.width:r._width)+r.marginLeft+r.marginRight,r.rotateAngle==0&&u==0||i._rotate(r,u,i.nameTable),t.datavisualization.Diagram.SpatialUtil._updateQuad(i,i._spatialSearch,r))},_getStackPosition:function(n,i,r,u,f){var e=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Util.bounds(i),s=null,h=null,a=i.width?i.width:i._width,v=i.height?i.height:i._height,c,l;if(n.container.orientation=="vertical"){h=e.y-o.y+u+i.marginTop+n.paddingTop;switch(i.horizontalAlign){case"left":s=e.x-o.x+i.marginLeft+n.paddingLeft;break;case"center":s=e.center.x-o.center.x;break;case"right":s=e.x+e.width-(o.x+o.width+n.paddingRight);break;case"stretch":c=(n.width-n.paddingLeft-n.paddingRight)/a;f.scale(i,c,1,n.pivot,f.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);o=t.datavisualization.Diagram.Util.bounds(i,f);s=e.x+n.paddingLeft-o.x}}else{s=e.x-o.x+r+i.marginLeft+n.paddingLeft;switch(i.verticalAlign){case"top":h=e.y-o.y+i.marginTop+n.paddingTop;break;case"center":h=e.center.y-o.center.y;break;case"bottom":h=e.y+e.height-(o.y+o.height+n.paddingBottom);break;case"stretch":l=(n.height-n.paddingTop-n.paddingBottom)/v;f.scale(i,1,l,n.pivot,f.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);o=t.datavisualization.Diagram.Util.bounds(i,f);h=e.y+n.paddingTop-o.y}}return{x:s,y:h}},_measureStackSize:function(n,i,r){for(var f=null,u=new t.datavisualization.Diagram.Rectangle,s=0,h=0,e=t.datavisualization.Diagram.Rectangle(0,0,0,0),c=i._getChildren(n.children),o=0;o<c.length;o++)f=i.nameTable[c[o]],f&&(f._type!="group"?(u=t.datavisualization.Diagram.Util.bounds(f),u.y=0,u.x=0):(u=this._measureContainerSize(f,i,r),u.y=0,u.x=0),u.width+=s+f.marginLeft+f.marginRight,u.height+=h+f.marginTop+f.marginBottom),u&&(e=i._union(u,e)),n.container.orientation=="horizontal"?s=u.width:h=u.height;return e.width+=n.paddingLeft+n.paddingRight,e.height+=n.paddingTop+n.paddingBottom,e},_measureContainerSize:function(n,i,r){if(n._type==="group"&&n.container)switch(n.container.type){case"canvas":return this._alignOnContainer(n,i,r),t.datavisualization.Diagram.Util.bounds(n);case"stack":return this._measureStackSize(n,i)}},_renderGradient:function(n,t,i){var u,r;return t.type==="linear"?(r=this._renderLinearGradient(n,t,i),u="url(#"+r+")"):t.type==="radial"&&(r=this._renderRadialGradient(n,t,i),u="url(#"+r+")"),u},_renderLinearGradient:function(n,t,i){var u=i.getElementsByTagName("defs")[0],f,r;return u?(f={id:n+"_gradient",x1:t.x1+"%",y1:t.y1+"%",x2:t.x2+"%",y2:t.y2+"%"},r=i.linearGradient(f),this._renderStops(t,i,r),u.appendChild(r),r.id):null},_renderRadialGradient:function(n,t,i){var u=i.getElementsByTagName("defs")[0],f,r;return u?(f={id:n+"_gradient",cx:t.cx+"%",cy:t.cy+"%",fx:t.fx+"%",fy:t.fy+"%",r:t.r+"%"},r=i.radialGradient(f),this._renderStops(t,i,r),u.appendChild(r),r.id):null},_renderStops:function(n,t,i){var f,r,u,e;if(t.getElementById(i.getAttribute("id"))===i)while(i.firstChild)i.removeChild(i.firstChild);for(f=n.stops,u=0,e=f.length;u<e;u++)r=f[u],i.appendChild(t.stop({offset:r.offset+"%","stop-color":r.color,"stop-opacity":r.opacity}))},_renderShape:function(n,t,i){var r=n._shape?n._shape:n.type;switch(r){case"rectangle":this._renderRect(n,t,i);break;case"ellipse":this._renderEllipse(n,t,i);break;case"image":this._renderImage(n,t,i);break;case"path":this._renderPath(n,t,i);break;case"polygon":this._renderPolygon(n,t,i);break;case"text":this._renderTextElement(n,t,i);break;case"html":this._renderHtmlElement(n,t,i);break;case"native":this._rendercontent(n,t,i)}},_renderHTMLTemplate:function(t){if(t.templateId&&n.templates){var i;return i=n.templates("#"+t.templateId),i.render(t)}},_renderSvgTemplate:function(n,t,i,r){var f=document.createElement("div"),u;f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+r+"<\/g><\/svg>";document.body.appendChild(f);u=document.getElementById("tempNative").cloneNode(!0);u.id=n.name+"_shape";i.appendChild(u);var e=u.getBBox(),o=n.width?n.width:n._width,s=n.height?n.height:n._height,h=e.width?o/e.width:1,c=e.height?s/e.height:1;u.setAttribute("transform","scale("+h+","+c+")");u.setAttribute("id",n.name+"_shape");f.parentNode.removeChild(f)},_rendercontent:function(i,r,u){var o,s,h,c;if(i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){var f=i.fillColor,e=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},i.shadow.angle,i.shadow.distance),l={id:i.name+"_shadow",width:i.width,height:i.height,stroke:i.borderColor!="none"||i.borderColor!="transparent"?"lightgrey":"none",fill:f!="none"||f!="transparent"?"lightgrey":"none",transform:"translate("+e.x+","+e.y+")",opacity:i.shadow.opacity};u.appendChild(r.rect(l))}!i.segments&&i.templateId&&n.templates&&(o=n.templates("#"+i.templateId),s=i.width,h=i.height,i._type!=="node"||i.height||i.width||(i.width=i._width,i.height=i._height),c=o.render(i),i.width=s,i.height=h,this._renderSvgTemplate(i,r,u,c))},_fill:function(n,t){var i;return n.gradient&&(i=this._renderGradient(n.name,n.gradient,t)),i||(i=n.fillColor),i},_renderRect:function(n,i,r){var u=this._fill(n,i),o=n.width?n.width:n._width,s=n.height?n.height:n._height,h={id:n.name+"_shape",rx:n.cornerRadius,ry:n.cornerRadius,width:o,height:s,fill:u,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray},f,e;n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),e={id:n.name+"_shadow",rx:n.cornerRadius,ry:n.cornerRadius,width:n.width,height:n.height,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+f.x+","+f.y+")",opacity:n.shadow.opacity},r.appendChild(i.rect(e)));r.appendChild(i.rect(h))},_renderEllipse:function(n,i,r){var e=n.width?n.width:n._width,o=n.height?n.height:n._height,u=this._fill(n,i),h={id:n.name+"_shape",rx:e/2,ry:o/2,cx:e/2,cy:o/2,fill:u,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray},f,s;n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),s={id:n.name+"_shadow",rx:n.width/2,ry:n.height/2,cx:n.width/2,cy:n.height/2,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+f.x+","+f.y+")",opacity:n.shadow.opacity},r.appendChild(i.ellipse(s)));r.appendChild(i.ellipse(h))},_renderImage:function(n,t,i){var o=n.fillColor,s=this._renderBackgroundRect(n,t,i),u=n.width?n.width:n._width,f=n.height?n.height:n._height,e={id:n.name+"_shape",width:u,height:f,opacity:n.opacity,preserveAspectRatio:"none"},r=t.image(e);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n.source);i.appendChild(r)},_renderPolygon:function(n,i,r){var u=this._fill(n,i),f,o,e,s;t.datavisualization.Diagram.Geometry.updatePolygonPoints(n);f=this._convertToSVGPoints(n.points);o={id:n.name+"_shape",fill:u,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,points:f};n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(e=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),s={id:n.name+"_shadow",points:f,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+e.x+","+e.y+")",opacity:n.shadow.opacity},r.appendChild(i.polygon(s)));r.appendChild(i.polygon(o))},_renderPath:function(n,i,r){var u=this._fill(n,i),o=n.width?n.width:n._width,s=n.height?n.height:n._height,f=t.datavisualization.Diagram.Geometry.updatePath(0,0,o,s,n.pathData,i),h,e,c;n._absolutePath=f;h={id:n.name+"_shape",width:o,height:s,d:f,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,stroke:n.borderColor,"stroke-width":n.borderWidth,fill:u};n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(e=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),c={id:n.name+"_shadow",width:n.width,height:n.height,d:f,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+e.x+","+e.y+")",opacity:n.shadow.opacity},r.appendChild(i.path(c)));r.appendChild(i.path(h))},_renderHtmlElement:function(n,i,r){var b=this._renderBackgroundRect(n,i,r),e,a,f,v,y,h,c;if(!n.segments&&n.templateId){var o=n.width?n.width:n._width,s=n.height?n.height:n._height,p=n.offsetX-o*n.pivot.x,w=n.offsetY-s*n.pivot.y,u=document.createElement("div"),l="width:"+o+"px;height:"+s+"px;padding:1px; opacity:"+n.opacity+";left:"+p+"px; top:"+w+"px; ";t.browserInfo().name==="msie"&&(l+="display: block; position: absolute; border:0px;");e={id:n.name+"_html","class":"foreignObject",style:l};t.datavisualization.Diagram.Util.attr(u,e);!n.segments&&n.templateId&&(a=this._renderHTMLTemplate(n),u.innerHTML=a);t.browserInfo().name==="msie"?(f=document.createElement("div"),v={id:n.name+"_parentdiv","class":"ej-d-node"},t.datavisualization.Diagram.Util.attr(f,v),f.appendChild(u),y=n.visible?"visible":"hidden",f.style.visibility=y,h=i.document.parentNode.getElementsByClassName("htmlLayer")[0],h?h.appendChild(f):i.document.parentNode.appendChild(u)):(e={id:n.name+"_shape",width:o,height:s,style:"pointer-events:none"},c=i.foreignObject(e),c.appendChild(u),r.appendChild(c))}},_initializeGuidelines:function(n,t,i){var r=n.g(t);return i.appendChild(r),r},_renderSideAlignmentLines:function(n,t,i,r,u){var f=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":1});i.appendChild(f)},_renderCenterAlignmentLines:function(n,t,i,r,u){var f=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":1});i.appendChild(f)},_renderSpacingLines:function(n,t,i,r,u){var e,o,f=r.g({}),s;n.x==t.x?(e="M"+(n.x*u-5)+" "+(n.y*u+5)+" L"+n.x*u+" "+n.y*u+" L"+(n.x*u+5)+" "+(n.y*u+5)+"z",o="M"+(t.x*u-5)+" "+(t.y*u-5)+" L"+t.x*u+" "+t.y*u+" L"+(t.x*u+5)+" "+(t.y*u-5)+"z",f.appendChild(r.line({x1:n.x*u-8,x2:n.x*u+8,y1:n.y*u-1,y2:n.y*u-1,stroke:"#07EDE1","stroke-width":1})),f.appendChild(r.line({x1:t.x*u-8,x2:t.x*u+8,y1:t.y*u+1,y2:t.y*u+1,stroke:"#07EDE1","stroke-width":1}))):(e="M"+(n.x*u+5)+" "+(n.y*u+5)+" L"+n.x*u+" "+n.y*u+" L"+(n.x*u+5)+" "+(n.y*u-5)+"z",o="M"+(t.x*u-5)+" "+(t.y*u-5)+" L"+t.x*u+" "+t.y*u+" L"+(t.x*u-5)+" "+(t.y*u+5)+"z",f.appendChild(r.line({x1:n.x*u-1,x2:n.x*u-1,y1:n.y*u-8,y2:n.y*u+8,stroke:"#07EDE1","stroke-width":1})),f.appendChild(r.line({x1:t.x*u+1,x2:t.x*u+1,y1:t.y*u-8,y2:t.y*u+8,stroke:"#07EDE1","stroke-width":1})));f.appendChild(r.path({d:e,fill:"#07EDE1"}));s=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":.6,fill:"#07EDE1"});f.appendChild(s);f.appendChild(r.path({d:o,fill:"#07EDE1"}));i.appendChild(f)},_removeGuidelines:function(n,t){t!=null&&n.removeChild(t)},update:function(n,t){var i=t._svg;n._type==="group"?this.updateGroup(n,i,t):n.segments?this.updateConnector(n,i,t):this.updateNode(n,i,t)},_updateGoupBackground:function(n,i){var r=n.offsetX-n.width/2,u=n.offsetY-n.height/2,h=n.rotateAngle,f=new t.datavisualization.Diagram.Point(r+n.width/2,u+n.height/2),e=n.fillColor,o=n.borderColor,s;(n.type=="bpmn"||n.type=="umlclassifier"&&n.classifier=="package")&&(e="transparent",o="transparent");s={id:n.name+"_shape",rx:n.cornerRadius,ry:n.cornerRadius,width:Math.round(n.width<0?0:n.width),height:Math.round(n.height<0?0:n.height),fill:e,stroke:o,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,transform:"rotate("+h+","+f.x+","+f.y+"),translate("+r+","+u+")"};i.getElementById(n.name+"_shape")&&t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+"_shape"),s)},updateGroup:function(n,t,i,r){var s=i._getChildren(n.children),l=n.visible?"visible":"hidden",h="display:block;",e,c,u,f,o;for(n.visible||(h="display:none;"),t.g({id:n.name,visibility:"visible",style:"display:block"}),e=0,c=s.length;e<c;e++)u=i.nameTable[s[e]],u&&(u._type==="group"?this.updateGroup(u,t,i,r):u.segments?this.updateConnector(u,t,i):this.updateNode(u,t,i,r));if(t.g({id:n.name,visibility:l,style:h}),this._updateGoupBackground(n,t),this._updateAssociatedConnector(n,t,i),this._updateLabels(n,t,i),this._updatePorts(n,t),n.isSwimlane&&n.phases&&n.phases.length>0)for(f=null,o=0;o<n.phases.length;o++)f=i.nameTable[n.phases[o]],f&&f.parent==n.name&&this._updatephase(f,i)},_removephases:function(n,i){var r,u,f;if(n.isSwimlane&&i.model.phases&&i.model.phases.length>0)for(r=null,u=i.model.phases.length-1;u>=0;u--)r=i.model.phases[u],r&&(f=i._svg.getElementById(r.name+"_phase"),f&&f.parentNode.removeChild(f),t.datavisualization.Diagram.Util.removeItem(i.model.phases,r))},_updatePhaseStyle:function(n,t,i){n&&t&&(t.id=n.name+"_phase",i._svg.g(t))},_updatephase:function(i,r){var a=r.nameTable[i.parent],h,f;if(a){var e=0,o=0,c=null,s=[],l,u=t.datavisualization.Diagram.Util.bounds(a),v=r._getChildren(a.children);v.length>1&&(h=r.nameTable[v[0]]);var y=u.top+50,p=u.left+50;i.orientation=="vertical"?(e=u.x,o=u.y+i.offset,h&&(y+=h.height),o<=u.bottom&&o>=y&&(c="translate("+e+","+o+")"),s.push({x:0,y:0}),s.push({x:u.width,y:0}),l=this._convertToSVGPoints(s)):(e=u.x+i.offset,o=u.y,e<=u.right&&e>p&&(c="translate("+e+","+o+")"),h&&(s.push({x:0,y:h.height}),s.push({x:0,y:u.height})),l=this._convertToSVGPoints(s));f={points:l,id:i.name+"_phase"};r._svg.polyline(f);f={points:l,id:i.name+"_phase_hitTest"};r._svg.polyline(f);c&&(f={id:i.name,transform:c});i.label&&this._updatePhaseLabel(i,i.label,r);r._svg.g(f);r._svg.getElementById(f.id)&&n("#"+f.id).insertAfter(n("#"+f.id)[0].parentNode.lastChild)}},_updatePhaseLabel:function(n,i,r){var f=r._svg,e=r._getPhaseBounds(n),u=f.getElementById(n.name+"_"+i.name);if(u){if(u.setAttribute("fill",i.fontColor),!i.text)return;u.textContent=i.text;e=t.datavisualization.Diagram.Util.bounds(n);this._wrapText(n,e,u,i,f);this._alignTextOnPhase(n,e,u,i,f)}},updateLabelStyle:function(t,i,r){var f=r.document.parentNode.getElementsByClassName("htmlLayer")[0],u=n(f).find("#"+t.name+"_"+i.name)[0];t&&u&&i&&(u.style.fontWeight=i.bold?"bold":"",u.style.fontStyle=i.italic?"italic":"",u.style.visibility=i.visible?"":"hidden",u.style.textDecoration=i.textDecoration,u.style.fontFamily=i.fontFamily,u.style.fontSize=i.fontSize+"px",u.style.color=i.fontColor,u.style.backgroundColor=i.fillColor,u.style.borderColor=i.borderColor,u.style.borderWidth=i.borderWidth,u.style.borderStyle="solid")},_updateNodeStyle:function(n,i){var r,u,f;n&&i&&(r={},r.opacity=n.opacity,r.fill=n.fillColor,r.stroke=n.borderColor,r["stroke-width"]=n.borderWidth,r["stroke-dasharray"]=n.borderDashArray,n.gradient&&(r.fill=this._renderGradient(n.name,n.gradient,i)),n._type=="node"&&(u=n.type=="text"?"_backRect":"_shape",t.browserInfo().name==="msie"&&n.type=="html"||i.getElementById(n.name+u)&&t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+u),r),n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=i.document.getElementById(n.name+"_shadow"),f&&t.datavisualization.Diagram.Util.attr(f,{fill:n.fillColor!="none"||n.fillColor!="transparent"?"lightgrey":"none"}))))},_updateConnectorStyle:function(n,i){if(n&&i){var r={};r.opacity=n.opacity;r.stroke=n.lineColor;r["stroke-width"]=n.lineWidth;r["stroke-dasharray"]=n.lineDashArray;r.opacity=n.opacity;t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+"_segments"),r)}},updateTargetDecoratorStyle:function(n,i){if(i){var r={};r.stroke=n.targetDecorator.borderColor;r.fill=n.targetDecorator.fillColor;t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+"_targetDecorator"),r)}},updateSourceDecoratorStyle:function(n,i){if(i){var r={};r.stroke=n.sourceDecorator.borderColor;r.fill=n.sourceDecorator.fillColor;t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+"_sourceDecorator"),r)}},updateNode:function(n,t,i){var r,u;if(t){if(n.type==="html"&&i._browserInfo.name==="msie"?(r=document.getElementById(n.name+"_html").getBoundingClientRect(),u={x:r.left,y:r.top,width:r.width,height:r.height}):r=t.getElementById(n.name+"_shape"),this._updateLabels(n,t,i),this._updateNode(n,t),i._layoutInAction)return;this._updateAssociatedConnector(n,t,i);i.activeTool.inAction&&(i.activeTool.name==="move"||i.activeTool.name==="rotate")||this._updatePorts(n,t)}},updateTextBlock:function(t,i,r){var f=r.document.parentNode.getElementsByClassName("htmlLayer")[0],e=n(f).children("#"+t.name)[0],o=n(e).children("#"+t.name+"_shape_lblbg")[0],u=o.childNodes[0];t&&u&&i&&(u.style.fontWeight=i.bold?"bold":"",u.style.fontStyle=i.italic?"italic":"",u.style.textDecoration=i.textDecoration,u.style.fontFamily=i.fontFamily,u.style.fontSize=i.fontSize+"px",u.style.color=i.fontColor,u.style.backgroundColor=i.fillColor,u.style.borderColor=i.borderColor,u.style.borderWidth=i.borderWidth);this._updateTextElement(t,r)},_updateAssociatedConnector:function(n,i,r){for(var u=0,f=n.inEdges.length;u<f;u++)r.nameTable[n.inEdges[u]]&&(r.nameTable[n.inEdges[u]]&&t.datavisualization.Diagram.Util.canBridge(r.nameTable[n.inEdges[u]],r)&&(t.datavisualization.Diagram.Util.updateBridging(r.nameTable[n.inEdges[u]],r),r._updateConnectorBridging(r.nameTable[n.inEdges[u]])),t.datavisualization.Diagram.DiagramContext.update(r.nameTable[n.inEdges[u]],r));for(u=0,f=n.outEdges.length;u<f;u++)r.nameTable[n.outEdges[u]]&&(r.nameTable[n.outEdges[u]]&&t.datavisualization.Diagram.Util.canBridge(r.nameTable[n.outEdges[u]],r)&&(t.datavisualization.Diagram.Util.updateBridging(r.nameTable[n.outEdges[u]],r),r._updateConnectorBridging(r.nameTable[n.outEdges[u]])),t.datavisualization.Diagram.DiagramContext.update(r.nameTable[n.outEdges[u]],r))},_updateNode:function(i,r){var u=i.width?i.width:i._width,f=i.height?i.height:i._height,a=i.offsetX-u*i.pivot.x,v=i.offsetY-f*i.pivot.y,y=i.rotateAngle,s=t.datavisualization.Diagram.Point(i.offsetX,i.offsetY),p=i.visible?"visible":"hidden",w={id:i.name,transform:"rotate("+y+","+s.x+","+s.y+"),translate("+a+","+v+")",visibility:p},h,e,o,c,l;r.g(w);h=i._shape?i._shape:i.type;switch(h){case"rectangle":r.rect({id:i.name+"_shape",width:u<0?0:u,height:f<0?0:f});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"ellipse":r.ellipse({id:i.name+"_shape",rx:u/2,ry:f/2,cx:u/2,cy:f/2});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.ellipse({id:i.name+"_shadow",rx:i.width/2,ry:i.height/2,cx:i.width/2,cy:i.height/2});break;case"image":this._updateBackgroundRect(i,r);r.image({id:i.name+"_shape",width:u,height:f});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"path":i._scaled||!i._absolutePath?(e=t.datavisualization.Diagram.Geometry.updatePath(0,0,u,f,i.pathData,r),i._absolutePath=e,i._scaled=!1):e=i._absolutePath;r.path({id:i.name+"_shape",d:e});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.path({id:i.name+"_shadow",d:e});break;case"polygon":this._updatePolygon(i,r);break;case"text":this._updateTextElement(i,r);break;case"html":this._updateHtmlElement(i,r);i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"native":o=n("#"+i.name+"_shape")[0]?n("#"+i.name+"_shape")[0].getBBox():{width:u,height:f};c=o.width?u/o.width:1;l=o.height?f/o.height:1;r.g({id:i.name+"_shape",width:u,height:f,transform:"scale("+c+","+l+")"});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height})}},_updateHtmlElement:function(n,i){var s;this._updateBackgroundRect(n,i);var h=n.visible?"visible":"hidden",u=n.width?n.width:n._width,f=n.height?n.height:n._height,e=n.offsetX-u*n.pivot.x,o=n.offsetY-f*n.pivot.y,r;t.browserInfo().name==="msie"?(r=document.getElementById(n.name+"_html"),r.style.left=e+"px",r.style.top=o+"px",r.style.webkitTransform="rotate("+n.rotateAngle+"deg)",r.style.MozTransform="rotate("+n.rotateAngle+"deg)",r.style.OTransform="rotate("+n.rotateAngle+"deg)",r.style.msTransform="rotate("+n.rotateAngle+"deg)",r.style.transform="rotate("+n.rotateAngle+"deg)",r.style.visibility=h):(r=i.getElementById(n.name+"_html"),s="width:"+u+"px;height:"+f+"px;padding:1px; left:"+e+"px; top:"+o+"px; ",t.datavisualization.Diagram.Util.attr(r,{style:s}),i.foreignObject({id:n.name+"_shape",width:u,height:f}));r.style.width=n.width.toString()+"px";r.style.height=n.height.toString()+"px"},_updatePolygon:function(n,i){t.datavisualization.Diagram.Geometry.updatePolygonPoints(n);i.polygon({id:n.name+"_shape",points:this._convertToSVGPoints(n.points)});n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&i.polygon({id:n.name+"_shadow",points:this._convertToSVGPoints(n.points)})},_convertToSVGPoints:function(n){for(var i="",t=0,r=n.length;t<r;t++)i+=n[t].x+","+n[t].y+" ";return i.trim()},_renderTextElement:function(n,i,r){var f=n.textBlock,o,u,s,h,a;if(f){this._renderBackgroundRect(n,i,r);o=document.createElement("div");u=document.createElement("span");t.datavisualization.Diagram.Util.attr(u,{id:n.name,"class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal; alignment-baseline:middle"});f.bold&&(u.style.fontWeight="bold");f.italic&&(u.style.fontStyle="italic");u.style.textDecoration=f.textDecoration;u.style.fontFamily=f.fontFamily;u.style.fontSize=f.fontSize+"px";u.style.color=f.fontColor;u.style.backgroundColor=n.fillColor;u.style.borderColor=n.borderColor;u.style.borderWidth=n.borderWidth;u.style.opacity=n.opacity;u.textContent=f.text;s="display: inline-block; position: absolute; width: inherit; height: inherit; pointer-events: none; ";t.datavisualization.Diagram.Util.attr(o,{id:n.name+"_shape_lblbg",style:s});o.appendChild(u);var e=document.createElement("div"),c=n.width?n.width:n._width,l=n.height?n.height:n._height,v=n.offsetX-c/2,y=n.offsetY-l/2,s="width:"+c+"px; height:"+l+"px; left:"+v+"px; top:"+y+"px; display: block; position: absolute; pointer-events: none; ";t.datavisualization.Diagram.Util.attr(e,{id:n.name,"class":"ej-d-node",style:s});e.style.webkitTransform="rotate("+n.rotateAngle+"deg) ";e.style.MozTransform="rotate("+n.rotateAngle+"deg) ";e.style.OTransform="rotate("+n.rotateAngle+"deg) ";e.style.msTransform="rotate("+n.rotateAngle+"deg)";e.style.transform="rotate("+n.rotateAngle+"deg) ";e.appendChild(o);h=i.document.parentNode.getElementsByClassName("htmlLayer")[0];h&&h.appendChild(e);a=t.datavisualization.Diagram.Util.bounds(n);this._alignTextOnLabel(n,a,u,o,n.textBlock)}},_updateTextElement:function(i,r){var e,o,f;this._updateBackgroundRect(i,r);var a=r.document.parentNode.getElementsByClassName("htmlLayer")[0],u=n(a).children("#"+i.name)[0],f=t.datavisualization.Diagram.Util.bounds(i),s,h,c,l;u&&(s=f.width,h=f.height,c=i.offsetX-i.width/2,l=i.offsetY-i.height/2,u.style.width=s+"px",u.style.height=h+"px",u.style.left=c+"px",u.style.top=l+"px",u.style.webkitTransform="rotate("+i.rotateAngle+"deg)",u.style.MozTransform="rotate("+i.rotateAngle+"deg)",u.style.OTransform="rotate("+i.rotateAngle+"deg)",u.style.msTransform="rotate("+i.rotateAngle+"deg)",u.style.transform="rotate("+i.rotateAngle+"deg)");e=n(u).children("#"+i.name+"_shape_lblbg")[0];o=e.childNodes[0];o.textContent=i.textBlock.text;f=t.datavisualization.Diagram.Util.bounds(i);this._alignTextOnLabel(i,f,o,e,i.textBlock)},_renderBackgroundRect:function(n,i,r){var u=this._fill(n,i),o={id:n.name+"_backRect","class":"backrect",x:0,y:0,width:n.width,height:n.height,fill:u,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray},f,e;n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),e={id:n.name+"_shadow","class":"backrect",width:n.width,height:n.height,stroke:"lightgrey",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+f.x+","+f.y+")",opacity:n.shadow.opacity},r.appendChild(i.rect(e)));r.appendChild(i.rect(o))},_updateBackgroundRect:function(n,t){var i={id:n.name+"_backRect",x:0,y:0,width:n.width,height:n.height};t.rect(i)},_hideNode:function(n,t){var i={id:n.name,style:"pointer-events:none;"};t.rect(i)},_showNode:function(n,t){var i={id:n.name,style:"pointer-events:auto;"};t.rect(i)},_removePhasehelper:function(n){n._svg.getElementById("phase_helper")&&n._svg.removeChild(n._svg.getElementById("phase_helper"),n._adornerLayer)},_updatePhaseHelper:function(n,t,i){var o,r,u,f,e;t&&(o=n._svg,r=n._currZoom,i.width=i.width<0?1:i.width,i.height=i.height<0?1:i.height,f=i.x+i.width/2,e=i.y+i.height/2,u={id:"phase_helper","class":"helper","pointer-events":"none",width:i.width*r,height:i.height*r,transform:"translate("+(f-i.width/2)*r+","+(e-i.height/2)*r+"),rotate(0,"+i.width/2*r+","+i.height/2*r+")"},n._svg.rect(u))},_phasehelper:function(n,t,i){if(t){var u=n._svg,r=n._currZoom,f=i.x+i.width/2,e=i.y+i.height/2,o=u.rect({id:"phase_helper","class":"helper","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:i.width*r,height:i.height*r,fill:"transparent",stroke:"green",transform:"translate("+(f-i.width/2)*r+","+(e-i.height/2)*r+"),rotate(0,"+i.width/2*r+","+i.height/2*r+")"});n._adornerLayer.appendChild(o)}},_drawContainerHelper:function(n){var i=n.activeTool.helper,o=n._svg,u=n._currZoom,r;i&&(r=t.datavisualization.Diagram.Util.bounds(i));var f=i.height?i.height:r.height,e=i.width?i.width:r.width,s=i.offsetX?i.offsetX:r.x+r.width/2,h=i.offsetY?i.offsetY:r.y+r.height/2,c=i.rotateAngle?i.rotateAngle:0,l=o.rect({id:"helper","class":"helper","stroke-width":1,"stroke-dasharray":"3,3","pointer-events":"none",width:e*u,height:f*u,fill:"transparent",stroke:"red",transform:"translate("+(s-e/2)*u+","+(h-f/2)*u+"),rotate("+c+","+e/2*u+","+f/2*u+")"});n._adornerLayer.appendChild(l)},_updateContainerHelper:function(n){var o=null,i=n.activeTool.helper,u=n._currZoom,r;i&&(r=t.datavisualization.Diagram.Util.bounds(i));var f=i.height?i.height:r.height,e=i.width?i.width:r.width,s=i.offsetX?i.offsetX:r.x+r.width/2,h=i.offsetY?i.offsetY:r.y+r.height/2,c=i.rotateAngle?i.rotateAngle:0;o={id:"helper","class":"helper",width:e*u,height:f*u,fill:"transparent",stroke:"red",transform:"translate("+(s-e/2)*u+","+(h-f/2)*u+"),rotate("+c+","+e/2*u+","+f/2*u+")"};n._svg.rect(o)},_removeContainerHelper:function(n,t,i){t.getElementById("helper")&&t.removeChild(t.getElementById("helper"),i)},setNodeShape:function(t,i,r){var u,f;r?(f=i.getElementById(r.name),u=n(f).find("#"+t.name)[0]):u=i.getElementById(t.name);n(u).empty();this._renderNode(t,i,u)},setLine:function(t,i,r,u){var f,e;r?(e=i.getElementById(r.name),f=n(e).find("#"+t.name)[0]):f=i.getElementById(t.name);n(f).empty();this.renderConnector(t,i,f,u)},addNodeLabel:function(t,i,r,u){var f,e;u?(e=r.getElementById(u.name),f=n(e).find("#"+t.name)[0]):f=r.getElementById(t.name);this._renderLabels(t,r)},renderConnector:function(n,t,i,r){var u,e=n.visible?"visible":"hidden",f;return u=t.g({id:n.name,"class":"ej-d-connector",visibility:e}),i?i.id!==u.id&&i.appendChild(u):t.appendChild(u),f=t.g({id:n.name+"segments"}),this._renderSegments(n,t,f,r),u.appendChild(f),this._renderLabels(n,t),this._renderDecorators(n,t,u,r),u},_renderSegments:function(n,i,r,u){var s=n.visible&&(u?u._browserInfo.name:t.browserInfo().name)==="msie"?"collapse":"hidden",o=this._findPath(n,u),f={id:n.name+"_segments",d:o,fill:"none",stroke:n.lineColor,"stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,opacity:n.opacity},e=i.path(f);r.appendChild(e);f={id:n.name+"_hitTest","class":"hitTest","stroke-width":n.lineHitPadding,d:o,"pointer-events":"stroke",stroke:"transparent",visibility:s};e=i.path(f);r.appendChild(e)},_findPath:function(n,i){for(var f,v,y,u,a,s,r,h,p,c,l,e,o=0;o<n.segments.length;o++){if(f=n.segments[o],f._bridges.length>0)for(v=0;v<f._bridges.length;v++)y=f._bridges[v],y._rendered=!1;if(u=f.points,o==0&&(i&&n.sourceNode&&(a=i._findNode(n.sourceNode)),u=this._clipDecorators(n,f,!0,a),f.type=="bezier"&&n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u[0]=t.datavisualization.Diagram.Util._adjustPoint(u[0],f._point1,!0,n.lineWidth)),e="M"+u[0].x+" "+u[0].y),o==n.segments.length-1&&(i&&n.targetNode&&(a=i._findNode(n.targetNode)),u=this._clipDecorators(n,f,!1,a)),f.type!="bezier")if(n.cornerRadius>0)for(r=0;r<u.length-1;r++)s=t.datavisualization.Diagram.Geometry.distance(u[r],u[r+1]),s>0&&(l=o<n.segments.length-1||r<u.length-2?s<n.cornerRadius*2?t.datavisualization.Diagram.Util._adjustPoint(u[r],u[r+1],!1,s/2):t.datavisualization.Diagram.Util._adjustPoint(u[r],u[r+1],!1,n.cornerRadius):u[r+1],(o>0||r>0)&&(s<n.cornerRadius*2?(c=t.datavisualization.Diagram.Util._adjustPoint(u[r],u[r+1],!0,s/2),(o<n.segments.length-1||r<u.length-2)&&(l=null)):c=t.datavisualization.Diagram.Util._adjustPoint(u[r],u[r+1],!0,n.cornerRadius)),c&&(e+=" Q"+u[r].x+" "+u[r].y+" "+c.x+" "+c.y),l&&(f._bridges.length>0&&(e=this._updateBridging(f,e,r),f.type==="orthogonal"&&(e=this._updateBridging(f,e,r+1))),e+=" L"+l.x+" "+l.y));else for(r=0;r<u.length;r++)r>0&&(e=this._updateBridging(f,e,r)+(" L"+u[r].x+" "+u[r].y));else h=f._endPoint,n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(h=t.datavisualization.Diagram.Util._adjustPoint(f._endPoint,f._point2,!0,n.lineWidth)),n.targetNode&&i&&(p=i._findNode(n.targetNode),a.borderColor!="none"&&(h=t.datavisualization.Diagram.Util._adjustPoint(h,f._point2,!0,p.borderWidth/2))),e+=" C"+f._point1.x+" "+f._point1.y+" "+f._point2.x+" "+f._point2.y+" "+h.x+" "+h.y}return e},_updateBridging:function(n,t,i){var f=t,u,r;if(n._bridges.length>0)if(n.type==="straight")for(u=0;u<n._bridges.length;u++)r=n._bridges[u],r._rendered||(f+=" L"+r.startPoint.x+" "+r.startPoint.y,f+=r.path);else if(n.type==="orthogonal")for(u=0;u<n._bridges.length;u++)r=n._bridges[u],r.segmentPointIndex!==i||r._rendered||(f+=" L"+r.startPoint.x+" "+r.startPoint.y,f+=r.path,r._rendered=!0);return f},_refreshSegments:function(n,t,i){this._updateConnector(n,t,i);this._updateDecorators(n,t,i)},_clipDecorators:function(n,i,r,u){var f=[],o,c,l,h,s,e;if(!r&&n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None){for(e=0;e<i.points.length;e++)f[e]=i.points[e];o=f[f.length-1];c=f[f.length-2];s=t.datavisualization.Diagram.Geometry.distance(o,c);s=s==0?1:s;l=2*n.lineWidth;h=t.datavisualization.Diagram.Point();h.x=o.x+l*(c.x-o.x)/s;h.y=o.y+l*(c.y-o.y)/s;u&&u.borderColor!="none"&&(h=t.datavisualization.Diagram.Util._adjustPoint(h,c,!0,u.borderWidth/2));f[f.length-1]=h}else if(r&&n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None){for(e=0;e<i.points.length;e++)f[e]=i.points[e];o=f[0];c=f[1];s=t.datavisualization.Diagram.Geometry.distance(o,c);s=s==0?1:s;l=2*n.lineWidth;h=t.datavisualization.Diagram.Point();h.x=o.x+l*(c.x-o.x)/s;h.y=o.y+l*(c.y-o.y)/s;i.type=="bezier"&&(s=t.datavisualization.Diagram.Geometry.distance(o,c),h.x=o.x+(i._point1.x-o.x)/s,h.y=o.y+(i._point1.y-o.y)/s);u&&u.borderColor!="none"&&(h=t.datavisualization.Diagram.Util._adjustPoint(h,i.type!="bezier"?c:i._point1,!0,u.borderWidth/2));f[0]=h}else if(r){for(e=0;e<i.points.length;e++)f[e]=i.points[e];u&&u.borderColor!="none"&&(f[0]=t.datavisualization.Diagram.Util._adjustPoint(f[0],f[1],!0,u.borderWidth/2))}else{for(e=0;e<i.points.length;e++)f[e]=i.points[e];u&&u.borderColor!="none"&&(f[f.length-1]=t.datavisualization.Diagram.Util._adjustPoint(f[f.length-1],f[f.length-2],!0,u.borderWidth/2))}return f},_updateConnector:function(n,t,i){var r=this._findPath(n,i);t.path({id:n.name+"_segments",d:r});t.path({id:n.name+"_hitTest",d:r})},updateConnector:function(n,t,i){if(t){var r=n.visible?"visible":"hidden";t.g({id:n.name,visibility:r});this._updateConnector(n,t,i);this._updateLabels(n,t,i);this._updateDecorators(n,t,i)}},renderDecorators:function(n,t,i){var r=t.getElementById(n.name);this._renderDecorators(n,t,r,i)},clearDecorators:function(n,t,i){this._updateConnector(n,t,i);var u=t.getElementById(n.name),r=t.getElementById(n.name+"_targetDecorator");r&&t.removeChild(r,u);r=t.getElementById(n.name+"_sourceDecorator");r&&t.removeChild(r,u)},_renderDecorators:function(n,i,r,u){var e,o,s,f,h;n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(f=n.segments[n.segments.length-1],e=f.points[f.points.length-2],o=n.targetPoint,f.type=="bezier"&&(e=f._point2),n.targetNode&&u&&(s=u._findNode(n.targetNode),s&&s.borderColor!="none"&&(o=t.datavisualization.Diagram.Util._adjustPoint(o,e,!0,s.borderWidth/2))),this._renderDecorator(n.name+"_targetDecorator",o,e,n,n.targetDecorator,i,r));n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(f=n.segments[0],e=n.sourcePoint,o=f.points[1],f.type=="bezier"&&(o=f._point1),n.sourceNode&&u&&(h=u._findNode(n.sourceNode),h&&h.borderColor!="none"&&(e=t.datavisualization.Diagram.Util._adjustPoint(e,o,!0,h.borderWidth/2))),this._renderDecorator(n.name+"_sourceDecorator",e,o,n,n.sourceDecorator,i,r))},_renderDecorator:function(n,i,r,u,f,e,o){var c,h,l,a,s=t.datavisualization.Diagram.Size(f.width,f.height),w,b,v,y,p;switch(f.shape){case"arrow":l=this._constructArrow(i,s);h={id:n,"class":"decorator",d:l,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(h);a=1.1*f.borderWidth;break;case"openarrow":l=this._constructArrow(i,s,!0);h={id:n,"class":"decorator",d:l,fill:"transparent",stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(h);a=1.1*f.borderWidth;break;case"circle":w=s.width/2;b=s.height/2;h={id:n,"class":"decorator",rx:w,ry:b,cx:i.x+s.width/2,cy:i.y,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.ellipse(h);a=.5*f.borderWidth;break;case"diamond":l=this._constructDiamond(i,s,e);h={id:n,"class":"decorator",x:i.x,y:i.y,width:s.width,height:s.height,d:l,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(h);a=.7*f.borderWidth;break;case"path":l=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-s.height/2,s.width,s.height,f.pathData,e);f._absolutePath=l;h={id:n,"class":"decorator",x:i.x,y:i.y,width:s.width,height:s.height,d:l,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(h);a=.5*f.borderWidth}c&&(f.borderColor!="none"?(v=t.datavisualization.Diagram.Geometry.findAngle(i,r),y=t.Matrix.identity(),t.Matrix.rotate(y,v),p=t.Matrix.transform(y,{x:a,y:0}),c.setAttribute("transform","translate("+p.x+","+p.y+"),rotate("+v+" "+i.x+" "+i.y+")")):c.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,r)+" "+i.x+" "+i.y+")"),o.appendChild(c))},_updateDecorators:function(n,i,r){var f,e,s,u,o,h;n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u=n.segments[n.segments.length-1],o=u.points,f=o[o.length-2],e=n.targetPoint,u.type=="bezier"&&(f=u._point2),n.targetNode&&r&&(s=r._findNode(n.targetNode),s&&s.borderColor!="none"&&(e=t.datavisualization.Diagram.Util._adjustPoint(n.targetPoint,f,!0,s.borderWidth/2))),this._updateDecorator(n.name+"_targetDecorator",e,f,n,n.targetDecorator,i));n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u=n.segments[0],o=u.points,f=n.sourcePoint,e=o[1],u.type=="bezier"&&(e=u._point1),n.sourceNode&&r&&(h=r._findNode(n.sourceNode),h.borderColor!="none"&&(f=t.datavisualization.Diagram.Util._adjustPoint(n.sourcePoint,e,!0,h.borderWidth/2))),this._updateDecorator(n.name+"_sourceDecorator",f,e,n,n.sourceDecorator,i))},_updateDecorator:function(n,i,r,u,f,e){var c,s,h,l,o=t.datavisualization.Diagram.Size(f.width,f.height),p,w,a,v,y;switch(f.shape){case"arrow":h=this._constructArrow(i,o);s={id:n,d:h,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(s);l=1.1*f.borderWidth;break;case"openarrow":h=this._constructArrow(i,o,!0);s={id:n,d:h,fill:"transparent",stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(s);l=1.1*f.borderWidth;break;case"circle":p=o.width/2;w=o.height/2;s={id:n,rx:p,ry:w,cx:i.x+o.width/2,cy:i.y,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.ellipse(s);l=.5*f.borderWidth;break;case"diamond":h=this._constructDiamond(i,o,e);s={id:n,x:i.x,y:i.y,width:o.width,height:o.height,d:h,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(s);l=.7*f.borderWidth;break;case"path":h=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-o.height/2,o.width,o.height,f.pathData,e);f._absolutePath=h;s={id:n,x:i.x,y:i.y,width:o.width,height:o.height,d:h,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(s);l=.5*f.borderWidth}c&&(f.borderColor!="none"?(a=t.datavisualization.Diagram.Geometry.findAngle(i,r),v=t.Matrix.identity(),t.Matrix.rotate(v,a),y=t.Matrix.transform(v,{x:l,y:0}),c.setAttribute("transform","translate("+y.x+","+y.y+"),rotate("+a+" "+i.x+" "+i.y+")")):c.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,r)+" "+i.x+" "+i.y+")"))},_constructArrow:function(n,i,r){var u=new t.datavisualization.Diagram.Path;return u.moveTo(n.x+i.width,n.y+i.height/2),u.lineTo(n.x,n.y),u.lineTo(n.x+i.width,n.y-i.height/2),r||u.close(),u.toString()},_constructDiamond:function(n,i){var r=new t.datavisualization.Diagram.Path;return r.moveTo(n.x+i.width,n.y),r.lineTo(n.x+i.width/2,n.y+i.height/2),r.lineTo(n.x,n.y),r.lineTo(n.x+i.width/2,n.y-i.height/2),r.lineTo(n.x+i.width,n.y),r.toString()},_renderLabels:function(i,r){var h;if(i.labels.length&&i.type!="text"){var a=i.labels,f=t.datavisualization.Diagram.Util.bounds(i),e,o,c,l,u,s=r.document.parentNode.getElementsByClassName("htmlLayer")[0];u=n(s).children("#"+i.name)[0];u&&s.removeChild(u);u=document.createElement("div");i.segments?(e=f.width,o=f.height,c=f.x,l=f.y):(e=i.width?i.width:i._width,o=i.height?i.height:i._height,c=i.offsetX-e/2,l=i.offsetY-o/2);var v=i.visible?"visible":"hidden",y="width:"+e+"px; height:"+o+"px; left:"+c+"px; top:"+l+"px; display: block; position: absolute; pointer-events: none; visibility:"+v+";",p=i._type==="node"?"ej-d-node":i._type==="group"?"ej-d-group":"ej-d-connector";for(t.datavisualization.Diagram.Util.attr(u,{id:i.name,"class":p,style:y}),i.rotateAngle&&(u.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",u.style.MozTransform="rotate("+i.rotateAngle+"deg) ",u.style.OTransform="rotate("+i.rotateAngle+"deg) ",u.style.msTransform="rotate("+i.rotateAngle+"deg)",u.style.transform="rotate("+i.rotateAngle+"deg) "),s&&s.appendChild(u),h=0;h<a.length;h++)this._renderLabel(i,f,a[h],u,s,r,e,o)}},_renderLabel:function(n,i,r,u,f,e,o,s){var c=document.createElement("div"),h=document.createElement("span"),l;t.datavisualization.Diagram.Util.attr(h,{id:n.name+"_"+r.name,"class":"ej-d-label",style:"display: inline-block; position: absolute; line-height: normal; pointer-events: all"});r.bold&&(h.style.fontWeight="bold");r.italic&&(h.style.fontStyle="italic");r.visible||(h.style.visibility="hidden");h.style.textDecoration=r.textDecoration;h.style.fontFamily=r.fontFamily;h.style.fontSize=r.fontSize+"px";h.style.color=r.fontColor;h.style.backgroundColor=r.fillColor;h.style.borderColor=r.borderColor;h.style.borderWidth=r.borderWidth;h.style.borderStyle="solid";h.textContent=r.text;o=o>r.width?o:r.width;s=s>r.height?s:r.height;o-=(r.margin.left||0)+(r.margin.right||0);s-=(r.margin.top||0)+(r.margin.bottom||0);l="display: inline-block; position: absolute; pointer-events: none; width:"+o+"px;height:"+s+"px;";t.datavisualization.Diagram.Util.attr(c,{id:n.name+"_"+r.name+"_lblbg",style:l});c.appendChild(h);u.appendChild(c);this._alignTextOnLabel(n,i,h,c,r)},_updateLabels:function(i,r){var b,h,y,p,c,f,l;if(i.labels&&i.labels.length&&i.type!="text"){var w=i.labels,s=t.datavisualization.Diagram.Util.bounds(i),e,o,a,v,k=r.document.parentNode.getElementsByClassName("htmlLayer")[0],u=n(k).children("#"+i.name)[0];if(u)for(i.segments?(e=s.width,o=s.height,a=s.x,v=s.y):(e=i.width?i.width:i._width,o=i.height?i.height:i._height,a=i.offsetX-e*i.pivot.x,v=i.offsetY-o*i.pivot.y),b=i.visible?"visible":"hidden",u.style.width=e+"px",u.style.height=o+"px",u.style.left=a+"px",u.style.top=v+"px",u.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",u.style.MozTransform="rotate("+i.rotateAngle+"deg) ",u.style.OTransform="rotate("+i.rotateAngle+"deg) ",u.style.msTransform="rotate("+i.rotateAngle+"deg)",u.style.transform="rotate("+i.rotateAngle+"deg)",u.style.visibility=b,c=0;c<w.length;c++)f=w[c],h=u.childNodes[c],l=h.childNodes[0],(f.text||l.textContent)&&(p=e>f.width?e:f.width,y=o>f.height?o:f.height,p-=(f.margin.left||0)+(f.margin.right||0),y-=(f.margin.top||0)+(f.margin.bottom||0),h.style.height=y+"px",h.style.width=p+"px",l.textContent=f.text,this._alignTextOnLabel(i,s,l,h,f))}},_alignTextOnPhase:function(n,i,r,u,f){var o,e,s,h;f.getElementById(n.name)&&(o=f.getElementById(n.name).getBoundingClientRect());o&&(e=r.getBBox(),s=f.getElementById(n.name+"_"+u.name+"_lblbg"),r.setAttribute("transform","translate("+-e.width/2+",50), rotate(0,0,0)"),r.setAttribute("pointer-events","auto"),s&&(h={width:e.width,height:e.height,fill:u.fillColor,stroke:u.borderColor,"stroke-width":u.borderWidth,transform:"translate("+-e.width+","+o.top+"), rotate(0,0,0)"},t.datavisualization.Diagram.Util.attr(s,h)))},updateLabel:function(i,r,u,f){var o;if(typeof r.text=="string"){var s=t.datavisualization.Diagram.Util.bounds(i),h=u.document.parentNode.getElementsByClassName("htmlLayer")[0],c=n(h).children("#"+i.name)[0],e=n(c).children("#"+i.name+"_"+r.name+"_lblbg")[0];e&&(o=e.childNodes[0],o.textContent=r.text,i.type!="node"||i.width||i.height||this.updateNode(i,u,f),this._alignTextOnLabel(i,s,o,e,r,f))}},_alignTextOnLabel:function(n,i,r,u,f){var s,h={x:f.offset.x,y:f.offset.y},a=n.width?n.width:n._width,v=n.height?n.height:n._height,y;a-=f.margin.left+f.margin.right;v-=f.margin.top+f.margin.bottom;s={x:a,y:v};f.rotateAngle&&(y=t.Matrix.identity(),t.Matrix.rotate(y,f.rotateAngle,h.x,h.y),s=t.Matrix.transform(y,{x:a,y:v}));var e=0,o=0,c,l,p=t.datavisualization.Diagram.Util.canMoveLabel(n);f.wrapping==t.datavisualization.Diagram.TextWrapping.NoWrap?(r.style.whiteSpace="nowrap",r.style.wordWrap="normal",r.style.maxWidth="",r.style.maxHeight=""):(r.style.whiteSpace="pre-wrap",f.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap?(r.style.wordBreak="break-all",r.style.wordWrap="break-word",n.segments?r.style.maxWidth=Math.abs(f.width)+"px":(Math.abs(s.x)<f.width&&(s.x=f.width),r.style.maxWidth=Math.abs(s.x)+"px",r.style.maxHeight=Math.abs(s.y)+"px")):(r.style.wordWrap="break-word",r.style.maxWidth="",r.style.maxHeight=""));switch(f.horizontalAlignment){case t.datavisualization.Diagram.HorizontalAlignment.Left:e="0%";c=f.margin.left+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Center:e="-50%";c=f.margin.left-f.margin.right+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Right:e="-100%";c=-f.margin.right+"px"}switch(f.verticalAlignment){case t.datavisualization.Diagram.VerticalAlignment.Top:o="0%";l=f.margin.top+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Center:o="-50%";l=f.margin.top-f.margin.bottom+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Bottom:o="-100%";l=-f.margin.bottom+"px"}p?(u.style.marginLeft=c,u.style.marginTop=l):(r.style.marginLeft=c,r.style.marginTop=l);h.x*=100;h.y*=100;r.style.textAlign=f.textAlign;r.style.webkitTransform="translate("+e+", "+o+") rotate("+f.rotateAngle+"deg)";r.style.MozTransform="translate("+e+", "+o+") rotate("+f.rotateAngle+"deg)";r.style.OTransform="translate("+e+", "+o+") rotate("+f.rotateAngle+"deg)";r.style.msTransform="translate("+e+", "+o+") rotate("+f.rotateAngle+"deg)";r.style.transform="translate("+e+", "+o+") rotate("+f.rotateAngle+"deg)";r.style.left="0px";r.style.top="0px";u&&(u.style.left=h.x+"%",u.style.top=h.y+"%")},_renderLabelsAsSvg:function(n,t){var r=t.document.getElementById(n.name),i;for(n.type=="text"&&this._renderTextElementAsSvg(n,n.textBlock,r,t),i=0;i<n.labels.length;i++)this._renderTextElementAsSvg(n,n.labels[i],r,t)},_renderTextElementAsSvg:function(n,i,r,u){var e={id:n.name+"_"+i.name,"class":"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:i.fontColor,"text-decoration":i.textDecoration,"dominant-baseline":"middle","pointer-events":"none"},f,s,o;(i.bold&&(e["font-weight"]="bold"),i.italic&&(e["font-style"]="italic"),f=u.text(e),f.textContent=i.text,e={id:n.name+"_"+i.name+"_lblbg",fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth,transform:"translate(0,0)"},s=u.rect(e),i.text)&&(r.appendChild(f),r.insertBefore(s,f),o=t.datavisualization.Diagram.Util.bounds(n),this._wrapText(n,o,f,i,u),this._alignTextOnSvgLabel(n,o,f,i,u))},_alignTextOnSvgLabel:function(n,i,r,u,f){var s=r.getBBox(),o=t.datavisualization.Diagram.Util._getLabelPosition(u,i),e=this._adjustOffsetWithTextBounds(n,u,o,s),c,l,h,a;r.setAttribute("transform","translate("+e.x+","+e.y+"), rotate("+u.rotateAngle+","+(o.x-e.x)+","+(o.y-e.y)+")");c=f.getElementById(n.name+"_"+u.name+"_lblbg");c&&(l=e.x+s.x,h=e.y,t.browserInfo().name==="mozilla"&&(h=e.y+u.fontSize/2),a={width:s.width,height:s.height,transform:"translate("+l+","+h+"), rotate("+u.rotateAngle+","+(o.x-l)+","+(o.y-h)+")",fill:u.fillColor?u.fillColor:"transparent",stroke:u.borderColor,"stroke-width":u.borderWidth},t.datavisualization.Diagram.Util.attr(c,a))},_adjustOffsetWithTextBounds:function(n,i,r,u){var f={x:0,y:0},o=0,e;o=i.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Top?r.y:i.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Center?r.y-u.height/2:r.y-u.height;f.y=o;switch(i.horizontalAlignment){case t.datavisualization.Diagram.HorizontalAlignment.Left:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:f.x=r.x;break;case t.datavisualization.Diagram.TextAlign.Center:f.x=r.x+u.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:f.x=r.x+u.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:f.x=r.x-u.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:f.x=r.x;break;case t.datavisualization.Diagram.TextAlign.Right:f.x=r.x+u.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:f.x=r.x-u.width;break;case t.datavisualization.Diagram.TextAlign.Center:f.x=r.x-u.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:f.x=r.x}}return e=t.datavisualization.Diagram.Util.bounds(n),(n.segments||n.type=="group")&&(f.x=f.x+e.x,f.y=f.y+e.y,r.x+=e.x,r.y+=e.y),t.browserInfo().name==="mozilla"&&(f.y=f.y-i.fontSize/2),f},_wrapText:function(n,t,i,r,u){for(var v=r.text,h,a,e,f,o,y,p,c,l,s;i.hasChildNodes();)i.removeChild(i.lastChild);if(n.segments?(h=t.width,a=t.height):(h=t.width-r.margin.left-r.margin.right,a=t.height-r.margin.top-r.margin.bottom),h=h<r.width?r.width:h,e=v.split("\n"),y="",u.getElementById(i.id)&&(c=u.getElementById(i.id).childNodes),c){for(o=0;o<e.length;o++)if(f=u.tspan(),f.style.fontSize=r.fontSize,i.appendChild(f),r.wrapping!="nowrap")for(s=0;s<e[o].length;s++)r.wrapping!="nowrap"?(l=c[c.length-1].getComputedTextLength(),l>=h-r.fontSize?(f.textContent+=e[o][s],p=-l,s==e[o].length-1||(f=u.tspan(),i.appendChild(f))):f.textContent+=e[o][s]):f.textContent+=e[o][s];else f.textContent+=e[0];this._wrapTextAlign(i,c,r.fontSize,r.textAlign)}},_wrapTextAlign:function(n,i,r,u){for(var f,o,s,e=0;e<i.length;e++){f=i[e].getComputedTextLength();switch(u){case"left":f=0;break;case"center":f=-f/2;break;case"right":f=-f}o={x:Number(f),dy:r};s=i[e];t.datavisualization.Diagram.Util.attr(s,o)}},_renderPorts:function(n,i,r){for(var e,o=n.ports,u,f=0,s=o.length;f<s;++f)u=o[f],e=this._renderPort(n,u,i),r.appendChild(e),(u.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||u.visibility&t.datavisualization.Diagram.PortVisibility.Hover||u.visibility&t.datavisualization.Diagram.PortVisibility.Connect)&&e.setAttribute("visibility","hidden")},_renderPort:function(n,i,r){var e,u,o=t.datavisualization.Diagram.Size(i.size,i.size),f,s,h,c;f=n._type==="group"?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!0);switch(i.shape){case"x":s=this._constructX(f,i.size);u={id:n.name+"_"+i.name,"class":"ej-d-port",fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth,d:s};e=r.path(u);break;case"circle":h=o.width/2;c=o.height/2;u={id:n.name+"_"+i.name,"class":"ej-d-port",rx:h,ry:c,cx:f.x,cy:f.y,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth};e=r.ellipse(u);break;case"square":u={id:n.name+"_"+i.name,"class":"ej-d-port",x:f.x-i.size/2,y:f.y-i.size/2,width:o.width,height:o.height,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth};e=r.rect(u)}return e},_insertPort:function(n,i,r){var f,u;f=document.getElementById(n.name);u=t.datavisualization.Diagram.SvgContext._renderPort(n,i,r);f.appendChild(u);(i.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&t.datavisualization.Diagram.PortVisibility.Hover||i.visibility&t.datavisualization.Diagram.PortVisibility.Connect)&&u.setAttribute("visibility","hidden")},_updatePort:function(n,i,r){var h=t.datavisualization.Diagram.Size(i.size,i.size),u=null,f,e,c,o,s;u=n._type==="group"?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!0);f=n.name+"_"+i.name;n._type==="group"&&(e=t.Matrix.identity(),t.Matrix.rotate(e,n.rotateAngle,n.offsetX,n.offsetY),u=t.Matrix.transform(e,u));switch(i.shape){case"x":c=this._constructX(u,i.size);r.path({id:f,d:c});break;case"circle":o=h.width/2;s=h.height/2;n.type==="group"?r.ellipse({id:f,rx:o,ry:s,cx:0,cy:0,transform:"rotate("+n.rotateAngle+","+u.x+","+u.y+"),translate("+u.x+","+u.y+")"}):r.ellipse({id:f,rx:o,ry:s,cx:u.x,cy:u.y});break;case"square":n.type==="group"?r.rect({id:f,x:0,y:0,transform:"rotate("+n.rotateAngle+","+u.x+","+u.y+"),translate("+(u.x-i.size/2)+","+(u.y-i.size/2)+")"}):r.rect({id:f,x:u.x-i.size/2,y:u.y-i.size/2})}},_updatePorts:function(n,t){for(var u,r=n.ports,i=0,f=r.length;i<f;++i)u=r[i],this._updatePort(n,u,t)},_constructX:function(n,i){var r=new t.datavisualization.Diagram.Path;return r.moveTo(n.x-i/2,n.y-i/2),r.lineTo(n.x+i/2,n.y+i/2),r.moveTo(n.x+i/2,n.y-i/2),r.lineTo(n.x-i/2,n.y+i/2),r.toString()},_enableSelectedNode:function(t,i,r){var f,u,o,e,s;if(t)if(t.type=="pseudoGroup")for(f=r._getChildren(t.children),u=0,o=f.length;u<o;u++)e=r.nameTable[f[u]],e&&this._enableSelectedNode(e,i,r);else s={id:t.name,"pointer-events":"auto",style:"pointer-events:block"},i.g(s);n(".decorator").attr("pointer-events","block");n(".handle").attr("pointer-events","block");n(".hitTest").attr("pointer-events","stroke")},_disableSelectedNode:function(t,i,r){var f,u,o,e,s;if(t.type=="pseudoGroup")for(f=r._getChildren(t.children),u=0,o=f.length;u<o;u++)e=r.nameTable[f[u]],e&&this._disableSelectedNode(e,i,r);else s={id:t.name,style:"pointer-events:none","pointer-events":"none"},n(".decorator").attr("pointer-events","none"),n(".handle").attr("pointer-events","none"),n(".hitTest").attr("pointer-events","none"),i.g(s)},_drawStackHighlighter:function(n,i,r,u,f,e){var c,s=[],o=t.datavisualization.Diagram.Util.bounds(n);e?f.y>=o.y&&f.y<o.center.y?(s.push({x:o.topLeft.x*u-5,y:o.topLeft.y*u-5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.topLeft.x*u-5,y:o.topLeft.y*u+5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.topRight.x*u+5,y:o.topRight.y*u-5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.topRight.x*u+5,y:o.topRight.y*u+5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u})):(s.push({x:o.bottomLeft.x*u-5,y:o.bottomLeft.y*u-5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u-5,y:o.bottomLeft.y*u+5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u+5,y:o.bottomRight.y*u-5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u+5,y:o.bottomRight.y*u+5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u})):f.x>=o.x&&f.x<o.center.x?(s.push({x:o.topLeft.x*u-5,y:o.topLeft.y*u-5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.topLeft.x*u+5,y:o.topLeft.y*u-5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u-5,y:o.bottomLeft.y*u+5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u+5,y:o.bottomLeft.y*u+5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u})):(s.push({x:o.topRight.x*u-5,y:o.topRight.y*u-5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.topRight.x*u+5,y:o.topRight.y*u-5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u-5,y:o.bottomRight.y*u+5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u+5,y:o.bottomRight.y*u+5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}));var c=this._convertToSVGPoints(s),l={id:"nodeHighlighter",points:c,fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none",style:"pointer-events: none"},h=i.polyline(l);return r.appendChild(h),h},_drawNodeHighlighter:function(n,i,r,u){var o,f=n.width?n.width:n._width,e=n.height?n.height:n._height,h=n.offsetX-f*n.pivot.x,c=n.offsetY-e*n.pivot.y,s=t.datavisualization.Diagram.Point(n.offsetX-f*n.pivot.x+f/2,n.offsetY-e*n.pivot.y+e/2),l="rotate("+n.rotateAngle+","+s.x*u+","+s.y*u+")",a={id:"nodeHighlighter","class":"ej-d-node",x:h*u,y:c*u,width:f*u,height:e*u,fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none",transform:l,style:"pointer-events: none"};return o=i.rect(a),r.appendChild(o),o},_removeNodeHighlighter:function(n,t){var i=n.getElementById("nodeHighlighter");i&&n.removeChild(i,t)},_drawPortHighlighter:function(n,i,r,u,f){var l,o,e,h,c,a,w=i.width?i.width:i._width,b=i.height?i.height:i._height,s,v="#8CC63F",k="#1A1A1A",d=.5,y,p,g;return n?(o=t.datavisualization.Diagram.Size(n.size*2,n.size*2),e=t.datavisualization.Diagram.Util._getPortPosition(n,t.datavisualization.Diagram.Util.bounds(i,!0)),p=t.Matrix.identity(),t.Matrix.rotate(p,i.rotateAngle,i.offsetX,i.offsetY),e=t.Matrix.transform(p,e),h=(e.x-n.size)*f,c=(e.y-n.size)*f,a="rotate(0,"+(h+o.width/2)+","+(c+o.height/2)+")"):(s=t.datavisualization.Diagram.Util.bounds(i,!0),o=t.datavisualization.Diagram.Size(s.width,s.height),e=t.datavisualization.Diagram.Point(s.x,s.y),h=e.x*f,c=e.y*f,k=v,v="transparent",d=2,y=t.datavisualization.Diagram.Point(i.offsetX-w*i.pivot.x+w/2,i.offsetY-b*i.pivot.y+b/2),a="rotate("+i.rotateAngle+","+y.x*f+","+y.y*f+")"),g={id:"portHighlighter","class":"ej-d-port",x:h,y:c,width:o.width*f,height:o.height*f,fill:v,stroke:k,"stroke-width":d,"pointer-events":"none",transform:a},l=r.rect(g),u.appendChild(l),l},_removePortHighlighter:function(n,t){var i=n.getElementById("portHighlighter");i&&n.removeChild(i,t)},_renderPhaseResize:function(n,i,r,u,f){var s,e=[],l="",a=!1,v=!1,o=t.datavisualization.Diagram.Util.bounds(n),c,h;s;e=[];e.push({x:o.topLeft.x*r,y:o.topLeft.y*r});e.push({x:o.bottomLeft.x*r,y:o.bottomLeft.y*r});s=this._convertToSVGPoints(e);h={id:"w-resize",points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"};c=i.polyline(h);f.appendChild(c);s;e=[];e.push({x:o.topLeft.x*r,y:o.topLeft.y*r});e.push({x:o.topRight.x*r,y:o.topRight.y*r});s=this._convertToSVGPoints(e);h={id:"n-resize",points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"};c=i.polyline(h);f.appendChild(c);l="";n.orientation=="vertical"&&(l="e-resize",v=!0);s;e=[];e.push({x:o.topRight.x*r,y:o.topRight.y*r});e.push({x:o.bottomRight.x*r,y:o.bottomRight.y*r});s=this._convertToSVGPoints(e);v&&(h={id:"e-resize-hitTest","class":l,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":v?"stroke ":"none"},c=i.polyline(h),f.appendChild(c));h={id:"e-resize","class":l,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":v?"stroke ":"none"};c=i.polyline(h);f.appendChild(c);l="";n.orientation=="horizontal"&&(l="s-resize",a=!0);s;e=[];e.push({x:o.bottomLeft.x*r,y:o.bottomLeft.y*r});e.push({x:o.bottomRight.x*r,y:o.bottomRight.y*r});s=this._convertToSVGPoints(e);a&&(h={id:"s-resize-hitTest","class":l,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":a?"stroke ":"none"},c=i.polyline(h),f.appendChild(c));h={id:"s-resize","class":l,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-event":a?"stroke ":"none"};c=i.polyline(h);f.appendChild(c)},renderSelector:function(t,i,r,u,f,e){var s,h,o,c;n(".phaseSelector").remove();s=t.width?t.width:t._width;h=t.height?t.height:t._height;t.segments?(o=i.g({id:i.document.id+"handle_g","class":"handle"}),r.appendChild(o),this._renderEndPointHandle(t,i,u)):t.type!="phase"?t.isLane||t.isSwimlane?(o=i.g({id:i.document.id+"handle_g","class":"handle"}),r.appendChild(o),this._renderPhaseResize(t,i,u,f,o,e)):(o=i.g({id:i.document.id+"handle_g","class":"handle",transform:"translate("+(t.offsetX-s/2)*u+","+(t.offsetY-h/2)*u+"),rotate("+t.rotateAngle+","+s/2*u+","+h/2*u+")"}),r.appendChild(o),this._renderResizeHandle(t,i,u,f)):t.type=="phase"&&e&&(o=i.g({id:i.document.id+"handle_g","class":"handle",transform:"translate("+e.x*u+","+e.y*u+"),rotate(0,"+e.width/2*u+","+e.height/2*u+")"}),i.document.getElementById(i.document.id+"handle_g")||r.appendChild(o),c=i.rect({id:"phaseSelector","class":"phaseSelector","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:e.width*u,height:e.height*u,fill:"transparent",stroke:"red"}),o.appendChild(c))},_renderResizeHandle:function(n,i,r,u){var f=n.width?n.width:n._width,e=n.height?n.height:n._height,o=t.datavisualization.Diagram.Point(f/2,-20/r);u&t.datavisualization.Diagram.SelectorConstraints.Rotator&&(this._renderPivotLine(n,i,r),this._renderRotateThumb("rotate",n,o.x,o.y,r,i));u&t.datavisualization.Diagram.SelectorConstraints.Resizer&&(this._renderResizeBorder("resizeBorder",n,i,r),this._renderResizeCorner("nw-resize",n,0,0,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest)),this._renderResizeCorner("n-resize",n,f/2*r,0,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth)),this._renderResizeCorner("ne-resize",n,f*r,0,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast)),this._renderResizeCorner("w-resize",n,0,e/2*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest)),this._renderResizeCorner("e-resize",n,f*r,e/2*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast)),this._renderResizeCorner("sw-resize",n,0,e*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest)),this._renderResizeCorner("s-resize",n,f/2*r,e*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth)),this._renderResizeCorner("se-resize",n,f*r,e*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast)))},renderUserHandles:function(n,t,i,r,u,f,e){var s,o;for(t.type==="phase"&&e&&(s=e._getPhaseBounds(t)),o=0;o<n.length;o++)(r&&n[o].enableMultiSelection||!r)&&n[o].visible&&this._renderUserHandle(n[o],t,i,u,f,s)},_renderUserHandle:function(n,i,r,u,f,e){var s=r.g({id:r.document.id+"userHandle_g","class":"userHandle"});f.appendChild(s);var o=this._getHandlePosition(n,i,u,e),h=t.datavisualization.Diagram.Geometry.updatePath(o.x*u-n.size/4,o.y*u-n.size/4,n.size/2,n.size/2,n.pathData,r),c=this._getHandleShape(n,o.x*u,o.y*u),l=this._getHandleIcon(n,h,o.x,o.y);s.appendChild(r.circle(c));s.appendChild(r.path(l))},_getHandleIcon:function(n,t){return{id:n.name+"_icon","class":"userHandle-icon",d:t,fill:n.pathColor}},_getHandlePosition:function(n,i,r,u){var e,o,f;if(i){e=t.datavisualization.Diagram.Point();o=i.type==="phase"&&u?t.datavisualization.Diagram.Util.bounds(u):t.datavisualization.Diagram.Util.bounds(i);var c=n.position,s=10,h=t.Matrix.identity();i.rotateAngle&&t.Matrix.rotate(h,i.rotateAngle);f=new t.datavisualization.Diagram.Point;switch(c){case"topleft":f=t.Matrix.transform(h,t.datavisualization.Diagram.Point(s+n.size/2,s+n.size/2));e.x=o.topLeft.x-f.x/r;e.y=o.topLeft.y-f.y/r;break;case"topcenter":f=t.Matrix.transform(h,t.datavisualization.Diagram.Point(0,s+n.size/2));e.x=o.topCenter.x-f.x/r;e.y=o.topCenter.y-f.y/r;break;case"topright":f=t.Matrix.transform(h,t.datavisualization.Diagram.Point(s+n.size/2,s/2-n.size));e.x=o.topRight.x+f.x/r;e.y=o.topRight.y+f.y/r;break;case"middleleft":f=t.Matrix.transform(h,t.datavisualization.Diagram.Point(-(s+n.size/2),0));e.x=o.middleLeft.x+f.x/r;e.y=o.middleLeft.y+f.y/r;break;case"middleright":f=t.Matrix.transform(h,t.datavisualization.Diagram.Point(s+n.size/2,0));e.x=o.middleRight.x+f.x/r;e.y=o.middleRight.y+f.y/r;break;case"bottomleft":f=t.Matrix.transform(h,t.datavisualization.Diagram.Point(-(s+n.size/2),s+n.size/2));e.x=o.bottomLeft.x+f.x/r;e.y=o.bottomLeft.y+f.y/r;break;case"bottomcenter":f=t.Matrix.transform(h,t.datavisualization.Diagram.Point(0,s/2-n.size));e.x=o.bottomCenter.x-f.x/r;e.y=o.bottomCenter.y-f.y/r;break;case"bottomright":f=t.Matrix.transform(h,t.datavisualization.Diagram.Point(s+n.size/2,s+n.size/2));e.x=o.bottomRight.x+f.x/r;e.y=o.bottomRight.y+f.y/r}}return e},_getHandleShape:function(n,t,i){return{id:n.name+"_shape","class":"userHandle",cx:t,cy:i,r:n.size/2,fill:n.backgroundColor,stroke:n.borderColor,"stroke-width":n.borderWidth,title:n.name}},_updateHandleShape:function(n,t,i,r){var u={id:n.name+"_shape",cx:t,cy:i};r.circle(u)},_updateHanleIcon:function(n,t,i){var r={id:n.name+"_icon",d:t};i.path(r)},_getHanleIcon:function(n,t){return{id:n.name,d:t,stroke:n.borderColor,"stroke-width":n.borderWidth,fill:n.fillColor}},renderPivotPoint:function(n,i,r){r.getElementById("pivot")||(t.datavisualization.Diagram.SvgContext._renderResizeCorner("pivot",n,n.offsetX*i,n.offsetY*i,r),this._updatePivotLine(n,r,i))},_renderPivotLine:function(n,i,r){if(!n.container){var u=n.width?n.width:n._width,h=n.height?n.height:n._height,f=t.datavisualization.Diagram.Point(u/2,-20/r),e=t.datavisualization.Diagram.Point(u/2,0),o=i.getElementById(i.document.id+"handle_g"),s=i.line({id:"pivotLine",x1:f.x*r,y1:f.y*r,x2:e.x*r,y2:e.y*r,stroke:"black","stroke-width":1,"stroke-dasharray":"2,3",fill:"none"});o.appendChild(s)}},_renderResizeBorder:function(n,t,i,r){var u=i.getElementById(i.document.id+"handle_g"),f=t.width?t.width:t._width,e=t.height?t.height:t._height,o=i.rect({id:n,width:f*r,height:e*r,stroke:"#097F7F","stroke-width":.6,"stroke-dasharray":"6,3",fill:"none"});u.appendChild(o)},_renderResizeCorner:function(n,i,r,u,f,e){var c=f.getElementById(f.document.id+"handle_g"),s="default",h="white",o;t.datavisualization.Diagram.Util.canResize(i)||(h="darkgray");e&&(h="darkgray",s="none");o={id:n,fill:h,stroke:"black","stroke-width":1,cx:r,cy:u,r:7,"pointer-events":s};c.appendChild(f.circle(o));o={id:n+"_transparent","class":n,fill:"transparent",cx:r,cy:u,r:10,"pointer-events":s};c.appendChild(f.circle(o))},_renderRotateThumb:function(n,i,r,u,f,e){if(!i.container){var h=e.getElementById(e.document.id+"handle_g"),c="#231f20";t.datavisualization.Diagram.Util.canRotate(i)||(c="darkgray");var o=20,s=20,l={id:"rotatehandle","class":n,fill:c,stroke:"black","stroke-width":.5,width:o,height:s,d:"M 16.856 10.239 L 18 3.438 l -2.189 0.817 c -0.974 -1.694 -2.482 -2.995 -4.326 -3.696 C 9.375 -0.245 7.071-0.18 5.01 0.744 C 2.942 1.668 1.365 3.342 0.558 5.453 c -0.803 2.115 -0.738 4.414 0.185 6.478 c 0.925 2.064 2.6 3.645 4.714 4.45 c 0.969 0.371 1.993 0.554 3.013 0.554 c 1.345 0 2.685 -0.317 3.897 -0.948 l -1.016 -1.962 c -1.584 0.822-3.445 0.929 -5.114 0.293 c -1.56 -0.596 -2.793 -1.762 -3.479 -3.289 C 2.078 9.502 2.031 7.803 2.622 6.244 C 3.216 4.68 4.387 3.443 5.914 2.761 C 7.437 2.079 9.137 2.03 10.7 2.626 c 1.246 0.475 2.271 1.328 2.986 2.424 L 11.54 5.851 L 16.856 10.239 Z",transform:"translate("+(r*f-o/2)+","+(u*f-s)+")"},a=e.path(l),v=e.circle({id:"rotate","class":n,fill:"transparent",stroke:"none",cx:o/2,cy:s/2,r:13,transform:"translate("+(r*f-o/2)+","+(u*f-s)+")"});h.appendChild(a);h.appendChild(v)}},_refreshEndPointHandles:function(t,i,r){if(t.segments){var u=i.getElementById(i.document.id+"handle_g");n(u).empty();this._renderEndPointHandle(t,i,r)}},_renderEndPointHandle:function(n,i,r){var f,u,e,o;if(!n.isPhase)for(f=0;f<n.segments.length;f++)u=n.segments[f],u.type=="bezier"&&(e=t.datavisualization.Diagram.Util.canDragSegmentThumbs(n),this._renderBezierLine("bezierline1_"+f,u._startPoint,u._point1,r,i),this._renderBezierLine("bezierline2_"+f,u._endPoint,u._point2,r,i),this._renderEndPointCorner("bezierpoint1_"+f,u._point1.x*r,u._point1.y*r,!1,i,e),this._renderEndPointCorner("bezierpoint2_"+f,u._point2.x*r,u._point2.y*r,!1,i,e)),o=u.points,f==0&&this._renderEndPointCorner("sourceEndPoint",u._startPoint.x*r,u._startPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)),f==n.segments.length-1?(this._renderEndPointCorner("targetEndPoint",u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isTargetConnected(n),i,t.datavisualization.Diagram.Util.canDragTargetEnd(n)),u.type=="orthogonal"&&this._renderTerminalOrthoThumbs(u,i,r,f)):u.type!="orthogonal"?this._renderSegmentEndThumb("segmentEnd_"+f,u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)):this._renderTerminalOrthoThumbs(u,i,r,f)},_renderTerminalOrthoThumbs:function(n,i,r,u,f){var e,s,o;if(n.points.length>2)for(e=0;e<n.points.length-1;e++)o=t.datavisualization.Diagram.Geometry.distance(n.points[e],n.points[e+1]),f=n.points[e].y==n.points[e+1].y?"horizontal":"vertical",s=o>=50?"visible":"hidden",this._renderOrthogonalThumb("OrthoThumb_"+e+"_"+u,(n.points[e].x+n.points[e+1].x)/2*r,(n.points[e].y+n.points[e+1].y)/2*r,i,s,f);else o=n.length||t.datavisualization.Diagram.Geometry.distance(n._startPoint,n._endPoint),s=o>=50?"visible":"hidden",f=n._startPoint.y==n._endPoint.y?"horizontal":"vertical",this._renderOrthogonalThumb("OrthoThumb_"+u,(n._endPoint.x+n._startPoint.x)/2*r,(n._endPoint.y+n._startPoint.y)/2*r,i,s,f)},_renderEndPointCorner:function(n,t,i,r,u,f){var s=u.getElementById(u.document.id+"handle_g"),e=r?"#8CC63F":"white",o;f||(e="darkgray");o={id:n,"class":n,opacity:.75,fill:e,stroke:"black","stroke-width":2,cx:t,cy:i,r:7};s.appendChild(u.circle(o))},_renderSegmentEndThumb:function(n,t,i,r,u){var f=u.getElementById(u.document.id+"handle_g"),e={id:n,"class":"segmentEnd",fill:"#e2e2e2",stroke:"black","stroke-width":2,cx:t,cy:i,r:5};f.appendChild(u.circle(e))},_renderOrthogonalThumb:function(n,t,i,r,u,f){var e,o,s;f=="horizontal"?(e="M0,7 L15,0 L30,7 L15,14 z",o=-15,s=-7):(e="M7,0 L0,15 L7,30 L14,15 z",o=-7,s=-15);var h=r.getElementById(r.document.id+"handle_g"),c={id:n,"class":"segmentEnd",fill:"#e2e2e2",stroke:"black","stroke-width":1,d:e,transform:"translate("+(t+o)+","+(i+s)+")",visibility:u};h.appendChild(r.path(c))},_renderBezierLine:function(n,t,i,r,u){var f=u.line({id:n,x1:t.x*r,y1:t.y*r,x2:i.x*r,y2:i.y*r,stroke:"black","stroke-width":1,"stroke-dasharray":"3,3",fill:"none"}),e=u.getElementById(u.document.id+"handle_g");e.appendChild(f)},_renderControlPointCorner:function(n,t,i,r){var u=r.g({"class":n}),f;r.getElementById(r.document.id+"handle_g").appendChild(u);f={id:n+"_"+i,fill:"white",stroke:"black","stroke-width":2,cx:t.x,cy:t.y,r:5};u.appendChild(r.circle(f))},_removePivotPoint:function(n,t,i){var r=t.getElementById(t.document.id+"handle_g");r!=null&&t.getElementById("pivot")&&(r.removeChild(t.getElementById("pivot")),this._updatePivotLine(n,t,i))},updateSelector:function(n,i,r,u,f){var e,o,h,s;n&&n.type==="phase"||(e=n.width?n.width:n._width,o=n.height?n.height:n._height,n.segments?(this._updateEndPointHandle(n,i,r),f&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&this.updateUserHandles(u.model.selectedItems.userHandles,n,i,!1,!1,r)):(n.isSwimlane||n.isLane||(h=i.g({id:i.document.id+"handle_g",transform:"translate("+(n.offsetX-e/2)*r+","+(n.offsetY-o/2)*r+"),rotate("+n.rotateAngle+","+e/2*r+","+o/2*r+")"})),this._updateResizeHandle(n,i,r,f),u.model.selectedItems.userHandles&&u.model.selectedItems.userHandles.length>0&&(s=!1,u.selectionList[0]&&u.selectionList[0].name=="multipleSelection"&&(s=!0),f&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&this.updateUserHandles(u.model.selectedItems.userHandles,n,i,s,!1,r))))},_updatePhaseResize:function(n,i,r){var e,u=[],o,f=t.datavisualization.Diagram.Util.bounds(n);e;u=[];u.push({x:f.topLeft.x*r,y:f.topLeft.y*r});u.push({x:f.bottomLeft.x*r,y:f.bottomLeft.y*r});e=this._convertToSVGPoints(u);o={id:"w-resize",points:e};i.polyline(o);e;u=[];u.push({x:f.topLeft.x*r,y:f.topLeft.y*r});u.push({x:f.topRight.x*r,y:f.topRight.y*r});e=this._convertToSVGPoints(u);o={id:"n-resize",points:e};i.polyline(o);e;u=[];u.push({x:f.topRight.x*r,y:f.topRight.y*r});u.push({x:f.bottomRight.x*r,y:f.bottomRight.y*r});e=this._convertToSVGPoints(u);o={id:"e-resize-hitTest",points:e};i.polyline(o);o={id:"e-resize",points:e};i.polyline(o);e;u=[];u.push({x:f.bottomLeft.x*r,y:f.bottomLeft.y*r});u.push({x:f.bottomRight.x*r,y:f.bottomRight.y*r});e=this._convertToSVGPoints(u);o={id:"s-resize-hitTest",points:e};i.polyline(o);o={id:"s-resize",points:e};i.polyline(o)},_updateResizeHandle:function(n,i,r,u){if(n.isSwimlane||n.isLane)this._updatePhaseResize(n,i,r,u);else{var f=n.width?n.width:n._width,e=n.height?n.height:n._height,s=n._corners,o=t.datavisualization.Diagram.Point(f/2,-20/r);u&t.datavisualization.Diagram.SelectorConstraints.Rotator&&(this._updateRotateHandle("rotate",o.x,o.y,r,i,n),this._updatePivotLine(n,i,r));u&t.datavisualization.Diagram.SelectorConstraints.Resizer&&(this._updateResizeCorner("nw-resize",0,0,i),this._updateResizeCorner("n-resize",f/2*r,0,i),this._updateResizeCorner("ne-resize",f*r,0,i),this._updateResizeCorner("w-resize",0,e/2*r,i),this._updateResizeCorner("e-resize",f*r,e/2*r,i),this._updateResizeCorner("sw-resize",0,e*r,i),this._updateResizeCorner("s-resize",f/2*r,e*r,i),this._updateResizeCorner("se-resize",f*r,e*r,i),this._updateResizeBorder("resizeBorder",n,i,r))}},_updateRotateHandle:function(n,t,i,r,u){var f=20,e=20,o={id:"rotatehandle",transform:"translate("+(t*r-f/2)+","+(i*r-e)+")"};u.path(o);u.circle({id:"rotate",transform:"translate("+(t*r-f/2)+","+(i*r-e)+")"})},_updatePivotLine:function(n,i,r){var u=n.width?n.width:n._width,f=t.datavisualization.Diagram.Point(u/2,-20/r),e=t.datavisualization.Diagram.Point(u/2,0),o=i.line({id:"pivotLine",x1:f.x*r,y1:f.y*r,x2:e.x*r,y2:e.y*r})},_updateResizeBorder:function(n,t,i,r){var u=t.width?t.width:t._width,f=t.height?t.height:t._height;i.rect({id:n,width:u*r,height:f*r})},_updateResizeCorner:function(n,t,i,r){var u={id:n,cx:t,cy:i};r.circle(u);u={id:n+"_transparent",cx:t,cy:i};r.circle(u)},_updateEndPointHandle:function(n,i,r){for(var u,e,o,f=0;f<n.segments.length;f++)u=n.segments[f],e=u.points,f==n.segments.length-1?(this._updateEndPointCorner("targetEndPoint",e[e.length-1].x*r,e[e.length-1].y*r,t.datavisualization.Diagram.Util.isTargetConnected(n),i,t.datavisualization.Diagram.Util.canDragTargetEnd(n)),u.type=="orthogonal"&&this._updateTerminalOrthoThumbs(u,i,r,f)):u.type!="orthogonal"?this._updateSegmentEndThumb("segmentEnd_"+f,u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)):this._updateTerminalOrthoThumbs(u,i,r,f),f==0&&this._updateEndPointCorner("sourceEndPoint",e[0].x*r,e[0].y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)),u.type=="bezier"&&(o=t.datavisualization.Diagram.Util.canDragSegmentThumbs(n),this._updateEndPointCorner("bezierpoint1_"+f,u._point1.x*r,u._point1.y*r,!1,i,o),this._updateEndPointCorner("bezierpoint2_"+f,u._point2.x*r,u._point2.y*r,!1,i,o),this._updateBezierLine("bezierline1_"+f,u._startPoint,u._point1,r,i),this._updateBezierLine("bezierline2_"+f,u._endPoint,u._point2,r,i))},_updateEndPointCorner:function(n,t,i,r,u,f){var e=r?"#8CC63F":"white",o;f||(e="darkgray");o={id:n,fill:e,cx:t,cy:i};u.circle(o)},_updateSegmentEndThumb:function(n,t,i,r,u){var f={id:n,cx:t,cy:i};u.circle(f)},_updateOrthoThumb:function(n,t,i,r,u,f){var e,o,s,h;f=="horizontal"?(e="M0,7 L15,0 L30,7 L15,14 z",o=-15,s=-7):(e="M7,0 L0,15 L7,30 L14,15 z",o=-7,s=-15);h={id:n,visibility:u,transform:"translate("+(t+o)+","+(i+s)+")",d:e};r.path(h)},_updateTerminalOrthoThumbs:function(n,i,r,u){var e,f,s,o;if(n.points.length>2)for(f=0;f<n.points.length-1;f++)o=t.datavisualization.Diagram.Geometry.distance(n.points[f],n.points[f+1]),e=n.points[f].y==n.points[f+1].y?"horizontal":"vertical",s=o>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+f+"_"+u,(n.points[f].x+n.points[f+1].x)/2*r,(n.points[f].y+n.points[f+1].y)/2*r,i,s,e);else o=n.length||t.datavisualization.Diagram.Geometry.distance(n._startPoint,n._endPoint),e=n._startPoint.y==n._endPoint.y?"horizontal":"vertical",s=o>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+u,(n._endPoint.x+n._startPoint.x)/2*r,(n._endPoint.y+n._startPoint.y)/2*r,i,s,e)},_updateBezierLine:function(n,t,i,r,u){var f=u.line({id:n,x1:t.x*r,y1:t.y*r,x2:i.x*r,y2:i.y*r})},_updateControlPointCorner:function(n,t,i,r){r.circle({id:n+"_"+i,cx:t.x,cy:t.y})},updateUserHandles:function(n,t,i,r,u,f){if(n&&n.length>0)for(var e=0;e<n.length;e++)(r&&n[e].enableMultiSelection||!r)&&this._updateHandle(n[e],t,i,u,f)},_updateHandle:function(n,i,r,u,f){if(!u&&n.visible){var e=this._getHandlePosition(n,i,f),o=t.datavisualization.Diagram.Geometry.updatePath(e.x*f-n.size/4,e.y*f-n.size/4,n.size/2,n.size/2,n.pathData,r);this._updateHandleShape(n,e.x*f,e.y*f,r);this._updateHanleIcon(n,o,r);r.getElementById(n.name+"_shape")&&n.visible&&(r.getElementById(n.name+"_shape").style.display="block",r.getElementById(n.name+"_icon").style.display="block")}else r.getElementById(n.name+"_shape")&&(r.getElementById(n.name+"_shape").style.display="none",r.getElementById(n.name+"_icon").style.display="none")},clearSelector:function(n,t){var i=n.getElementById(n.document.id+"handle_g");i&&t.removeChild(i);i=n.getElementById(n.document.id+"userHandle_g");i&&t.removeChild(i)},_initializePageBreaks:function(n,t,i){var r=n.g(t);return i.appendChild(r),r},_renderVPageBreakLine:function(n,t,i,r){var u=i.line({x1:n.x,y1:n.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});r.appendChild(u)},_renderPageSettingsRect:function(n,t,i,r,u,f,e){var o=i.rect({id:"pageback",x:n.x,y:n.y,width:t.x,height:t.y,style:"fill:"+f+";stroke:"+u+";stroke-width:"+e+""});r.appendChild(o)},_updatePageBakground:function(n,i,r,u,f,e,o){var s=r.document.getElementById("pageback"),h={x:n.x,y:n.y,width:i.x<0?0:i.x,height:i.y<0?0:i.y,style:"fill:"+e+";stroke:"+f+";stroke-width:"+o+""};s&&t.datavisualization.Diagram.Util.attr(s,h)},_renderHPageBreakLine:function(n,t,i,r){var u=i.line({x1:n.x,y1:n.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});r.appendChild(u)},_removePageBreaks:function(n,t,i){t!=null&&i!=null&&i.removeChild(t)},removeChild:function(t,i){var r=i.svg.document.getElementById(t.name),u=i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],f=n(u).find("#"+t.name)[0];r&&r.parentNode.removeChild(r);f&&u.removeChild(f)}};t.datavisualization.Diagram.DiagramContext={updateViewPort:function(n){var i;n._views.forEach(function(r){i=n._views[r];i.context==t.datavisualization.Diagram.SvgContext&&i.type=="mainview"&&t.datavisualization.Diagram.PageUtil._updatePageSize(n)})},renderNode:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;i&&(i=u.document.getElementById(i.id));r.context.renderNode(n,u,i||r.diagramLayer)})},renderPort:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r._canvas;r.context._insertPort(n,t,u)})},renderConnector:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;r.context.renderConnector(n,u,i||r.diagramLayer,t)})},renderGroup:function(n,t,i){var r,u;t._views.forEach(function(f){var e;r=t._views[f];u=r.svg||r._canvas;i=r.svg.getElementById(n.parent);r.type=="overview"&&(e=!0);r.context.renderGroup(n,u,i||r.diagramLayer,t.nameTable,t,null,e)})},update:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;n._type==="group"||n.type==="pseudoGroup"?r.context.updateGroup(n,u,t,i):n.segments?r.context.updateConnector(n,u,t):r.context.updateNode(n,u,t,i)})},_refreshSegments:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;n.segments&&i.context._refreshSegments(n,r,t)})},renderShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._renderShadow(n,r)})},updateShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._updateShadow(n,r)})},removeShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._removeShadow(n,r)})},addNodeLabel:function(n,t,i,r){var u,f;r._views&&r._views.forEach(function(e){u=r._views[e];f=u.svg||u.canvas;u.context.addNodeLabel(n,t,f,i)})},updateLabel:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r.canvas;r.context.updateLabel(n,t,u,i)})},setNodeShape:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r.canvas;r.context.setNodeShape(n,u,i)})},setLine:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r.canvas;r.context.setLine(n,u,i,t)})},renderDecorators:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.renderDecorators(n,r,t)})},clearDecorators:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.clearDecorators(n,r,t)})},updateTargetDecoratorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.updateTargetDecoratorStyle(n,r)})},updateSourceDecoratorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.updateSourceDecoratorStyle(n,r)})},updateNodeStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context._updateNodeStyle(n,r)})},updateLabelStyle:function(n,t,i){i._views.forEach(function(r){var u=i._views[r],f=u.svg||u.canvas;u.context.updateLabelStyle(n,t,f)})},updateConnectorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context._updateConnectorStyle(n,r)})},updateTextBlock:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r.canvas;r.context.updateTextBlock(n,t,u)})},updateBPMNNodeStyle:function(n,i){var f,u,r=0;if(n=t.datavisualization.Diagram.BPMNShape(n,i),n.children)for(u=i._getChildren(n.children),r=0;r<u.length;r++)f=i.nameTable[u[r]],t.datavisualization.Diagram.DiagramContext.updateNodeStyle(f,i,n);else t.datavisualization.Diagram.DiagramContext.updateNodeStyle(n,i)},updateBPMNNodeShape:function(n,i){var f,r,u=0,e;if(n=t.datavisualization.Diagram.BPMNShape(n,i),r=i._getChildren(n.children),r.length>0&&i.nameTable[r[0]])for(u=0;u<r.length;u++)f=i.nameTable[r[u]],f&&t.datavisualization.Diagram.DiagramContext.setNodeShape(f,i,n);else e=i._svg.getElementById(n.name),e.parentNode.removeChild(e),i.add(n)}}}(jQuery,Syncfusion),function(n,t){"use strict";t.widget("ejSymbolPalette","ej.datavisualization.SymbolPalette",{element:null,model:null,nameTable:{},defaults:{width:250,height:400,paletteItemWidth:50,paletteItemHeight:50,previewWidth:110,previewHeight:110,previewOffset:{x:112,y:112},diagramId:null,headerHeight:30,selectedPaletteName:0,cssClass:"e-datavisualization-symbolpalette",showPaletteItemText:!0,allowDrag:!0,palettes:[]},dataTypes:{paletteItemWidth:"number",paletteItemHeight:"number",previewWidth:"number",previewHeight:"number",headerHeight:"number",showPaletteItemText:"boolean",allowDrag:"boolean",palettes:"array"},_canvas:null,_init:function(){t.browserInfo().name==="msie"&&Number(t.browserInfo().version)<9||(this.selectedItem=null,this.activePalette=null,this._selectedElement=null,this._renderSymbolPalette(),this._wireEvents(),this.updateScrollerViewport())},_setModel:function(n){for(var t in n)switch(t){case"width":this._setWidth(n[t]);break;case"height":this._setHeight(n[t]);break;case"paletteItemWidth":this.model.paletteItemWidth=n[t];this._redrawContent();break;case"paletteItemHeight":this.model.paletteItemHeight=n[t];this._redrawContent();break;case"headerHeight":this._setHeaderHeight(n[t]);break;case"cssClass":this._setCssClass(n[t]);break;case"showPaletteItemText":this._showItemText(n[t])}},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_renderSymbolPalette:function(){var n,i,r;if(this._canvas=document.createElement("div"),this._canvas.setAttribute("class","e-scanvas"),this._canvas.setAttribute("id",this.element[0].id+"_canvas"),this.element[0].setAttribute("style","height:"+this.model.height+"; width:"+this.model.width+";"),this.element.append(this._canvas),this.element.ejScroller({width:this._setViewPortWidth(),height:this._setViewPortHeight()}),n=this.model.palettes,n)for(i=0,r=n.length;i<r;i++)n[i]=t.datavisualization.Diagram.Palette(n[i],this),this._renderPalette(n[i])},_renderHtmlLayer:function(n){var i=document.createElement("div"),u={id:n.id+"_htmlLayer","class":"htmlLayer"},r;return t.datavisualization.Diagram.Util.attr(i,u),r=i,i.style.pointerEvents="none",i.style.position="absolute",i.style.left="2px",i.style.top="0px",n.appendChild(r),r},_initGroupNode:function(n){for(var i=null,r=0;r<n.children.length;r++)i=n.children[r],typeof i=="object"&&(i._type=="group"?(i=t.datavisualization.Diagram.Group(i),palette._initGroupNode(i)):i=i.segments?t.datavisualization.Diagram.Connector(i):t.datavisualization.Diagram.Node(i),i.parent=n.name,this.nameTable[i.name]=i)},_setViewPortWidth:function(){this.element[0].setAttribute("style","width:"+this.model.width+";");var n=this.element.width();return Math.abs(n)},_setViewPortHeight:function(){this.element[0].setAttribute("style","height:"+this.model.height+";");var n=this.element.height();return Math.abs(n)},_renderPalette:function(n){this._renderHeader(n);this._renderContent(n);this._collapse(n)},_renderHeader:function(i){var r=document.createElement("div"),u={id:i.name+"_header","class":"e-header",style:"height:"+this.model.headerHeight+"px;"};t.datavisualization.Diagram.Util.attr(r,u);this._renderHeaderArrow(r,i.expanded,i.name);this._renderHeaderText(r,i.name);this._addExpandedClass(r,i.expanded);this.model.selectedPaletteName===i.name&&(n(r).addClass("selected"),this.activePalette=i);this._canvas.appendChild(r)},_renderHeaderText:function(n,t){var i=document.createElement("span");i.setAttribute("class","e-header-text");i.innerHTML=t;n.appendChild(i)},_renderHeaderArrow:function(t,i){var r=document.createElement("span");r.setAttribute("class","e-header-arrow e-icon");r.setAttribute("style","top:"+(this.model.headerHeight-16)/2+"px;");this._addExpandedClass(r,i);this.model.selectedPaletteName===name&&n(r).addClass("selected");t.appendChild(r)},_renderContent:function(n){var r=document.createElement("div"),t,i,u;if(r.setAttribute("id",n.name+"_content"),r.setAttribute("class","e-scontent"),this.model.palettes.length-1===this.model.palettes.indexOf(n)&&r.setAttribute("style","border-bottom-width: 0px;"),this._canvas.appendChild(r),t=n.items,t&&t.length>0)for(i=0,u=t.length;i<u;i++)t[i].parent?this.nameTable[t[i].name]=t[i]:(this._renderItem(t[i],r),this.nameTable[t[i].name]=t[i])},_renderItem:function(n,t){var i=this._renderItemContainer(n.name,t);n.segments?this._renderConnector(n,i):n._type=="node"?this._renderNode(n,i):this._renderGroup(n,i)},_renderItemContainer:function(i,r,u){var e=document.createElement("div"),s={id:i+"_paletteItem",draggable:"true",height:this.model.paletteItemHeight+"px",width:this.model.paletteItemWidth+"px","class":"e-paletteItem",style:"-ms-touch-action: none;touch-action: none;"},o,f;return t.datavisualization.Diagram.Util.attr(e,s),r.appendChild(e),o=this.element[0].id,f=this,u||n(e).ejDraggable({clone:!0,cursorAt:{top:f.model.previewOffset.y,left:f.model.previewOffset.x},helper:function(){var r=n("#"+f.model.diagramId).ejDiagram("instance"),s,h,u,i,o;if(s=f.model.paletteItemWidth,h=f.model.paletteItemHeight,f.model.paletteItemWidth=f.model.previewWidth,f.model.paletteItemHeight=f.model.previewHeight,u=f._renderItemContainer(f.selectedItem.name+"_clone",document.body,!0),u.document.setAttribute("drag","true"),i=n.extend(!0,{},f.selectedItem),r._selectedSymbol=i,r._paletteTable=f.nameTable,r._palNameTable=n.extend(!0,{},f.nameTable),i.segments){var e=t.datavisualization.Diagram.Util.bounds(i),c=(f.model.previewWidth-10)/e.width,l=(f.model.previewHeight-10)/e.height;r.scale(i,c,l,e.topLeft,r.nameTable);f._renderConnector(i,u)}else i.width=f.model.previewWidth-10,i.height=f.model.previewHeight-10,i.offsetX=i.width/2+5,i.offsetY=i.height/2+5,i._type=="node"?f._renderNode(i,u):f._renderGroup(i,u);return o=document.getElementById(f.selectedItem.name+"_clone_paletteItem"),n(o).addClass("dragClone"),f.model.paletteItemWidth=s,f.model.paletteItemHeight=h,n(o)},drag:function(){var i=this,t=n(".dragClone")[0];t&&t.setAttribute("paletteId",o)},dragStop:function(){var t=n("#"+f.model.diagramId).ejDiagram("instance");t._selectedSymbol=null;n(".dragClone").remove()}}),this._renderAnchor(e,i)},_renderAnchor:function(n,i){var r=document.createElement("div"),f={id:i+"_anchor",height:this.model.paletteItemHeight+"px",width:this.model.paletteItemWidth+"px","class":"e-anchor"},u;return t.datavisualization.Diagram.Util.attr(r,f),n.appendChild(r),u=this._renderSvg(r,i),this._renderText(r,i),u},_renderSvg:function(n,i){var r=document.createElement("div"),u={id:i+"_svgWrapper",width:this.model.paletteItemWidth+"px;",height:+this.model.paletteItemHeight+"px;","class":"e-svg-container"},f;return t.datavisualization.Diagram.Util.attr(r,u),u={id:i+"_svg",width:this.model.paletteItemWidth,height:this.model.paletteItemHeight,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},f=new t.datavisualization.Diagram.Svg(u),r.appendChild(f.document),this._renderHtmlLayer(r),n.appendChild(r),f},_renderText:function(n,t){var i=document.createElement("div"),r;i.setAttribute("class","e-text-container");i.setAttribute("style","width:"+this.model.paletteItemWidth+"px; text-align : center");r=document.createElement("span");r.setAttribute("class","e-paletteItemText");r.innerHTML=t.split("_clone").length>1?t.split("_clone")[0]:t;i.appendChild(r);this.model.showPaletteItemText||(i.style.display="none");n.appendChild(i)},_renderNode:function(n,i){var u=t.datavisualization.Diagram.SvgContext.renderNode(n,i),r=!1;i.document.getAttribute("drag")!=null&&(r=!0);this._transformItem(u,n.width,n.height,n,r)},_updateChildBounds:function(n,i){var u=null,f,r;if(n._type=="group"){for(f=this._getChildren(n.children),r=0;r<f.length;r++)u=i[f[r]],u._type=="group"&&this._updateChildBounds(u,i);t.datavisualization.Diagram.Util._updateChildBounds(n,this)}},_getChildren:function(n){var i,r,t;if(n){for(i=[],r=0;r<n.length;r++)t=n[r],t&&(typeof t=="object"?i.push(t.name):typeof t=="string"&&i.push(t));return i}},_renderGroup:function(n,i){this._updateChildBounds(n,this.nameTable);var u=t.datavisualization.Diagram.SvgContext.renderGroup(n,i,null,this.nameTable,this),r=!1;i.document.getAttribute("drag")!=null&&(r=!0);this._transformItem(u,n.width,n.height,n,r)},_renderConnector:function(n,i){var f=t.datavisualization.Diagram.SvgContext.renderConnector(n,i),r=t.datavisualization.Diagram.Util.bounds(n),u=!1;i.document.getAttribute("drag")!=null&&(u=!0);this._transformItem(f,r.width,r.height,null,u)},_wireEvents:function(){this._on(this.element,t.eventType.click,".e-header",this._headerClick);this._on(this.element,t.eventType.mouseDown,".e-header",this._headerMouseDown);this._on(this.element,"mouseover",".e-header",this._headerMouseOver);this._on(this.element,"mouseout",".e-header",this._headerMouseOut);this._on(this.element,t.eventType.mouseDown,".e-paletteItem",this._itemMouseDown);this._on(this.element,"mouseover",".e-paletteItem",this._itemMouseOver);this._on(this.element,"mouseout",".e-paletteItem",this._itemMouseOut);this._on(this.element,t.eventType.click,".e-anchor",this._itemClick)},_headerClick:function(t){var r=this,i;n(t.currentTarget).next(".e-scontent").slideToggle(200,function(){r._refresh()});this._updateHeaderState(t.currentTarget);i=this._getActivePalette(t.currentTarget.id);i&&i!==this.activePalette&&(this.activePalette=i)},_headerMouseDown:function(n){n.preventDefault();n.stopPropagation()},_headerMouseOver:function(t){n(t.currentTarget).addClass("hover");n(t.currentTarget).find(".e-header-arrow").addClass("hover")},_headerMouseOut:function(t){n(t.currentTarget).removeClass("hover");n(t.currentTarget).find(".e-header-arrow").removeClass("hover")},_itemMouseDown:function(i){var r,u,s,e,f,h,o;if(this.model.diagramId&&(r=n("#"+this.model.diagramId).ejDiagram("instance"),r.activeTool instanceof t.datavisualization.Diagram.LineTool&&(r.activeTool._showAllPorts(!0),r.deactivateTool())),this.model.allowDrag||(i.preventDefault(),i.stopPropagation()),this._selectedElement?this._selectedElement!==i.currentTarget&&(n(this._selectedElement).removeClass("selected"),this._selectedElement=i.currentTarget):this._selectedElement=i.currentTarget,n(i.currentTarget).hasClass("selected")||n(i.currentTarget).addClass("selected"),u=this._getActivePalette(i.currentTarget.parentElement.id),u&&u!==this.activePalette&&(this._clearHeaderSelection(),this._updateHeaderSelection(n(i.currentTarget.parentElement).prev()),this.activePalette=u),this.activePalette&&this._selectedElement)for(s=this._selectedElement.id.slice(0,this._selectedElement.id.lastIndexOf("_")),e=this.activePalette.items,f=0,h=e.length;f<h;f++)o=e[f],o.name===s&&(this.selectedItem=o)},_itemMouseOver:function(t){n(t.currentTarget).addClass("hover")},_itemMouseOut:function(t){n(t.currentTarget).removeClass("hover")},_itemDraStart:function(n){var t=n.originalEvent.dataTransfer;t.setData("Text",this.element[0].id);t.effectAllowed="copy"},_itemClick:function(){},_collectionChanged:function(n){var t,i,r;n.changeType=="insert"?this._renderPalette(n.element):n.changeType=="remove"&&(t=n.element,t!=null&&(i=document.getElementById(t.name+"_header"),i&&i.parentNode.removeChild(i),r=document.getElementById(t.name+"_content"),r&&r.parentNode.removeChild(r)))},addPaletteItem:function(n,t){for(var u,i,r=0;r<this.model.palettes.length;r++)i=this.model.palettes[r],i.name===n&&(i.items.push(t),u=document.getElementById(n+"_content"),this._renderItem(t,u))},removePaletteItem:function(n,i){for(var r,u,f=0;f<this.model.palettes.length;f++)u=this.model.palettes[f],u.name===n&&(t.datavisualization.Diagram.Util.removeItem(u.items,i),r=document.getElementById(n+"_content"),r.removeChild(r.getElementsByClassName("e-paletteItem e-draggable e-js").item(i.name+"_paletteItem")),this.selectedItem=null)},addPalette:function(n){this.model.palettes.push(n);this._renderPalette(n)},removePalette:function(n){for(var r,u,i,f=0;f<this.model.palettes.length;f++)i=this.model.palettes[f],i.name===n&&(t.datavisualization.Diagram.Util.removeItem(this.model.palettes,i),r=document.getElementById(i.name+"_header"),r&&r.parentNode.removeChild(r),u=document.getElementById(i.name+"_content"),u&&u.parentNode.removeChild(u))},setWidth:function(n){this.model.width=n;this._setWidth(n)},setHeight:function(n){this.model.height=n;this._setHeight(n)},setPaletteItemWidth:function(n){this.model.paletteItemWidth=n;this._redrawContent()},setPaletteItemHeight:function(n){this.model.paletteItemHeight=n;this._redrawContent()},setHeaderHeight:function(n){this.model.headerHeight=n;this._setHeaderHeight(n)},setCssClass:function(n){this._setCssClass(n);this.model.cssClass=n},showPaletteItemText:function(n){this._showItemText(n);this.model.showPaletteItemText=n},searchPalette:function(n,i){var r=new t.datavisualization.Diagram.Collection;return i!=""&&(n=this._getSearchPaletteItems(i),r.add(n)),r},_getSearchPaletteItems:function(n){for(var f=new t.datavisualization.Diagram.Palette,u=this.model.palettes,r,i=0;i<u.length;i++)if(u[i].name.toLocaleLowerCase().search(n.toLocaleLowerCase())>=0)for(r=0;r<u[i].items.length;r++)this.element.find("#"+u[i].items[r].name+"_paletteItem")[0].style.display="block";else for(r=0;r<u[i].items.length;r++)this.element.find("#"+u[i].items[r].name+"_paletteItem")[0].style.display=u[i].items[r].name.toLocaleLowerCase().search(n.toLocaleLowerCase())>=0?"block":"none";return f},_addExpandedClass:function(t,i){i?n(t).addClass("expanded"):n(t).addClass("collapsed")},_collapse:function(t){t.expanded||n(document.getElementById(t.name+"_header")).next(".e-scontent").slideToggle(10)},_transformItem:function(n,i,r,u,f){var c,a;if(!f){var v=30*this.model.paletteItemWidth/100,y=30*this.model.paletteItemHeight/100,e=(this.model.paletteItemWidth-v)/i,o=(this.model.paletteItemHeight-y)/r;e=o=Math.min(e,o);e=e>1?1:e;o=o>1?1:o;var s=this.model.paletteItemWidth/2-i*e/2,h=this.model.paletteItemHeight/2-r*o/2,l="";l+="translate("+s+","+h+")";l+="scale("+e+","+o+")";n.setAttribute("transform",l);c=document.getElementById(n.id+"_svgWrapper_htmlLayer");c.style.webkitTransform="translate("+s+"px,"+h+"px) scale("+e+", "+o+")";c.style.MozTransform="translate("+s+"px,"+h+"px) scale("+e+", "+o+")";c.style.OTransform="translate("+s+"px,"+h+"px) scale("+e+", "+o+")";c.style.msTransform="translate("+s+"px,"+h+"px) scale("+e+", "+o+")";c.style.transform="translate("+s+"px,"+h+"px) scale("+e+", "+o+")"}u&&t.browserInfo().name==="msie"&&u._type=="group"&&u.type==="html"&&(a=document.getElementById(u.name+"_html"),a.setAttribute("style","zoom:"+scale+";"))},_getScaleFactor:function(n,t){var u=30*this.model.paletteItemWidth/100,f=30*this.model.paletteItemHeight/100,i=(this.model.paletteItemWidth-u)/n,r=(this.model.paletteItemHeight-f)/t;return i=i>1?1:i,r=r>1?1:r,Math.min(i,r)},_getTranslateFactor:function(){var n=15/100*this.model.paletteItemWidth,t=15/100*this.model.paletteItemHeight;return Math.min(n,t)},_setWidth:function(n){this.element.css("width",n)},_setHeight:function(n){this.element.css("height",n)},_setHeaderHeight:function(n){this.element.find(".e-header").css("height",n);this.element.find(".e-header-arrow").css("top",(n-16)/2)},_setCssClass:function(n){this.element.removeClass(this.model.cssClass).addClass(n)},_showItemText:function(n){n!==this.model.showPaletteItemText&&(n?this.element.find(".e-text-container").show():this.element.find(".e-text-container").hide())},_redrawContent:function(){for(var u,e,t,r,o,f=this.element.find(".e-scontent"),i=0,s=f.length;i<s;++i)if(u=f[i],n(u).empty(),e=this.model.palettes[i],t=e.items,t&&t.length>0)for(r=0,o=t.length;r<o;r++)this._renderItem(t[r],u)},_getActivePalette:function(n){for(var t,u=n.slice(0,n.lastIndexOf("_")),r=this.model.palettes,i=0,f=r.length;i<f;i++)if(t=r[i],t.name===u&&t!==this.activePalette)return t;return null},_updateHeaderState:function(n){this._clearHeaderSelection();this._updateExpandState(n);this._updateHeaderSelection(n)},_updateExpandState:function(t){n(t).hasClass("expanded")?(n(t).removeClass("expanded").addClass("collapsed"),n(t).find(".e-header-arrow").removeClass("expanded").addClass("collapsed")):(n(t).removeClass("collapsed").addClass("expanded"),n(t).find(".e-header-arrow").removeClass("collapsed").addClass("expanded"))},_updateHeaderSelection:function(t){n(t).hasClass("selected")||(n(t).addClass("selected"),n(t).find(".e-header-arrow").addClass("selected"))},_clearHeaderSelection:function(){this.element.find(".e-header").removeClass("selected");this.element.find(".e-header-arrow").removeClass("selected")},_addItem:function(n,t){var i=document.getElementById(n.name+"_content");this._renderItem(t,i)},_removeItem:function(n,t){var i=document.getElementById(n.name+"_content");i.removeChild(document.getElementById(t.name+"_paletteItem"));t===this._selectedElement&&(this._selectedElement=null)},updateScrollerViewport:function(){var n=this.element.ejScroller("instance");n.model.touchScroll=!1;n.model.width=this._setViewPortWidth();n.model.height=this._setViewPortHeight();this._refresh()},_refresh:function(){this.element.ejScroller("refresh")},_getNodeDimension:function(n){var f=n._width,e=n._height,o=n.width?n.width:n.maxWidth?n.maxWidth:n.minWidth,i=document.createElement("span"),s=0,h=0,r,u;if(n.labels.length){for(t.datavisualization.Diagram.Util.attr(i,{id:n.name+"_label","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(i),u=0;u<n.labels.length;u++)r=n.labels[u],r.bold&&(i.style.fontWeight="bold"),r.italic&&(i.style.fontStyle="italic"),i.style.textDecoration=r.textDecoration,i.style.fontFamily=r.fontFamily,i.style.fontSize=r.fontSize+"px",i.style.color=r.fontColor,i.style.backgroundColor=r.fillColor,i.style.borderColor=r.borderColor,i.style.borderWidth=r.borderWidth,i.textContent=r.text,i.style.wordWrap="break-word",i.style.whiteSpace="pre",o&&(i.style.maxWidth=o-(r.margin.left+r.margin.right)-r.fontSize+"px"),s+=i.offsetWidth+r.margin.left+r.margin.right,h+=i.offsetHeight+r.margin.top+r.margin.bottom;n._width=s;n._height=h;n.minWidth&&(n.minWidth>n._width||!n._width)&&(n._width=n.minWidth);n.maxWidth&&(n.maxWidth<n._width||!n._width)&&(n._width=n.maxWidth);n.minHeight&&(n.minHeight>n._height||!n._height)&&(n._height=n.minHeight);n.maxHeight&&(n.maxHeight<n._height||!n._height)&&(n._height=n.maxHeight);n.width||n.labels[0].horizontalAlignment!="left"||(n.offsetX+=(n._width-f)/2);n.width||n.labels[0].horizontalAlignment!="right"||(n.offsetX-=(n._width-f)/2);n.height||n.labels[0].verticalAlignment!="top"||(n.offsetY+=(n._height-e)/2);n.height||n.labels[0].verticalAlignment!="bottom"||(n.offsetY-=(n._height-e)/2);this.element[0].removeChild(i)}}})}(jQuery,Syncfusion),function(n,t){"use strict";var i,u,f,e,o,s,r,h,c,l,a,v,y,p,w;t.datavisualization.Diagram.extend=function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};i=function(){function i(n,i){this.name=n;this.diagram=i;this.helper=null;this.inAction=!1;this.selectedObject=null;this.startPoint=t.datavisualization.Diagram.Point(0,0);this.currentPoint=t.datavisualization.Diagram.Point(0,0);this.previousPoint=t.datavisualization.Diagram.Point(0,0);this.cursor="default";this._currentPossibleConnection=null;this._previousPossibleConnection=null;this._possibleConnectionPort=null;this.singleAction=!1;this.svgHelper=null;this.single=null;this._centralPoint=t.datavisualization.Diagram.Point(0,0);this._enableAutoNode=null;this._prevTool=null}return i.prototype.abort=function(){this._endAction();t.datavisualization.Diagram.SvgContext.updateSelector(this.diagram.selectionList[0],this.diagram._svg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints);this.diagram._removeTooltip()},i.prototype.keydown=function(n){var t=n.keyCode?n.keyCode:n.which;t===27&&this.inAction?this.abort():this.inAction||t!=27||this.diagram._clearSelection()},i.prototype._updateNextPhases=function(n,i,r){var o=0,s,u,e,f;for(o=n.orientation=="horizontal"?i:r,s=this.diagram._getPhaseIndex(n.name),e=this.diagram.nameTable[n.parent],f=s+1;f<e.phases.length;f++)u=this.diagram.nameTable[e.phases[f]],u&&(u.offset+=o),t.datavisualization.Diagram.SvgContext._updatephase(u,this.diagram)},i.prototype._getphase=function(n){return this.diagram.nameTable[n]},i.prototype._updateSelectedPhase=function(n,i,r){var u,f;typeof n=="string"?(n=this._getphase(n),u=this.diagram.nameTable["phaseStack"+n.name]):u=this.diagram.nameTable["phaseStack"+n.name];u&&(n.orientation=="horizontal"?(u.width+=i,u.offsetX+=i/2,this._updateNextPhases(n,i,0)):(u.height+=r,u.offsetY+=r/2,this._updateNextPhases(n,0,r)),f=this.diagram.nameTable[n.parent+"phaseStack"],f&&t.datavisualization.Diagram.SvgContext._alignOnStackContainer(f,this.diagram))},i.prototype._getLastPhase=function(n){if(n.children[1])var t=this.diagram.nameTable[this.diagram._getChild(n.children[1])];if(t&&t.children&&t.children.length>0)return this.diagram.nameTable[t.children[t.children.length-1]]},i.prototype._containChil=function(n,t){for(var i=0;i<t.length;i++)if(t[i]==n.name)return!0},i.prototype._containsSwimlane=function(n){var i,t;for(i in n)if(t=this.diagram.nameTable[n[i]],t.isSwimlane||t.isLane)return!0;return!1},i.prototype._raiseEndPointDrag=function(n,t,i){if(n||t){var r,u,f,e;return u=this._currentPossibleConnection?this._currentPossibleConnection:null,f=this._possibleConnectionPort?this._possibleConnectionPort:null,e=this.currentPoint,r=n?"Target":"Source",this._raiseEvent("connector"+r+"Change",{node:u,port:f,point:e,dragState:i,cancel:!1})}},i.prototype._decideSelectedItem=function(n,t,i){var r=null,u;if(t)t.parent?this.diagram.selectionList&&this.diagram.selectionList[0]&&t.parent==this.diagram.selectionList[0].name&&!i?(r=t,this.diagram.selectionList[0].type=="bpmn"&&(r=this.diagram.selectionList[0])):i&&this.diagram.selectionList[0]&&this.diagram.selectionList[0].name==t.name?r=t:(u=this.diagram.nameTable[t.parent],r=this._decideSelectedItem(n,u,i),this.diagram.selectionList&&this.diagram.selectionList[0]&&r&&this.diagram.selectionList[0].name==r.name&&!i&&(r=t)):r=t;else return null;return r},i.prototype._removeHighLighter=function(){t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._svg,this.diagram._adornerLayer)},i.prototype._nodeHighLighter=function(n){var f=null,r=null,u=null,i,e;n&&this.selectedObject.parent?(i=this.diagram.nameTable[this.selectedObject.parent],i.container&&i.container.type=="stack"&&this.selectedObject.name!=n.name?t.datavisualization.Diagram.SvgContext._drawStackHighlighter(n,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,i.container.orientation==="vertical"?!0:!1):i.container&&i.container.type=="canvas"&&this.selectedObject.parent!=n.name?t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom):this._removeHighLighter()):n&&n.container&&!n.isSwimlane?this.selectedObject.isLane?(i=this.diagram.nameTable[n.parent],n.name.indexOf("phaseStack")===-1&&t.datavisualization.Diagram.SvgContext._drawStackHighlighter(n,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,i.container.orientation==="vertical"?!0:!1)):t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom):this._removeHighLighter();this._nodeToHit&&n&&n.name!=this._nodeToHit.name&&(r=t.datavisualization.Diagram.Util.bounds(this._nodeToHit),u=this._getTargetNode(this._nodeToHit,r),this._raiseEvent("mouseLeave",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(this._nodeToHit),target:this.diagram.getNode(u)}));n?(this._nodeToHit&&this._nodeToHit.name!==n.name||!this._nodeToHit)&&(this._nodeToHit=n,this.selectedObject.parent&&(f=this.diagram.nameTable[this.selectedObject.parent]),this.selectedObject.type=="pseudoGroup"&&(e=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],e&&e.parent&&(f=this.diagram.nameTable[e.parent])),r=t.datavisualization.Diagram.Util.bounds(n),u=this._getTargetNode(n,r),this._raiseEvent("mouseEnter",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(f),target:this.diagram.getNode(u)})):this._nodeToHit=null;n&&(this.selectedObject.parent&&(f=this.diagram.nameTable[this.selectedObject.parent]),r=t.datavisualization.Diagram.Util.bounds(n),u=this._getTargetNode(n,r),this._raiseEvent("mouseOver",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(f),target:this.diagram.getNode(u)}))},i.prototype._doubleClick=function(n){var t,i;n&&n.parent&&(t=this.diagram.nameTable[n.parent],t&&(i=n.name,this.diagram.updateSelectedObject(i),this.diagram._clearSelection(),this.diagram.addSelection(n)))},i.prototype._itemClick=function(n,t){var r,i;t&&t.parent?(r=this.diagram.nameTable[t.parent],r&&r.container&&t&&!this.diagram._selectedSymbol&&(i=t.name,i.indexOf("_header_swimlane")!=-1?n&&this.diagram.updateSelectedObject(n.parent):i.indexOf("_Headerr_")!=-1?this.diagram.updateSelectedObject(t.parent):t&&t.isPhase?i.indexOf("phaseStack")!=-1&&(this.diagram._clearSelection(),this.diagram.addSelection(this.diagram.nameTable[i.split("phaseStack")[1]]),this.selectedObject=null):this.diagram.updateSelectedObject(i))):t&&this.diagram.updateSelectedObject(t.name);n&&(n.type=="pseudoGroup"||n.name=="multipleSelection")&&!this._containsChild(n,t.name)&&this.diagram.updateSelectedObject(n.name)},i.prototype._getTargetNode=function(n,i){for(var e,o,u,s,h=null,f=[],c=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,i),r=0;r<c.length;r++)if(e=c[r],e.objects.length>0)for(o=0;o<e.objects.length;o++)u=e.objects[o],!u.segments&&u.visible&&(h=t.datavisualization.Diagram.Util.bounds(u),f.indexOf(u)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(i,h)&&f.push(u));for(s=[],s.push(n),r=0;r<f.length;r++)f[r].name!=n.name&&s.push(f[r]);return s},i.prototype._updateMargin=function(n,i){var o,s,u;if(n.type=="pseudoGroup")for(o=null,s=this.diagram._getChildren(n.children),u=0;u<s.length;u++)o=this.diagram.nameTable[s[u]],this._updateMargin(o,i);else if(i&&i.container&&i.container.type=="canvas"){var f=t.datavisualization.Diagram.Util.bounds(i),e=t.datavisualization.Diagram.Util.bounds(n),r=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);n.marginLeft=r.x-(f.x+i.paddingLeft);n.marginRight=f.x+i.width-(r.x+r.width)-i.paddingRight;n.marginTop=r.y-(f.y+i.paddingTop);n.marginBottom=f.bottom-(r.y+r.height)-i.paddingBottom}},i.prototype._getNodeUnderMouse=function(t){var i,r=null,e=null,u=n(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),f;return u&&(i=u.attr("class"),i==="ej-d-node"||i==="ej-d-group"?r=this.diagram._findNode(u.attr("id")):i==="ej-d-connector"&&(r=this.diagram._findConnector(u.attr("id")))),r&&(i=this.diagram.getObjectType(r),i==="group"?e=r:r.parent&&(f=this.diagram.nameTable[r.parent],i=this.diagram.getObjectType(f),f&&i!="node"&&(e=f))),e},i.prototype._isChange=function(n,t){var i=null;return n._type==="group"||n.type==="pseudoGroup"||t._type==="group"||t.type==="pseudoGroup"?(n._type!=="group"&&n.type!=="pseudoGroup"||t._type==="group"||t.type==="pseudoGroup"||(i=!this._containsChild(n,t.name)),n._type==="group"||n.type==="pseudoGroup"||t._type!=="group"&&t.type!=="pseudoGroup"?(n._type==="group"||n.type==="pseudoGroup")&&(t._type==="group"||t.type==="pseudoGroup")&&n.name==t.name&&(i=!0):i=!this._containsChild(t,n.name)):n.name==t.name&&(i=!0),i},i.prototype._containsChild=function(n,t){var u=!0,i=null,f,r;if(n.children)for(f=this.diagram._getChildren(n.children),r=0;r<f.length;r++)i=this.diagram.nameTable[f[r]],i._type==="group"?u=this._containsChild(i,t):i.name==t&&(u=!1);return u},i.prototype._findNodeUnderMouse=function(t,i){var r=null,u=null,e,o=n(t.target),f=n(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group");return f&&f.context.localName!="div"&&(e=f.attr("class"),e==="ej-d-node"||e==="ej-d-group"?u=this.diagram._findNode(f.attr("id")):e==="ej-d-connector"&&(u=this.diagram._findConnector(f.attr("id")))),r=u&&!u.parent?u:this._decideSelectedItem(t,u,i),this.prevSelectObject=r,i&&this.diagram.selectionList[0]&&(r&&r._type==="group"&&!this._containsChild(r,this.diagram.selectionList[0].name)?r=r:r&&this.diagram.selectionList[0].name!=r.name&&this._isChange(this.diagram.selectionList[0],r)?r=this.diagram.selectionList[0]:u&&u.name==this.diagram.selectionList[0].name&&!this._isChange(this.diagram.selectionList[0],r)&&(r=this.diagram.selectionList[0])),this.actualObject=u,r},i.prototype._findLabelUnderMouse=function(t){var i,o=n(t.target),s=o[0].getAttribute("class"),u,e,r,f;return s=="ej-d-label"&&(u=n(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),u&&(e=u[0].getAttribute("id"),r=u[0].getAttribute("class"),r&&(r==="ej-d-node"||r==="ej-d-group"?(i=this.diagram._findNode(e),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f):r==="ej-d-connector"&&(i=this.diagram._findConnector(e),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f)))),i},i.prototype._selectionContainsChild=function(n){var i,t,r,u,f;if(this.diagram.selectionList[0].children){for(i=this.diagram._getChildren(this.diagram.selectionList[0].children),t=null,r=0;r<i.length;r++)if(t=this.diagram.nameTable[i[r]],t&&t.name==n)return!0}else if(this.diagram.selectionList[0]._type==="group"&&this.diagram.selectionList[0].type!="pseudoGroup"){if(this.diagram.selectionList[0].name==n)return!0}else if(this.diagram.nameTable[n]&&this.diagram.nameTable[n]._type==="group"){for(i=this.diagram._getChildren(this.diagram.nameTable[n].children),u=0;u<i.length;u++)if(t=this.diagram.nameTable[i[u]],t&&(f=this._selectionContainsChild(t.name)),f)return f}else if(this.diagram.selectionList[0].name==n)return!0;return!1},i.prototype._isSelected=function(n){var u=null,i=this.diagram.nameTable[n],r,t;if(this._selectionContainsChild(i.name))return!0;if(i._type==="group")for(r=this.diagram._getChildren(i.children),t=0;t<r.length;t++)if(u=r[t],this._selectionContainsChild(u))return!0;return!1},i.prototype._isColleagueSelected=function(n){var u=this.diagram.nameTable[n],f=null,i,r,t;if(u.parent&&(i=this.diagram.nameTable[u.parent],i))for(r=this.diagram._getChildren(i.children),t=0;t<r.length;t++)if(f=r[t],this._isSelected(f))return!0;return!1},i.prototype._isInSelection=function(n){var i,r,t;if(this.diagram.selectionList[0].type=="pseudoGroup"&&this.diagram.selectionList[0].children)for(i=this.diagram._getChildren(this.diagram.selectionList[0].children),r=null,t=0;t<i.length;t++)if(r=this.diagram.nameTable[i[t]],r.name==n)return!0},i.prototype._getCloneNode=function(n){var t=null;return t=jQuery.extend(!0,{},n),t.children=[],t.minHeight=0,t.minWidth=0,t.maxHeight=0,t.maxWidth=0,t},i.prototype._getProcessedObject=function(n){var t=this.diagram.nameTable[n],i;if(t){if(this._isInSelection(n))return null;if(this._selectionContainsChild(t.name))return{add:t,remove:null};if(t.parent)if(this._selectionContainsChild(t.parent)){if(this._isInSelection(t.parent))return{add:t,remove:this.diagram.nameTable[t.parent]};if(i=this.diagram.nameTable[t.parent],i)return{add:i,remove:this.diagram.nameTable[i.parent]}}else return this._isColleagueSelected(t.parent)&&!this._selectionContainsChild(t.parent)?this._isSelected(t.parent)?{add:t,remove:null}:{add:this.diagram.nameTable[t.parent],remove:null}:this.diagram.selectionList[0]&&this._isInSelection(t.parent)?{add:this.diagram.nameTable[t.name],remove:this.diagram.nameTable[t.parent]}:this._getProcessedObject(t.parent);else return{add:t,remove:null}}},i.prototype._measureStackBounds=function(n){for(var f=null,r,i=null,e=this.diagram._getChildren(n.children),u=0;u<e.length;u++)f=this.diagram.nameTable[e[u]],r=t.datavisualization.Diagram.Util.bounds(f),r&&(i=i?this.diagram._union(r,i):r);return i.width+=n.paddingLeft+n.paddingRight,i.height+=n.paddingTop+n.paddingBottom,i},i.prototype.hasSameParent=function(){var n,t,u,r,i;if(this.selectedObject.type=="pseudoGroup"){if(n=this.selectedObject,t=null,this.diagram.nameTable[this.diagram._getChild(n.children[0])])for(u=this.diagram.nameTable[this.diagram._getChild(n.children[0])].parent,r=this.diagram._getChildren(n.children),i=0;i<r.length;i++)if(t=this.diagram.nameTable[r[i]],t.parent!=u||t.parent=="")return!1;return!0}return!1},i.prototype._fromDiagram=function(n){for(var r=!0,t=null,i=0;i<n.length;i++)if(t=this.diagram.nameTable[this.diagram._getChild(n[i])],t&&t.parent){r=!1;break}return r},i.prototype._fromContainer=function(n){for(var t=null,i=null,r=0;r<n.length;r++)if(t=this.diagram.nameTable[this.diagram._getChild(n[r])],t.parent&&(i=this.diagram.nameTable[t.parent],i&&i.container))return!0},i.prototype._fromSameContainer=function(n){for(var t=null,i=null,r=0;r<n.length;r++)if(t=this.diagram.nameTable[this.diagram._getChild(n[r])],!i&&t.parent&&(i=t.parent),t.parent&&t.parent!=i)return!1;return!0},i.prototype._processCtrlKey=function(n){var o,e,s,i,f,c,u,r;if(this.diagram.selectionList.length>0){e=this.diagram.selectionList;e[0].type=="pseudoGroup"?(s=!0,o=this._findNodeUnderMouse(n)):o=this._findNodeUnderMouse(n);var h=this._findNodeUnderMouse(n,!0),l=this.selectedObject,a=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:h,cancel:!1});this._itemClick(this.selectedObject,this.actualObject,h);a.cancel&&(this.selectedObject=l);this.actualObject&&(this.actualObject.parent?s?(i=e[0],f=this._getProcessedObject(this.actualObject.name),f?(this.selectedObject?(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,this.selectedObject.name)):f.remove&&(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,f.remove.name)),this.selectedObject?this._hasMultipleSelection(this.selectedObject)||i.children.push(this.selectedObject.name):f.add&&(this._hasMultipleSelection(f.add)||i.children.push(f.add.name))):(u=this.actualObject,this.selectedObject?this._hasMultipleSelection(this.selectedObject)?(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,this.selectedObject.name)):i.children.push(this.selectedObject.name):this._hasMultipleSelection(u)?(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,u.name)):i.children.push(u.name)),t.datavisualization.Diagram.Util._updateGroupBounds(i,this.diagram),i.children.length<=1?(c=this.diagram.nameTable[this.diagram._getChild(i.children[0])],this.diagram._hasSelection()&&this.diagram._clearSelection(),this.selectedObject=c,this.diagram._addSelection(this.selectedObject)):(this.selectedObject=e[0],t.datavisualization.Diagram.SvgContext.updateSelector(this.selectedObject,this.diagram._svg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints))):this.diagram.selectionList[0]._type==="group"?(e=this.diagram.selectionList[0],f=this._getProcessedObject(this.actualObject.name),u=f.add,f&&this.diagram._hasSelection()&&this.diagram._clearSelection()):(f=null,o._type==="group"&&(f=this._getProcessedObject(this.actualObject.name)),u=f?f.add:o,e=this.diagram.selectionList[0],this.diagram._hasSelection()&&this.diagram._clearSelection(),r=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),e.name!=u.name&&r.children.push(e.name),this.selectedObject?r.children.push(this.selectedObject.name):this._containsChild(r,u.name)&&r.children.push(u.name),this._checkRepeatedChild(r.children),this.diagram.nodes().push(r),this.diagram.nameTable[r.name]=r,t.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram),this.selectedObject=r,this.diagram._addSelection(this.selectedObject)):s?(i=e[0],u=this.actualObject,this.selectedObject?this._hasMultipleSelection(this.selectedObject)?(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,this.selectedObject.name)):i.children.push(this.selectedObject.name):this._hasMultipleSelection(u)?(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,u.name)):i.children.push(u.name),t.datavisualization.Diagram.Util._updateGroupBounds(i,this.diagram),this.selectedObject=e[0],t.datavisualization.Diagram.SvgContext.updateSelector(this.selectedObject,this.diagram._svg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints)):(u=this.actualObject,e=this.diagram.selectionList[0],u!=e&&(this.diagram._hasSelection()&&this.diagram._clearSelection(),r=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),r.children.push(e.name),this.selectedObject?r.children.push(this.selectedObject.name):r.children.push(u.name),this.diagram.nodes().push(r),this.diagram.nameTable[r.name]=r,t.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram),this.selectedObject=r,this.diagram._addSelection(this.selectedObject))));this.selectedObject=this.diagram.selectionList[0]}else o=this._findNodeUnderMouse(n),this.selectedObject=o;return o},i.prototype._checkRepeatedChild=function(i){for(var e=null,r=n.extend(!0,{},i),u,r=this.diagram._getChildren(r),f=0;f<r.length;f++)if(e=this.diagram.nameTable[r.children[f]],e._type==="group")for(u=0;u<r.children.length;u++)this._containsChild(e,r.children[u])||(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,r.children[u]))},i.prototype._hasMultipleSelection=function(n){for(var i=this.diagram._getChildren(this.diagram.selectionList[0].children),t=0;t<i.length;t++)if(n.name==i[t])return!0;return!1},i.prototype._getNextParent=function(n){if(n.parent){var t=this.diagram.nameTable[n.parent];return this._hasMultipleSelection(t)?n:this._getNextParent(t)}return n},i.prototype._hasMultipleSelection=function(n){for(var i=this.diagram._getChildren(this.diagram.selectionList[0].children),t=0;t<i.length;t++)if(n.name==i[t])return!0;return!1},i.prototype._getNextParent=function(n){if(n.parent){var t=this.diagram.nameTable[n.parent];return this._hasMultipleSelection(t)?n:this._getNextParent(t)}return n},i.prototype._findObj=function(n,t){var r,u=n.getAttribute("id"),i;return t?r=this.diagram._findChildren(t,u):(i=n.getAttribute("class"),i&&(i==="ej-d-node"||i==="ej-d-group"?r=this.diagram._findNode(u):i==="ej-d-connector"&&(r=this.diagram._findConnector(u)))),r},i.prototype.mousedown=function(n){this.startPoint=this.mousePosition(n);this.currentPoint=this.mousePosition(n);this.previousPoint=this.startPoint},i.prototype.mousemove=function(n){(!t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this instanceof t.datavisualization.Diagram.LineTool)&&(this.currentPoint=this.mousePosition(n))},i.prototype.mouseup=function(){this._endAction();this.diagram._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(this.diagram);this.singleAction&&this.diagram.activateTool("select")},i.prototype.mousePosition=function(n){return this.diagram._mousePosition(n)},i.prototype.updateCursor=function(n){this.diagram._currentCursor=n;this.diagram._updateCursor()},i.prototype.nearestGridPoint=function(n){var i=t.datavisualization.Diagram.Point();if(this.diagram.model.snap&t.datavisualization.Diagram.Snap.Grid){var o=this.diagram.model.magnification/100,r=this.diagram.model.grid.horizontalSpacing*o,u=this.diagram.model.grid.verticalSpacing*o,f=n.x%r,e=n.y%u;i.x=f>=r/2?n.x+r-f:n.x-f;i.y=e>=u/2?n.y+u-e:n.y-e}return i},i.prototype.snap=function(n){var i=this.diagram.model.snapSettings,r=this.diagram._currZoom;return i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines&&(n.x=t.datavisualization.Diagram.SnapUtil._round(n.x,i.verticalGridLines.snapInterval,r)),i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines&&(n.y=t.datavisualization.Diagram.SnapUtil._round(n.y,i.horizontalGridLines.snapInterval,r)),n},i.prototype._endAction=function(){var i,r,s,u,h,f,o,c,e;if(this.inAction=!1,this.svgHelper)if(i=this.helper,r=this.diagram._spatialSearch,i._type!="group")t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(r,r.quadTable[i.name],i);else for(s=this.helper.children.length-1,u=s;u>=0;u--)t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(r,r.quadTable[i.children[u].name],i.children[u]);this.helper&&(this.svgHelper&&(h=this.diagram,f=this,this.diagram._views.forEach(function(t){var r=h._views[t];if(f.helper)var i=r.svg.getElementById(f.helper.name),u=r.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],e=n(u).find("#"+f.helper.name)[0];i&&i.parentNode&&i.parentNode.removeChild(i);e&&u.removeChild(e)})),this.helper.gradient&&(o=this.diagram._svg.getElementsByTagName("defs")[0],c=this.diagram._svg.getElementById(this.helper.name+"_gradient"),o&&c&&o.removeChild(this.diagram._svg.getElementById(this.helper.name+"_gradient"))),e=document.getElementById(this.helper.name+"_parentdiv"),e&&e.parentNode.removeChild(e));this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._svg,this.diagram._adornerLayer));this._currentPossibleConnection=null;this._possibleConnectionPort=null;this.helper=null;this.svgHelper=null;this.selectedObject=null;this.startPoint=t.datavisualization.Diagram.Point(0,0);this.currentPoint=t.datavisualization.Diagram.Point(0,0);this.previousPoint=t.datavisualization.Diagram.Point(0,0)},i.prototype._isResizeCorner=function(n){var t=!1;switch(n){case"n-resize":case"e-resize":case"w-resize":case"s-resize":case"ne-resize":case"nw-resize":case"se-resize":case"sw-resize":case"targetEndPoint":case"sourceEndPoint":t=!0}return t},i.prototype._initHelper=function(){this.selectedObject&&(this.helper=n.extend(!0,{},this.selectedObject),this._updateHelperName(this.helper))},i.prototype._updateHelperName=function(n,t){var u,i,r,f,e;for(t?n.name+="helper":n.name="helper",n.opacity=.5,u=n.labels,i=0,r=u.length;i<r;++i)u[i].name+="helper";if(n.ports)for(f=n.ports,i=0,r=f.length;i<r;++i)f[i].name+="helper";if(n._type==="group")for(e=this.diagram._getChildren(n.children),i=0,r=e.length;i<r;i++)this._updateHelperName(e[i],!0)},i.prototype._raiseEvent=function(n,t){return t.elementType=this.diagram.getObjectType(t.element),this.diagram._trigger(n,t),t},i.prototype._findPort=function(n,t){var f=this.diagram._findPortAtPoint(n,t),r,e,u,i;if(!f&&t._type==="group")for(e=this.diagram._getChildren(t.children),u=0;u<e.length;u++)if(i=this.diagram.nameTable[e[u]],i&&!i.segments)if(r=this._findPort(n,i),r&&i._type!="group")this._currentPossibleConnection=i,f=r;else if(r)return r;return f},i.prototype._checkConnectionPossible=function(n){var i=null,p=t.datavisualization.Diagram.Point(this.currentPoint.x,this.currentPoint.y),r=this.diagram._findConnectableNodeUnderMouse(n),u,c,l,e,o,s,f,v;if(r&&!r.segments)r.type=="pseudoGroup"||r.isLane||r.isSwimlane?(this._currentPossibleConnection=null,this._possibleConnectionPort=null):(this._showPorts(r),this._currentPossibleConnection=r,(this._previousPossibleConnection==null||this._previousPossibleConnection.name!==this._currentPossibleConnection.name)&&(this._previousPossibleConnection=this._currentPossibleConnection));else if(this.diagram.activeTool instanceof t.datavisualization.Diagram.LineTool)this._showPorts(),this._currentPossibleConnection=null,this._possibleConnectionPort=null;else{for(u=t.datavisualization.Diagram.Point(0,0),this._endPoint=="targetEndPoint"?(u.x=this.selectedObject.targetPoint.x-25,u.y=this.selectedObject.targetPoint.y-25):this._endPoint=="sourceEndPoint"&&(u.x=this.selectedObject.sourcePoint.x-25,u.y=this.selectedObject.sourcePoint.y-25),c=t.datavisualization.Diagram.Rectangle(u.x,u.y,50,50),l=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,c),e=0;e<l.length;e++)if(o=l[e],o.objects.length>0)for(s=0;s<o.objects.length;s++)f=o.objects[s],v=t.datavisualization.Diagram.Util.bounds(f),t.datavisualization.Diagram.Geometry.intersectsRect(c,v)?!f.segments&&f.visible&&this._showPort(f):f.segments||this._showPort(f,!0);this._currentPossibleConnection=null;this._possibleConnectionPort=null}if(this._currentPossibleConnection){if(i=this._findPort(p,this._currentPossibleConnection),i&&t.datavisualization.Diagram.Util.canConnect(i,!0)||t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)?t.datavisualization.Diagram.SvgContext._drawPortHighlighter(i,this._currentPossibleConnection,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom):t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._svg,this.diagram._adornerLayer),this._possibleConnectionPort=i,i&&t.datavisualization.Diagram.Util.canConnect(i,!0)){var h=this._currentPossibleConnection,a=t.datavisualization.Diagram.Util._getPortPosition(this._possibleConnectionPort,t.datavisualization.Diagram.Util.bounds(h,!0)),y=t.Matrix.identity();t.Matrix.rotate(y,h.rotateAngle,h.offsetX,h.offsetY);a=t.Matrix.transform(y,a);this.currentPoint=a}}else this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._svg,this.diagram._adornerLayer),this._possibleConnectionPort=null)},i.prototype._showPorts=function(n){n?(this._currentPossibleConnection&&this._currentPossibleConnection.name!==n.name&&this._showPort(this._currentPossibleConnection,!0),this._showPort(n)):this._currentPossibleConnection!=null&&this._showPort(this._currentPossibleConnection,!0)},i.prototype._showPort=function(n,i){var f,r,e,u,o;if(i)for(f=n.ports,u=0,o=f.length;u<o;++u)r=f[u],(r.visibility&t.datavisualization.Diagram.PortVisibility.Hover||r.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&(this.name=="endPoint"||this instanceof t.datavisualization.Diagram.LineTool))&&(e=this.diagram._svg.getElementById(n.name+"_"+r.name),e&&e.setAttribute("visibility","hidden"));else if(n.visible)for(f=n.ports,u=0,o=f.length;u<o;++u)r=f[u],(r.visibility&t.datavisualization.Diagram.PortVisibility.Hover||r.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&(this.name=="endPoint"&&this.inAction||this instanceof t.datavisualization.Diagram.LineTool))&&(e=this.diagram._svg.getElementById(n.name+"_"+r.name),e&&e.setAttribute("visibility","visible"))},i.prototype._showAllPorts=function(n){var i,r,u=this.diagram.nodes();if(t.datavisualization.Diagram.Util.isPageEditable(this.diagram)||(n=!0),n)for(i=0,r=u.length;i<r;i++)this._showPort(u[i],n);else for(i=0,r=u.length;i<r;++i)this._showPort(u[i])},i.prototype._disconnect=function(n){var r,i=this.diagram.nameTable[n.targetNode],u=null;i&&(u=t.datavisualization.Diagram.Util.findPortByName(i,n.targetPort),r=this._raiseEvent("connectionChange",{element:n,connection:i,port:u,cancel:!1}),r.cancel||(t.datavisualization.Diagram.Util.removeItem(i.inEdges,n.name),n.targetNode=null,n.targetPort=null));i=this.diagram.nameTable[n.sourceNode];i&&(u=t.datavisualization.Diagram.Util.findPortByName(i,n.sourcePort),r=this._raiseEvent("connectionChange",{element:n,connection:i,port:u,cancel:!1}),r.cancel||(t.datavisualization.Diagram.Util.removeItem(i.outEdges,n.name),n.sourceNode=null,n.sourcePort=null))},i.prototype.getLabelUnderMouse=function(){return this.activeLabel},i}();t.datavisualization.Diagram.ToolBase=i;u=function(n){function i(t){n.call(this,"select",t);this.cursor="default";this._svgHelper=null}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){n.prototype.mousedown.call(this,t);var i=this._findNodeUnderMouse(t);i&&(this.selectedObject=i)},i.prototype.mousemove=function(i){n.prototype.mousemove.call(this,i);t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y?this._updateHelper():(this.inAction=!0,this._initHelper()))},i.prototype.mouseup=function(i){var h,u,c,r,f,v,e,y,o,a,s,l;if(this.inAction)if(this.currentPoint=this.mousePosition(i),h=t.datavisualization.Diagram.Geometry.rect([{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPoint.x,y:this.currentPoint.y}]),h.width!==0||h.height!==0){for(f=[],v=this.diagram.nodes(),u=0,c=v.length;u<c;u++)e=this.diagram.nameTable[v[u].name],e&&e.visible&&(r=t.datavisualization.Diagram.Util.bounds(e),r=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),t.datavisualization.Diagram.Util.canSelect(e)&&(t.datavisualization.Diagram.Geometry.containsRect(h,r)?e.parent===""&&f.push(e):e._type==="group"&&this._checkGroupChildren(f,e,h)));for(y=this.diagram.connectors(),u=0,c=y.length;u<c;u++)o=this.diagram.nameTable[y[u].name],o&&o.visible&&(r=t.datavisualization.Diagram.Util.bounds(o),r=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),t.datavisualization.Diagram.Util.canSelect(o)&&t.datavisualization.Diagram.Geometry.containsRect(h,r)&&o.parent===""&&f.push(o));if(this.diagram._hasSelection()&&(f=this.diagram._getChildren(f),t.datavisualization.Diagram.Util.removeItem(f,"multipleSelection"),this.diagram._clearSelection()),f.length>0){if(a=f,a.length>1){for(l=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),u=0,c=a.length;u<c;u++)l.children.push(this.diagram._getChild(a[u]));this.diagram.nodes().push(l);this.diagram.nameTable[l.name]=l;s=l}else t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(s=f[0]);s&&((s._type==="group"||s.type==="pseudoGroup")&&t.datavisualization.Diagram.Util._updateGroupBounds(s,this.diagram),this.diagram._addSelection(s))}}else this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();else this.selectedObject||this.diagram._hasSelection()?(i.ctrlKey||i.shiftKey?t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)||this._processCtrlKey(i):this.diagram._hasSelection()&&this.diagram._clearSelection(),this.diagram._addSelection(this.selectedObject)):this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();this.diagram._isDropped=!1;this.selectedObject&&this._raiseEvent("click",{element:this.diagram.getNode(this.selectedObject)});n.prototype.mouseup.call(this,i)},i.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this.selectedObject=null,this._svgHelper=null);n.prototype._endAction.apply(this)},i.prototype._initHelper=function(){var n,t,i;this._svgHelper||(n=this.diagram._svg.g(),this.diagram._adornerLayer.appendChild(n),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),n.appendChild(i),n.setAttribute("pointer-events","none"),this._svgHelper=n)},i.prototype._updateHelper=function(){var t=this.diagram._svg.getElementById("helper"),i=Math.abs(this.startPoint.x-this.currentPoint.x),r=Math.abs(this.startPoint.y-this.currentPoint.y),n=this.diagram._currZoom,u=(this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x)*n,f=(this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y)*n;t&&this.diagram._svg.rect({id:t.id,x:u,y:f,width:i*n,height:r*n})},i.prototype._checkGroupChildren=function(n,i,r){for(var u,e,o=this.diagram._getChildren(i.children),f=0;f<o.length;f++)u=this.diagram.nameTable[o[f]],u&&(e=t.datavisualization.Diagram.Util.bounds(u),t.datavisualization.Diagram.Geometry.containsRect(r,e)?n.push(u):u._type==="group"&&this._checkGroupChildren(n,u,r))},i}(i);t.datavisualization.Diagram.SelectTool=u;f=function(i){function r(n){i.call(this,"move",n);this.cursor="move";this._isMouseDown=!1;this.diffx=0;this.diffy=0;this.helper=null;this.hoverNode=null;this.stackOverNode=null;this.undoObject=[];this.activeLabel=null;this._canMoveLabel=!1}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);this.diffx=0;this.diffy=0;this._allowPan(this.selectedObject,"mousedown",n);i.prototype.mousedown.call(this,n);this._isMouseDown=!0;this._canMoveLabel=!1;this.activeLabel=null;this.diagram._currentCursor!="pointer"&&this.updateCursor(this.cursor);this._findLabelUnderMouse(n)},r.prototype._containsChild=function(n,t){for(var e,r=!0,i=null,f=this.diagram._getChildren(n.children),u=0;u<f.length;u++)i=this.diagram.nameTable[f[u]],i&&(e=this.diagram.getObjectType(i),e==="group"?r=this._containsChild(i,t):i.name==t&&(r=!1));return r},r.prototype._nodeCanHighlight=function(n){var t=!1;return this.diagram._getChildren(n.children).indexOf(this.selectedObject.name)==-1&&(this.selectedObject._type!="group"?t=!0:n._type==="group"&&(this._containsChild(this.selectedObject,n.name)||(t=!0))),t},r.prototype._swimlanPhaseDrag=function(n){if(this.selectedObject&&this.selectedObject.isPhase){var i=null,r=this._findNodeUnderMouse(n);r&&(i=this._getSwimLaneNode(r,this.selectedObject,!0));i&&t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(i,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom)}},r.prototype._containerMouseMove=function(n){var u,f,i,r,e;this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container?(u=this.diagram.nameTable[this.selectedObject.parent].container,this.helper?(this._updateHelperXY(this.helper,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.SvgContext._updateContainerHelper(this.diagram)):(t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),this.helper=this._getCloneNode(this.selectedObject),this.helper.name="helper",this.startPoint=this.currentPoint,f=t.datavisualization.Diagram.Util.bounds(this.helper),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram)),u.type=="canvas"?(i=this._getNodeUnderMouse(n),i&&!i.segments&&i._type==="group"?(i.container&&i.container.type!="stack"&&this._nodeHighLighter(i),this.hoverNode=i):(this._removeHighLighter(),this.hoverNode=null)):u.type=="stack"&&(r=this._findStackOverNode(this.helper,n),r?(this._nodeHighLighter(r),this.stackOverNode=r):(this._removeHighLighter(),this.stackOverNode=null))):(this.selectedObject.isSwimlane||(this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()?(this.helper?(f=t.datavisualization.Diagram.Util.bounds(this.helper),this._updateHelperXY(this.helper,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.SvgContext._updateContainerHelper(this.diagram)):(this.helper=this._getCloneNode(this.selectedObject),this.helper.name="helper",this.helper.children=[],this.startPoint=this.currentPoint,t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram)),t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),i=this._getNodeUnderMouse(n),e=!0,i&&!i.segments?(i.container&&i.container.type!="stack"&&this._nodeHighLighter(i),this.hoverNode=i):(this._removeHighLighter(),this.hoverNode=null),this._nodeHighLighter(i)):this.isDiagram(n)||this.selectedObject.segments?!this.isDiagram(n)&&this.selectedObject.isPhase?t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram):this._removeHighLighter():(i=this._getNodeUnderMouse(n),t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),i&&i.container&&(this.selectedObject.isSwimlane||this.selectedObject.isLane)?this._getSwimLaneNode(i,this.selectedObject)&&this._nodeHighLighter(i):i&&i.container&&i.container.type!="stack"&&this.selectedObject.name!=i.name&&this.selectedObject.type!="pseudoGroup"&&this._nodeHighLighter(i),this.hoverNode=i,this.hoverNode&&(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this._fromDiagram(this.selectedObject.children)&&this._nodeHighLighter(this.hoverNode))),e||(this.selectedObject.type=="pseudoGroup"?this._fromDiagram(this.diagram._getChildren(this.selectedObject.children))?this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint):this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&this.hasSameParent()&&this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint):this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)));this._swimlanPhaseDrag(n)},r.prototype.mousemove=function(r){var u,f,e,l,o,a,s,v,c,h,y;if(this._allowPan(this.selectedObject,"mousemove",r),i.prototype.mousemove.call(this,r),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this._isMouseDown&&!this.inAction&&(this.selectedObject||(u=this._findNodeUnderMouse(r,!0),this.diagram._selectedSymbol&&(u=this.diagram.selectionList[0]),u&&(t.datavisualization.Diagram.Util.canMoveLabel(u)&&this.activeLabel?this._canMoveLabel=!0:(this._disableLabel(this.activeLabel?u:this.diagram.selectionList[0],this.activeLabel),this._canMoveLabel=!1),this.diagram.selectionList[0]&&this.diagram.selectionList[0].type=="pseudoGroup"?(this._canMoveLabel?(this.selectedObject=u,this.diagram._clearSelection()):this.selectedObject=this.diagram.selectionList[0],f=this.selectedObject,e=this._raiseEvent("itemClick",{actualObject:this.actualObject,selectedObject:this.selectedObject,model:this.diagram.model,cancel:!1}),this._itemClick(this.selectedObject,this.actualObject,this.diagram.model),e.cancel&&(this.selectedObject=f),this.diagram.selectionList[0]!=this.selectedObject&&this.diagram._clearSelection()):(this.diagram.selectionList[0]!=u?(this.diagram._clearSelection(),this.selectedObject=this.diagram.nameTable[u.name]):this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name],f=this.selectedObject,e=this._raiseEvent("itemClick",{actualObject:this.actualObject,selectedObject:this.selectedObject,model:this.diagram.model,cancel:!1}),this._itemClick(this.selectedObject,this.actualObject,this.diagram.model),e.cancel&&(this.selectedObject=f),this.diagram.selectionList[0]!=this.selectedObject&&this.diagram._clearSelection()),o={},this.selectedObject&&(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(o=this.diagram._getChildTable(this.selectedObject,o)),a={childTable:o,node:this.selectedObject},l=n.extend(!0,{},a),this.undoObject=jQuery.extend(!0,{},l)))),this.selectedObject&&t.datavisualization.Diagram.Util.canSelect(this.selectedObject)&&!this.diagram._isEditing)if(this.inAction||(this.inAction=!0,this._canMoveLabel||this.updateCursor("move"),this._updateSelection()),this._canMoveLabel)this._updateLabelXY(this.activeLabel,this.previousPoint,this.currentPoint);else{if(this.diagram&&!this.diagram._isEditing&&this._containerMouseMove(r),this.selectedObject.segments&&(s=this.selectedObject,(t.datavisualization.Diagram.Util.isTargetConnected(s)||t.datavisualization.Diagram.Util.isSourceConnected(s))&&this._disconnect(s)),this.selectedObject.type=="pseudoGroup")for(c=this.diagram._getChildren(this.selectedObject.children),h=0,y=c.length;h<y;h++)v=this.diagram.nameTable[c[h]],t.datavisualization.Diagram.DiagramContext.update(v,this.diagram);else this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram);this.diagram._renderTooltip(this.selectedObject);this._updateSelection();this.diagram._updateSelectionHandle(!0)}this.previousPoint=this.currentPoint},r.prototype._findStackOverNode=function(n,i){var l=this.diagram.nameTable[n.parent],s=null,r,o,e,h,c,u,f;if(l)for(e=this.diagram._getChildren(l.children),h=e.length,c=0;c<h;c++)if(s=this.diagram.nameTable[e[c]],r=this.mousePosition(i),o=t.datavisualization.Diagram.Util.bounds(s),l.container.orientation=="vertical"){if(u=this.diagram.nameTable[e[h-1]],f=this.diagram.nameTable[e[0]],r.y>=o.y&&r.y<=o.bottom)return s;if(r.y<=f.offsetY-f.height/2)return f;if(r.y>=u.offsetY+u.height/2)return u}else{if(u=this.diagram.nameTable[e[h-1]],f=this.diagram.nameTable[e[0]],r.x>=o.x&&r.x<=o.right)return s;if(r.x<=f.offsetX-f.width/2)return f;if(r.x>=u.offsetX+u.width/2)return u}},r.prototype._removeFromContainer=function(n){var i,u,r;if(n.type=="pseudoGroup")for(i=null,u=this.diagram._getChildren(n.children),r=0;r<u.length;r++)i=this.diagram.nameTable[u[r]],i&&t.datavisualization.Diagram.SvgContext._removeFromContainer(i,this.diagram._svg,this.diagram._adornerLayer);else t.datavisualization.Diagram.SvgContext._removeFromContainer(n,this.diagram._svg,this.diagram._adornerLayer)},r.prototype._updateContainerProperties=function(n){var u,e,o,h,s,f,c,r,i;if(n&&n.type=="pseudoGroup"){for(u=null,this.helper?(e=this.helper.offsetX-this.selectedObject.offsetX,o=this.helper.offsetY-this.selectedObject.offsetY):(e=0,o=0),h=this.diagram._getChildren(n.children),s=0;s<h.length;s++)u=this.diagram.nameTable[h[s]],u&&!u.isSwimlane&&(r=this.diagram.nameTable[this.selectedObject.parent],r&&(r.children=this.diagram._getChildren(r.children),r&&r.children&&t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name)),i=this.diagram.nameTable[u.name],i&&(f=this.diagram.nameTable[i.parent],f&&(f.children=this.diagram._getChildren(f.children),t.datavisualization.Diagram.Util.removeItem(f.children,i.name)),i.parent=this.hoverNode.name,c=this.diagram.nameTable[i.parent],this._containsChild(c,i.name)&&c.children.push(i.name),this.diagram.updateNode(i.name,{offsetX:i.offsetX+e}),this.diagram.updateNode(i.name,{offsetY:i.offsetY+o}),this.diagram.nameTable[i.name]=i));return n.offsetX+=e,n.offsetY+=o,n}return r=this.diagram.nameTable[this.selectedObject.parent],r&&r.children&&(r.children=this.diagram._getChildren(r.children),t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name)),i=this.selectedObject,this.hoverNode.isSwimlane||(i.parent=this.hoverNode.name),this.diagram.nameTable[i.name]=i,i},r.prototype._updatePreviousContainer=function(n){if(n._type==="group")if(n.container.type=="canvas"){var i=t.datavisualization.Diagram.Util.bounds(n),r=this.diagram._getMinMaxSize(n,i.width,i.height);n.width=r.width;n.height=r.height}else n.container.type=="stack"},r.prototype._updateContainer=function(n,i,r){var e,o,w=0,b=0,f,l,k,u,h,s,y,tt,it,c,st,ht,rt,ut,a,v,p,ft,et;if(n&&(l=this.diagram.nameTable[n.parent],l||n.type!="pseudoGroup"||(k=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],l=this.diagram.nameTable[k.parent]),l&&l.container))if(l.container.type=="canvas"){if(r){u=this.diagram.nameTable[n.parent];u||n.type!="pseudoGroup"||(u=l);h=t.datavisualization.Diagram.Util.bounds(u);s=u.rotateAngle;this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);y=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);o=t.datavisualization.Diagram.Util.bounds(u);var d=this.diagram._getTightChildrenBounds(u),ct=!0,ot=!0,g=y.x+y.width,nt=y.y+y.height;g>=o.right&&(w=g-o.right+u.paddingRight,f=this.diagram._getMinMaxSize(u,u.width+w,u.height,!0),tt=f.width-u.width,u.width=f.width,u.offsetX+=tt/2,g<o.right&&(ct=!1));nt>=o.bottom&&(b=nt-o.bottom+u.paddingBottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+b,!0),it=f.height-u.height,u.height=f.height,u.offsetY+=it/2,ot=!0,nt<o.bottom&&(ot=!1));g<o.right&&ct&&(w=d.x+d.width+u.paddingRight-o.right,f=this.diagram._getMinMaxSize(u,u.width+w,u.height,!0),tt=f.width-u.width,u.width=f.width,u.offsetX+=tt/2);nt<o.bottom&&ot&&(b=d.y+d.height+u.paddingBottom-o.bottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+b,!0),it=f.height-u.height,u.height=f.height,u.offsetY+=it/2);this._updateMargin(n,u);t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram);this.diagram._rotate(u,s,this.diagram.nameTable);c=t.datavisualization.Diagram.Util.bounds(u);this.diagram._translate(u,h.topLeft.x-c.topLeft.x,h.topLeft.y-c.topLeft.y,this.diagram.nameTable);u.parent&&u.container&&u.container.type=="canvas"&&this._updateMargin(u,this.diagram.nameTable[u.parent]);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram)}else st=!1,ht=!1,u=this.diagram.nameTable[n.parent],h=t.datavisualization.Diagram.Util.bounds(u),s=u.rotateAngle,u.rotateAngle==0&&s==0||this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable),u.container&&u.container.type=="canvas"&&this._updateMargin(n,u),n.container&&n.container.type=="stack"&&(n.container.orientation=="vertical"?st=!0:ht=!0),e=this.diagram._getBoundsWithoutStretch(u,st,ht),f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),rt=u.width,ut=u.height,ft=f.width-u.width,et=f.height-u.height,u.offsetX+=ft/2,u.width=f.width,u.offsetY+=et/2,u.height=f.height,u.isSwimlane&&(u.orientation=="horizontal"?rt!=u.width&&this._getLastPhase(u)&&(a=this._getLastPhase(u).name.split("phaseStack")[1],this._updateSelectedPhase(a,u.width-rt,.0001),v=this._getphase(a),v.offset+=u.width-rt,t.datavisualization.Diagram.SvgContext._updatephase(v,this.diagram)):u.orientation=="vertical"&&ut!=u.height&&this._getLastPhase(u)&&(a=this._getLastPhase(u).name.split("phaseStack")[1],this._updateSelectedPhase(a,1e-5,u.height-ut),v=this._getphase(a),v.offset+=u.height-ut,t.datavisualization.Diagram.SvgContext._updatephase(v,this.diagram))),t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram,!1),u.rotateAngle==0&&s==0||this.diagram._rotate(u,s,this.diagram.nameTable),c=t.datavisualization.Diagram.Util.bounds(u),this.diagram._translate(u,h.topLeft.x-c.topLeft.x,h.topLeft.y-c.topLeft.y,this.diagram.nameTable);n.parent?(this._updateContainer(this.diagram.nameTable[n.parent]),this.diagram.nameTable[n.parent].parent||t.datavisualization.Diagram.DiagramContext.update(this.diagram.nameTable[n.parent],this.diagram)):n.type=="pseudoGroup"&&(k=this.diagram.nameTable[this.diagram._getChild(n.children[0])],p=this.diagram.nameTable[k.parent],p.parent&&(this._updateContainer(this.diagram.nameTable[p.name]),this.diagram.nameTable[p.name]||t.datavisualization.Diagram.DiagramContext.update(this.diagram.nameTable[p.name],this.diagram)))}else l.container.type=="stack"&&(u=this.diagram.nameTable[n.parent],e=t.datavisualization.Diagram.SvgContext._measureStackSize(u,this.diagram,!0),h=t.datavisualization.Diagram.Util.bounds(u),s=u.rotateAngle,u.rotateAngle==0&&s==0||this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable),f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),ft=f.width-u.width,et=f.height-u.height,u.offsetX+=ft/2,u.width=f.width,u.offsetY+=et/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnStack(u,this.diagram),u.rotateAngle==0&&s==0||this.diagram._rotate(u,s,this.diagram.nameTable),c=t.datavisualization.Diagram.Util.bounds(u),this.diagram._translate(u,h.topLeft.x-c.topLeft.x,h.topLeft.y-c.topLeft.y,this.diagram.nameTable),u.parent&&this._updateContainer(u,!1,!1),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram))},r.prototype._addToContainer=function(n){var r,f,u,i;if(n.type=="pseudoGroup")for(r=null,f=this.diagram._getChildren(n.children),u=0;u<f.length;u++)r=this.diagram.nameTable[f[u]],r&&(i=this.diagram._svg.getElementById(r.parent),i||(i=this.diagram._diagramLayer),r._type==="group"?t.datavisualization.Diagram.SvgContext.renderGroup(r,this.diagram._svg,i,this.diagram.nameTable,this.diagram):r.segments?t.datavisualization.Diagram.SvgContext.renderConnector(r,this.diagram._svg,i):t.datavisualization.Diagram.SvgContext.renderNode(r,this.diagram._svg,i));else this.diagram._clearSelection(),this.hoverNode&&this.hoverNode.children&&!this.hoverNode.isSwimlane&&this.hoverNode.children.push(n.name),n&&(i=this.diagram._svg.getElementById(n.parent),i||(i=this.diagram._diagramLayer),n._type==="group"?t.datavisualization.Diagram.SvgContext.renderGroup(n,this.diagram._svg,i,this.diagram.nameTable,this.diagram):n.segments?t.datavisualization.Diagram.SvgContext.renderConnector(n,this.diagram._svg,i):t.datavisualization.Diagram.SvgContext.renderNode(n,this.diagram._svg,i));this.selectedObject=n},r.prototype._addToDiagram=function(){this.seletedObject=this.diagram.nameTable[this.selectedObject.name];this._removeFromContainer(this.selectedObject);var n=this.diagram.nameTable[this.selectedObject.parent];n&&(n.children=this.diagram._getChildren(n.children),t.datavisualization.Diagram.Util.removeItem(n.children,this.selectedObject.name));this.selectedObject.marginBottom=0;this.selectedObject.marginTop=0;this.selectedObject.marginLeft=0;this.selectedObject.marginRight=0;this.selectedObject.parent="";this.diagram.nameTable[this.selectedObject.name]=this.selectedObject;this._updateXY(this.diagram.nameTable[this.selectedObject.name],this.startPoint,this.currentPoint);this._addToContainer(this.selectedObject)},r.prototype.isDiagram=function(n){return n.target.id==this.diagram._id+"_canvas_svg"?!0:!1},r.prototype._allowPan=function(n,i,r){i==="mousedown"&&this.diagram.tools.panTool.mousedown(r);n&&(n._type==="group"||n._type=="node")&&n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan&&(i==="mousemove"?this.diagram.tools.panTool.mousemove(r):i==="mouseup"&&this.diagram.tools.panTool.mouseup(r))},r.prototype._checkForDropEvent=function(n){var i=null,r=null,u=null,f;return this.selectedObject&&this.selectedObject.parent&&(i=this.diagram.nameTable[this.selectedObject.parent]),n&&(u=t.datavisualization.Diagram.Util.bounds(n),r=this._getTargetNode(n,u)),f=this._raiseEvent("drop",{cancel:!1,source:this.diagram.getNode(i),target:this.diagram.getNode(r)}),f.cancel},r.prototype._getSwimLaneNode=function(n,t,i){if(n.isSwimlane)if(i){if(this.diagram.nameTable[this.diagram._getChild(n.children[2])].container.orientation==t.orientation)return n}else if(this.diagram.nameTable[this.diagram._getChild(n.children[2])].container.orientation!=t.orientation)return n;if(n.parent){var r=this.diagram.nameTable[n.parent];if(r)return this._getSwimLaneNode(r,t)}return null},r.prototype._cloneGroupNode=function(t,i){var o=null,r,u,e,f;if(u=n.extend(!0,{},t),u.name+=i,t._type==="group")for(u.children=[],e=this.diagram._getChildren(t.children),f=0;f<e.length;f++)o=this.diagram.nameTable[e[f]],r=n.extend(!0,{},o),r.name+=i,r.parent&&(r.parent+=i),r._type==="group"&&this._cloneGroupNode(r,i),this.diagram.nameTable[r.name]=r,this.diagram.nodes().push(r),u.children.push(r.name);return u},r.prototype._getSwimLaneStackIndex=function(n){var u=null,i,r;return n.container.type=="canvas"&&(n.parent&&(i=this.diagram.nameTable[n.parent]),i&&(r=t.datavisualization.Diagram.Util.bounds(n),u=i.container.orientation==="vertical"?this.currentPoint.y>=r.y&&this.currentPoint.y<r.center.y?i.children.indexOf(n.name):i.children.indexOf(n.name)+1:this.currentPoint.x>=r.x&&this.currentPoint.x<r.center.x?i.children.indexOf(n.name):i.children.indexOf(n.name)+1)),u},r.prototype._changeNodeState=function(n,i){var r,p,a=null,o,f,w,e,s,h,c,v,l,y,u;return this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isLane&&!i?(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),o=this._findNodeUnderMouse(n),o&&(a=this._getSwimLaneNode(o,this.selectedObject)),o&&a?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter(),f=this.diagram.nameTable[this.diagram._getChild(a.children[2])],f&&(w=t.datavisualization.Diagram.Util.randomId(),e=this._cloneGroupNode(this.selectedObject,w),this.diagram.remove(this.selectedObject),this.hoverNode&&(s=this._getSwimLaneStackIndex(this.hoverNode)),s||s==0?f.children.splice(s,0,e.name):f.children.push(e.name),e.parent=f.name,this.diagram.add(e),h=this.diagram.nameTable[f.parent],h&&this._updateContainer(e),t.datavisualization.Diagram.DiagramContext.update(h,this.diagram),this.selectedObject=h)):(c=t.datavisualization.Diagram.SwimLaneHelper._createSwimlane(this.selectedObject,this.diagram),c&&(this.diagram.remove(this.selectedObject),this.diagram.add(c),this.selectedObject=c))):this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container?(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),v=this.diagram.nameTable[this.selectedObject.parent].container,v.type=="canvas"?(t.datavisualization.Diagram.SvgContext._showNode(this.selectedObject,this.diagram._svg),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter(),l=!this._checkForDropEvent(this.hoverNode),l&&(this.hoverNode&&this.hoverNode.allowDrop||this.hoverNode&&this.hoverNode.name==this.selectedObject.parent?this.hoverNode.container&&this.hoverNode.container.type=="canvas"&&(this.seletedObject=this.diagram.nameTable[this.selectedObject.name],p=this.selectedObject.parent,this._removeFromContainer(this.selectedObject),r=this._updateContainerProperties(this.diagram.nameTable[this.selectedObject.name]),this._updateXY(this.diagram.nameTable[this.selectedObject.name],this.startPoint,this.currentPoint),this._addToContainer(r)):(this.isDiagram(n)&&this._addToDiagram(),this.diffx=0,this.diffy=0))):v.type=="stack"&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter())):(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),this.selectedObject&&!this.selectedObject.isSwimlane&&(this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()?(this.currentPoint=this.previousPoint,this.diffx=0,this.diffy=0,this._removeHighLighter(),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this.hoverNode&&this.hoverNode.allowDrop&&!this._checkForDropEvent(this.hoverNode)||this.hoverNode&&this.hoverNode.name==this.selectedObject.parent?(this.seletedObject=this.diagram.nameTable[this.selectedObject.name],p=this.selectedObject.parent,r=this._updateContainerProperties(this.diagram.nameTable[this.selectedObject.name]),this._removeFromContainer(this.selectedObject),this._addToContainer(r)):(this.diffx=0,this.diffy=0,!this.hoverNode&&this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter(),this.seletedObject=this.diagram.nameTable[this.selectedObject.name],l=!this._checkForDropEvent(this.hoverNode),l&&this.isDiagram(n)&&(this._removeChildParent(this.selectedObject),this._addToDiagram())))):this.isDiagram(n)||this.selectedObject.type=="pseudoGroup"?this.hoverNode&&(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this._fromDiagram(this.selectedObject.children)&&this.hoverNode.allowDrop&&(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._svg,this.diagram._adornerLayer),this._containsSwimlane(this.selectedObject.children)&&(this._removeFromContainer(this.selectedObject),r=this._updateContainerProperties(this.diagram.nameTable[this.selectedObject.name]),u=this.diagram.nameTable[r.parent],u&&this._updateMargin(this.selectedObject,u),this._addToContainer(this.selectedObject))):(y=this.hoverNode,(y&&y.container&&this.hoverNode.allowDrop&&!this._checkForDropEvent(this.hoverNode)||this.hoverNode&&this.hoverNode.container&&this.hoverNode.name==this.selectedObject.parent)&&(this.selectedObject.segments||(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter(),this.seletedObject=this.diagram.nameTable[this.selectedObject.name],this._removeFromContainer(this.selectedObject),r=this._updateContainerProperties(this.diagram.nameTable[this.selectedObject.name]),u=this.diagram.nameTable[r.parent],u&&this._updateMargin(r,u),this._addToContainer(r),u&&t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram)))))),this._checkPhaseDrop(n),r},r.prototype._checkPhaseDrop=function(n){var i=null,r,u,f;this.selectedObject.isPhase&&(f=this._findNodeUnderMouse(n),f&&(i=this._getSwimLaneNode(f,this.selectedObject,!0)),i?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._svg,this.diagram._adornerLayer),this.selectedObject.orientation=="vertical"?(r=this.currentPoint.x-(i.offsetX-i.width/2),u="horizontal"):(r=this.currentPoint.y-(i.offsetY-i.height/2),u="vertical"),this.diagram._remove(this.selectedObject),this.inAction=!1,this.diagram._addPhase(i.name,{name:t.datavisualization.Diagram.Util.randomId(),offset:r,orientation:u,label:{text:"Phase"},lineColor:this.selectedObject.lineColor,lineDashArray:this.selectedObject.lineDashArray,lineWidth:this.selectedObject.lineWidth})):this.diagram._remove(this.selectedObject))},r.prototype._removeChildParent=function(n){var i,r,f,u;if(n.type=="pseudoGroup")for(i=null,f=this.diagram._getChildren(n.children),u=0;u<f.length;u++)i=this.diagram.nameTable[f[u]],i&&(i.parent!=""&&(r=this.diagram.nameTable[i.parent],r&&r.children&&t.datavisualization.Diagram.Util.removeItem(r.children,i.name)),i.parent="");else t.datavisualization.Diagram.SvgContext._removeFromContainer(n,this.diagram._svg,this.diagram._adornerLayer)},r.prototype._updateNodeState=function(n,i){var u,e,c,f,h,o;if(this.diagram.nameTable[this.selectedObject.parent]&&(u=this.diagram.nameTable[this.selectedObject.parent].container),this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container){if(u=this.diagram.nameTable[this.selectedObject.parent].container,u.type=="canvas")this.hoverNode&&i&&(e=this.selectedObject.parent,this._updateContainer(i,e,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram));else if(u.type=="stack"&&(c=this._checkForDropEvent(this.stackOverNode),!c))if(f=this.stackOverNode,f){var r=this.diagram.nameTable[f.parent],l=t.datavisualization.Diagram.Util.bounds(r),s=r.rotateAngle;r.rotateAngle==0||s!=0||this.diagram._rotate(r,-r.rotateAngle,this.diagram.nameTable);r.children=this.diagram._getChildren(r.children);this.selectedObject.name!=f.name&&(this._swapChildren(r.children,this.selectedObject.name,f.name,r.container.orientation==="vertical"?!0:!1),this._updateContainer(this.selectedObject),r.rotateAngle==0||s!=0||this.diagram._rotate(r,s,this.diagram.nameTable),h=t.datavisualization.Diagram.Util.bounds(r),this.diagram._translate(r,l.topLeft.x-h.topLeft.x,l.topLeft.y-h.topLeft.y,this.diagram.nameTable),t.datavisualization.Diagram.DiagramContext.update(r,this.diagram))}else this.diffx=0,this.diffy=0}else this.selectedObject.type=="pseudoGroup"&&(o=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],o&&o.parent&&(u=this.diagram.nameTable[o.parent].container),u&&u.type=="canvas"&&this.hoverNode&&i&&(e=this.selectedObject.parent,this._updateContainer(i,e,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram)))},r.prototype.mouseup=function(r,u){var w=this.inAction,f,c,l,e,a,v,o,s,h,y,p;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);this.inAction?(c=this._changeNodeState(r,u),this.inAction=!1,this._canMoveLabel?this._updateLabelXY(this.activeLabel,this.previousPoint,this.currentPoint):this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint),this._updateNodeState(r,c),this._updateObject(),e={},(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(e=this.diagram._getChildTable(this.selectedObject,e)),a={childTable:e,node:this.selectedObject},l=n.extend(!0,{},a),this.diagram._selectedSymbol||(v={type:"positionchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},l),isMultipleNode:this.selectedObject._type==="group"?!0:!1},this.diagram.addHistoryEntry(v)),this.diagram._updateSelectionHandle(),f=this.selectedObject):this.selectedObject?f=this._findNodeUnderMouse(r):(r.ctrlKey||r.shiftKey?f=this._processCtrlKey(r):(o=!0,s=this._findNodeUnderMouse(r),r.which===3&&this.diagram.selectionList[0]&&(this.diagram.selectionList[0].type==="pseudoGroup"||this.diagram.selectionList[0]._type==="group")&&this._hasMultipleSelection(s)&&(o=!1),t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(this.selectedObject=o?s:this.diagram.selectionList[0]),f=this.selectedObject),this.selectedObject&&!this.diagram._selectionContains(this.selectedObject)&&this.diagram._clearSelection());this.selectedObject&&this.selectedObject.type!="pseudoGroup"&&(h=this._findNodeUnderMouse(r,!0),w||(y=this.selectedObject,p=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:h,model:this.diagram.model,cancel:!1}),this._itemClick(this.selectedObject,this.actualObject,h),p.cancel&&(this.selectedObject=y)));this._allowPan(this.selectedObject,"mouseup",r);this._updateSelection();this._enableLabel(this.selectedObject,this.activeLabel);delete this.diffx;delete this.diffy;delete this._isMouseDown;this.diagram._removeTooltip();this.diagram._isEditing||this.diagram._endEdit();delete this.hoverNode;f&&this._raiseEvent("click",{element:this.diagram.getNode(f),actualObject:this.diagram.getNode(this.actualObject)});i.prototype.mouseup.call(this,r)},r.prototype._swapChildren=function(n,i,r,u){var o=this.diagram.nameTable[r];if(o){var e=t.datavisualization.Diagram.Util.bounds(o),s=n.indexOf(i),f=n.indexOf(r);u?s>f?this.currentPoint.y>=e.y&&this.currentPoint.y<e.center.y?(n.splice(n.indexOf(i),1),n.splice(f,0,i)):(n.splice(n.indexOf(i),1),n.splice(f+1,0,i)):this.currentPoint.y>=e.y&&this.currentPoint.y<e.center.y?(n.splice(n.indexOf(i),1),n.splice(f-1,0,i)):(n.splice(n.indexOf(i),1),n.splice(f,0,i)):s>f?this.currentPoint.x>=e.x&&this.currentPoint.x<e.center.x?(n.splice(n.indexOf(i),1),n.splice(f,0,i)):(n.splice(n.indexOf(i),1),n.splice(f+1,0,i)):this.currentPoint.x>=e.x&&this.currentPoint.x<e.center.x?(n.splice(n.indexOf(i),1),n.splice(f-1,0,i)):(n.splice(n.indexOf(i),1),n.splice(f,0,i))}},r.prototype._updateObject=function(){var r,i,n,u;if(this.selectedObject.type=="pseudoGroup")for(i=this.diagram._getChildren(this.selectedObject.children),n=0,u=i.length;n<u;n++)r=this.diagram.nameTable[i[n]],t.datavisualization.Diagram.DiagramContext.update(r,this.diagram);else t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)},r.prototype._endAction=function(){i.prototype._endAction.apply(this);this._isMouseDown=!1;this._mouseOffset=t.datavisualization.Diagram.Size(0,0)},r.prototype._renderHelper=function(){this.svgHelper||(this.helper.segments?t.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer):this.helper._type==="group"?t.datavisualization.Diagram.SvgContext.renderGroup(this.helper,this.diagram._svg,this.diagram._diagramLayer):t.datavisualization.Diagram.SvgContext.renderNode(this.helper,this.diagram._svg,this.diagram._diagramLayer),this.svgHelper=document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"))},r.prototype._updateHelper=function(){this._updateXY(this.helper,this.previousPoint,this.currentPoint);t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},r.prototype._updateHelperXY=function(n,i,r){var s=r.x<i.x,h=r.y<i.y,f=this.diffx+(r.x-i.x),e=this.diffy+(r.y-i.y),u,o;(this.diagram.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines)&&this.diagram._enableSnapToObject()&&(u=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.helper,s,h,t.datavisualization.Diagram.Point(f,e),r,i));u||(u=t.datavisualization.Diagram.Point(f,e));this.diffx=f-u.x;this.diffy=e-u.y;t.datavisualization.Diagram.Geometry.isEmptyPoint(u)||(o=this._raiseEvent("drag",{element:this.diagram.getNode(this.helper),offset:u,cancel:!1}),o.cancel||(this.diagram._translate(n,u.x,u.y,this.diagram.nameTable),this._updateParent(n),n._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram)))},r.prototype._updateXY=function(n,i,r){var s=r.x<i.x,h=r.y<i.y,f=this.diffx+(r.x-i.x),e=this.diffy+(r.y-i.y),u,o,c;(this.diagram.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines||this.diagram._enableSnapToObject())&&(u=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.selectedObject,s,h,t.datavisualization.Diagram.Point(f,e),r,i));u||(u=t.datavisualization.Diagram.Point(f,e));this.diffx=f-u.x;this.diffy=e-u.y;t.datavisualization.Diagram.Geometry.isEmptyPoint(u)||(this.diagram._selectedSymbol||(o=this._raiseEvent("drag",{element:this.diagram.getNode(this.selectedObject),offset:u,cancel:!1})),(o&&!o.cancel||this.diagram._selectedSymbol)&&(c=!1,n.segments||t.datavisualization.Diagram.Util.canAllowPan(n)&&(this.diagram._hScrollOffset===0&&(u.x=0),this.diagram._vScrollOffset===0&&(u.y=0)),this.diagram._translate(n,u.x,u.y,this.diagram.nameTable),this._updateParent(n),n._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram)))},r.prototype._updateLabelXY=function(n,i,r){var h=t.datavisualization.Diagram.Util.bounds(this.selectedObject),u=r.x-i.x,f=r.y-i.y,e,o,s;this.selectedObject.segments||(e=t.Matrix.identity(),t.Matrix.rotate(e,-this.selectedObject.rotateAngle),o=t.Matrix.transform(e,t.datavisualization.Diagram.Point(u,f)),u=o.x,f=o.y);s=this._raiseEvent("drag",{element:this.diagram.getNode(n),offset:n.offset,cancel:!1});s.cancel||this.diagram._translateLabel(this.selectedObject,n,u,f)},r.prototype._updateParent=function(n){var i,u,r,f;if(n.type=="pseudoGroup")for(u=this.diagram._getChildren(n.children),r=0;r<u.length;r++)i=this.diagram.nameTable[u[r]],i&&i.parent&&(t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[i.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.diagram.nameTable[i.parent],this.diagram),this.diagram._updateAssociatedConnectorEnds(this.diagram.nameTable[i.parent],this.diagram.nameTable));else n&&n.parent&&(t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[n.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.diagram.nameTable[n.parent],this.diagram),this.diagram._updateAssociatedConnectorEnds(this.diagram.nameTable[n.parent],this.diagram.nameTable));n.parent&&(f=this.diagram.nameTable[n.parent],f&&this._updateParent(f))},r.prototype._updateSelection=function(){this.diagram._selectionContains(this.selectedObject)||this.diagram._addSelection(this.selectedObject)},r.prototype._disableLabel=function(t,i){if(t&&i){var u=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],r=n(u).find("#"+t.name+"_"+i.name)[0];r&&(r.style.pointerEvents="none")}},r.prototype._enableLabel=function(t,i){if(t&&i){var u=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],r=n(u).find("#"+t.name+"_"+i.name)[0];r&&(r.style.pointerEvents="all")}},r}(i);t.datavisualization.Diagram.MoveTool=f;e=function(i){function r(n){i.call(this,"resize",n);this.cursor="default";this._resizeDirection=null;this._mouseOffset=t.datavisualization.Diagram.Size(0,0);this.diffx=0;this.diffy=0;this._startPoint=t.datavisualization.Diagram.Size(0,0);this.undoObject=null;this.pseudoGroupConstraints=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(r){var f,u,e;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);i.prototype.mousedown.call(this,r);this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name];u={};(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(u=this.diagram._getChildTable(this.selectedObject,u));e={childTable:u,node:this.selectedObject};this.selectedObject&&this.selectedObject.type==="pseudoGroup"&&(this.pseudoGroupConstraints=this.diagram.model.selectedItems.getConstraints&&n.isFunction(this.diagram.model.selectedItems.getConstraints)?this.diagram.model.selectedItems.getConstraints():t.datavisualization.Diagram.Util._getPseudoGroupConstraints(this.diagram,this.selectedObject,this.selectedObject));f=n.extend(!0,{},e);this.undoObject=jQuery.extend(!0,{},f);this._resizeDirection=r.target.getAttribute("class");this.selectedObject.width||(this.selectedObject.width=this.selectedObject._width);this.selectedObject.height||(this.selectedObject.height=this.selectedObject._height);this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:this.selectedObject.offsetY,x:this.selectedObject.offsetX}},r.prototype._createUpdateHelper=function(){var n,i;this.helper?(n=t.datavisualization.Diagram.Util.bounds(this.helper),this._updateSize(this.helper,this.previousPoint,this.currentPoint,null,null,null,!0),i=t.datavisualization.Diagram.Util.bounds(this.helper),this.selectedObject.container&&this.diagram._translate(this.helper,n.topLeft.x-i.topLeft.x,n.topLeft.y-i.topLeft.y,this.diagram.nameTable),t.datavisualization.Diagram.SvgContext._updateContainerHelper(this.diagram)):(this.helper=this._getCloneNode(this.selectedObject),this.helper.type=null,this.helper.name="helper",t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this._startPoint=this.currentPoint,this._updateSize(this.helper,this.previousPoint,this.currentPoint,null,null,null,!0))},r.prototype.mousemove=function(n){var r,u;i.prototype.mousemove.call(this,n);t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);this.selectedObject&&(this.inAction||(t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._svg,this.diagram._currZoom),this.inAction=!0),r=!1,this.selectedObject&&this.selectedObject.parent?(u=this.diagram.nameTable[this.selectedObject.parent],u.container&&u.container.type=="canvas"&&(r=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(r=!0),this.selectedObject&&r?this._createUpdateHelper():this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?this._createUpdateHelper():this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container&&this.diagram.nameTable[this.selectedObject.parent].container.type=="stack"?(this.helper||(this.helper=this._getCloneNode(this.selectedObject)),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this._startPoint=this.currentPoint,this._updateSize(this.helper,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.DiagramContext.update(this.helper,this.diagram)):this.selectedObject.type!="pseudoGroup"?this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint):this.selectedObject.type=="pseudoGroup"&&!this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._renderTooltip(this.selectedObject),this.diagram._updateSelectionHandle(!0));this.previousPoint=this.currentPoint},r.prototype._updateResizeObject=function(){var n=this.diagram.nameTable[this.selectedObject.name],r=t.datavisualization.Diagram.Util.bounds(n),u=n.rotateAngle,f,e,i;return this.diagram._rotate(n,-n.rotateAngle,this.diagram.nameTable),f=n.width-this.helper.width,e=n.height-this.helper.height,n.container||n.rotateAngle!=0?(this.diagram.updateNode(n.name,{width:this.helper.width}),this.diagram.updateNode(n.name,{height:this.helper.height})):this._updateSize(n,this.startPoint,this.currentPoint),n.minWidth=n.width,n.minHeight=n.height,this.diagram._rotate(n,u,this.diagram.nameTable),i=t.datavisualization.Diagram.Util.bounds(n),(n.container||n.rotateAngle!=0)&&this.diagram._translate(n,r.topLeft.x-i.topLeft.x,r.topLeft.y-i.topLeft.y,this.diagram.nameTable),n},r.prototype.mouseup=function(r){var f,s,u,e,h,c,o,l,a;this.inAction&&(t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.inAction=!1,f=!1,this.selectedObject&&this.selectedObject.parent?(s=this.diagram.nameTable[this.selectedObject.parent],s.container&&s.container.type=="canvas"&&(f=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(f=!0),this.selectedObject&&f?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),u=this._updateResizeObject(),this._updateContainer(u,null,!0)):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),u=this.diagram.nameTable[this.selectedObject.name],this.selectedObject.container&&(u.minWidth=this.helper.width,u.minHeight=this.helper.height),this._updateSize(this.selectedObject,this._startPoint,this.currentPoint,null,null,!0),this.selectedObject.parent?(e=this.diagram.nameTable[this.selectedObject.parent],e._type==="group"&&e.container&&e.container.type=="stack"&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),u=this.diagram.nameTable[this.selectedObject.name],h=this.diagram._getMinMaxSize(this.selectedObject,this.helper.width,this.helper.height),u.height=h.height,u.width=h.width,this.selectedObject.container&&(u.minWidth=u.width,u.minHeight=u.height),this._updateContainer(this.diagram.nameTable[this.selectedObject.name]))):this.selectedObject&&(this.selectedObject.minWidth=this.selectedObject.width,this.selectedObject.minHeight=this.selectedObject.height)):this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container&&this.diagram.nameTable[this.selectedObject.parent].container.type=="stack"?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this.selectedObject.height=this.helper.height,this.selectedObject.width=this.helper.width,this._updateContainer(this.selectedObject)):this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(),o={},(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(o=this.diagram._getChildTable(this.selectedObject,o)),l={childTable:o,node:this.selectedObject},c=n.extend(!0,{},l),a={type:"sizechanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},c),isMultipleNode:this.selectedObject._type==="group"?!0:!1},this.diagram.addHistoryEntry(a),this.diagram._removeTooltip());i.prototype.mouseup.call(this,r)},r.prototype._getSwimlaneHeader=function(n){var t;return n&&n.isSwimlane&&n.children&&n.children.length>0&&(t=this.diagram.nameTable[n.children[0]]),t},r.prototype._getPhaseStack=function(n){var t;return n&&n.isSwimlane&&n.children&&n.children.length>0&&(t=this.diagram.nameTable[this.diagram._getChild(n.children[1])]),t},r.prototype._updateContainer=function(n,i,r){var e,o,c=0,l=0,f,s,ut,u,d,ft,h,p,w,nt,tt,it,ot,rt,b,k;if(n&&(s=this.diagram.nameTable[n.parent],s||n.type!="pseudoGroup"||(ut=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],s=this.diagram.nameTable[ut.parent]),s))if(s.container&&s.container.type=="canvas"){if(r){r=!1;u=this.diagram.nameTable[n.parent];u||n.type!="pseudoGroup"||(u=s);d=t.datavisualization.Diagram.Util.bounds(u);ft=u.rotateAngle;this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);h=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);o=t.datavisualization.Diagram.Util.bounds(u);var a=this.diagram._getTightChildrenBounds(u),et=!0,g=!0,v=h.x+h.width,y=h.y+h.height;v>=o.right&&(c=v-o.right+u.paddingRight,f=this.diagram._getMinMaxSize(u,u.width+c,u.height,!0),p=f.width-u.width,u.width=f.width,u.offsetX+=p/2,v<o.right&&(et=!1));y>=o.bottom&&(l=y-o.bottom+u.paddingBottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+l,!0),w=f.height-u.height,u.height=f.height,u.offsetY+=w/2,g=!0,y<o.bottom&&(g=!1));v<o.right&&et&&(c=a.x+a.width+u.paddingRight-o.right,f=this.diagram._getMinMaxSize(u,u.width+c,u.height,!0),p=f.width-u.width,u.width=f.width,u.offsetX+=p/2);y<o.bottom&&g&&(l=a.y+a.height+u.paddingBottom-o.bottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+l,!0),w=f.height-u.height,u.height=f.height,u.offsetY+=w/2);this._updateMargin(n,u);t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram);this.diagram._rotate(u,ft,this.diagram.nameTable);nt=t.datavisualization.Diagram.Util.bounds(u);this.diagram._translate(u,d.topLeft.x-nt.topLeft.x,d.topLeft.y-nt.topLeft.y,this.diagram.nameTable);u.parent&&u.container&&u.container.type=="canvas"&&this._updateMargin(u,this.diagram.nameTable[u.parent]);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram)}else tt=!1,it=!1,u=this.diagram.nameTable[n.parent],n.container&&n.container.type=="stack"&&(n.container.orientation=="vertical"?tt=!0:it=!0),e=this.diagram._getBoundsWithoutStretch(u,tt,it),e.width+=u.paddingLeft+u.paddingRight,e.height+=u.paddingTop+u.paddingBottom,f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),b=f.width-u.width,k=f.height-u.height,u.offsetX+=b/2,u.width=f.width,u.offsetY+=k/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram);u.parent&&(this.diagram.nameTable[u.parent]&&(r=!0),this._updateContainer(u,null,r))}else s.container&&s.container.type=="stack"&&(ot=!0,u=this.diagram.nameTable[n.parent],u.parent&&(rt=this.diagram.nameTable[u.parent]),rt&&rt.isSwimlane&&(ot=!0),e=t.datavisualization.Diagram.SvgContext._measureStackSize(u,this.diagram,!0),f=this.diagram._getMinMaxSize(u,e.width,e.height,u.verticalAlign),b=f.width-u.width,k=f.height-u.height,u.offsetX+=b/2,u.width=f.width,u.offsetY+=k/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnStack(u,this.diagram),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram),u.parent&&this._updateContainer(u))},r.prototype._updateSize=function(n,i,r,u,f,e,o,s){var v,l,k=t.Matrix.identity(),nt,tt,a,rt,it,ut;t.Matrix.rotate(k,-n.rotateAngle);var y={snapped:!1,offset:0,left:!1,right:!1},p={snapped:!1,offset:0,top:!1,bottom:!1},c=u?u:this.currentPoint.x-this.startPoint.x,h=f?f:this.currentPoint.y-this.startPoint.y,d=t.datavisualization.Diagram.Point(0,0),g=t.Matrix.identity(),w=n.offsetX,b=n.offsetY;t.Matrix.rotate(g,n.rotateAngle,w,b);nt=n.width;tt=n.height;w=w-nt*n.pivot.x;b=b-tt*n.pivot.y;switch(this._resizeDirection){case"n-resize":d=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt/2,b+tt));a=1;l=t.Matrix.transform(k,t.datavisualization.Diagram.Point(c,h));c=l.x;h=l.y;h=this._snapTop(y,p,c,h,n,r==i);v=(this.initialBounds.height-h)/n.height;break;case"e-resize":d=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w,b+tt/2));l=t.Matrix.transform(k,t.datavisualization.Diagram.Point(c,h));c=l.x;h=l.y;c=this._snapRight(y,p,c,h,n,r==i);h=0;a=(this.initialBounds.width+c)/n.width;v=1;break;case"w-resize":d=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt,b+tt/2));l=t.Matrix.transform(k,t.datavisualization.Diagram.Point(c,h));c=l.x;h=l.y;c=this._snapLeft(y,p,c,h,n,r==i);h=0;a=(this.initialBounds.width-c)/n.width;v=1;break;case"s-resize":d=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt/2,b));a=1;l=t.Matrix.transform(k,t.datavisualization.Diagram.Point(c,h));c=l.x;h=l.y;h=this._snapBottom(y,p,l.x,l.y,n,r==i);v=(this.initialBounds.height+h)/n.height;break;case"ne-resize":d=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w,b+tt));l=t.Matrix.transform(k,t.datavisualization.Diagram.Point(c,h));c=l.x;h=l.y;c=this._snapRight(y,p,c,h,n,r==i);h=this._snapTop(y,p,c,h,n,r==i);a=(this.initialBounds.width+c)/n.width;v=(this.initialBounds.height-h)/n.height;break;case"nw-resize":d=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt,b+tt));l=t.Matrix.transform(k,t.datavisualization.Diagram.Point(c,h));c=l.x;h=l.y;h=this._snapTop(y,p,c,h,n,r==i);c=this._snapLeft(y,p,c,h,n,r==i);a=(this.initialBounds.width-c)/n.width;v=(this.initialBounds.height-h)/n.height;break;case"se-resize":d=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w,b));l=t.Matrix.transform(k,t.datavisualization.Diagram.Point(c,h));c=l.x;h=l.y;h=this._snapBottom(y,p,c,h,n,r==i);c=s?c:this._snapRight(y,p,c,h,n,r==i);a=(this.initialBounds.width+c)/n.width;v=(this.initialBounds.height+h)/n.height;break;case"sw-resize":d=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt,b));l=t.Matrix.transform(k,t.datavisualization.Diagram.Point(c,h));c=l.x;h=l.y;h=this._snapBottom(y,p,c,h,n,r==i);c=this._snapLeft(y,p,c,h,n,r==i);a=(this.initialBounds.width-c)/n.width;v=(this.initialBounds.height+h)/n.height}n&&(this.pseudoGroupConstraints||(this.pseudoGroupConstraints=n.constraints));this.pseudoGroupConstraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio&&(this._resizeDirection=="n-resize"||this._resizeDirection=="s-resize"||this._resizeDirection=="w-resize"||this._resizeDirection=="e-resize"?(rt=t.Matrix.transform(k,t.datavisualization.Diagram.Point(this.previousPoint.x-this.currentPoint.x,this.previousPoint.y-this.currentPoint.y)),Math.abs(rt.x)>Math.abs(rt.y)?v=a:a=v):v=this.previousPoint!=this.currentPoint?a=Math.max(v,a):a=0);it=t.datavisualization.Diagram.Size();a<0&&(a=1);v<0&&(v=1);it.width=a;it.height=v;t.datavisualization.Diagram.Geometry.isEmptySize(it)||(this.diagram.scale(n,a,v,d,this.diagram.nameTable,null,e,o),ut=this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),offset:it,cancel:!1}),ut.cancel&&!o&&this.diagram.scale(n,1/a,1/v,d,this.diagram.nameTable),n._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram));this.pseudoGroupConstraints=null},r.prototype._snapTop=function(n,i,r,u,f,e){var o=u,s,c,h;if(i.top=!0,n.left=n.right=!1,s=this.diagram.model.snapSettings,c=this.diagram._currZoom,this.diagram._enableSnapToObject()&&!f.rotateAngle&&(h=this.initialBounds.y-this.initialBounds.height/2+u-(f.offsetY-f.height/2),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,h,this.selectedObject,e)),i.snapped)o=u-h+i.offset;else if(s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var l=this.initialBounds.y-this.initialBounds.height/2,a=l+u,v=t.datavisualization.Diagram.SnapUtil._round(a,s.horizontalGridLines.snapInterval,c);o=v-l}return o},r.prototype._snapBottom=function(n,i,r,u,f,e){var o=u,s,c,h,a;if(i.bottom=!0,n.left=n.right=!1,s=this.diagram.model.snapSettings,c=this.diagram._currZoom,this.diagram._enableSnapToObject()&&!f.rotateAngle&&(h=this.initialBounds.y+this.initialBounds.height/2+u-(f.offsetY+f.height/2),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,h,this.selectedObject,e)),a=t.datavisualization.Diagram.Util.bounds(f),i.snapped)o=u-h+i.offset;else if(s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var l=this.initialBounds.y+this.initialBounds.height/2,v=l+u,y=t.datavisualization.Diagram.SnapUtil._round(v,s.horizontalGridLines.snapInterval,c);o=y-l}return o},r.prototype._snapLeft=function(n,i,r,u,f,e){var o=r,s,c,h,a;if(n.left=!0,i.top=i.bottom=!1,s=this.diagram.model.snapSettings,c=this.diagram._currZoom,this.diagram._enableSnapToObject()&&!f.rotateAngle&&(h=this.initialBounds.x-this.initialBounds.width/2+r-(f.offsetX-f.width/2),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,h,u,this.selectedObject,e)),a=t.datavisualization.Diagram.Util.bounds(f),n.snapped)o=r-h+n.offset;else if(s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var l=this.initialBounds.x-this.initialBounds.width/2,v=l+r,y=t.datavisualization.Diagram.SnapUtil._round(v,s.horizontalGridLines.snapInterval,c);o=y-l}return o},r.prototype._snapRight=function(n,i,r,u,f,e){var o=r,s,c,h;if(n.right=!0,i.top=i.bottom=!1,s=this.diagram.model.snapSettings,c=this.diagram._currZoom,this.diagram._enableSnapToObject()&&!f.rotateAngle&&(h=this.initialBounds.x+this.initialBounds.width/2+r-(f.offsetX+f.width/2),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,h,u,this.selectedObject,e)),n.snapped)o=r-h+n.offset;else if(s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var l=this.initialBounds.x+this.initialBounds.width/2,a=l+r,v=t.datavisualization.Diagram.SnapUtil._round(a,s.verticalGridLines.snapInterval,c);o=v-l}return o},r}(i);t.datavisualization.Diagram.ResizeTool=e;o=function(i){function r(n){i.call(this,"endPoint",n);this.cursor="move";this._endPoint=null;this._undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(r){var u;i.prototype.mousedown.call(this,r);r.ctrlKey&&r.shiftKey&&(u=n(r.target).parents(".ej-d-connector"),u.length>0&&(this.selectedObject=this.diagram.nameTable[u[0].id],this.diagram._hasSelection()&&this.diagram._clearSelection(),this.diagram._addSelection(this.selectedObject)));this._initialValue=null;this.diagram.selectionList[0]&&!this.selectedObject&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name]);this.undoObject=this._getClonedObject(this.selectedObject);this._endPoint=r.target.getAttribute("class");this.targetid=r.target.id;this._selectedSegment="";var f=this._endPoint=="targetEndPoint"?!0:!1,e=this._endPoint=="sourceEndPoint"?!0:!1,o=this._raiseEndPointDrag(f,e,t.datavisualization.Diagram.DragState.Starting)},r.prototype.mousemove=function(n){var h,r,u,c,e,f,a,l,v,o,s,y;if(i.prototype.mousemove.call(this,n),this.selectedObject&&!(n.ctrlKey&&n.shiftKey)&&t.datavisualization.Diagram.Util.canMove(this.selectedObject))if(h=!1,this.selectedObject.segments.length==2&&(h=!0),r=this.currentPoint.x-this.previousPoint.x,u=this.currentPoint.y-this.previousPoint.y,this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y)this.inAction&&(this.selectedSegment&&this._endPoint=="segmentEnd"?(r!=0||u!=0)&&(o=this.currentPoint.x-this.startPoint.x,s=this.currentPoint.y-this.startPoint.y,o=this._initialValue.x+o-this.selectedSegment._endPoint.x,s=this._initialValue.y+s-this.selectedSegment._endPoint.y,r=r*o<0?0:o,u=u*s<0?0:s,this._updateAdjacentSegments(r,u)):this._endPoint!="segmentEnd"&&((this._endPoint=="targetEndPoint"||this._endPoint=="sourceEndPoint")&&this._checkConnectionPossible(n),y=this._updatePoints(this.selectedObject,t.datavisualization.Diagram.DragState.Dragging),this._disconnect(this.selectedObject),this._updateConnection(this.selectedObject,y)),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0));else{if(this.inAction=!0,this.selectedObject.segments.length>0)for(c=0;c<this.selectedObject.segments.length;c++)this.selectedObject.segments[c]._bridges=[];this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest").style["pointer-events"]="none";this.diagram._svg.getElementById(this.selectedObject.name).style["pointer-events"]="none";this.diagram._svg.getElementById(this.diagram._svg.document.id+"handle_g").style["pointer-events"]="none";e=this.targetid.split("_");e.reverse();f=Number(e[0]);this.selectedSegment=this.selectedObject.segments[f];a=this.selectedSegment;this.selectedSegment&&this.selectedSegment.type=="orthogonal"?(l=!1,f===0&&(v=!0),this.selectedSegment.length?f==0?(this.insertFirstSegment(r,u,e),l=!0):this.nextSegment=this.selectedObject.segments[f+1]:(this._addTerminalSegment(r,u,e),l=!0)):this.nextSegment=this.selectedObject.segments[f+1];l&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,!(h||v||!this.selectedObject.sourcePort),!(h||!(a.length||a.length===0)||!this.selectedObject.targetPort),this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram._currZoom));this.selectedSegment||this._endPoint!="targetEndPoint"||(this.selectedSegment=this.selectedObject.segments[this.selectedObject.segments.length-1]);this.selectedSegment||this._endPoint!="sourceEndPoint"||(this.selectedSegment=this.selectedObject.segments[0],this.nextSegment=this.selectedObject.segments[1]);this.selectedSegment&&(this._initialValue={x:this.selectedSegment._endPoint.x,y:this.selectedSegment._endPoint.y});this.undoObject=this._getClonedObject(this.selectedObject)}this.previousPoint=this.currentPoint},r.prototype._updateAdjacentSegments=function(n,i){var r=this.selectedSegment,u={x:n+r._endPoint.x,y:i+r._endPoint.y},e,f;u=this.snap(u);r.type=="orthogonal"?(r._direction=="left"||r._direction=="right"?(i=u.y-r._endPoint.y,r._startPoint.y+=i,r._endPoint.y=r._startPoint.y):(n=u.x-r._endPoint.x,r._startPoint.x+=n,r._endPoint.x=r._startPoint.x),r.points[0]=r._startPoint,r.points[r.points.length-1]=r._endPoint,e=this.selectedObject.segments.indexOf(this.selectedSegment),f=this.selectedObject.segments[e-1],f&&this.updatePreviousSegment(r,f,n,i)):r.type=="straight"?(r.points[r.points.length-1]=r._endPoint=u,r._point=r.point=u):(r.points[r.points.length-1]=r._endPoint=u,r._point=r.point=u,t.datavisualization.Diagram.Util._updateBezierPoints(r));this.nextSegment&&this.updateNextSegment(r,this.nextSegment,n,i)},r.prototype._addTerminalSegment=function(n,i,r){var u=this.selectedSegment,f,e,o,h,c,s;for(this.selectedObject.segments.pop(),f=this.selectedObject.segments[this.selectedObject.segments.length-1]&&this.selectedObject.segments[this.selectedObject.segments.length-1].type=="orthogonal"?this.selectedObject.segments[this.selectedObject.segments.length-1]:null,e=0;e<u.points.length-2;e++)o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(u.points[e],u.points[e+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(u.points[e],u.points[e+1])}),o.length==0&&(o._direction=f.direction=="top"||f.direction=="bottom"?o.direction=n>0?"right":"left":o.direction=i>0?"bottom":"top"),f=o,this.selectedObject.segments.push(o);if(h=Number(r[1]),(u.points.length==2||h==u.points.length-2)&&(f&&(f.length+=5,f._length=f.length),h!=0)){var l=t.datavisualization.Diagram.Geometry.distance(u.points[u.points.length-2],u._endPoint),a=t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint),v=t.datavisualization.Diagram.Segment({type:"orthogonal",length:2*l/3,direction:a});this.selectedObject.segments.push(v)}c=t.datavisualization.Diagram.Segment({type:"orthogonal"});this.selectedObject.segments.push(c);s=Number(r[0])+(Number(r[1])||0);this.selectedSegment=this.selectedObject.segments[s];this.nextSegment=this.selectedObject.segments[s+1];s==this.selectedObject.segments.length-2?this.nextSegment._direction=Number(r[0])==0?t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint):u._direction:c._direction=t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint);s==0&&this.insertFirstSegment(n,i,r)},r.prototype.insertFirstSegment=function(n,i,r){var u=this.selectedSegment,l,e,o,f,h,c,s,a;if(this.selectedObject.sourcePort&&u.length&&this.selectedObject.segments[0].points.length>2){for(this.selectedObject.segments.splice(0,1),f=[],e=0;e<u.points.length-1;e++)o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(u.points[e],u.points[e+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(u.points[e],u.points[e+1])}),o.length==0&&(o._direction=l.direction=="top"||l.direction=="bottom"?o.direction=n>0?"right":"left":o.direction=i>0?"bottom":"top"),l=o,f.push(o);this.selectedObject.segments=f.concat(this.selectedObject.segments);this.selectedSegment=this.selectedObject.segments[Number(r[1])];this.nextSegment=this.selectedObject.segments[Number(r[1])+1]}else u=this.selectedObject.segments[0],f=[],f.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:u.direction,length:u.length/3})),u.direction=="bottom"||u.direction=="top"?(h=Math.max(5,Math.abs(n)),c=n>0?"right":"left"):(h=Math.max(5,Math.abs(i)),c=i>0?"bottom":"top"),f.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:c,length:h})),s=this.selectedObject.segments[1],s&&s.length&&(c!=s.direction&&(h*=-1),s.length-=h,s._length=s.length),u.length=u._length=2*u._length/3,this.selectedObject.segments=f.concat(this.selectedObject.segments),a=Number(r[0])+Number(r[1]),this.selectedSegment=this.selectedObject.segments[2],this.nextSegment=this.selectedObject.segments[3]},r.prototype.updatePreviousSegment=function(n,i,r,u){i._endPoint=i.points[i.points.length-1]=n._startPoint;i.type=="orthogonal"?(i.direction=="bottom"?(i.length+=u,i.length<0&&(i._direction=i.direction="top",i.length*=-1)):i.direction=="top"?(i.length-=u,i.length<0&&(i._direction=i.direction="bottom",i.length*=-1)):i.direction=="right"?(i.length+=r,i.length<0&&(i._direction=i.direction="left",i.length*=-1)):i.direction=="left"&&(i.length-=r,i.length<0&&(i._direction=i.direction="right",i.length*=-1)),i._length=i.length):i.type=="bezier"&&t.datavisualization.Diagram.Util._updateBezierPoints(i)},r.prototype.updateNextSegment=function(n,i,r,u){var o=n._endPoint,e,f;i._startPoint=i.points[0]=this.selectedSegment._endPoint;i&&(i.type=="orthogonal"?(i.length||i.length===0)&&(i._direction=="left"||i._direction=="right"?(r!=0&&(i._direction=="right"?i._length-=r:i._length+=r,(i.length||i.length===0)&&(i.length=i._length,i.length<0&&(i.direction=="left"?i.direction="right":i.direction=="right"&&(i.direction="left"),i.length*=-1,i._direction=i.direction,i._length=i.length))),u!=0&&n.type!="orthogonal"&&(i._startPoint.y=i.points[0].y=i._endPoint.y=i.points[i.points.length-1].y=o.y,e=this.selectedObject.segments.indexOf(i),f=this.selectedObject.segments[e+1],f._startPoint.y=f.points[0].y=i._endPoint.y,f.length&&(f.direction=="bottom"?(f.length-=u,f.length<0&&(f.direction="top",f.length*=-1)):(f.length+=u,f.length<0&&(f.direction="bottom",f.length*=-1))))):(u!=0&&(i._direction=="bottom"?i._length-=u:i._length+=u,(i.length||i.length===0)&&(i.length=i._length,i.length<0&&(i.direction=="top"?i.direction="bottom":i.direction=="bottom"&&(i.direction="top"),i.length*=-1,i._length=i.length,i._direction=i.direction))),r!=0&&n.type!="orthogonal"&&(i._startPoint.x=i.points[0].x=i._endPoint.x=i.points[i.points.length-1].x=o.x,e=this.selectedObject.segments.indexOf(i),f=this.selectedObject.segments[e+1],f.length&&(f.direction=="right"?(f.length+=r,f.length<0&&(f.direction="left",f.length*=-1)):(f.length-=r,f.length<0&&(f.direction="right",f.length*=-1)))))):i.type=="bezier"&&t.datavisualization.Diagram.Util._updateBezierPoints(i))},r.prototype.mouseup=function(n){var o,s;if(n.shiftKey&&n.ctrlKey)this._addOrRemoveStraightSegments(n);else if(this.inAction){if(this.inAction=!1,this._endPoint=="segmentEnd"&&this.selectedSegment.type=="orthogonal"){var u=this.selectedObject.segments.indexOf(this.selectedSegment),f=this.selectedObject.segments[u-1],r=this.selectedObject.segments[u+1],e=!1;f&&f.type=="orthogonal"&&Math.abs(f.length)<5?u!=1&&(e=this._removePrevSegment(u)):r&&r.type=="orthogonal"&&(o=r.length||r.length===0?r.length:t.datavisualization.Diagram.Geometry.distance(r.points[0],r.points[1]),Math.abs(o<=5)&&(e=this._removeNextSegment(u)));e&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram._currZoom))}else this._endPoint!="segmentEnd"&&(this._updatePoints(this.selectedObject,t.datavisualization.Diagram.DragState.Completed),this._disconnect(this.selectedObject),this._currentPossibleConnection&&!this.inAction?this._updateConnection(this.selectedObject):(this.selectedObject.sourceNode||this.selectedObject.targetNode)&&this._updateConnection(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram));t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram);t.datavisualization.Diagram.SvgContext.update(this.selectedObject,this.diagram);this.diagram._updateConnectorBridging(this.selectedObject);this.diagram._updateSelectionHandle();this.selectedObject&&(this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest").style["pointer-events"]="",this.diagram._svg.getElementById(this.selectedObject.name).style["pointer-events"]="");this.diagram._svg.getElementById(this.diagram._svg.document.id+"handle_g").style["pointer-events"]="";this._initialValue=null}this.selectedObject&&(s={type:"endpointchanged",undoObject:this.undoObject,redoObject:this._getClonedObject(this.selectedObject),isMultipleNode:this.selectedObject._type==="group"?!0:!1},this.diagram.addHistoryEntry(s));i.prototype.mouseup.call(this,n)},r.prototype._addOrRemoveStraightSegments=function(n){var s,e,r,f,i,u;if(this._endPoint=="segmentEnd")s=n.target.id,e=s.split("_"),e.reverse(),r=Number(e[0]),i=this.selectedObject.segments[r],i&&i.type=="straight"&&(f=this.selectedObject.segments[r+1],f&&(this.selectedObject.segments.splice(r,1),f._startPoint=f.points[0]=i._startPoint,o=!0));else{var h=n.target.getAttribute("class"),s=n.target.id,o=!1,r=this._findIndex();this.selectedObject.segments&&this.selectedObject.segments[r]&&this.selectedObject.segments[r].type=="straight"&&(i=this.selectedObject.segments[r],u=t.datavisualization.Diagram.Segment({type:"straight",point:i._endPoint}),this.selectedObject.segments.splice(r+1,0,u),i._point=i.point=i.points[1]=i._endPoint=this.currentPoint,u.points[0]=u._startPoint=this.currentPoint,u.points[1]=u._endPoint=u.point,o=!0)}o&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram._currZoom))},r.prototype._findIndex=function(){for(var n,o,e,s,h,u,c,l,f,r=[],i=0;i<this.selectedObject.segments.length;i++)n=this.selectedObject.segments[i],o={x:Math.min(n._startPoint.x,n._endPoint.x),y:Math.min(n._startPoint.y,n._endPoint.y),width:Math.abs(n._startPoint.x-n._endPoint.x),height:Math.abs(n._startPoint.y-n._endPoint.y)},t.datavisualization.Diagram.Geometry.inflate(o,this.selectedObject.lineHitPadding/2,this.selectedObject.lineHitPadding/2),t.datavisualization.Diagram.Geometry.containsPoint(o,this.currentPoint)&&r.push(n);if(r.length==1)return this.selectedObject.segments.indexOf(r[0]);for(i=0;i<r.length;i++)u=r[i],f=this.currentPoint,c=(f.y-u._startPoint.y)/(u._endPoint.y-f.y),l=(f.x-u._startPoint.x)/(u._endPoint.x-f.x),e=Math.abs(c-l),i==0&&(s=e,h=0),e<s&&(s=e,h=i);return this.selectedObject.segments.indexOf(r[h])},r.prototype._removeNextSegment=function(n){var i=this.selectedObject.segments[n-1],r=this.selectedObject.segments[n+2],u=this.selectedObject.segments[n+1];return u.length||u.length===0?(this.selectedObject.segments.splice(n,2),this.selectedSegment.direction=="top"||this.selectedSegment.direction=="bottom"?(r._startPoint.y=this.selectedSegment._startPoint.y,i._endPoint.x=r._startPoint.x):(r._startPoint.x=this.selectedSegment._startPoint.x,i._endPoint.y=r._startPoint.y)):(this.selectedObject.segments.splice(n+1,1),this.selectedSegment.direction=="top"||this.selectedSegment.direction=="bottom"?i._endPoint.x=u._endPoint.x:i._endPoint.y=u._endPoint.y,i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint)),this.selectedSegment.length=this.selectedSegment._length=this.selectedSegment.direction=null),i&&r&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,r._startPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,r._startPoint)),(r.length||r.length===0)&&(r._length=r.length=t.datavisualization.Diagram.Geometry.distance(i._endPoint,r._endPoint),r.length&&(r._direction=r.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._endPoint,r._endPoint)))),!0},r.prototype._removePrevSegment=function(n){var i=this.selectedObject.segments[n-2],f=this.selectedObject.segments[n+1],o=f.length||f.length===0?f.length:t.datavisualization.Diagram.Geometry.distance(f.points[0],f.points[1]),r,u,e;return o<=5?(r=this.selectedObject.segments[n+2],f.length===o?this.selectedObject.segments.splice(n-1,4):this.selectedObject.segments.splice(n-1,3),r?(i.direction=="top"||i.direction=="bottom"?(i._endPoint.y=r._endPoint.y,r._startPoint.x=i._endPoint.x):(i._endPoint.x=r._endPoint.x,r._startPoint.y=i._endPoint.y),(i.length||i.length===0)&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint))),(r.length||r.length===0)&&(r._length=r.length=t.datavisualization.Diagram.Geometry.distance(r._startPoint,r._endPoint),r._length&&(r._direction=r.direction=t.datavisualization.Diagram.Util._getBezierDirection(r._startPoint,r._endPoint)))):(i._endPoint=this.selectedObject.endPoint,i.direction=i.length=i._length=null,i._direction=f._direction)):(u=this.selectedObject.segments[n+1],this.selectedObject.segments.splice(n-1,2),e=this.selectedSegment,e.direction=="left"||e.direction=="right"?(i._endPoint.x=u._startPoint.x,u._startPoint.y=i._endPoint.y):(i._endPoint.y=u._startPoint.y,u._startPoint.x=i._endPoint.x),(this.selectedSegment.length||this.selectedSegment.length===0)&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint))),(u.length||u.length===0)&&(u._length=u.length=t.datavisualization.Diagram.Geometry.distance(u._startPoint,u._endPoint),u.length&&(u._direction=u.direction=t.datavisualization.Diagram.Util._getBezierDirection(u._startPoint,u._endPoint)))),!0},r.prototype._getClonedObject=function(t){if(t){var i=n.extend(!0,{},t);return i.targetNode=t.targetNode,i.sourceNode=t.sourceNode,i.targetPort=t.targetPort,i.sourcePort=t.sourcePort,i}},r.prototype._updateConnection=function(n,i){var r,u;this._endPoint=="targetEndPoint"?(this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(n.targetNode!=this._currentPossibleConnection.name||n.targetPort!=this._possibleConnectionPort.name)&&(r=this._raiseConnectionChangeEvent(n,!0)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(n.targetNode!=this._currentPossibleConnection.name||n.targetPort)&&(r=this._raiseConnectionChangeEvent(n,!0)):this.selectedObject.targetNode&&(r=this._raiseConnectionChangeEvent(n,!0)),r&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),(n.segments.length>2||n.segments[0].points.length==2)&&t.datavisualization.Diagram.Util._updatePreviousSegment(n),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram.model.zoomFactor))):this._endPoint=="sourceEndPoint"&&(this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(n.sourceNode!=this._currentPossibleConnection.name||n.sourcePort!=this._possibleConnectionPort.name)&&(r=this._raiseConnectionChangeEvent(n)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(n.sourceNode!=this._currentPossibleConnection.name||n.sourcePort)&&(r=this._raiseConnectionChangeEvent(n)):(this.selectedObject.sourceNode&&(r=this._raiseConnectionChangeEvent(n),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram)),r&&t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram.model.zoomFactor)));u=this.selectedSegment._endPoint;this.diagram._dock(n,this.diagram.nameTable,i);r&&this._endPoint=="sourceEndPoint"&&this.selectedObject.segments.length>1&&(this.selectedSegment.points.length==2&&!this.selectedObject.sourcePort&&this.selectedSegment.length?(this.selectedSegment.direction=="right"||this.selectedSegment.direction=="left"?(this.selectedSegment.direction=this.selectedSegment._startPoint.x<u.x?this.selectedSegment._direction="right":this.selectedSegment._direction="left",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.x-u.x)):(this.selectedSegment.direction=this.selectedSegment._startPoint.y<u.y?this.selectedSegment._direction="bottom":this.selectedSegment._direction="top",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.y-u.y)),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram.model.zoomFactor)):r&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram.model.zoomFactor)))},r.prototype._raiseConnectionChangeEvent=function(n,i){var u=this._raiseEvent("connectionChange",{element:this.selectedObject,endPoint:this._endPoint,connection:this._currentPossibleConnection,port:this._possibleConnectionPort,cancel:!1}),r;if(!u.cancel)return i?(this._currentPossibleConnection&&n.targetNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.inEdges.push(n.name),n.targetNode&&(r=this.diagram.nameTable[this.selectedObject.targetNode],t.datavisualization.Diagram.Util.removeItem(r.inEdges,n.name))),n.targetNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,n.targetPort=this._possibleConnectionPort?this._possibleConnectionPort.name:null):(this._currentPossibleConnection&&n.sourceNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.outEdges.push(n.name),n.sourceNode&&(r=this.diagram.nameTable[this.selectedObject.sourceNode],t.datavisualization.Diagram.Util.removeItem(r.outEdges,n.name))),n.sourceNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,n.sourcePort=this._possibleConnectionPort?this._possibleConnectionPort.name:null),!0},r.prototype._disconnect=function(){},r.prototype._endAction=function(){this._showPorts();var n;this._currentPossibleConnection&&!this._possibleConnectionPort&&(n=this._currentPossibleConnection);i.prototype._endAction.apply(this);this._endPoint&&(this._endPoint=null,n&&(this.diagram._checkToolToActivate(n,this.currentPoint),this.diagram._updateCursor()))},r.prototype._updatePoints=function(n,i){var f,o,e,v,u,w,d,y,b,c,l,p,r,s,h,a,k;if(this._endPoint!="segmentEnd"&&(f=this._endPoint=="targetEndPoint"?!0:!1,o=this._endPoint=="sourceEndPoint"?!0:!1,this._endPoint)){v=this._endPoint.match("bezierpoint1")?"bezierpoint1":this._endPoint.match("bezierpoint2")?"bezierpoint2":this._endPoint;switch(v){case"targetEndPoint":e=this.selectedSegment._endPoint;break;case"sourceEndPoint":e=this.selectedSegment._startPoint;break;case"bezierpoint1":e=this.selectedSegment._point1;break;case"bezierpoint2":e=this.selectedSegment._point2}if(u=this.currentPoint,this._possibleConnectionPort==null&&(u=this.snap(u)),w=t.datavisualization.Diagram.Point(e.x-u.x,e.y-u.y),d=this._raiseEndPointDrag(f,o,i),!t.datavisualization.Diagram.Geometry.isEmptyPoint(w)&&(y=!1,c=null,this.inAction||(f?c="target":o&&(c="source"),b=this._raiseEvent("drag",{end:c,element:this.diagram.getNode(this.selectedObject),cancel:!1}),y=b.cancel),!y))if(f||o){if(l=this._currentPossibleConnection?t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection,!1):!1,this.selectedObject.segments.length>1&&(f||l||this.selectedSegment.type!="orthogonal"||!this.selectedSegment.length&&this.selectedSegment.length!==0?f&&!l&&this.selectedSegment.type=="orthogonal"&&this.selectedSegment.points.length==2&&(s=u.x-this.selectedSegment._endPoint.x,h=u.y-this.selectedSegment._endPoint.y,this.selectedSegment._direction=="left"||this.selectedSegment._direction=="right"?(this.selectedSegment._startPoint.y=this.selectedSegment.points[0].y+=h,this.selectedSegment._endPoint.y=this.selectedSegment.points[1].y=this.selectedSegment._startPoint.y):(this.selectedSegment._startPoint.x=this.selectedSegment.points[0].x+=s,this.selectedSegment._endPoint.x=this.selectedSegment.points[1].x=this.selectedSegment._startPoint.x),a=this.selectedObject.segments.length-1,this.selectedObject.segments[a-1]&&this.updatePreviousSegment(this.selectedObject.segments[a],this.selectedObject.segments[a-1],s,h)):(this.selectedObject.sourcePoint=u,s=u.x-this.selectedSegment._startPoint.x,h=u.y-this.selectedSegment._startPoint.y,this.selectedSegment.direction=="left"||this.selectedSegment.direction=="right"?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=u.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=u.x,this.selectedSegment._startPoint=this.selectedSegment.points[0]=u,this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(u,this.selectedSegment._endPoint),this.selectedSegment._length&&(this.selectedSegment._direction=this.selectedSegment.direction=t.datavisualization.Diagram.Util._getBezierDirection(u,this.selectedSegment._endPoint)),this.updateNextSegment(this.selectedObject.segments[0],this.selectedObject.segments[1],s,h),r=this.selectedObject.segments[1],p=!1,r&&r.length&&(r.length=r._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,r._endPoint),r.length&&(r.direction=r._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,r._endPoint))),this.selectedSegment.length==0||r.length===0?(r.length==0&&this.selectedObject.segments.length>2?this.selectedObject.segments.splice(0,2):this.selectedObject.segments.length>1&&this.selectedObject.segments.splice(0,1),this.selectedSegment=this.selectedObject.segments[0],this.selectedSegment._startPoint=this.selectedSegment.points[0]=u,this.selectedSegment._direction=="left"||this.selectedSegment._direction=="right"?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=u.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=u.x,r=this.selectedObject.segments[1],this.selectedObject.segments.length>1?(this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(u,r._startPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(n.segments[1],n.segments[0],n.segments[2],n.sourcePoint,n.targetPoint),r._startPoint=r.points[0]=n.segments[0]._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),p=!0):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),r&&r.length&&(r.length=r._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,r._endPoint),r.length&&(r.direction=r._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,r._endPoint))))),(o||f)&&!l&&(k=this.selectedSegment.points.length,this.diagram._setEndPoint(n,t.datavisualization.Diagram.Point(u.x,u.y),f),k!=this.selectedSegment.points.length||p))return!0}else t.datavisualization.Diagram.Util._setBezierPoint(this.selectedSegment,t.datavisualization.Diagram.Point(u.x,u.y),v)}},r}(i);t.datavisualization.Diagram.ConnectionEditTool=o;s=function(n){function i(t){n.call(this,"shapeTool",t);this.cursor="crosshair"}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){n.prototype.mousedown.call(this,t);this.selectedObject=this.createNode();this.selectedObject._type="node"},i.prototype.createNode=function(){var n=this.diagram._getNewNode(this.diagram.model.drawType);return n.name=this.diagram.model.drawType.name?this.diagram.model.drawType.name+t.datavisualization.Diagram.Util.randomId():"node"+t.datavisualization.Diagram.Util.randomId(),n.offsetX=this.currentPoint.x,n.offsetY=this.currentPoint.y,n.width=5,n.height=5,!n.type=="text"&&(n.shape=this.diagram.model.drawType.shape?this.diagram.model.drawType.shape:n.shape),n},i.prototype.mousemove=function(t){n.prototype.mousemove.call(this,t);this.selectedObject&&(this.inAction?this._updateHelper():(this.inAction=!0,this._initHelper(),this._renderHelper(),this._calcOffset()))},i.prototype.mouseup=function(t){if(this.inAction){this.inAction=!1;this.diagram.model.snapSettings.snapConstraints.snapToLines&&this._calcOffset();var i=this.createNode();this._updateSize(this.selectedObject,this.startPoint,this.currentPoint);this.diagram.add(this.selectedObject);this.diagram._clearSelection();this.diagram._addSelection(this.selectedObject)}this.diagram._toolToActivate="selectTool";this.diagram._drawingTool=!1;n.prototype.mouseup.call(this,t)},i.prototype._calcOffset=function(){var r=this.diagram.model.magnification/100,n=t.datavisualization.Diagram.Util.bounds(this.helper),i=n.topLeft;i=t.datavisualization.Diagram.Point(n.x+n.width,n.y+n.height);var u=i.x*r,f=i.y*r,e=t.datavisualization.Diagram.Point(u,f),o=this.snap(t.datavisualization.Diagram.Point(u,f));this._mouseOffset=t.datavisualization.Diagram.Size(e.x-o.x,e.y-o.y)},i.prototype.getBoundingRect=function(){var u=Math.abs(this.startPoint.x-this.currentPoint.x),f=Math.abs(this.startPoint.y-this.currentPoint.y),n=t.datavisualization.Diagram.Size(u,f),i,r;return this.diagram.model.snapSettings.snapConstraints.snapToVerticalLines&&this._mouseOffset.width!=0&&(n.width-=this._mouseOffset.width,this._mouseOffset.width=0),this.diagram.model.snapSettings.snapConstraints.snapToHorizontalLines&&this._mouseOffset.height!=0&&(n.height-=this._mouseOffset.height,this._mouseOffset.height=0),i=Math.min(this.startPoint.x,this.currentPoint.x),r=Math.min(this.startPoint.y,this.currentPoint.y),{size:n,offset:t.datavisualization.Diagram.Point(i,r)}},i.prototype._renderHelper=function(){this.svgHelper||(this.svgHelper=t.datavisualization.Diagram.SvgContext.renderNode(this.helper,this.diagram._svg,this.diagram._diagramLayer),this.svgHelper=document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"))},i.prototype._updateHelper=function(){this._updateSize(this.helper,this.startPoint,this.currentPoint);t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},i.prototype._updateSize=function(n,i,r){var f=this.getBoundingRect(i,r),u=f.size,e=f.offset;t.datavisualization.Diagram.Geometry.isEmptySize(u)||(n.offsetX=e.x+u.width/2,n.offsetY=e.y+u.height/2,n.width=u.width,n.height=u.height,n._shape==="path"&&(n._scaled=!0))},i}(i);t.datavisualization.Diagram.ShapeTool=s;r=function(i){function r(n,t){i.call(this,n,t);this.cursor="crosshair";this._isMouseDown=!1;this._targetPossibleConnection=null;this._sourcePossibleConnection=null;this._targetPort=null;this._sourcePort=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);t.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(this._isMouseDown=!0,this.diagram._hasSelection()&&this.diagram._clearSelection(),this._currentPossibleConnection&&(this._sourcePossibleConnection=this._currentPossibleConnection,this._sourcePort=this._possibleConnectionPort),this._raiseEndPointDrag(!0,!1,t.datavisualization.Diagram.DragState.Starting))},r.prototype.mousemove=function(n){if(i.prototype.mousemove.call(this,n),this._checkConnectionPossible(n),this._isMouseDown)if(this.inAction){if(this._targetPossibleConnection=this._currentPossibleConnection,this._targetPort=this._possibleConnectionPort,this.helper){var r=this._raiseEndPointDrag(!0,!1,t.datavisualization.Diagram.DragState.Dragging);r.cancel||this._updateHelper()}}else this.inAction=!0,this._initHelper(),this._renderHelper();this.previousPoint=this.currentPoint},r.prototype.mouseup=function(n){var r,u,f;if(this._isMouseDown=!1,this.inAction){this.inAction=!1;var e=this._getStartPoint(),o=this._getCurrentPoint(),s=t.datavisualization.Diagram.Geometry.distance(e,o);s>0&&(r=this.createConnector(e,o),r.name="connector"+t.datavisualization.Diagram.Util.randomId(),this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(u=this._raiseEvent("connectionChange",{element:r,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),f=this._raiseEndPointDrag(!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.sourceNode=this._sourcePossibleConnection.name,r.sourcePort=this._sourcePort.name,t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name))):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(u=this._raiseEvent("connectionChange",{element:r,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),f=this._raiseEndPointDrag(!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.sourceNode=this._sourcePossibleConnection.name,t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name)))),this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(u=this._raiseEvent("connectionChange",{element:r,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),f=this._raiseEndPointDrag(!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.targetNode=this._targetPossibleConnection.name,r.targetPort=this._targetPort.name,t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name))):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(u=this._raiseEvent("connectionChange",{element:r,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),f=this._raiseEndPointDrag(!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.targetNode=this._targetPossibleConnection.name,t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name)))),this.diagram.add(r),r=this.diagram.nameTable[r.name],t.datavisualization.Diagram.Util.updateBridging(r,this.diagram),t.datavisualization.Diagram.SvgContext.update(r,this.diagram),this.diagram._updateConnectorBridging(r))}this.singleAction&&this.diagram.deactivateTool();this._prevTool&&(this._prevTool.inAction=!1);this._showPorts();i.prototype.mouseup.call(this,n)},r.prototype._getStartPoint=function(){return this._sourcePossibleConnection&&this._sourcePort?t.datavisualization.Diagram.Util._getPortPosition(this._sourcePort,t.datavisualization.Diagram.Util.bounds(this._sourcePossibleConnection)):this.snap(this.startPoint)},r.prototype._getCurrentPoint=function(){return this._targetPossibleConnection&&this._targetPort?t.datavisualization.Diagram.Util._getPortPosition(this._targetPort,t.datavisualization.Diagram.Util.bounds(this._targetPossibleConnection)):this.snap(this.currentPoint)},r.prototype._initHelper=function(){this.helper=this.createConnector(t.datavisualization.Diagram.Point(0,0),t.datavisualization.Diagram.Point(0,0));this.diagram._setZorder(this.helper);this.helper.name="helper"},r.prototype.createConnector=function(){return null},r.prototype._renderHelper=function(){this.svgHelper||(this.svgHelper=t.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer),this.svgHelper=this.diagram._svg.document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"),n(this.diagram._svg.getElementById(this.svgHelper.id)).attr("pointer-events","none"),n(this.diagram._svg.getElementById(this.svgHelper.id+"_hitTest")).attr("pointer-events","none"))},r.prototype._updateHelper=function(){var n=[],i=this._getStartPoint(),r=this._getCurrentPoint();n.push(i);n.push(r);this.diagram._setEndPoint(this.helper,i,!1);this.diagram._setEndPoint(this.helper,r,!0);this._disconnect(this.helper);this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(this.helper.sourceNode=this._sourcePossibleConnection.name,this.helper.sourcePort=this._sourcePort.name,this._sourcePossibleConnection.outEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(this.helper.sourceNode=this._sourcePossibleConnection.name,this._sourcePossibleConnection.outEdges.push(this.helper.name)));this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(this.helper.targetNode=this._targetPossibleConnection.name,this.helper.targetPort=this._targetPort.name,this._targetPossibleConnection.inEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(this.helper.targetNode=this._targetPossibleConnection.name,this._targetPossibleConnection.inEdges.push(this.helper.name)));this.diagram._dock(this.helper,this.diagram.nameTable);t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},r.prototype._endAction=function(){i.prototype._endAction.apply(this);this._targetPossibleConnection=null;this._sourcePossibleConnection=null;this._targetPort=null;this._sourcePort=null;this._isMouseDown=!1},r.prototype._showPorts=function(){},r.prototype._showAllPorts=function(n){i.prototype._showAllPorts.call(this,n)},r}(i);t.datavisualization.Diagram.LineTool=r;h=function(n){function i(t){n.call(this,"straightLine",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createConnector=function(n,t){return this.diagram._getNewConnector({segments:[{type:"straight"}],sourcePoint:n,targetPoint:t})},i}(r);t.datavisualization.Diagram.StraightLineTool=h;c=function(n){function i(t){n.call(this,"orthogonalLine",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createConnector=function(n,t){return this.diagram._getNewConnector({segments:[{type:"orthogonal"}],sourcePoint:n,targetPoint:t})},i}(r);t.datavisualization.Diagram.OrthogonalLineTool=c;l=function(i){function r(n){i.call(this,"rotatetool",n);this._mouseOffset=t.datavisualization.Diagram.Size(0,0);this.undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(t){var u,r,f,e;i.prototype.mousedown.call(this,t);this.selectedObject=this.diagram.selectionList[0];r={};(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(r=this.diagram._getChildTable(this.selectedObject,r));f={childTable:r,node:this.selectedObject};u=n.extend(!0,{},f);this.undoObject=jQuery.extend(!0,{},u);e=this.diagram._currZoom},r.prototype.mousemove=function(n){var f,r,e,u,o;if(i.prototype.mousemove.call(this,n),this.selectedObject)if(this.inAction)u=!1,this.selectedObject.parent?(o=this.diagram.nameTable[this.selectedObject.parent],o.container&&(u=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(u=!0),u?(this.helper||(this.helper=this._getCloneNode(this.selectedObject),this.helper.name="helper"),this._rotate(this.helper),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram)):this.selectedObject.type=="pseudoGroup"&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))?this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&this.hasSameParent()&&(this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject)):(this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject));else{if(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")for(f=this.diagram._getChildren(this.selectedObject.children),r=0;r<f.length;r++)if(e=this.diagram.nameTable[f[r]],!t.datavisualization.Diagram.Util.canResize(e))return;this.inAction=!0}this.previousPoint=this.currentPoint},r.prototype._rotate=function(n){var r=!1,u;if(this.inAction||(u=this._raiseEvent("rotationChange",{element:this.diagram.getNode(n),cancel:!1}),r=u.cancel),!r){var f=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),e=this.currentPoint,i=t.datavisualization.Diagram.Geometry.findAngle(t.datavisualization.Diagram.Point(f.x,f.y),e)+90;i=t.datavisualization.Diagram.SnapUtil._snapAngle(this.diagram,i);this.diagram._rotate(n,i-n.rotateAngle,this.diagram.nameTable)}},r.prototype._updateRotateObject=function(){var i=this.diagram.nameTable[this.selectedObject.name],n;return t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.helper&&(n=this.helper.rotateAngle-this.diagram.nameTable[this.selectedObject.name].rotateAngle,this.diagram._rotate(this.selectedObject,n,this.diagram.nameTable),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)),i},r.prototype._updateContainer=function(n,i,r){var e,o,c=0,l=0,f,s,rt,u,d,ut,h,p,w,nt,tt,it,b,k;if(n&&(s=this.diagram.nameTable[n.parent],s||n.type!="pseudoGroup"||(rt=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],s=this.diagram.nameTable[rt.parent]),s))if(s.container.type=="canvas"){if(r){r=!1;u=this.diagram.nameTable[n.parent];u||n.type!="pseudoGroup"||(u=s);d=t.datavisualization.Diagram.Util.bounds(u);ut=u.rotateAngle;this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram);e=t.datavisualization.Diagram.Util.bounds(n);h=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);o=t.datavisualization.Diagram.Util.bounds(u);var a=this.diagram._getTightChildrenBounds(u),ft=!0,g=!0,v=h.x+h.width,y=h.y+h.height;v>=o.right&&(c=v-o.right+u.paddingRight,f=this.diagram._getMinMaxSize(u,u.width+c,u.height,!0),p=f.width-u.width,u.width=f.width,u.offsetX+=p/2,v<o.right&&(ft=!1));y>=o.bottom&&(l=y-o.bottom+u.paddingBottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+l,!0),w=f.height-u.height,u.height=f.height,u.offsetY+=w/2,g=!0,y<o.bottom&&(g=!1));v<o.right&&ft&&(c=a.x+a.width+u.paddingRight-o.right,f=this.diagram._getMinMaxSize(u,u.width+c,u.height,!0),p=f.width-u.width,u.width=f.width,u.offsetX+=p/2);y<o.bottom&&g&&(l=a.y+a.height+u.paddingBottom-o.bottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+l,!0),w=f.height-u.height,u.height=f.height,u.offsetY+=w/2);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram);this._updateMargin(n,u);t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram);this.diagram._rotate(u,ut,this.diagram.nameTable);nt=t.datavisualization.Diagram.Util.bounds(u);this.diagram._translate(u,d.topLeft.x-nt.topLeft.x,d.topLeft.y-nt.topLeft.y,this.diagram.nameTable);u.parent&&u.container&&u.container.type=="canvas"&&this._updateMargin(u,this.diagram.nameTable[u.parent]);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram)}else tt=!1,it=!1,u=this.diagram.nameTable[n.parent],n.container&&n.container.type=="stack"&&(n.container.orientation=="vertical"?tt=!0:it=!0),e=this.diagram._getBoundsWithoutStretch(u,tt,it),e.width+=u.paddingLeft+u.paddingRight,e.height+=u.paddingTop+u.paddingBottom,f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),b=f.width-u.width,k=f.height-u.height,u.offsetX+=b/2,u.width=f.width,u.offsetY+=k/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram);u.parent&&(this.diagram.nameTable[u.parent]&&(r=!0),this._updateContainer(u,null,r))}else s.container.type=="stack"&&(u=this.diagram.nameTable[n.parent],e=t.datavisualization.Diagram.SvgContext._measureStackSize(u,this.diagram,!0),f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),b=f.width-u.width,k=f.height-u.height,u.offsetX+=b/2,u.width=f.width,u.offsetY+=k/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnStack(u,this.diagram),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram),u.parent&&this._updateContainer(u))},r.prototype.mouseup=function(r){var f,o,u,s,h,c,e,l,a;this.inAction&&(this.inAction=!1,f=!1,o=!1,this.selectedObject.parent?(u=this.diagram.nameTable[this.selectedObject.parent],u.container&&(f=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(s=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],u=this.diagram.nameTable[s.parent],u.container&&(f=!0)),f&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter(),u.container.type=="canvas"&&(o=!0),o&&(h=this._updateRotateObject(),this._updateContainer(h,null,!0))),this.selectedObject.type!="pseudoGroup"?this._rotate(this.selectedObject):this._fromContainer(this.diagram._getChildren(this.selectedObject.children))||this._rotate(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),e={},(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(e=this.diagram._getChildTable(this.selectedObject,e)),l={childTable:e,node:this.selectedObject},c=n.extend(!0,{},l),a={type:"rotationchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},c),isMultipleNode:this.selectedObject._type==="group"?!0:!1},this.diagram.addHistoryEntry(a),this.diagram._updateSelectionHandle(),this.diagram._removeTooltip());i.prototype.mouseup.call(this,r)},r}(i);t.datavisualization.Diagram.RotateTool=l;a=function(n){function i(i){n.call(this,"PivotTool",i);this._mouseOffset=t.datavisualization.Diagram.Size(0,0)}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){n.prototype.mousedown.call(this,t);this.selectedObject=this.diagram.selectionList[0]},i.prototype.mousemove=function(i){if(n.prototype.mousemove.call(this,i),this.selectedObject)if(this.inAction){var r=this.currentPoint.x-this.previousPoint.x,u=this.currentPoint.y-this.previousPoint.y,f=t.Matrix.identity();t.Matrix.rotate(f,-this.selectedObject.rotateAngle);var e=t.Matrix.transform(f,t.datavisualization.Diagram.Point(r,u)),o=(this.selectedObject.width*this.selectedObject.pivot.x+e.x)/this.selectedObject.width,s=(this.selectedObject.height*this.selectedObject.pivot.y+e.y)/this.selectedObject.height;this.selectedObject.pivot.x=o;this.selectedObject.pivot.y=s;this.selectedObject.offsetX+=r;this.selectedObject.offsetY+=u;this.diagram._updateSelectionHandle()}else this.inAction=!0;this.previousPoint=this.currentPoint},i.prototype._rotate=function(n){var i=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),r=this.currentPoint,u=this.FindAngle(i,r);this.diagram._rotate(n,u-n.rotateAngle,i,this.diagram.nameTable)},i.prototype.mouseup=function(t){this.inAction&&(this.inAction=!1,this.diagram._updateSelectionHandle());n.prototype.mouseup.call(this,t)},i}(i);t.datavisualization.Diagram.PivotTool=a;v=function(n){function i(t){n.call(this,"panTool",t);this.diagram=t;this._isMouseDown=!1;this.cursor="pointer"}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){var r,i,u;return n.prototype.mousedown.call(this,t),r=this.diagram._svg.document,i=this.diagram._svg.document.createSVGPoint(),i.x=t.clientX,i.y=t.clientY,u=i.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),r.lastMouseX=u.x,r.lastMouseY=u.y,this._isMouseDown=!0,!1},i.prototype.mousemove=function(i){var r,u;if(n.prototype.mousemove.call(this,i),this._isMouseDown){this.inAction=!0;r=this.diagram._svg.document;u=this.diagram._svg.document.createSVGPoint();u.x=i.clientX;u.y=i.clientY;var h=u.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),f=h.x,e=h.y,o,s;return o=f-r.lastMouseX,s=e-r.lastMouseY,this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||(o=0),this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY||(s=0),t.datavisualization.Diagram.ZoomUtil.zoomPan(this.diagram,1,o,s,t.datavisualization.Diagram.Point(f,e)),r.lastMouseX=f,r.lastMouseY=e,!1}},i.prototype.mouseup=function(t){this.inAction=!1;document.onmousemove=null;document.onmouseup=null;this._isMouseDown=!1;n.prototype.mouseup.call(this,t)},i}(i);t.datavisualization.Diagram.PanTool=v;y=function(i){function r(n,r){i.call(this,n,r);this.boundingRect=t.datavisualization.Diagram.Rectangle();this.activeLabel=null;this.cursor="crosshair"}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);this._findNodeUnderMouse(n);this.diagram._isEditing&&this.diagram._endEdit()},r.prototype.createNode=function(){},r.prototype.mousemove=function(n){i.prototype.mousemove.call(this,n);t.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(this.selectedObject||t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this.diagram._isEditing||(this.inAction?this._updateHelper():(this.inAction=!0,this._initHelper())))},r.prototype.mouseup=function(n){var r,u,i;this.activeLabel=null;r=12;this.inAction?(i=this.getBoundingRect(this.startPoint,this.currentPoint),this._endAction(),(i.width===0||i.height===0)&&(i.width=90,i.height=r),this.selectedObject=this.createNode(i.x+i.width/2,i.y+i.height/2,i.width,i.height),this.diagram._startEdit(this.selectedObject)):(u=this._findNodeUnderMouse(n),u!=null&&t.datavisualization.Diagram.Util.isPageEditable(this.diagram)?(this.selectedObject=u,this.diagram._startEdit(this.selectedObject)):(i=t.datavisualization.Diagram.Rectangle(this.currentPoint.x-45,this.currentPoint.y-r/2,90,r),this._endAction(),this.selectedObject=this.createNode(i.x+i.width/2,i.y+i.height/2,i.width,r),this.diagram._startEdit(this.selectedObject)))},r.prototype.getBoundingRect=function(){var n=Math.abs(this.startPoint.x-this.currentPoint.x),t=Math.abs(this.startPoint.y-this.currentPoint.y),i=this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x,r=this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y;return{x:i,y:r,width:n,height:t}},r.prototype._initHelper=function(){var n,t,i;this._svgHelper||(n=this.diagram._svg.g(),this.diagram._adornerLayer.appendChild(n),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),n.appendChild(i),n.setAttribute("pointer-events","none"),this._svgHelper=n)},r.prototype._updateHelper=function(){var t=this.diagram._svg.getElementById("helper"),i=Math.abs(this.startPoint.x-this.currentPoint.x),r=Math.abs(this.startPoint.y-this.currentPoint.y),n=this.diagram._currZoom,u=(this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x)*n,f=(this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y)*n;t&&this.diagram._svg.rect({id:t.id,x:u,y:f,width:i*n,height:r*n})},r.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this._svgHelper=null);i.prototype._endAction.apply(this)},r.prototype._findNodeUnderMouse=function(t){var i,e=n(t.target).context,o,s,r,f;if(e.getAttribute("class")=="ej-d-label")o=n(e).parents(".ej-d-node,.ej-d-connector,.ej-d-group")[0],i=this._findObj(o),i.labels.length&&(s=e.id.split("_"),this.activeLabel=i.labels.filter(function(n){if(n.name===s[1])return n})[0]);else if(r=n(t.target).parents("g"),r.length>3){var h=r[r.length-4],c=h.getAttribute("id"),u=h.getAttribute("class");u&&(u==="ej-d-node"||u==="ej-d-group"?(i=this.diagram._findNode(c),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f):u==="ej-d-connector"&&(i=this.diagram._findConnector(c),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f))}return i},r}(t.datavisualization.Diagram.ToolBase);t.datavisualization.Diagram.TextToolBase=y;p=function(n){function i(t){n.call(this,"textTool",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createNode=function(n,i,r,u){return t.datavisualization.Diagram.Node({name:"text"+t.datavisualization.Diagram.Util.randomId(),offsetX:n,offsetY:i,width:r,height:u,borderColor:"transparent",fillColor:"transparent",labels:[],ports:[],type:"text",textBlock:t.datavisualization.Diagram.TextBlockDefaults})},i}(t.datavisualization.Diagram.TextToolBase);t.datavisualization.Diagram.TextTool=function(n){return new p(n)};w=function(i){function r(n){i.call(this,"phase",n);this.selectedSeperetor=null;this._svgHelper=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);this.inAction=!0},r.prototype._getSeperator=function(t){if(n(t.target).parents("g").first()[0]){var i=n(t.target).parents("g").first()[0].id;return this._getphase(i)}},r.prototype._removePhasehelper=function(){t.datavisualization.Diagram.SvgContext._removePhasehelper(this.diagram)},r.prototype._updatePhasehelper=function(n){var i=this._bounds?jQuery.extend(!0,{},this._bounds):this.diagram._getPhaseBounds(n),r,u,f=this.snap(this.startPoint),e=this.snap(this.currentPoint);n.orientation=="horizontal"?(r=e.x-f.x,u=0):(r=0,u=e.y-f.y);i&&(i.width+=r,i.height+=u,t.datavisualization.Diagram.SvgContext._updatePhaseHelper(this.diagram,n,i))},r.prototype._drawPhasehelper=function(n){var i=this.diagram._getPhaseBounds(n);n&&i&&t.datavisualization.Diagram.SvgContext._phasehelper(this.diagram,n,i)},r.prototype.mousemove=function(n){if(i.prototype.mousemove.call(this,n),this.selectedSeperetor)this.selectedSeperetor&&(this._bounds||(this._bounds=this.diagram._getPhaseBounds(this.selectedSeperetor)),this._updatePhasehelper(this.selectedSeperetor));else{if(this.inAction){var t=this._getSeperator(n);t&&!this.selectedSeperetor&&(this.selectedSeperetor=t)}this._drawPhasehelper(this.selectedSeperetor);this.diagram.selectionList[0]&&this.diagram.selectionList[0].type!="phase"?(this.diagram._clearSelection(),this.diagram.addSelection(this.selectedSeperetor)):this.diagram.addSelection(this.selectedSeperetor)}this.previousPoint=this.currentPoint},r.prototype._updateLaneMinValue=function(n,t,i){var f=this.diagram.nameTable[n],r,u,e;if(f&&f.children&&f.children.length>0&&(u=this.diagram.nameTable[f.children[2]],u&&u.children&&u.children.length>0))for(e=0;e<u.children.length;e++)r=this.diagram.nameTable[u.children[e]],r&&(r.minHeight=r.height+i,r.minWidth=r.width+t)},r.prototype._updateSwimlane=function(n,i,r,u,f){var s=0,l=0,c,w,e,a;if(i=i?i:1e-6,r=r?r:1e-6,i=-i,r=-r,u){if(i=1e-6,this.selectedSeperetor&&this.selectedSeperetor.parent&&(e=this.diagram.nameTable[this.selectedSeperetor.parent]),e){var h=this._getOuterPhaseNodes(e,u),v=this._getLeastOffset(e,u),y=t.datavisualization.Diagram.Util.bounds(e),p=this.snap(this.currentPoint),o=p.y-(y.y+this.selectedSeperetor.offset);p.y<v+20*this.diagram._currZoom?(o=v+10*this.diagram._currZoom-(y.y+this.selectedSeperetor.offset),f&&(o=r),n.offset+=o,this._updateSelectedPhase(n,i,o),l=o):(f&&(r=-r),n.offset+=r,this._updateSelectedPhase(n,i,r),l=r);this._updateLaneMinValue(n.parent,0,o);for(c in h)this.diagram._translate(h[c],0,o,this.diagram.nameTable),h[c].marginTop+=o,t.datavisualization.Diagram.DiagramContext.update(h[c],this.diagram)}}else if(r=1e-6,this.selectedSeperetor&&this.selectedSeperetor.parent&&(e=this.diagram.nameTable[this.selectedSeperetor.parent]),e){var h=this._getOuterPhaseNodes(e,u),v=this._getLeastOffset(e,u),y=t.datavisualization.Diagram.Util.bounds(e),p=this.snap(this.currentPoint),o=p.x-(y.x+this.selectedSeperetor.offset);p.x<v+20*this.diagram._currZoom?(o=v+10*this.diagram._currZoom-(y.x+this.selectedSeperetor.offset),f&&(o=-i),n.offset+=o,this._updateSelectedPhase(n,o,r),s=o):(f&&(i=-i),n.offset+=i,this._updateSelectedPhase(n,i,r),s=i);this._updateLaneMinValue(n.parent,s,0);for(c in h)this.diagram._translate(h[c],s,0,this.diagram.nameTable),h[c].marginLeft+=s,t.datavisualization.Diagram.DiagramContext.update(h[c],this.diagram)}w=this.diagram.nameTable[n.name];w&&w.parent&&(e=this.diagram.nameTable[w.parent],e&&(a=this.diagram.tools.resize,a.selectedObject=e,a._resizeDirection="se-resize",this.diagram.selectionList.push(e),a.initialBounds={width:e.width,height:e.height,y:e.offsetY,x:e.offsetX},e.minWidth+=s,e.minHeight+=l,this.diagram.isPhaseResize=!0,a._updateSize(e,null,null,s?s:1e-5,l?l:1e-5,!1,null,!0),this.diagram.isPhaseResize=!1,t.datavisualization.Diagram.DiagramContext.update(e,this.diagram)))},r.prototype.mouseup=function(n){var r;if(this.diagram._clearSelection(),r=this._getSeperator(n),r&&!this.selectedSeperetor)this.selectedSeperetor=r,this.diagram.addSelection(this.selectedSeperetor);else{if(this.selectedSeperetor){var u=this.snap(this.currentPoint),f=this.snap(this.startPoint),e=f.x-u.x,o=f.y-u.y,s=this.selectedSeperetor.orientation==="vertical"?!0:!1;this.selectedSeperetor.type==="phase"&&this._updateSwimlane(this.selectedSeperetor,e,o,s);t.datavisualization.Diagram.SvgContext._updatephase(this.selectedSeperetor,this.diagram);this.diagram.selectionList[0]&&this.diagram.selectionList[0].type!="phase"?(this.diagram._clearSelection(),this.diagram.addSelection(this.selectedSeperetor)):this.diagram.addSelection(this.selectedSeperetor)}this._removePhasehelper()}this._bounds=null;this.inAction=!1;this.selectedSeperetor=null;i.prototype.mouseup.call(this,n)},r.prototype._getLeastOffset=function(n,i){var u,e,f,o;if(n){var h=this.diagram.nameTable[this.diagram._getChild(n.children[2])],r=null,s=null;for(e=0;e<h.children.length;e++)if(f=this.diagram.nameTable[h.children[e]],f&&f.children&&f.children.length>1)for(o=1;o<f.children.length;o++)s=this.diagram.nameTable[f.children[o]],s&&(r=t.datavisualization.Diagram.Util.bounds(s),i?r.y+r.height<n.offsetY-n.height/2+this.selectedSeperetor.offset&&(u=u&&u<r.y+r.height?r.y+r.height:r.y+r.height):r.x+r.width<n.offsetX-n.width/2+this.selectedSeperetor.offset&&(u=u&&u<r.x+r.width?r.x+r.width:r.x+r.width))}return u},r.prototype._getOuterPhaseNodes=function(n,i){var f,r,e;if(n){var h=this.diagram.nameTable[this.diagram._getChild(n.children[2])],o=[],s=null,u=null;for(f=0;f<h.children.length;f++)if(r=this.diagram.nameTable[this.diagram._getChild(h.children[f])],r&&r.children&&r.children.length>1)for(e=0;e<r.children.length;e++)u=this.diagram.nameTable[this.diagram._getChild(r.children[e])],u&&(s=t.datavisualization.Diagram.Util.bounds(u),i?s.y>n.offsetY-n.height/2+this.selectedSeperetor.offset&&o.push(u):s.x>n.offsetX-n.width/2+this.selectedSeperetor.offset&&o.push(u))}return o},r}(i);t.datavisualization.Diagram.PhaseTool=w}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.LayoutTypes={None:"none",HierarchicalTree:"hierarchicaltree",OrganizationalChart:"organizationalchart"};t.datavisualization.Diagram.ChartOrientations={Horizontal:"horizontal",Vertical:"vertical"};t.datavisualization.Diagram.ChartTypes={Left:"left",Right:"right",Alternate:"alternate",Center:"center"};t.datavisualization.Diagram.Layout={doLayout:function(n){t.datavisualization.Diagram.HierarchicalLayout.doLayout(n)}};t.datavisualization.Diagram.HierarchicalLayout={doLayout:function(t){var i,e,f,v,r,u,l,a,o,s,h,c;if(e=t.model,i={diagram:t,_anchorX:0,_anchorY:0,_graphNodes:{},_firstLevelNodes:[],levels:[],maxLevel:0},i=n.extend(!0,{},i,e.layout),e.nodes.length>0){for(r=0;r<e.nodes.length;r++)f=e.nodes[r],v=i._graphNodes[f.name]=this._setUpLayoutInfo(i,f),v.tree.hasSubTree=!1,f.inEdges&&f.inEdges.length||i._firstLevelNodes.push(f);for(r=0;r<i._firstLevelNodes.length;r++)f=i._firstLevelNodes[r],this._updateEdges(i,f,1);if(i._firstLevelNodes.length>0){for(i._rootNode=i._firstLevelNodes[0],l=0,a=0,r=0;r<i._firstLevelNodes.length;r++)u=this._updateTree(i,l,a,i._firstLevelNodes[r],0,i._firstLevelNodes[r-1]),i.orientation=="lefttoright"||i.orientation=="righttoleft"?a=u.right+i.horizontalSpacing:l=u.right+i.horizontalSpacing,r==0?(o=u.x,h=u.y,s=u.right,c=u.bottom):(o=Math.min(o,u.x),h=Math.min(h,u.y),s=Math.max(s,u.right),c=Math.max(c,u.bottom));for(this._updateAnchor(i,{x:o,y:h,right:s,bottom:c}),r=0;r<i._firstLevelNodes.length;r++)this._updateNodes(i,i._firstLevelNodes[r],0);for(r=0;r<i._firstLevelNodes.length;r++)this._updateConnectors(i,i._firstLevelNodes[r],1)}}},_updateTree:function(n,t,i,r,u,f,e){var o,s,l,y,p,c,w,a,b,v,k,h;return o=this._getDimensions(n,r,t,i,u),s=n._graphNodes[r.name],n.maxLevel=Math.max(n.maxLevel,u),l=u,p=this._hasChild(n,r),p||s.tree.assistants.length?(h=o.y+o.height+n.verticalSpacing,s.tree.assistants.length&&(y=this._setDepthSpaceForAssistants(n,r,h,o.height,u,n.verticalSpacing),l=y.level,h=y.bottom),s.tree.assistants.length||s.tree.orientation=="horizontal"||(h=o.y+o.height+n.verticalSpacing/2),c=s.tree.orientation=="horizontal"?this._updateHorizontalTree(n,r,f,o.x,h,l):this._updateVerticalTree(n,r,o.x,h,l,e),s.y=o.y,t=s.mid,s.tree.assistants.length&&(k=t!==undefined?t:o.x,v=this._setBreadthSpaceForAssistants(n,r,o,k,h,u),p||(a=c=v,t=(a.x+a.right)/2-o.width/2,c=a),b=v?v.canMoveBy:undefined),s.x=t,w={x:t,y:o.y,right:t+o.width,bottom:o.y+o.height},this._translateSubTree(n,r,w,c,o,u,b,f!=undefined,e),c):this._updateLeafNode(n,r,f,o,u,e)},_updateLeafNode:function(n,t,i,r,u,f){var e,o;return e=n._graphNodes[t.name],e.x=r.x,e.y=r.y,e.maxLevel=Math.max(u,e.maxLevel||0),o={x:r.x,y:r.y,right:r.x+r.width,bottom:r.y+r.height},e.maxLevel=Math.max(e.maxLevel||0,u),this._translateSubTree(n,t,o,o,r,u,undefined,i!=undefined,f),{x:e.x,y:e.y,right:e.x+r.width,bottom:e.y+r.height}},_translateSubTree:function(n,t,i,r,u,f,e,o,s){var h=n._graphNodes[t.name],l=n.diagram.nameTable[h.tree.children[0]],c=l?n._graphNodes[l.name]:null,a=this._hasChild(n,t),v=this._findIntersectingLevels(n,i,f),p=this._findIntersectingLevels(n,r,f),y=[];v.length?(h.intersect=v,this._spaceLeftFromPrevSubTree(n,t,i),h.canMoveBy=h.diff,h.fchildList=[],e!==undefined&&(h.canMoveBy=Math.min(e,h.canMoveBy)),l&&c.canMoveBy!==undefined&&(h.canMoveBy=Math.min(h.canMoveBy,c.canMoveBy),c.fchildList&&(h.fchildList=c.fchildList)),h.fchildList[f]=t.name,o&&(h.x-=h.canMoveBy,h.subTreeTranslation-=h.canMoveBy,a&&(this._shiftSubordinates(n,p,h.canMoveBy),r.x=Math.min(r.x,h.x),r.right=Math.max(r.right,h.x+u.width),r.bottom=Math.max(r.bottom,h.y+u.height),r.x-=h.canMoveBy,r.right-=h.canMoveBy))):a&&(r.x=Math.min(r.x,i.x),r.right=Math.max(r.right,i.x+u.width),r.bottom=Math.max(r.bottom,h.y+u.height));s||(i={x:h.x,y:u.y,right:h.x+u.width,bottom:u.y+u.height},y.push({rBounds:i}),this._updateRearBounds(n,t,y,f))},_updateRearBounds:function(n,t,i,r,u){var f,o,u,h,c,l=!0,s,e;if(t&&(s=n._graphNodes[t.name],u=s.intersect,l=!s.tree.children.length&&!s.tree.assistants.length),h=i[0].rBounds,c=i[i.length-1].rBounds,u&&u.length){for(f=n.levels[u[0]].rBounds,f.y<h.y&&(f.bottom=h.y,i.splice(0,0,{rBounds:f})),f=n.levels[u[u.length-1]].rBounds,l&&f.bottom>c.bottom&&(f.y=c.bottom,i.push({rBounds:f})),o=u[0],e=i.length-1;e>=0;e--)n.levels.splice(o,0,i[e]);o+=i.length;n.levels.splice(o,u.length)}else for(o=this._findLevel(n,i[i.length-1].rBounds,r),e=i.length-1;e>=0;e--)n.levels.splice(o,0,i[e])},_shiftSubordinates:function(n,t,i){var r;if(i!=0)for(r=0;r<t.length;r++)n.levels[t[r]].rBounds&&(n.levels[t[r]].rBounds.x-=i,n.levels[t[r]].rBounds.right-=i)},_setDepthSpaceForAssistants:function(n,t,i,r,u,f){for(var o=n._graphNodes[t.name],s,h,c=i,e=0;e<o.tree.assistants.length;e++)s=n._graphNodes[o.tree.assistants[e]],s&&(s.tree.children=s.tree.assistants=[],s.y=i,h=n.diagram.nameTable[o.tree.assistants[e]].height,(n.orientation=="lefttoright"||n.orientation=="righttoleft")&&(h=n.diagram.nameTable[o.tree.assistants[e]].width),c=i+h+f/2,n.maxLevel=u+1,e%2==1&&e!=o.tree.assistants.length-1&&(i=c,u++));return{level:n.maxLevel,bottom:i+h+f}},_setBreadthSpaceForAssistants:function(n,t,i,r,u,f){for(var o,v,h,s=n._graphNodes[t.name],w=u,l=f,y,a,c,p,e=0;e<s.tree.assistants.length;e++)o=n._graphNodes[s.tree.assistants[e]],o&&(v=n.diagram.nameTable[s.tree.assistants[e]].width,(n.orientation=="lefttoright"||n.orientation=="righttoleft")&&(v=n.diagram.nameTable[s.tree.assistants[e]].height),y=e%2==0?r+i.width/2-20-v:r+i.width/2+20,h=this._updateTree(n,y,o.y,n.diagram.nameTable[s.tree.assistants[e]],l+1),this._hasChild(n,t)||(e==0?c=h:this._uniteRects(c,h)),e%2==0&&o.prevBounds&&(a=a===undefined?o.canMoveBy:Math.min(a,o.canMoveBy)),(e%2==1||e==s.tree.assistants.length-1)&&(p=this._findIntersectingLevels(n,h,l+1),this._updateRearBounds(n,null,[{rBounds:h}],l+1,p),l++));return c&&(c.canMoveBy=a),c},_updateHorizontalTree:function(n,t,i,r,u,f){var o,e,c,it,rt,l,ot,w,b,h,y,k=this._getDimensions(n,t,r,u,f),s=n._graphNodes[t.name],ut=s.tree.type,d=f,ft=r,st=u,g,nt,et=n.levels.slice(0,n.levels.length),tt,a,v,p;if(this._hasChild(n,t)){for(tt=n.orientation=="lefttoright"||n.orientation=="righttoleft"?!0:!1,a=0;a<s.tree.children.length;a++){if(o=n.diagram.nameTable[s.tree.children[a]],g=o.width?o.width:o._width,nt=o.height?o.height:o._height,it=tt?nt:g,rt=tt?g:nt,ot=n.levels[d+1]?n.levels[d+1].rBounds:null,c=this._updateTree(n,ft,st,o,d+1,n.diagram.nameTable[s.tree.children[a-1]]),e=n._graphNodes[o.name],b={x:e.x,y:e.y,right:e.x+it,bottom:e.y+rt},a==0)w={x:Math.min(e.x,c.x),y:Math.min(e.y,c.y),right:c.right,bottom:c.bottom},l=e;else if(l&&l.canMoveBy!=undefined&&e.fchildList&&e.fchildList.length-1>h){for(v=n._graphNodes[e.fchildList[h]];h<e.fchildList.length-1;){if(v.canMoveBy&&et.indexOf(v.prevBounds)<0)v=n._graphNodes[e.fchildList[h+1]],h++;else break;p=v.canMoveBy-e.canMoveBy}p!=undefined&&p<=l.canMoveBy&&(y=y?Math.min(y,p):p,et.indexOf(v.prevBounds)>=0&&this._translateSiblings(n,t,o))}h=h?Math.max(e.maxLevel,h):e.maxLevel;this._uniteRects(w,c);s.maxLevel=Math.max(s.maxLevel||0,e.maxLevel||0);ft=c.right+n.horizontalSpacing}isNaN(y)||(l.canMoveBy=y);s.mid=(l.x+b.right)/2-k.width/2;ut=="left"?s.mid=b.right-k.width:ut=="right"&&(s.mid=k.x)}return w},_updateVerticalTree:function(n,t,i,r,u,f){var c,o,l,d,ft,g,a,v,et,ht,e,ot,nt,tt,it,b,y,s,st,p,w=[],h=[],k,rt,ut;for(ht=this._getDimensions(n,t,i,r,u),e=n._graphNodes[t.name],ot=n.diagram.nameTable[e.tree.children[0]],nt=n.orientation=="lefttoright"||n.orientation=="righttoleft"?!0:!1,tt=e.tree.type=="left"||e.tree.type=="leftoffset"?-1:0,it=i,b=r,y=u,s=0;s<e.tree.children.length;s++)e.tree.type=="alternate"&&(st=s%2==0&&e.tree.children.length>2?"left":"right",tt=s%2==0&&e.tree.children.length>2?-1:0),it=i+this._findOffset(n,t,e,st),c=n.diagram.nameTable[e.tree.children[s]],rt=c.width?c.width:c._width,ut=c.height?c.height:c._height,d=nt?ut:rt,ft=nt?rt:ut,l=this._updateTree(n,it+tt*d,b,c,u+1,undefined,!0),o=n._graphNodes[c.name],v={x:o.x,y:o.y,right:o.x+d,bottom:o.y+ft},s==0?(this._uniteRects(l,v),a=l):this._uniteRects(a,l),!o.prevBounds||e.tree.type=="alternate"&&s%2==1&&e.tree.children.length>2||(p=p!==undefined?Math.min(o.canMoveBy,p):o.canMoveBy),e.maxLevel=Math.max(e.maxLevel||0,o.maxLevel||0),e.tree.type=="alternate"&&e.tree.children.length>2&&s%2==0?(s!=0&&(b=g.bottom+n.verticalSpacing/2),h.push({rBounds:v}),o.levelBounds&&(h=h.concat(o.levelBounds))):(b=e.tree.type=="alternate"&&e.tree.children.length>2?Math.max(l.bottom,g.bottom)+n.verticalSpacing/2:l.bottom+n.verticalSpacing/2,u=e.maxLevel,w.push({rBounds:v}),o.levelBounds&&(w=w.concat(o.levelBounds))),g=v;return f?e.levelBounds=w:(e.tree.type=="alternate"&&e.tree.children.length>2&&(et={x:h[0].rBounds.x,y:h[0].rBounds.y,right:h[h.length-1].rBounds.right,bottom:h[h.length-1].rBounds.bottom},k=this._findIntersectingLevels(n,et,y+1),this._updateRearBounds(n,null,h,y+1,k)),k=this._findIntersectingLevels(n,a,y+1),this._updateRearBounds(n,null,w,y+1,k)),isNaN(p)||(n._graphNodes[ot.name].canMoveBy=p),e.childBounds=a,e.mid=i,a},_findOffset:function(n,t,i,r){var u=0,f=n.orientation=="lefttoright"||n.orientation=="righttoleft"?t.height:t.width,e=r?r:i.tree.type;u=i.tree.offset||20;i.tree.type=="alternate"&&u>=n.horizontalSpacing&&(u=n.horizontalSpacing/2);switch(e){case"left":u=f/2-u;break;case"right":u=u+f/2}return u},_translateSiblings:function(n,t,i){var r,f,u,e;for(u=n._graphNodes[t.name],e=n._graphNodes[i.name].diff-n._graphNodes[i.name].canMoveBy,r=0;r<u.tree.children.length;r++){if(i.name==u.tree.children[r])break;f=n._graphNodes[u.tree.children[r]];f.x+=e}},_uniteRects:function(n,t){n.x=Math.min(n.x,t.x);n.right=Math.max(n.right,t.right);n.bottom=Math.max(n.bottom,t.bottom)},_spaceLeftFromPrevSubTree:function(n,t,i){for(var r=n._graphNodes[t.name],f,e,o=n.horizontalSpacing,u=0;u<r.intersect.length;u++)e=n.levels[r.intersect[u]].rBounds,f=i.x-(e.right+o),(r.diff==undefined||f<r.diff)&&(r.diff=f,r.prevBounds=n.levels[r.intersect[u]])},_findIntersectingLevels:function(n,t,i){var u={x:t.x,y:t.y,right:t.right,bottom:t.bottom},e,r,f;u.y-=n.verticalSpacing/2;u.bottom+=n.verticalSpacing/2;e=[];f=i;r=n.levels[f]?n.levels[f].rBounds:null;do{if(r&&(u.y<r.y&&u.bottom>r.y||u.y<r.bottom&&r.bottom<u.bottom||u.y>r.y&&u.bottom<r.bottom||u.y<r.y&&u.bottom>r.bottom))e.splice(0,0,f);else if(r&&r.bottom<u.y)break;f--;r=n.levels[f]?n.levels[f].rBounds:null}while(f>=0);f=i+1;r=n.levels[f]?n.levels[f].rBounds:null;do{if(r&&(u.y<r.y&&u.bottom>r.y||u.y<r.bottom&&r.bottom<u.bottom||u.y>r.y&&u.bottom<r.bottom||u.y<r.y&&u.bottom>r.bottom))e.push(f);else if(r&&r.y>u.bottom)break;f++;r=n.levels[f]?n.levels[f].rBounds:null}while(f<=n.levels.length);return e},_findLevel:function(n,t,i){var f=t,r=0,u=n.levels[r]?n.levels[r].rBounds:null;do{if(u&&f.bottom<u.y)return r;r++;u=n.levels[r]?n.levels[r].rBounds:null}while(r<=n.levels.length);return i},_updateEdges:function(i,r,u){var f=i._graphNodes[r.name],o,e;if(r.outEdges&&r.outEdges.length&&r.isExpanded)for(o=0;o<r.outEdges.length;o++)e=i.diagram.nameTable[i.diagram.nameTable[r.outEdges[o]].targetNode],e.excludeFromLayout||(f.tree.children.push(e.name),e.outEdges&&e.outEdges.length&&e.isExpanded&&(f.tree.hasSubTree=!0),this._updateEdges(i,e,u+1));f.tree.level=u;f.tree.hasSubTree&&(f.tree.orientation="horizontal");i.getLayoutInfo&&i.type=="organizationalchart"&&(typeof i.getLayoutInfo=="string"&&(i.getLayoutInfo=t.util.getObject(i.getLayoutInfo,window)),n.isFunction(i.getLayoutInfo)&&i.getLayoutInfo(i.diagram,r,f.tree));i.level&&f.tree.type!="alternate"&&u>=i.level&&(f.tree.hasSubTree=!1)},_updateAnchor:function(n,i){var f,u,r,o,s,e;if(u=t.datavisualization.Diagram.ScrollUtil._viewPort(n.diagram),n.orientation=="toptobottom"?(n._anchorX=u.width/2-(i.right-i.x)/2+n.marginX-i.x,n._anchorY=n.marginY):n.orientation=="bottomtotop"?(n._anchorX=u.width/2-(i.right-i.x)/2+n.marginX-i.x,n._anchorY=u.height-(i.x+n.marginY)):n.orientation=="lefttoright"?(n._anchorX=n.marginX,n._anchorY=u.height/2-(i.right-i.x)/2+n.marginY-i.x):n.orientation=="righttoleft"&&(n._anchorX=u.width-(i.y+n.marginX),n._anchorY=u.height/2-(i.right-i.x)/2+n.marginY-i.x),n.fixedNode){for(r=n.diagram.nameTable[n.fixedNode],o=r.width?r.width:r._width,s=r.height?r.height:r._height,n._anchorX=r.offsetX,n._anchorY=r.offsetY,n._anchorX+=n.orientation=="righttoleft"?o/2:-o/2,n._anchorY+=n.orientation=="bottomtotop"?s/2:-s/2,f=r,e=0;f.inEdges.length;)f=this._getParentNode(n,f),e+=n._graphNodes[f.name].subTreeTranslation||0;n.orientation=="lefttoright"||n.orientation=="righttoleft"?(n._anchorX-=n._graphNodes[r.name].y,n._anchorY-=n._graphNodes[r.name].x+e):(n._anchorX-=n._graphNodes[r.name].x+e,n._anchorY-=n._graphNodes[r.name].y)}},_updateConnectors:function(n,i,r){var c,s,u,f,h,l,o,y=0,a=0,p=0,w=0,e=0,v=0;if(f=n._graphNodes[i.name],f.tree.children.length)for(c=0;c<f.tree.children.length;c++){u=n.diagram.nameTable[f.tree.children[c]];s=n.diagram.nameTable[u.inEdges[0]];var b=i.width?i.width:i._width,k=i.height?i.height:i._height,d=u.width?u.width:u._width,g=u.height?u.height:u._height;n.type=="organizationalchart"?n.orientation=="toptobottom"||n.orientation=="bottomtotop"?(a=n.orientation=="toptobottom"?k:-k,w=n.orientation=="toptobottom"?-g:g,h=n.orientation=="toptobottom"?"bottom":"top",f.tree.assistants.length?(e=Math.abs(u.offsetY+w/2-(i.offsetY+a/2))-n.verticalSpacing/2,o=[{type:"orthogonal",length:e,direction:h}]):f.tree.orientation=="horizontal"&&s.segments.length==1?n.diagram._dock(s,n.diagram.nameTable):f.tree.orientation=="horizontal"?o=[{type:"orthogonal"}]:(e=Math.abs(u.offsetY-(i.offsetY+a/2)),o=[{type:"orthogonal",length:e,direction:h}],f.tree.offset<5&&(l=f.tree.type=="left"?"right":"left",e=n.verticalSpacing/4,v=Math.abs(f.tree.offset)+n.horizontalSpacing/2,o=[{type:"orthogonal",length:e,direction:h},{type:"orthogonal",length:v,direction:l}]))):(y=n.orientation=="lefttoright"?b:-b,p=n.orientation=="lefttoright"?-d:d,h=n.orientation=="lefttoright"?"right":"left",f.tree.assistants.length?(e=Math.abs(u.offsetX+p/2-(i.offsetX+y/2))-n.verticalSpacing/2,o=[{type:"orthogonal",length:e,direction:h}]):f.tree.orientation=="horizontal"&&s.segments.length==1?n.diagram._dock(s,n.diagram.nameTable):f.tree.orientation=="horizontal"?o=[{type:"orthogonal"}]:(e=Math.abs(u.offsetX-(i.offsetX+y/2)),o=[{type:"orthogonal",length:e,direction:h}],f.tree.offset<5&&(l=f.tree.type=="left"?"bottom":"top",e=n.verticalSpacing/4,v=Math.abs(f.tree.offset)+10,o=[{type:"orthogonal",length:e,direction:h},{type:"orthogonal",length:v,direction:l}]))):n.diagram._dock(s,n.diagram.nameTable);o&&n.diagram.updateConnector(s.name,{segments:o});n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(s,n.diagram);(u.isExpanded||this._hasChild(n,u))&&this._updateConnectors(n,u,r+1)}if(f.tree.assistants.length)for(c=0;c<f.tree.assistants.length;c++)u=n.diagram.nameTable[f.tree.assistants[c]],s=n.diagram.nameTable[u.inEdges[0]],e=Math.abs(u.offsetY-(i.offsetY+a/2)),o=[{type:"orthogonal",length:e,direction:h}],o&&n.diagram.updateConnector(s.name,{segments:o}),n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(s,n.diagram),(u.isExpanded||this._hasChild(n,u))&&this._updateConnectors(n,u,r+1)},_updateNodes:function(n,i,r){var f,u,e=i.width?i.width:i._width,o=i.height?i.height:i._height;if(i.excludeFromLayout||(i.offsetX=n._anchorX,i.offsetY=n._anchorY,n.orientation=="lefttoright"?(i.offsetX+=n._graphNodes[i.name].y+e/2,i.offsetY+=n._graphNodes[i.name].x+r+o/2):n.orientation=="righttoleft"?(i.offsetX-=n._graphNodes[i.name].y+e/2,i.offsetY+=n._graphNodes[i.name].x+r+o/2):n.orientation=="toptobottom"?(i.offsetX+=n._graphNodes[i.name].x+r+e/2,i.offsetY+=n._graphNodes[i.name].y+o/2):(i.offsetX+=n._graphNodes[i.name].x+r+e/2,i.offsetY-=n._graphNodes[i.name].y+o/2)),this._hasChild(n,i))for(u=0;u<n._graphNodes[i.name].tree.children.length;u++)f=n.diagram.nameTable[n._graphNodes[i.name].tree.children[u]],this._updateNodes(n,f,r+(n._graphNodes[i.name].subTreeTranslation||0));if(n._graphNodes[i.name].tree.assistants.length)for(u=0;u<n._graphNodes[i.name].tree.assistants.length;u++)f=n.diagram.nameTable[n._graphNodes[i.name].tree.assistants[u]],this._updateNodes(n,f,r+(n._graphNodes[i.name].subTreeTranslation||0));t.datavisualization.Diagram.SpatialUtil._updateQuad(n.diagram,n.diagram._spatialSearch,i);n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(i,n.diagram)},_getDimensions:function(n,t,i,r,u){var f=t.width?t.width:t._width,e=t.height?t.height:t._height,o;return(n.orientation=="lefttoright"||n.orientation=="righttoleft")&&(u||(o=i,i=r,r=o),e=t.width?t.width:t._width,f=t.height?t.height:t._height),{x:i,y:r,width:f,height:e}},_getParentNode:function(n,t){if(t.inEdges&&t.inEdges.length)return n.diagram.nameTable[n.diagram.nameTable[t.inEdges[0]].sourceNode]},_hasChild:function(n,t){var t=n._graphNodes[t.name];return t.tree.children&&t.tree.children.length},_setUpLayoutInfo:function(n){var t={};return t.subTreeTranslation=0,n.type=="organizationalchart"?t.tree={orientation:"vertical",type:"alternate",offset:20,enableRouting:!0}:n.type=="hierarchicaltree"&&(t.tree={orientation:"horizontal",type:"center",enableRouting:!0}),t.tree.children=[],t.tree.assistants=[],t.tree.level=0,t}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.ZoomUtil={zoomPan:function(i,r,u,f,e,o){var s,h,c,l,a;t.datavisualization.Diagram.Util.canZooming(i)&&(s=t.Matrix.identity(),t.Matrix.scale(s,i._currZoom,i._currZoom),t.Matrix.translate(s,-i._hScrollOffset,-i._vScrollOffset),h=i._currZoom*r,h>30?r=30/i._currZoom:h<.25&&(r=.25/i._currZoom),c=t.Matrix.identity(),l=e?t.Matrix.transform(s,e):t.datavisualization.Diagram.Point(n(i.element).width()/2,n(i.element).height()/2),t.Matrix.scale(c,r,r,l.x,l.y),h=i._currZoom*r,t.Matrix.translate(c,u,f),t.Matrix.multiply(s,c),a=t.Matrix.transform(s,t.datavisualization.Diagram.Point(0,0)),this._applyTransform(i,h,a,o))},_applyTransform:function(n,i,r,u){n._currZoom=i;var f=r.x*-1,e=r.y*-1;u||n._scrollLimit()!==t.datavisualization.Diagram.ScrollLimit.Infinity&&(f<n._hScrollbar.model.minimum?f=n._hScrollbar.model.minimum:f>n._hScrollbar.model.maximum&&(f=n._hScrollbar.model.maximum),e<n._vScrollbar.model.minimum?e=n._vScrollbar.model.minimum:e>n._vScrollbar.model.maximum&&(e=n._vScrollbar.model.maximum));n._updateScrollOffset(f,e,!0,u)}};t.datavisualization.Diagram.PageUtil={_createPageBreaks:function(n){this._removePageBreaks(n);var i={id:n._canvas.id+"pagebreaks","pointer-events":"none"},r=t.datavisualization.Diagram.SvgContext._initializePageBreaks(n._svg,i,n._pageBackgroundLayer);this._updatePageBreaks(r,n)},_removePageBreaks:function(n){var i=n._svg.getElementById(n._canvas.id+"pagebreaks");i&&t.datavisualization.Diagram.SvgContext._removePageBreaks(n._svg,i,n._pageBackgroundLayer)},_updatePageBreaks:function(n,i){var o=i._getDigramBounds(),k=i.model.pageSettings,r=o.x,w=o.width+o.x,u=o.y,b=o.height+o.y,f=i._currZoom,a=i._pageHeight(),v=i._pageWidth(),e=i._pageMargin(),y=parseInt(Math.ceil((w-r)/v)),p=parseInt(Math.ceil((b-u)/a)),s,h,c,l;for(r=-i._canvas.clientLeft+(e+r)*f,u=-i._canvas.clientTop+(e+u)*f,s=(v*y-e*2)*f,h=(a*p-e*2)*f,t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r,u),t.datavisualization.Diagram.Point(r+s,u),i._svg,n),t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u),t.datavisualization.Diagram.Point(r,u+h),i._svg,n),c=1;c<y;c++)t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r+(v*c-e)*f,u),t.datavisualization.Diagram.Point(r+(v*c-e)*f,u+h),i._svg,n);for(l=1;l<p;l++)t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u+(a*l-e)*f),t.datavisualization.Diagram.Point(r+s,u+(a*l-e)*f),i._svg,n);t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r+s,u),t.datavisualization.Diagram.Point(r+s,u+h),i._svg,n);t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u+h),t.datavisualization.Diagram.Point(r+s,u+h),i._svg,n)},_updatePageSize:function(n,i){var f=!1,e,l;n._pageOrientation()==t.datavisualization.Diagram.PageOrientations.Landscape?n._pageHeight()>n._pageWidth()&&(f=!0):n._pageWidth()>n._pageHeight()&&(f=!0);f&&(e=n._pageWidth(),n._pageWidth(n._pageHeight()),n._pageHeight(e));var r=n._getDigramBounds(),u=n._currZoom,o=r.x*u,s=r.y*u,h=r.width*u,c=r.height*u,a=n.model.pageSettings;n._pageBackgroundLayer&&n._pageBackgroundLayer.firstChild?t.datavisualization.Diagram.SvgContext._updatePageBakground(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),n._svg,n._pageBackgroundLayer,n._pageBorderColor(),n._pageBackgroundColor(),n._pageBorderWidth()):t.datavisualization.Diagram.SvgContext._renderPageSettingsRect(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),n._svg,n._pageBackgroundLayer,n._pageBorderColor(),n._pageBackgroundColor(),n._pageBorderWidth());n._svg.document.style.left=0;n._svg.document.style.top=0;l=!1;n._pageWidth()||n._pageHeight()||(l=!0);a.pageWidth&&n._pageHeight()&&(n._showPageBreak()?this._createPageBreaks(n):this._removePageBreaks(n));i||t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(n)}};t.datavisualization.Diagram.ScrollUtil={_transform:function(n,i,r,u){t.datavisualization.Diagram.SvgContext.transformView(n,-i,-r);u&&t.datavisualization.Diagram.SvgContext.scaleContent(n,n._currZoom);t.datavisualization.Diagram.PageUtil._updatePageSize(n);t.datavisualization.Diagram.SvgContext._updateBackground(i,r,n._currZoom,n);t.datavisualization.Diagram.SvgContext._updateGrid(i,r,n._currZoom,n)},_viewPort:function(i){var f=i.element[0],r=n(f).width(),u=n(f).height(),e=i.element[0].getBoundingClientRect(),s=window.screenX<0?window.screenX*-1:window.screenX,o;return r===0&&(r=Math.floor(window.innerWidth-s-Math.floor(e.left))),o=window.screenY<0?window.screenY*-1:window.screenY,u===0&&(u=Math.floor(window.innerHeight-o-Math.floor(e.top))),t.datavisualization.Diagram.Size(r,u)},_union:function(n,t){var i,r,u,f;return n.width<=0?t:n.width>0?(i=Math.min(n.x,t.x),r=Math.min(n.y,t.y),t.width===Infinity||n.width===Infinity?n.width=Infinity:(u=Math.max(n.x+n.width,t.x+t.width),n.width=Math.max(u-i,0)),t.height===Infinity||n.height===Infinity?n.height=Infinity:(f=Math.max(n.y+n.height,t.y+t.height),n.height=Math.max(f-r,0)),n.x=i,n.y=r,n):void 0},_setScrollContentSize:function(i){var v=i._currZoom,u=this._viewPort(i),h,c,r,y,p,l,w,b,a,k;u=t.datavisualization.Diagram.Rectangle(i._hScrollOffset,i._vScrollOffset,u.width,u.height);var f=i._spatialSearch.pageLeft,e=i._spatialSearch.pageRight,o=i._spatialSearch.pageTop,s=i._spatialSearch.pageBottom;f>e&&(f=e=0);o>s&&(o=s=0);i.model.pageSettings&&(h=i._pageWidth(),c=i._pageHeight(),h>0&&c>0?i._multiplePage()?(f=Math.floor(f/h)*h,o=Math.floor(o/c)*c,e=Math.ceil(e/h)*h,s=Math.ceil(s/c)*c):(f=0,o=0,e=h,s=c):(f=f<0?f:0,o=o<0?o:0,e=e>u.width?e:u.width,s=s>u.height?s:u.height));f=f*v;o=o*v;e=e*v;s=s*v;r=t.datavisualization.Diagram.Rectangle(0,0,0,0);r=this._union(r,t.datavisualization.Diagram.Rectangle(0,0,u.width,u.height));r=this._union(r,t.datavisualization.Diagram.Geometry.rect([{x:f,y:o},{x:e,y:s}]));r.width-=u.width;r.height-=u.height;r.x>i._hScrollOffset&&(l=r.x-i._hScrollOffset,r.x-=l,r.width+=l);i._hScrollOffset>r.x+r.width&&(r.width=i._hScrollOffset-r.x);y=r.x;p=Math.max(0,r.x+r.width);r.y>i._vScrollOffset&&(l=r.y-i._vScrollOffset,r.y-=l,r.height+=l);i._vScrollOffset>r.y+r.height&&(r.height=i._vScrollOffset-r.y);w=r.y;b=Math.max(0,r.y+r.height);r.width=r.width<u.width?u.width:r.width;r.height=r.height<u.height?u.height:r.height;i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited&&(a=this._setMinMaxValues(i,y,w,p,b),y=a.minX,w=a.minY,p=a.maxX,b=a.maxY);f>=i._hScrollOffset&&e<=u.width+i._hScrollOffset?(i._hScrollbar._remove(),i._hScrollbar.model.width=0):(n("#"+i._canvas.id+"_hScrollbar").ejScrollBar({width:u.width-18,viewportSize:u.width-18,maximum:p,minimum:y}),n("#"+i._canvas.id+"_hScrollbar").ejScrollBar("scroll",i._hScrollOffset),k=document.getElementById(i._canvas.id+"_hScrollbar"),k.style.marginTop=u.height-18+"px");o>=i._vScrollOffset&&s<=u.height+i._vScrollOffset?(i._vScrollbar._remove(),i._vScrollbar.model.height=0):(n("#"+i._canvas.id+"_vScrollbar").ejScrollBar({height:u.height-18,viewportSize:u.height-18,maximum:b,minimum:w}),n("#"+i._canvas.id+"_vScrollbar").ejScrollBar("scroll",i._vScrollOffset));t.datavisualization.Diagram.SvgContext.setSize(i._svg,r.width,r.height)},_setMinMaxValues:function(n,t,i,r,u){var f=n.model.pageSettings.scrollableArea;return t<f.left&&(t=f.left),i<f.top&&(i=f.top),r>f.right&&(r=f.right),u>f.bottom&&(u=f.bottom),{minX:t,minY:i,maxX:r,maxY:u}},_initScrollbar:function(i){var u=i._canvas,f=document.getElementById(u.id+"_hScrollbar"),e=document.getElementById(u.id+"_vScrollbar"),r=this._viewPort(i);n(f).ejScrollBar({orientation:t.ScrollBar.Orientation.Horizontal,width:r.width-18,viewportSize:r.width-18,scroll:function(n){n.source!=null&&(n.source=="thumb"||n.source=="button"||n.source=="key")&&n.scrollData!=null&&i._updateScrollOffset(n.scrollLeft,i._vScrollOffset)}});i._hScrollbar=n(f).ejScrollBar("instance");n(e).ejScrollBar({orientation:t.ScrollBar.Orientation.Vertical,height:r.height-18,viewportSize:r.height-18,scroll:function(n){n.source!=null&&(n.source=="thumb"||n.source=="button"||n.source=="key")&&n.scrollData!=null&&i._updateScrollOffset(i._hScrollOffset,n.scrollTop)}});i._vScrollbar=n(e).ejScrollBar("instance")}};t.datavisualization.Diagram.SnapUtil={_canConsider:function(n,t,i){var r=!1;return t!=i&&(t._type=="group"||t._type=="pseudoGroup"?r=!this._contains(n,t,i):t.segments||(r=!(t==i))),r},_contains:function(n,t,i){var e=i.name,o=null,u,f,r;if(t.children.indexOf(e)>=0){if(o=n[e],o==i)return!0}else if(t.children.indexOf(i)>=0)return!0;if(t._type=="group"||t._type=="pseudoGroup"){for(u=!1,f=0;f<t.children.length;f++)if(this.diagram&&this.diagram._getNode(t.children[f])&&(r=n[this.diagram._getNode(t.children[f])],r&&(typeof r=="string"&&(r=n[r]),r._type=="group"&&(u=this._contains(n,r,i)),u)))return u;return u}return!1},_round:function(n,t,i){for(var e=0,r=0;r<t.length;r++)e+=t[r];e/=i;var o=Math.floor(Math.abs(n)/e),u=n%e,f=o*e;if(n>=0)for(r=0;r<t.length;r++){if(u<=t[r]/i)return f+(u<t[r]/(2*i)?0:t[r]/i);f+=t[r]/i;u-=t[r]/i}else for(f=f*-1,r=t.length-1;r>=0;r--){if(Math.abs(u)<=t[r]/i)return f-(Math.abs(u)<t[r]/(2*i)?0:t[r]/i);f-=t[r]/i;u+=t[r]/i}return n},_findNodes:function(n,i,r,u,f){for(var c=[],o,e,l,h,a=t.datavisualization.Diagram.SpatialUtil.findQuads(n,f?u:r),s=0;s<a.length;s++)if(o=a[s],o.objects.length>0)for(h=0;h<o.objects.length;h++)e=o.objects[h],!e.segments&&e.visible&&(l=t.datavisualization.Diagram.Util.bounds(e),c.indexOf(e)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(r,l)&&c.push(e),f&&f.indexOf(e)&&t.datavisualization.Diagram.Geometry.intersectsRect(u,l)&&f.push(e));return c},_snapAngle:function(n,t){var i=n._snapAngle(),r=t%i;return r>=i/2?t+i-r:t-r},_snapPoint:function(n,i,r,u,f,e,o){var c=n.model.snapSettings,l=n._currZoom,h=t.datavisualization.Diagram.Point(),s=t.datavisualization.Diagram.Util.bounds(i),k={snapped:!1,offset:0},d={snapped:!1,offset:0};this.diagram=n;n._enableSnapToObject()&&this._snapObject(n,i,k,d,f,o==e);var g=s.x+f.x,nt=s.y+f.y,tt=s.x+s.width+f.x,it=s.y+s.height+f.y,a=this._round(tt,c.verticalGridLines.snapInterval,l),v=this._round(g,c.verticalGridLines.snapInterval,l),y=this._round(nt,c.horizontalGridLines.snapInterval,l),p=this._round(it,c.horizontalGridLines.snapInterval,l),w=s.x+s.width,b=s.y+s.height;return k.snapped?h.x=n._enableSnapToObject()?k.offset:e.x-o.x:c.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines?Math.abs(f.x)>=1&&(h.x+=r?Math.abs(a-w)>Math.abs(v-s.x)?v-s.x:a-w:Math.abs(a-w)<Math.abs(v-s.x)?a-w:v-s.x):h.x=e.x-o.x,d.snapped?h.y=d.offset:c.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines?Math.abs(f.y)>=1&&(h.y+=u?Math.abs(p-b)>Math.abs(y-s.y)?y-s.y:p-b:Math.abs(p-b)<Math.abs(y-s.y)?p-b:y-s.y):h.y=e.y-o.y,h},_snapObject:function(n,i,r,u,f,e){var v=null,y=null,w,b,d=[],g=[],it=[],rt=[],o=t.datavisualization.Diagram.Util.bounds(i),l=n._currZoom,ut=n._hScrollOffset,ft=n._vScrollOffset,h=n._snapObjectDistance(),p=n._viewPort,et=t.datavisualization.Diagram.Rectangle(ut/l,o.y-5,p.width/l,o.height+10),ot=t.datavisualization.Diagram.Rectangle(o.x-5,ft/l,o.width+10,p.height/l),k,a,c,s,nt,tt;for(p=t.datavisualization.Diagram.Rectangle(ut/l,ft/l,p.width/l,p.height/l),k=this._findNodes(n._spatialSearch,i,ot,p),nt=n.nameTable,a=0;a<k.length;a++)c=k[a],!c.segments&&this._canConsider(nt,i,c)&&(s=t.datavisualization.Diagram.Util.bounds(c),s.y+s.height<o.y+f.y?it.push({object:c,distance:Math.abs(o.y+f.y-s.y-s.height)}):s.y>o.y+f.y+o.height&&rt.push({object:c,distance:Math.abs(o.y+f.y+o.height-s.y)}),(v==null||v>Math.abs(s.y-o.y-f.y))&&(Math.abs(s.x+s.width/2-(o.x+o.width/2+f.x))<=h?(w=this._createSnapObject(s,o,"centerX"),v=Math.abs(s.y-o.y)):Math.abs(s.x-(o.x+f.x))<=h?(w=this._createSnapObject(s,o,"left"),v=Math.abs(s.y-o.y)):Math.abs(s.x+s.width-(o.x+o.width+f.x))<=h?(w=this._createSnapObject(s,o,"right"),v=Math.abs(s.y-o.y)):Math.abs(s.x+s.width-(o.x+f.x))<=h?(w=this._createSnapObject(s,o,"leftRight"),v=Math.abs(s.y-o.y)):Math.abs(s.x-(o.x+o.width+f.x))<=h&&(w=this._createSnapObject(s,o,"rightLeft"),v=Math.abs(s.y-o.y))));for(k=this._findNodes(n._spatialSearch,i,et,p),a=0;a<k.length;a++)c=k[a],!c.segments&&this._canConsider(nt,i,c)&&(s=t.datavisualization.Diagram.Util.bounds(c),s.x+s.width<o.x+f.x&&(d[d.length]={object:c,distance:Math.abs(o.x+f.x-s.x-s.width)}),s.x>o.x+f.x+o.width&&(g[g.length]={object:c,distance:Math.abs(o.x+f.x+o.width-s.x)}),(y==null||y>Math.abs(s.x-o.x-f.x))&&(Math.abs(s.y+s.height/2-(o.y+o.height/2+f.y))<=h?(b=this._createSnapObject(s,o,"centerY"),y=Math.abs(s.x-o.x)):Math.abs(s.y-o.y-f.y)<=h?(b=this._createSnapObject(s,o,"top"),y=Math.abs(s.x-o.x)):Math.abs(s.y+s.height-(o.y+o.height+f.y))<=h?(b=this._createSnapObject(s,o,"bottom"),y=Math.abs(s.x-o.x)):Math.abs(s.y+s.height-o.y-f.y)<=h?(b=this._createSnapObject(s,o,"topBottom"),y=Math.abs(s.x-o.x)):Math.abs(s.y-(o.y+o.height+f.y))<=h&&(b=this._createSnapObject(s,o,"bottomTop"),y=Math.abs(s.x-o.x))));tt=this._createGuidelines(n,w,b,r,u,e);r.snapped||this._createHSpacingLines(n,i,d,g,r,u,e,tt,f,h);u.snapped||this._createVSpacingLines(n,i,it,rt,r,u,e,tt,f,h)},_snapSize:function(n,i,r,u,f,e,o){var p=null,w=null,d,g,s=t.datavisualization.Diagram.Util.bounds(e),ut=n.nameTable,nt=[],tt=[],l=n._currZoom,st=n._hScrollOffset,ht=n._vScrollOffset,v=n._snapObjectDistance(),y=n._viewPort,lt=t.datavisualization.Diagram.Rectangle(st/l,(s.y-5)/l,y.width/l,(s.height+10)/l),at=t.datavisualization.Diagram.Rectangle((s.x-5)/l,ht/l,(s.width+10)/l,y.height/l),it,b,a,c,h,et,ot;for(y=t.datavisualization.Diagram.Rectangle(st/l,ht/l,y.width/l,y.height/l),it=[],b=this._findNodes(n._spatialSearch,e,at,y,it),a=0;a<b.length;a++)c=b[a],this._canConsider(ut,e,c)&&!c.segments&&(h=t.datavisualization.Diagram.Util.bounds(c),(p==null||p>Math.abs(h.y-s.y))&&(i.left?Math.abs(s.x+u-h.x)<=v?(d=this._createSnapObject(h,s,"left"),p=Math.abs(h.y-s.y)):Math.abs(s.x+u-h.x-h.width)<=v&&(d=this._createSnapObject(h,s,"leftRight"),p=Math.abs(h.y-s.y)):i.right&&(Math.abs(s.x+u+s.width-h.x-h.width)<=v?(d=this._createSnapObject(h,s,"right"),p=Math.abs(h.y-s.y)):Math.abs(s.x+u+s.width-h.x)<=v&&(d=this._createSnapObject(h,s,"rightLeft"),p=Math.abs(h.y-s.y)))));for(b=this._findNodes(n._spatialSearch,e,lt,y),a=0;a<b.length;a++)c=b[a],this._canConsider(ut,e,c)&&!c.segments&&(h=t.datavisualization.Diagram.Util.bounds(c),(w==null||w>Math.abs(h.x-s.x))&&(r.top?Math.abs(s.y+f-h.y)<=v?(g=this._createSnapObject(h,s,"top"),w=Math.abs(h.x-s.x)):Math.abs(s.y+f-h.y-h.height)<=v&&(g=this._createSnapObject(h,s,"topBottom"),w=Math.abs(h.x-s.x)):r.bottom&&(Math.abs(s.y+s.height+f-h.y-h.height)<=v?(g=this._createSnapObject(h,s,"bottom"),w=Math.abs(h.x-s.x)):Math.abs(s.y+s.height+f-h.y)<=v&&(g=this._createSnapObject(h,s,"bottomTop"),w=Math.abs(h.x-s.x)))));for(a=0;a<it.length;a++)if(c=it[a],this._canConsider(ut,e,c)){var k=t.datavisualization.Diagram.Util.bounds(c),ft=i.left?-u:u,ct=Math.abs(s.width+ft-k.width),rt;ct<=v&&(rt=i.left?-k.width+s.width:k.width-s.width,nt[nt.length]={source:c,diff:ct,offset:rt});ft=r.top?-f:f;et=Math.abs(s.height+ft-k.height);et<=v&&(rt=r.top?-k.height+s.height:k.height-s.height,tt[tt.length]={source:c,diff:et,offset:rt})}ot=this._createGuidelines(n,d,g,i,r,o);!i.snapped&&nt.length>0&&(i.left||i.right)&&this._addSameWidthLines(n,nt,i,o,ot,e);!r.snapped&&tt.length>0&&(r.top||r.bottom)&&this._addSameHeightLines(n,tt,r,o,ot,e)},_createSnapObject:function(n,i,r){var u;switch(r){case"left":u={start:t.datavisualization.Diagram.Point(n.x,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x-i.x,offsetY:0,type:"sideAlign"};break;case"right":u={start:t.datavisualization.Diagram.Point(n.x+n.width,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"top":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y),offsetY:n.y-i.y,offsetX:0,type:"sideAlign"};break;case"bottom":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height),offsetY:n.y+n.height-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"topBottom":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height),offsetY:n.y+n.height-i.y,offsetX:0,type:"sideAlign"};break;case"bottomTop":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y),offsetY:n.y-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"leftRight":u={start:t.datavisualization.Diagram.Point(n.x+n.width,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width-i.x,offsetY:0,type:"sideAlign"};break;case"rightLeft":u={start:t.datavisualization.Diagram.Point(n.x,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"centerX":u={start:t.datavisualization.Diagram.Point(n.x+n.width/2,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width/2,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width/2-(i.x+i.width/2),offsetY:0,type:"centerAlign"};break;case"centerY":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height/2),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height/2),offsetY:n.y+n.height/2-(i.y+i.height/2),offsetX:0,type:"centerAlign"}}return u},_createGuidelines:function(n,i,r,u,f,e){var l={id:n._canvas.id+"guideline","pointer-events":"none",style:"pointer-events:none;"},o=t.datavisualization.Diagram.SvgContext._initializeGuidelines(n._svg,l,n._adornerLayer),s=n._currZoom,h=n._hScrollOffset,c=n._vScrollOffset;return i&&(u.offset=i.offsetX,u.snapped=!0,e||(i.type=="sideAlign"?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(i.start,i.end,o,n._svg,s,h,c):i.type=="centerAlign"&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(i.start,i.end,o,n._svg,s,h,c))),r&&(f.offset=r.offsetY,f.snapped=!0,e||(r.type=="sideAlign"?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(r.start,r.end,o,n._svg,s,h,c):r.type=="centerAlign"&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(r.start,r.end,o,n._svg,s,h,c))),o},_removeGuidelines:function(n){var i=n._svg.getElementById(n._canvas.id+"guideline");i!=null&&t.datavisualization.Diagram.SvgContext._removeGuidelines(n._adornerLayer,i)},_sortByDistance:function(n,t,i){var r,u,f;if(i)for(r=0;r<n.length;r++)for(u=r+1;u<n.length;u++)n[r][t]>n[u][t]&&(f=n[r],n[r]=n[u],n[u]=f);else for(r=0;r<n.length;r++)for(u=r+1;u<n.length;u++)n[r][t]<n[u][t]&&(f=n[r],n[r]=n[u],n[u]=f)},_createHSpacingLines:function(n,i,r,u,f,e,o,s,h,c){var a=null,l,w,p,y,b,v,d,g,k;this._sortByDistance(r,"distance",!0);this._sortByDistance(u,"distance",!0);l=[];w=t.datavisualization.Diagram.Util.bounds(i);r.length>0&&(l[l.length]=r[0],p=t.datavisualization.Diagram.Util.bounds(r[0].object),a=p.y,r.length>1?(b=t.datavisualization.Diagram.Util.bounds(r[1].object),v=p.x-b.x-b.width,Math.abs(v-r[0].distance)<=c?a=this._findEquallySpacedNodesAtLeft(r,v,a,l):v=r[0].distance):v=r[0].distance);this._sortByDistance(l,"distance");l[l.length]={object:i,distance:0};a=w.y<a||!a?w.y:a;u.length>0&&(y=t.datavisualization.Diagram.Util.bounds(u[0].object),a=y.y<a?y.y:a,u.length>1&&(b=t.datavisualization.Diagram.Util.bounds(u[1].object),d=b.x-y.x-y.width),r.length>0?Math.abs(u[0].distance-r[0].distance)<=c?(g=Math.abs(u[0].distance-r[0].distance)/2,u[0].distance<r[0].distance?v-=g:v+=g,l[l.length]=u[0]):r.length==1&&(p=undefined,l.splice(0,1),l[l.length]=u[0],v=d):(v=d,l[l.length]=u[0]),u.length>1&&y.x+y.width<b.x&&(a=this._findEquallySpacedNodesAtRight(u,d,a,l,c)));l.length>2&&(this._addHSpacingLines(n,l,o,s,a),k=0,o&&(k=h.x),p?f.offset=v-Math.abs(w.x+k-p.x-p.width)+k:y&&(f.offset=Math.abs(w.x+w.width+k-y.x)-v+k),f.snapped=!0)},_createVSpacingLines:function(n,i,r,u,f,e,o,s,h,c){var a=null,l,p,w,v,b,y,d,g,k;this._sortByDistance(r,"distance",!0);this._sortByDistance(u,"distance",!0);l=[];p=t.datavisualization.Diagram.Util.bounds(i);r.length>0&&(l[l.length]=r[0],w=t.datavisualization.Diagram.Util.bounds(r[0].object),a=w.x+w.width,r.length>1?(b=t.datavisualization.Diagram.Util.bounds(r[1].object),y=w.y-b.y-b.height,Math.abs(y-r[0].distance)<=c?a=this._findEquallySpacedNodesAtTop(r,y,a,l):y=r[0].distance):y=r[0].distance);this._sortByDistance(l,"distance");l[l.length]={object:i,distance:0};a=p.x+p.width>a||!a?p.x+p.width:a;u.length>0&&(v=t.datavisualization.Diagram.Util.bounds(u[0].object),a=v.x+v.width>a?v.x+v.width:a,u.length>1&&(b=t.datavisualization.Diagram.Util.bounds(u[1].object),d=b.y-v.y-v.height),r.length>0?Math.abs(u[0].distance-r[0].distance)<=c?(g=Math.abs(u[0].distance-r[0].distance)/2,u[0].distance<r[0].distance?y-=g:y+=g,l[l.length]=u[0]):r.length==1&&(w=undefined,l.splice(0,1),l[l.length]=u[0],y=d):(y=d,l[l.length]=u[0]),u.length>1&&b.y>v.y+v.height&&(a=this._findEquallySpacedNodesAtBottom(u,d,a,l,c)));l.length>2&&(this._addVSpacingLine(n,l,o,s,a),k=0,o&&(k=h.y),w?e.offset=y-Math.abs(p.y+k-w.y-w.height)+k:v&&(e.offset=Math.abs(p.y+p.height+k-v.y)-y+k),e.snapped=!0)},_addHSpacingLines:function(n,i,r,u,f){var h=n._currZoom,c=n._hScrollOffset,l=n._vScrollOffset,e,o,s;if(i.length>2&&!r)for(e=0;e<i.length-1;e++)o=t.datavisualization.Diagram.Util.bounds(i[e].object),s=t.datavisualization.Diagram.Util.bounds(i[e+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width,f-15),t.datavisualization.Diagram.Point(s.x,f-15),u,n._svg,h,c,l)},_addVSpacingLine:function(n,i,r,u,f){var h=n._currZoom,c=n._hScrollOffset,l=n._vScrollOffset,o,s,e;if(i.length>2&&!r)for(e=0;e<i.length-1;e++)o=t.datavisualization.Diagram.Util.bounds(i[e].object),s=t.datavisualization.Diagram.Util.bounds(i[e+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(f+15,o.y+o.height),t.datavisualization.Diagram.Point(f+15,s.y),u,n._svg,h,c,l)},_addSameWidthLines:function(n,i,r,u,f,e){var l=n._currZoom,a=n._hScrollOffset,v=n._vScrollOffset,s,y;this._sortByDistance(i,"offset");var o=t.datavisualization.Diagram.Util.bounds(e),c=i[0],p=t.datavisualization.Diagram.Util.bounds(c.source),h=[];for(h.push(i[0]),s=1;s<i.length;s++)y=t.datavisualization.Diagram.Util.bounds(i[s].source),y.width==p.width&&h.push(i[s]);if(h.length>0&&!u)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+c.offset,o.y-15),t.datavisualization.Diagram.Point(o.x+o.width+c.offset,o.y-15),f,n._svg,l,a,v),s=0;s<h.length;s++)o=t.datavisualization.Diagram.Util.bounds(h[s].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x,o.y-15),t.datavisualization.Diagram.Point(o.x+o.width,o.y-15),f,n._svg,l,a,v);r.offset=c.offset;r.snapped=!0},_addSameHeightLines:function(n,i,r,u,f,e){var l=n._currZoom,a=n._hScrollOffset,v=n._vScrollOffset,s,y;this._sortByDistance(i,"offset");var o=t.datavisualization.Diagram.Util.bounds(e),c=i[0],p=t.datavisualization.Diagram.Util.bounds(c.source),h=[];for(h.push(i[0]),s=0;s<i.length;s++)y=t.datavisualization.Diagram.Util.bounds(i[s].source),y.height==p.height&&h.push(i[s]);if(h.length>0){if(!u)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+c.offset),t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+o.height+c.offset),f,n._svg,l,a,v),s=0;s<h.length;s++)o=t.datavisualization.Diagram.Util.bounds(h[s].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width+15,o.y),t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+o.height),f,n._svg,l,a,v);r.offset=c.offset;r.snapped=!0}},_findEquallySpacedNodesAtLeft:function(n,i,r,u){for(var o,f,s,e=1;e<n.length;e++)if(o=t.datavisualization.Diagram.Util.bounds(n[e-1].object),f=t.datavisualization.Diagram.Util.bounds(n[e].object),s=o.x-f.x-f.width,Math.abs(s-i)<=1)u[u.length]=n[e],f.y<r&&(r=f.y);else break;return r},_findEquallySpacedNodesAtRight:function(n,i,r,u,f){var l=n[0].distance,s,h,o,c,e;if(Math.abs(i-l)<=f)for(e=0;e<n.length-1;e++)if(s=n[e].object,h=t.datavisualization.Diagram.Util.bounds(n[e+1].object),o=t.datavisualization.Diagram.Util.bounds(s),c=h.x-o.x-o.width,Math.abs(c-i)<=1)u[u.length]=n[e+1],o.y<r&&(r=o.y);else break;return r},_findEquallySpacedNodesAtTop:function(n,i,r,u){for(var o,f,s,e=1;e<n.length;e++)if(o=t.datavisualization.Diagram.Util.bounds(n[e-1].object),f=t.datavisualization.Diagram.Util.bounds(n[e].object),s=o.y-f.y-f.height,Math.abs(s-i)<=1)u[u.length]=n[e],f.x+f.width>r&&(r=f.x+f.width);else break;return r},_findEquallySpacedNodesAtBottom:function(n,i,r,u,f){var l=n[0].distance,s,h,e,c,o;if(Math.abs(i-l)<=f)for(o=0;o<n.length-1;o++)if(s=n[o].object,h=t.datavisualization.Diagram.Util.bounds(n[o+1].object),e=t.datavisualization.Diagram.Util.bounds(s),c=h.y-e.y-e.height,Math.abs(c-i)<=1)u[u.length]=n[o+1],e.x+e.width>r&&(r=e.x+e.width);else break;return r}};t.datavisualization.Diagram.SpatialUtil={findQuads:function(n,t){n.quads=[];var i=n.parentQuad;return this._findQuads(n,i,t),n.quads},_addIntoAQuad:function(n){for(var t=!1;!t;)t=this._add(n,n.parentQuad)},_setCurrentNode:function(n,i){n.childnode=i;var r=t.datavisualization.Diagram.Util.bounds(i);n.childLeft=r.left;n.childTop=r.top;n.childRight=r.right;n.childBottom=r.bottom},_add:function(n,i){if(this._isContained(n,i))return this._selectQuad(n,i),!0;var r,u=!i.objects.length&&i.first==null&&i.second==null&&i.third==null&&i.fourth==null;return n.childLeft<i.left?n.childTop<i.top?(r=t.datavisualization.Diagram.Quad(i.left-i.width,i.top-i.height,i.width*2,i.height*2),u||(r.fourth=i)):(r=t.datavisualization.Diagram.Quad(i.left-i.width,i.top,i.width*2,i.height*2),u||(r.second=i)):n.childTop<i.top?(r=t.datavisualization.Diagram.Quad(i.left,i.top-i.height,i.width*2,i.height*2),u||(r.third=i)):(r=t.datavisualization.Diagram.Quad(i.left,i.top,i.width*2,i.height*2),u||(r.first=i)),i.parent=r,n.parentQuad=r,!1},_isContained:function(n,t){return n.childLeft>=t.left&&n.childRight<=t.left+t.width&&n.childTop>=t.top&&n.childBottom<=t.top+t.height?!0:!1},_selectQuad:function(n,t){for(var i=t;i!==null;)i=this._getQuad(n,i)},_getQuad:function(n,i){var u=i.width/2,f=i.height/2,e,r;if(u>=100&&f>=100)if(e=i.left+u,r=i.top+f,n.childRight<=e){if(n.childBottom<=r)return i.first?i.first:i.first=t.datavisualization.Diagram.Quad(i.left,i.top,u,f,i);if(n.childTop>=r)return i.third?i.third:i.third=t.datavisualization.Diagram.Quad(i.left,r,u,f,i)}else if(n.childLeft>=e){if(n.childBottom<=r)return i.second?i.second:i.second=t.datavisualization.Diagram.Quad(e,i.top,u,f,i);if(n.childTop>=r)return i.fourth?i.fourth:i.fourth=t.datavisualization.Diagram.Quad(e,r,u,f,i)}return i.objects.push(n.childnode),n.quadTable[n.childnode.name]=i,null},_findQuads:function(n,t,i){t.first&&this._isIntersect(t.first,i)&&this._findQuads(n,t.first,i);t.second&&this._isIntersect(t.second,i)&&this._findQuads(n,t.second,i);t.third&&this._isIntersect(t.third,i)&&this._findQuads(n,t.third,i);t.fourth&&this._isIntersect(t.fourth,i)&&this._findQuads(n,t.fourth,i);t.objects.length>0&&n.quads.push(t)},_isIntersect:function(n,t){return n.left+n.width<t.x||n.top+n.height<t.x||n.left>t.x+t.width||n.top>t.y+t.height?!1:!0},_update:function(n){if(n.parent!=null&&n.objects.length==0&&n.first==null&&n.second==null&&n.third==null&&n.fourth==null){var t=n.parent;t.first==n?t.first=null:t.second==n?t.second=null:t.third==n?t.third=null:t.fourth==n&&(t.fourth=null);this._update(n.parent)}else return},_isWithinPageBounds:function(n,t){return t.left>=n.pageLeft&&t.right<=n.pageRight&&t.top>=n.pageTop&&t.bottom<=n.pageBottom?!0:!1},_updateBounds:function(n,i,r){var u=!1;i.topElement&&r.name==i.topElement.name&&(u=!0,i.pageTop=null,this._findQuadElement(i,i.parentQuad,"top"));i.leftElement&&r.name==i.leftElement.name&&(u=!0,i.pageLeft=null,this._findQuadElement(i,i.parentQuad,"left"));i.rightElement&&r.name==i.rightElement.name&&(u=!0,i.pageRight=null,this._findQuadElement(i,i.parentQuad,"right"));i.bottomElement&&r.name==i.bottomElement.name&&(u=!0,i.pageBottom=null,this._findQuadElement(i,i.parentQuad,"bottom"));u&&n._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(n,!0)},_findQuadElement:function(n,i,r){var u,f;switch(r){case"bottom":i.third!=null||i.fourth!=null?(i.third!=null&&this._findQuadElement(n,i.third,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r)):(i.first!=null&&this._findQuadElement(n,i.first,r),i.second!=null&&this._findQuadElement(n,i.second,r));break;case"top":i.first!=null||i.second!=null?(i.first!=null&&this._findQuadElement(n,i.first,r),i.second!=null&&this._findQuadElement(n,i.second,r)):(i.third!=null&&this._findQuadElement(n,i.third,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r));break;case"left":i.first!=null||i.third!=null?(i.first!=null&&this._findQuadElement(n,i.first,r),i.third!=null&&this._findQuadElement(n,i.third,r)):(i.second!=null&&this._findQuadElement(n,i.second,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r));break;case"right":i.second!=null||i.fourth!=null?(i.second!=null&&this._findQuadElement(n,i.second,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r)):(i.third!=null&&this._findQuadElement(n,i.third,r),i.first!=null&&this._findQuadElement(n,i.first,r))}for(f=0;f<i.objects.length;f++)u=t.datavisualization.Diagram.Util.bounds(i.objects[f]),r==="bottom"&&(n.pageBottom<=u.bottom||n.pageBottom==null)?(n.pageBottom=u.bottom,n.bottomElement=i.objects[f]):r==="top"&&(n.pageTop>=u.top||n.pageTop==null)?(n.pageTop=u.top,n.topElement=i.objects[f]):r==="left"&&(n.pageLeft>=u.left||n.pageLeft==null)?(n.pageLeft=u.left,n.leftElement=i.objects[f]):r==="right"&&(n.pageRight<=u.right||n.pageRight==null)&&(n.pageRight=u.right,n.rightElement=i.objects[f])},_initializeNodes:function(n,t){for(var r,f,u=n.nodes(),i=0;i<u.length;i++)r=u[i],f=this.getObjectType(r),f!="group"&&this._updateQuad(n,t,r)},_initializeConnectors:function(n,t){for(var r=n.connectors(),i=0;i<r.length;i++)this._updateQuad(n,t,r[i])},_updateQuad:function(i,r,u){var o,e,f;this._setCurrentNode(r,u);o=t.datavisualization.Diagram.Util.bounds(u);e=r.quadTable[u.name];e?u.segments?(this._removeFromaQuad(r,e,u),this._addIntoAQuad(r)):this._isContained(r,e)||(this._removeFromaQuad(r,e,u),this._addIntoAQuad(r)):(r.parentQuad||(r.parentQuad=t.datavisualization.Diagram.Quad(0,0,200,200)),this._addIntoAQuad(r));this._isWithinPageBounds(r,o)&&r.leftElement!=u&&r.topElement!=u&&r.rightElement!=u&&r.bottomElement!=u||(f=!1,r.pageLeft>=r.childLeft||r.pageLeft==null?(r.pageLeft=r.childLeft,r.leftElement=u,f=!0):u==r.leftElement&&(r.pageLeft=null,this._findQuadElement(r,r.parentQuad,"left"),f=!0),r.pageTop>=r.childTop||r.pageTop==null?(r.pageTop=r.childTop,r.topElement=u,f=!0):u==r.topElement&&(r.pageTop=null,this._findQuadElement(r,r.parentQuad,"top"),f=!0),r.pageBottom<=r.childBottom||r.pageBottom==null?(f=!0,r.pageBottom=r.childBottom,r.bottomElement=u):u==r.bottomElement&&(r.pageBottom=null,this._findQuadElement(r,r.parentQuad,"bottom"),f=!0),r.pageRight<=r.childRight||r.pageRight==null?(r.pageRight=r.childRight,r.rightElement=u,f=!0):u==r.rightElement&&(r.pageRight=null,this._findQuadElement(r,r.parentQuad,"right"),f=!0));f&&(i._views.forEach(function(t){var u=i._views[t],r;u.type=="overview"&&(r=n("#"+t).ejOverview("instance"),r&&r._updateOverview(u))}),!i._layoutInAction&&i._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(i,i.activeTool.inAction))},_removeFromaQuad:function(n,t,i){if(t){var r=t.objects.indexOf(i);t.objects.splice(r,1);this._update(t);delete n.quadTable[i.name]}}};t.datavisualization.Diagram.Quad=function(n,t,i,r,u){return{left:n,top:t,width:i,height:r,parent:u,first:null,second:null,third:null,fourth:null,objects:[]}};t.datavisualization.Diagram.SpatialSearch=function(){return{pageLeft:null,pageRight:null,pageTop:null,pageBottom:null,topElement:null,bottomElement:null,rightElement:null,leftElement:null,childLeft:null,childTop:null,childRight:null,childBottom:null,childNode:null,quads:null,parentQuad:t.datavisualization.Diagram.Quad(0,0,200,200),quadTable:{}}}}(jQuery,Syncfusion),function(n,t){"use strict";t.widget("ejOverview","ej.datavisualization.Overview",{element:null,validTags:["div"],model:null,defaults:{sourceID:"",width:null,height:null},_canvas:null,_actionName:"",_startPoint:null,_currentPoint:null,_prevPoint:null,_helper:null,_viewPortRatio:1,_resizeDirection:"",_inAction:!1,_init:function(){t.browserInfo().name==="msie"&&Number(t.browserInfo().version)<9||(this._wireEvents(),this._renderCanvas(),this._setParent(this.model.sourceID))},_renderCanvas:function(){var n=document.createElement("div");n.setAttribute("id",this.element[0].id+"_canvas");n.setAttribute("class","drawing");n.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";style:-ms-touch-action: none;touch-action: none;");this.element[0].setAttribute("tabindex",0);this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width});this.element.append(n);this._canvas=n},_renderDocument:function(i){var o,r,h,c;if(i.canvas=this._canvas,window.SVGSVGElement){o={id:this._canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:i.style};r=new t.datavisualization.Diagram.Svg(o);this._svg=r;i.svg=r;var l=document.getElementById(this._id),e=l,u=n(e).width(),f=n(e).height(),s=e.getBoundingClientRect(),a=window.screenX<0?window.screenX*-1:window.screenX;u===0&&(u=Math.floor(window.innerWidth-a-Math.floor(s.left)));h=window.screenY<0?window.screenY*-1:window.screenY;f===0&&(f=Math.floor(window.innerHeight-h-Math.floor(s.top)));r.document.setAttribute("width",u);r.document.setAttribute("height",f);this.width=u;this.height=f;c=r.defs({id:i.canvas.id+"definition"});r.appendChild(c);i.diagramLayer=t.datavisualization.Diagram.SvgContext._renderDiagramLayer(i.canvas,i.svg,i.svg);i.canvas.appendChild(r.document);this._addOverviewRectPanel();this._renderHtmlLayer(i.canvas)}},_removeDocument:function(){var n=document.getElementById(this._canvas.id+"_svg");this._canvas.removeChild(n)},_renderHtmlLayer:function(n){var i=document.createElement("div"),u={id:n.id+"_htmlLayer","class":"htmlLayer"},r;return t.datavisualization.Diagram.Util.attr(i,u),r=i,i.style.pointerEvents="none",i.style.position="absolute",i.style.left="0px",i.style.top="0px",n.appendChild(r),r},_setModel:function(n){for(var t in n)switch(t){case"sourceID":this._setParent(n[t])}},_setParent:function(t){if(this._parent){var i=n("#"+this._parent._id).ejDiagram("instance");this._parent=null;i._setOverview(null,this._id)}t&&(this.model.sourceID=t,this._parent=n("#"+t).ejDiagram("instance"),this._parent&&this._parent._setOverview(this))},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_wireEvents:function(){var i=n(this._canvas);this._on(i,t.eventType.mouseDown,this._mousedown);this._on(i,t.eventType.mouseMove,this._mousemove);this._on(i,t.eventType.mouseUp,this._mouseup);this._on(i,t.eventType.mouseLeave,this._documentmouseup);this._on(i,"touchstart",this.handleTouchStart);this._on(i,"touchmove",this.handleTouchMove);this._on(i,"touchend",this.handleTouchEnd);window&&this._on(n(window),"resize",this.updateScrollerViewport)},updateScrollerViewport:function(){},_mouseup:function(n){var f,e,t,u;if(this._currentPoint=this._mouseposition(n),f=this.width,e=this.height,this._actionName)if(this._startPoint.x!=this._currentPoint.x||this._startPoint.y!=this._currentPoint.y){if(this._actionName!="pan"&&this._helper){t=this._helper.getBBox();this._resizeDirection=this._resizeDirection||"";var o=t.x,s=t.y,i=t.width,r=t.height,h=this._resizeDirection=="topleft"||this._resizeDirection=="topright"||this._resizeDirection=="bottomleft"||this._resizeDirection=="bottomright";this._renderOverviewRect(o,s,i,r)}}else if((n.target.id==this._canvas.id+"overviewbackrect"||n.target.id=="helper")&&this._startPoint.x==this._currentPoint.x&&this._startPoint.y==this._currentPoint.y){var u=document.getElementById(this._canvas.id+"overviewrect"),t=u.getBBox(),i=t.width||100,r=t.height||100/this._viewPortRatio;this.inAction=!0;this._actionName="pan";this._renderOverviewRect(this._currentPoint.x-i/2,this._currentPoint.y-r/2,i,r);this.inAction=!1}this._helper&&(u=document.getElementById(this._canvas.id+"overviewhandle"),u.removeChild(this._helper),this._helper=null);this._actionName="";this._startPoint=null;this._currentPoint=null;this._prevPoint=null;this._helper=null;this._viewPortRatio=1;this._resizeDirection="";this._inAction=!1},_mousedown:function(n){if(n.target.className.animVal=="overviewbackrect"&&(this._actionName="draw"),n.target.id==this._canvas.id+"overviewrect"&&(this._actionName="pan"),n.target.className.animVal=="overviewresizer"){this._actionName="scale";switch(n.target.id){case this._canvas.id+"left":this._resizeDirection="left";break;case this._canvas.id+"right":this._resizeDirection="right";break;case this._canvas.id+"top":this._resizeDirection="top";break;case this._canvas.id+"bottom":this._resizeDirection="bottom";break;case this._canvas.id+"topleft":this._resizeDirection="topleft";break;case this._canvas.id+"topright":this._resizeDirection="topright";break;case this._canvas.id+"bottomleft":this._resizeDirection="bottomleft";break;case this._canvas.id+"bottomright":this._resizeDirection="bottomright"}}this._startPoint=this._prevPoint=this._mouseposition(n);var i=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent);this._viewPortRatio=i.width/i.height},_mouseposition:function(n){var i=this._parent._isTouchEvent(n);i||(i=n);var u=this._canvas.scrollLeft,f=this._canvas.scrollTop,r=this._canvas.getBoundingClientRect(),e=i.clientX+u-r.left,o=f+i.clientY-r.top;return new t.datavisualization.Diagram.Point(e,o)},_updateCursor:function(n){if(n.target.className.animVal=="overviewresizer")switch(n.target.id){case this._canvas.id+"left":this._canvas.style.cursor="w-resize";break;case this._canvas.id+"right":this._canvas.style.cursor="e-resize";break;case this._canvas.id+"top":this._canvas.style.cursor="n-resize";break;case this._canvas.id+"bottom":this._canvas.style.cursor="s-resize";break;case this._canvas.id+"topleft":this._canvas.style.cursor="nw-resize";break;case this._canvas.id+"topright":this._canvas.style.cursor="ne-resize";break;case this._canvas.id+"bottomleft":this._canvas.style.cursor="sw-resize";break;case this._canvas.id+"bottomright":this._canvas.style.cursor="se-resize"}else this._canvas.style.cursor=""},_mousemove:function(n){if(this._updateCursor(n),this._currentPoint=this._mouseposition(n),this._actionName)switch(this._actionName){case"draw":this._inAction||(this._initHelper(),this._inAction=!0);this._updateHelper();break;case"scale":this._inAction||(this._initHelper(),this._inAction=!0);this._updateOverviewRectangle();break;case"pan":this._inAction=!0;this._translateOverviewRectangle()}this._prevPoint=this._currentPoint},_documentmouseup:function(){if(this._inAction=!1,this._actionName="",this._helper){var n=document.getElementById(this._canvas.id+"overviewhandle");n.removeChild(this._helper);this._helper=null}},_addOverviewRectPanel:function(){var u=this._svg,f=u.g({id:this._id+"_overviewlayer"}),e,r,i,o;this._canvas.firstChild.appendChild(f);e=u.rect({fill:"transparent",width:"100%",height:"100%","class":"overviewbackrect",id:this._canvas.id+"overviewbackrect"});f.appendChild(e);r=n(f);this._on(r,t.eventType.mouseDown,this._mousedown);this._on(r,t.eventType.mouseMove,this._mousemove);this._on(r,t.eventType.mouseUp,this._mouseup);this._on(r,t.eventType.mouseLeave,this._documentmouseup);this._on(r,"touchstart",this.handleTouchStart);this._on(r,"touchmove",this.handleTouchMove);this._on(r,"touchend",this.handleTouchEnd);i=u.g({id:this._canvas.id+"overviewhandle"});f.appendChild(i);o=u.rect({id:this._canvas.id+"overviewrect",fill:"transparent"});i.appendChild(o);this._renderOverviewCorner("left",i);this._renderOverviewCorner("right",i);this._renderOverviewCorner("top",i);this._renderOverviewCorner("bottom",i);this._renderOverviewCorner("topleft",i);this._renderOverviewCorner("topright",i);this._renderOverviewCorner("bottomleft",i);this._renderOverviewCorner("bottomright",i)},_updateOverview:function(n){var c,l,i,f,e,v,r,u,y,h;n=n||this._parent._views[this._id];i=this._parent._getDigramBounds();c=i.width;l=i.height;var a=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),o=this.width,s=this.height;n.context==t.datavisualization.Diagram.SvgContext?(f=Math.max(c,a.width),e=Math.max(l,a.height),this.contentWidth=f=Math.max(f,o/s*e),this.contentHeight=e=Math.max(e,s/o*f),v=document.getElementById(this._canvas.id+"_diagramLayer"),r=Math.min(o/f,s/e),this.scale=r,v.setAttribute("transform","scale("+r+","+r+"),translate("+-i.x+","+-i.y+")"),u=document.getElementById(this._canvas.id+"_htmlLayer"),u.style.webkitTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.MozTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.OTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.msTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.transform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",y=document.getElementById(this._id+"_overviewlayer"),y.setAttribute("transform","translate("+-i.x*r+","+-i.y*r+")")):(h=n._canvas.document.getContext("2d"),n.scale&&h.scale(1/n.scale.x,1/n.scale.y),n.scale={x:r,y:r},h.scale(r,r),t.datavisualization.Diagram.CanvasContext.refreshCanvas(this._parent.model,n));this._scrollOverviewRect(this._parent._hScrollOffset,this._parent._vScrollOffset,this._parent._currZoom)},_updateOverviewRectangle:function(){var n=this._currentPoint.x-this._prevPoint.x,t=this._currentPoint.y-this._prevPoint.y;if(this._actionName=="scale"){var i={width:0,height:0},r=0,u=0,f,e;switch(this._resizeDirection){case"left":i.width-=n;i.height-=n/this._viewPortRatio;r=n;u=n/this._viewPortRatio/2;break;case"right":i.width+=n;i.height+=n/this._viewPortRatio;u=n/this._viewPortRatio/-2;break;case"top":i.height-=t;i.width-=t*this._viewPortRatio;u=t;r=t*this._viewPortRatio/2;break;case"bottom":i.height+=t;i.width+=t*this._viewPortRatio;r=t*this._viewPortRatio/-2;break;case"topleft":Math.abs(t)>Math.abs(n)?n=t*this._viewPortRatio:t=n/this._viewPortRatio;i.width-=n;i.height-=t;r=n;u=t;break;case"topright":Math.abs(t)>Math.abs(n)?n=-t*this._viewPortRatio:t=-(n/this._viewPortRatio);u=t;i.width+=n;i.height-=t;break;case"bottomleft":Math.abs(t)>Math.abs(n)?n=-t*this._viewPortRatio:t=-n/this._viewPortRatio;r=n;i.width-=n;i.height+=t;break;case"bottomright":Math.abs(t)>Math.abs(n)?n=t*this._viewPortRatio:t=n/this._viewPortRatio;i.width+=n;i.height+=t}this._updateHelper(r,u,i,f,e)}},_initHelper:function(){var e,n,t;if(!this._helper){var o=this._svg,s=document.getElementById(this._canvas.id+"overviewhandle"),h=this._parent._currZoom,i=this._startPoint.x,r=this._startPoint.y,u=1,f=1;this._actionName=="scale"&&(e=document.getElementById(this._canvas.id+"overviewrect"),n=e.getBBox(),i=n.x,r=n.y,u=n.width,f=n.height);t=o.rect({id:"helper",x:i,y:r,width:u,height:f,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"});s.appendChild(t);this._helper=t}},_updateHelper:function(n,i,r){var n,i,o,s;if(r)var u=this._helper.getBBox(),h=u.x+n,c=u.y+i,f=u.width+r.width,e=u.height+r.height;else{n=this._currentPoint.x>this._startPoint.x?this._currentPoint.x-this._prevPoint.x:this._prevPoint.x-this._currentPoint.x;i=this._currentPoint.y>this._startPoint.y?this._currentPoint.y-this._prevPoint.y:this._prevPoint.y-this._currentPoint.y;Math.abs(i)>Math.abs(n)?(n=this._viewPortRatio*i,s=!0,o=!1):(i=n/this._viewPortRatio,o=!0,s=!1);var u=this._helper.getBBox(),h=this._startPoint.x>this._currentPoint.x?u.x-n:u.x,c=this._startPoint.y>this._currentPoint.y?u.y-i:u.y,f=u.width+n,e=u.height+i}this._helper&&t.datavisualization.Diagram.Util.attr(this._helper,{id:this._helper.id,x:h,y:c,width:f<0?0:f,height:e<0?0:e})},_renderOverviewCorner:function(n,t){var i=this._svg,r,u;n=="top"||n=="bottom"||n=="right"||n=="left"?(r=i.rect({id:this._canvas.id+"visible"+n}),t.appendChild(r),u=i.rect({id:this._canvas.id+n,"class":"overviewresizer",fill:"transparent"}),t.appendChild(u)):(r=i.circle({id:this._canvas.id+"visible"+n}),t.appendChild(r),u=i.circle({id:this._canvas.id+n,"class":"overviewresizer",fill:"transparent"}),t.appendChild(u))},_updateOverviewrect:function(n,i,r,u){if(r&&u){var f=document.getElementById(this._canvas.id+"overviewrect"),e={x:n,y:i,width:Math.max(1,r),height:Math.max(1,u)};t.datavisualization.Diagram.Util.attr(f,e);this._updateOverviewCorner("top",n+8,i-2,Math.max(0,r-16),2);this._updateOverviewCorner("bottom",n+8,i+u,Math.max(0,r-16),2);this._updateOverviewCorner("left",n-2,i+8,2,Math.max(0,u-16));this._updateOverviewCorner("right",n+r,i+8,2,Math.max(0,u-16));this._updateOverviewCorner("topleft",n,i,5,5);this._updateOverviewCorner("topright",n+r,i,5,5);this._updateOverviewCorner("bottomleft",n,i+u,5,5);this._updateOverviewCorner("bottomright",n+r,i+u,5,5)}},_scrollOverviewRect:function(n,i,r){var h;if(!this._actionName){var c=this.width,l=this.height,u=Math.min(this.contentWidth/c,this.contentHeight/l),f={},e=f.x=n/r/u,o=f.y=i/r/u,s=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),a=f.width=s.width/r/u,v=f.height=s.height/r/u,y=s.width/s.height;e+a>c&&(h=e+a-c,e-=h);o+v>l&&(h=o+v-l,o-=h);this._updateOverviewrect(e,o,a,v)}},_updateOverviewCorner:function(n,i,r,u,f){var h="visible"+n,c=document.getElementById(this._canvas.id+h),e,o,s;n=="top"||n=="bottom"||n=="right"||n=="left"?(e={x:i,y:r,width:u,height:f,fill:"#ED1C24"},o={x:i-2,y:r-2,width:u==2?4:u,height:f==2?4:f}):(e={cx:i,cy:r,r:4,fill:"#ED1C24"},o={cx:i,cy:r,r:6,fill:"transparent"});t.datavisualization.Diagram.Util.attr(c,e);s=document.getElementById(this._canvas.id+n);t.datavisualization.Diagram.Util.attr(s,o)},_translateOverviewRectangle:function(){var o=this.width,s=this.height,h=this._currentPoint.x-this._prevPoint.x,c=this._currentPoint.y-this._prevPoint.y,i=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),a=Math.min(i.width/o,i.height/s),l=document.getElementById(this._canvas.id+"overviewrect"),n=l.getBBox(),r=n.x+h,u=n.y+c,f=n.width,e=n.height;this._updateOverviewrect(r,u,f,e);this._updateView(this._parent._currZoom,r,u,f,e,null)},_updateView:function(i,r,u,f,e,o){var b=this.width,k=this.height,d=this.contentWidth/b,g=this.contentHeight/k,y=r*d*i,p=u*g*i,h=this._parent._getDigramBounds(),v,s;if(i!=1||this._actionName=="pan"){var a=n("#"+this._parent._canvas.id+"_hScrollbar").ejScrollBar("instance").model,w=-y+a.maximum,c=-y+this._parent._hScrollOffset,l=-p+this._parent._vScrollOffset;h.width*i<w&&(s=h.width*i-w,c=Math.abs(s)<Math.abs(c)?c-s:0);a=n("#"+this._parent._canvas.id+"_vScrollbar").ejScrollBar("instance").model;v=-p+a.maximum;h.height*i<v&&(s=h.height*i-v,l=Math.abs(s)<Math.abs(l)?l-s:0)}t.datavisualization.Diagram.ZoomUtil.zoomPan(this._parent,i/this._parent._currZoom,c,l,o,!1)},_renderOverviewRect:function(n,i,r,u){var o=this.width,s=this.height,e=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),h=r/o*this.contentWidth,c=u/s*this.contentHeight,f=Math.max(e.width/h,e.height/c);f>=.25&&f<=30&&(this._updateView(f,n,i,r,u,new t.datavisualization.Diagram.Point(0,0)),this._updateOverviewrect(n,i,r,u))},handleTouchStart:function(n){n.preventDefault()},handleTouchMove:function(n){n.preventDefault()},handleTouchEnd:function(n){n.preventDefault()},handleTouchLeave:function(n){n.preventDefault()}})}(jQuery,Syncfusion),function(n,t){"use strict";var i=function(){function i(n){return this.document=document.createElement("canvas"),this.id=n.id,n&&t.datavisualization.Diagram.Util.attr(this.document,n),this}return i.prototype.rect=function(n,t,i,r,u,f){var e=this.document.getContext("2d");e.beginPath();u&&u.angle&&this.rotateContext(u,e);f?(this.setStyle(f,e),f.dashArray?this.dashedRectangle(n,t,i,r,f.dashArray):e.strokeRect(n,t,i,r)):e.strokeRect(n,t,i,r);e.fillRect(n,t,i,r);e.closePath();u&&u.angle&&e.restore()},i.prototype.ellipse=function(n,i,r,u,f,e){var s=this.document.getContext("2d"),o;e&&this.setStyle(e,s);o=4*((Math.sqrt(2)-1)/3);s.beginPath();f&&f.angle&&this.rotateContext(f,s);s.moveTo(n,i-u);s.bezierCurveTo(n+o*r,i-u,n+r,i-o*u,n+r,i);s.bezierCurveTo(n+r,i+o*u,n+o*r,i+u,n,i+u);s.bezierCurveTo(n-o*r,i+u,n-r,i+o*u,n-r,i);s.bezierCurveTo(n-r,i-o*u,n-o*r,i-u,n,i-u);s.fill();e&&e.dashArray&&(this.bezierCurve(t.datavisualization.Diagram.Point(n,i-u),new t.datavisualization.Diagram.Point(n+o*r,i-u),new t.datavisualization.Diagram.Point(n+r,i-o*u),new t.datavisualization.Diagram.Point(n+r,i),e),this.bezierCurve(t.datavisualization.Diagram.Point(n+r,i),new t.datavisualization.Diagram.Point(n+r,i+o*u),new t.datavisualization.Diagram.Point(n+o*r,i+u),new t.datavisualization.Diagram.Point(n,i+u),e),this.bezierCurve(t.datavisualization.Diagram.Point(n,i+u),new t.datavisualization.Diagram.Point(n-o*r,i+u),new t.datavisualization.Diagram.Point(n-r,i+o*u),new t.datavisualization.Diagram.Point(n-r,i),e),this.bezierCurve(t.datavisualization.Diagram.Point(n-r,i),new t.datavisualization.Diagram.Point(n-r,i-o*u),new t.datavisualization.Diagram.Point(n-o*r,i-u),new t.datavisualization.Diagram.Point(n,i-u),e));s.stroke();s.closePath();f&&f.angle&&s.restore()},i.prototype.circle=function(n,t,i,r,u){var f=this.document.getContext("2d");u&&this.setStyle(u,f);r&&r.angle&&this.rotateContext(r,f);u&&u.dashArray?(f.beginPath(),f.arc(n,t,i,0,2*Math.PI),f.fill(),f.stroke(),f.closePath()):this.ellipse(n,t,i*2,i*2,r,u);r&&r.angle&&f.restore()},i.prototype.arc=function(n,t,i,r,u){var e={angle:r,x:n,y:t},f=this.document.getContext("2d");u&&this.setStyle(u,f);e&&e.angle&&this.rotateContext(e,f);f.beginPath();u&&u.dashArray?f.arc(n,t,i,0,Math.PI):f.arc(n,t,i,0,Math.PI);f.stroke();f.closePath();e&&e.angle&&f.restore()},i.prototype.path=function(n,i,r,u,f,e,o){var h=this.document.getContext("2d"),tt,s,yt,g;o&&this.setStyle(o,h);h.beginPath();h.translate(i,r);e&&e.angle&&this.rotateContext(e,h);tt=document.createElementNS("http://www.w3.org/2000/svg","path");tt.setAttribute("d",n);this.document.appendChild(tt);for(var gt=this.getSegments(tt),ri=i,ui=r,ft,et,k,d,ot,st,ht=gt,i=0,r=0,ct=0,ni=ht.length;ct<ni;++ct){s=ht[ct];yt=s.command;"x1"in s&&(k=s.x1);"x2"in s&&(ot=s.x2);"y1"in s&&(d=s.y1);"y2"in s&&(st=s.y2);"x"in s&&(i=s.x);"y"in s&&(r=s.y);switch(yt){case"M":h.moveTo(i,r);s.x=i;s.y=r;break;case"L":h.lineTo(i,r);s.x=i;s.y=r;break;case"C":h.bezierCurveTo(k,d,ot,st,i,r);s.x=i;s.y=r;s.x1=k;s.y1=d;s.x2=ot;s.y2=st;break;case"Q":h.quadraticCurveTo(k,d,i,r);s.x=i;s.y=r;s.x1=k;s.y1=d;break;case"A":var w=new t.datavisualization.Diagram.Point(ft,et),c=s.r1,l=s.r2,v=s.angle*(Math.PI/180),ti=s.largeArcFlag,it=s.sweepFlag,b=new t.datavisualization.Diagram.Point(i,r),a=new t.datavisualization.Diagram.Point(Math.cos(v)*(w.x-b.x)/2+Math.sin(v)*(w.y-b.y)/2,-Math.sin(v)*(w.x-b.x)/2+Math.cos(v)*(w.y-b.y)/2),lt=Math.pow(a.x,2)/Math.pow(c,2)+Math.pow(a.y,2)/Math.pow(l,2);lt>1&&(c*=Math.sqrt(lt),l*=Math.sqrt(lt));g=(ti==it?-1:1)*Math.sqrt((Math.pow(c,2)*Math.pow(l,2)-Math.pow(c,2)*Math.pow(a.y,2)-Math.pow(l,2)*Math.pow(a.x,2))/(Math.pow(c,2)*Math.pow(a.y,2)+Math.pow(l,2)*Math.pow(a.x,2)));isNaN(g)&&(g=0);var y=new t.datavisualization.Diagram.Point(g*c*a.y/l,g*-l*a.x/c),p=new t.datavisualization.Diagram.Point((w.x+b.x)/2+Math.cos(v)*y.x-Math.sin(v)*y.y,(w.y+b.y)/2+Math.sin(v)*y.x+Math.cos(v)*y.y),pt=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2))},rt=function(n,t){return(n[0]*t[0]+n[1]*t[1])/(pt(n)*pt(t))},wt=function(n,t){return(n[0]*t[1]<n[1]*t[0]?-1:1)*Math.acos(rt(n,t))},ut=wt([1,0],[(a.x-y.x)/c,(a.y-y.y)/l]),at=[(a.x-y.x)/c,(a.y-y.y)/l],vt=[(-a.x-y.x)/c,(-a.y-y.y)/l],nt=wt(at,vt);rt(at,vt)<=-1&&(nt=Math.PI);rt(at,vt)>=1&&(nt=0);var ii=1-it?1:-1,bt=ut+ii*(nt/2),fi=new t.datavisualization.Diagram.Point(p.x+c*Math.cos(bt),p.y+l*Math.sin(bt));if(s.centp=p,s.xAxisRotation=v,s.rx=c,s.ry=l,s.a1=ut,s.ad=nt,s.sweepFlag=it,h!=null){var rt=c>l?c:l,kt=c>l?1:c/l,dt=c>l?l/c:1;h.save();h.translate(p.x,p.y);h.rotate(v);h.scale(kt,dt);h.arc(0,0,rt,ut,ut+nt,1-it);h.scale(1/kt,1/dt);h.rotate(-v);h.translate(-p.x,-p.y);h.restore()}break;case"Z":h.closePath();i=ft;r=et}ft=i;et=r}h.fill();o&&o.dashArray?this.drawDashedPath(ht,o):h.stroke();h.translate(-i,-r);e&&e.angle&&h.restore()},i.prototype.getSegments=function(i){for(var r,a,c,l,k,u,e,o,v,y,p,w,d,g,nt=i.pathSegList,f=[],s=0,h=0,b=0,tt=nt.numberOfItems;b<tt;++b){r=nt.getItem(b);a=r.pathSegTypeAsLetter;"x1"in r&&(v=r.x1);"x2"in r&&(p=r.x2);"y1"in r&&(y=r.y1);"y2"in r&&(w=r.y2);"x"in r&&(s=r.x);"y"in r&&(h=r.y);switch(a){case"M":f.push({command:"M",x:s,y:h});break;case"L":f.push({command:"L",x0:e,y0:o,x:s,y:h});break;case"H":f.push({command:"L",x0:e,y0:o,x:s,y:o});break;case"V":f.push({command:"L",x0:e,y0:o,x:e,y:h});break;case"C":f.push({command:"C",x0:e,y0:o,x1:v,y1:y,x2:p,y2:w,x:s,y:h});break;case"S":u&&(c=u.command=="C"||u.command=="S"?{x:u.x2,y:u.y2}:{x:u.x0,y:u.y0},l=new t.datavisualization.Diagram.Point(2*e-c.x,2*o-c.y),f.push({command:"C",x0:e,y0:o,x1:l.x,y1:l.y,x2:p,y2:w,x:s,y:h}));break;case"Q":f.push({command:"Q",x0:e,y0:o,x1:v,y1:y,x:s,y:h});break;case"T":u&&(c=u.command=="Q"?{x:u.x1,y:u.y1}:{x:u.x0,y:u.y0},l=new t.datavisualization.Diagram.Point(2*e-c.x,2*o-c.y),f.push({command:"Q",x0:e,y0:o,x1:l.x,y1:l.y,x:s,y:h}));break;case"A":k=n.extend(!0,{},r);k.command="A";f.push(k);break;case"Z":f.push({command:"L",x0:s,y0:h,x:d,y:g});s=e;h=o}u=f[f.length-1];(a==="M"||a==="m")&&(d=s,g=h);e=s;o=h}return f},i.prototype.drawDashedPath=function(n,i){for(var r,p,u,h,c,v,y,o,s,l,f=0,e=0,a=0,k=n.length;a<k;++a){r=n[a];p=r.command;"x1"in r&&(h=r.x1);"x2"in r&&(v=r.x2);"y1"in r&&(c=r.y1);"y2"in r&&(y=r.y2);"x"in r&&(f=r.x);"y"in r&&(e=r.y);switch(p){case"M":l={x:f,y:e};break;case"L":this.dashedLine(o,s,f,e,i.dashArray);break;case"H":this.dashedLine(o,s,f,s,i.dashArray);break;case"V":this.dashedLine(o,s,o,e,i.dashArray);break;case"C":this.bezierCurve(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(f,e),i);break;case"Q":this.quadraticCurve(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(f,e),i);break;case"A":if(u=this.document.getContext("2d"),u!=null){var d=r.rx>r.ry?r.rx:r.ry,w=r.rx>r.ry?1:r.rx/r.ry,b=r.rx>r.ry?r.ry/r.rx:1;u.save();u.translate(r.centp.x,r.centp.y);u.rotate(r.xAxisRotation);u.scale(w,b);this.dashedArc(d,0,0,r.a1,r.a1+r.ad,1-r.sweepFlag,i.dashArray);u.scale(1/w,1/b);u.rotate(-r.xAxisRotation);u.translate(-r.centp.x,-r.centp.y);u.restore()}break;case"Z":this.dashedLine(f,e,l.x,l.y,i.dashArray);f=o;e=s}o=f;s=e}},i.prototype.calculateCirclePoints=function(n,i,r,u,f,e){var h,o,s,c;for(u=u*180/Math.PI,f=f*180/Math.PI,h=2*Math.PI*n*(Math.abs(u-f)/360)*.7,o=Math.abs(u-f)/h,o=e?o*-1:o,s=0,c=[];s<h;)c.push(t.datavisualization.Diagram.Geometry.transform({x:i,y:r},u+o*s,n)),s++;return c},i.prototype.polygon=function(n,t,i){var u=this.document.getContext("2d"),r;for(u.beginPath(),t&&t.angle&&this.rotateContext(t,u),i&&this.setStyle(i,u),u.moveTo(n[0].x,n[0].y),r=1;r<n.length;r++)u.lineTo(n[r].x,n[r].y);if(u.lineTo(n[0].x,n[0].y),u.fill(),i&&i.dashArray){for(r=1;r<n.length;r++)this.line(n[r-1],n[r],i);this.line(n[r-1],n[0],i)}u.stroke();u.closePath();t&&t.angle&&u.restore()},i.prototype.image=function(n,t,i,r,u,f,e){var o=this.document.getContext("2d");o.beginPath();f&&f.angle&&this.rotateContext(f,o);e&&this.setStyle(e,o);r&&u?o.drawImage(n,t,i,r,u):o.drawImage(n,t,i);o.closePath();f&&f.angle&&o.restore()},i.prototype.text=function(n,t,i,r,u){var f=this.document.getContext("2d");f.beginPath();r&&r.angle&&this.rotateContext(r,f);u&&this.setStyle(u,f);f.fillText(n.text,t,i);f.closePath();r&&r.angle&&f.restore()},i.prototype.line=function(n,t,i){var r=this.document.getContext("2d");r.beginPath();i&&this.setStyle(i,r);i&&i.dashArray?this.dashedLine(n.x,n.y,t.x,t.y,i.dashArray):(r.moveTo(n.x,n.y),r.lineTo(t.x,t.y),r.stroke());r.closePath()},i.prototype.polyline=function(n,t){var r=this.document.getContext("2d"),i;for(r.beginPath(),t&&this.setStyle(t,r),i=1;i<n.length;i++)this.line(n[i-1],n[i],t);r.stroke()},i.prototype.bezierCurve=function(n,t,i,r,u){var f=this.document.getContext("2d"),e,c,o,h;if(f.beginPath(),f.moveTo(n.x,n.y),u&&this.setStyle(u,f),u&&u.dashArray){for(e=[],this.flattenCubicBezier(e,n,t,i,r),c=0,o=0;o<u.dashArray.length;o++)c+=Number(u.dashArray[o]);var a=e.length/c,l=!0,s=0;for(o=0;o<a;o++)for(h=0;h<u.dashArray.length;h++)s+=Number(u.dashArray[h]),s<e.length&&(l?f.lineTo(e[s].x,e[s].y):f.moveTo(e[s].x,e[s].y)),l=!l}else f.moveTo(n.x,n.y),f.bezierCurveTo(t.x,t.y,i.x,i.y,r.x,r.y);f.stroke()},i.prototype.quadraticCurve=function(n,t,i,r){var u=this.document.getContext("2d"),f,h,e,s;if(u.beginPath(),u.moveTo(n.x,n.y),r&&this.setStyle(r,u),r&&r.dashArray){for(f=[],this.flattenQuadraticBezier(f,n,t,i),h=0,e=0;e<r.dashArray.length;e++)h+=Number(r.dashArray[e]);var l=f.length/h,c=!0,o=0;for(e=0;e<l;e++)for(s=0;s<r.dashArray.length;s++)o+=Number(r.dashArray[s]),o<f.length&&(c?u.lineTo(f[o].x,f[o].y):u.moveTo(f[o].x,f[o].y)),c=!c}else u.moveTo(n.x,n.y),u.quadraticCurveTo(t.x,t.y,i.x,i.y);u.stroke()},i.prototype.arrow=function(n,t,i,r,u){var f=this.document.getContext("2d");f.beginPath();u&&this.setStyle(u,f);t&&t.angle&&this.rotateContext(t,f);f.moveTo(n.x+i.width,n.y+i.height/2);f.lineTo(n.x,n.y);f.lineTo(n.x+i.width,n.y-i.height/2);r||(f.closePath(),f.fill());f.stroke();t&&t.angle&&f.restore()},i.prototype.diamond=function(n,t,i,r){var u=this.document.getContext("2d");u.beginPath();r&&this.setStyle(r,u);t&&t.angle&&this.rotateContext(t,u);u.moveTo(n.x+i.width,n.y);u.lineTo(n.x+i.width/2,n.y+i.height/2);u.lineTo(n.x,n.y);u.lineTo(n.x+i.width/2,n.y-i.height/2);u.lineTo(n.x+i.width,n.y);u.stroke();u.fill();u.closePath();t&&t.angle&&u.restore()},i.prototype.dashedLine=function(n,t,i,r,u){var f=this.document.getContext("2d");f.save();var o=i-n,s=r-t,h=Math.sqrt(o*o+s*s),l=Math.atan2(s,o);f.beginPath();f.translate(n,t);f.moveTo(0,0);f.rotate(l);for(var a=u.length,v=0,c=!0,e=0;h>e;)e+=Number(u[v++%a]),e>h&&(e=h),c?f.lineTo(e,0):f.moveTo(e,0),c=!c,f.stroke();f.restore()},i.prototype.dashedRectangle=function(n,t,i,r,u){this.dashedLine(n,t,n+i,t,u);this.dashedLine(n+i,t,n+i,t+r,u);this.dashedLine(n+i,t+r,n,t+r,u);this.dashedLine(n,t+r,n,t,u)},i.prototype.dashedArc=function(n,t,i,r,u,f,e){for(var o,h,l,a=0,s=0;s<e.length;s++)a+=Number(e[s]);o=this.calculateCirclePoints(n,t,i,r,u,f,a);h=this.document.getContext("2d");h.beginPath();var y=o.length/a,v=!0,c=0;for(s=0;s<y;s++)for(l=0;l<e.length;l++)c+=Number(e[l]),c<o.length&&(v?(h.lineTo(o[c].x,o[c].y),h.stroke()):h.moveTo(o[c].x,o[c].y)),v=!v;h.closePath()},i.prototype.absolutePath=function(n){for(var t,o,a,v,s,h,c,l,e=n.pathSegList,r=0,u=0,f=0,y=e.numberOfItems;f<y;++f){if(t=e.getItem(f),o=t.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(o))"x"in t&&(r=t.x),"y"in t&&(u=t.y);else{"x1"in t&&(s=r+t.x1);"x2"in t&&(c=r+t.x2);"y1"in t&&(h=u+t.y1);"y2"in t&&(l=u+t.y2);"x"in t&&(r+=t.x);"y"in t&&(u+=t.y);switch(o){case"m":e.replaceItem(n.createSVGPathSegMovetoAbs(r,u),f);break;case"l":e.replaceItem(n.createSVGPathSegLinetoAbs(r,u),f);break;case"h":e.replaceItem(n.createSVGPathSegLinetoHorizontalAbs(r),f);break;case"v":e.replaceItem(n.createSVGPathSegLinetoVerticalAbs(u),f);break;case"c":e.replaceItem(n.createSVGPathSegCurvetoCubicAbs(r,u,s,h,c,l),f);break;case"s":e.replaceItem(n.createSVGPathSegCurvetoCubicSmoothAbs(r,u,c,l),f);break;case"q":e.replaceItem(n.createSVGPathSegCurvetoQuadraticAbs(r,u,s,h),f);break;case"t":e.replaceItem(n.createSVGPathSegCurvetoQuadraticSmoothAbs(r,u),f);break;case"a":e.replaceItem(n.createSVGPathSegArcAbs(r,u,t.r1,t.r2,t.angle,t.largeArcFlag,t.sweepFlag),f);break;case"z":case"Z":r=a;u=v}}(o==="M"||o==="m")&&(a=r,v=u)}return i.prototype._scalePathData=function(n,t,i,r){return n!==i?n=r!==i?n*t-(Number(i)*t-Number(i))+(r-Number(i)):Number(n)*t-(Number(i)*t-Number(i)):r!==i&&(n=r),n},n},i.prototype.setStyle=function(n,t){n.fill&&(t.fillStyle=n.fill);n.stroke&&(t.strokeStyle=n.stroke);n.font&&(t.font=n.font);n.lineWidth&&(t.lineWidth=n.lineWidth)},i.prototype.rotateContext=function(n,t){t.save();t.translate(n.x,n.y);t.rotate(n.angle*Math.PI/180);t.translate(-n.x,-n.y)},i.prototype.pathBounds=function(n){for(var i,b,r,v,y,p,w,c,l,u,f,e,o,s=0,h=0,a=0,k=n.length;a<k;++a){i=n[a];b=i.command;a==0&&i.x&&i.y&&(u=e=i.x,f=o=i.y);"x1"in i&&(v=i.x1);"x2"in i&&(p=i.x2);"y1"in i&&(y=i.y1);"y2"in i&&(w=i.y2);"x"in i&&(s=i.x);"y"in i&&(h=i.y);switch(b){case"M":c=s;l=h;case"L":case"H":case"V":s&&(u=Math.min(s,u),e=Math.max(s,e));h&&(f=Math.min(h,f),o=Math.max(h,o));break;case"C":case"S":r=this.getBezierBounds(t.datavisualization.Diagram.Point(c,l),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(p,w),t.datavisualization.Diagram.Point(s,h));u=Math.min(r.x,u);e=Math.max(r.x+r.width,e);f=Math.min(r.y,f);o=Math.max(r.y+r.height,o);break;case"Q":case"q":case"T":r=this.getQuadraticBounds(t.datavisualization.Diagram.Point(c,l),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(s,h));u=Math.min(r.x,u);e=Math.max(r.x+r.width,e);f=Math.min(r.y,f);o=Math.max(r.y+r.height,o);break;case"Z":s=c;h=l}}return{x:u,y:f,width:e-u,height:o-f}},i.prototype.flattenCubicBezier=function(n,i,r,u,f,e){for(var e=1.5,h=Number((t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r)+t.datavisualization.Diagram.Geometry.distance(f,u))/e),s=0;s<=h;s++){var o=s/h,c=(1-o)*(1-o)*(1-o)*i.x+3*o*(1-o)*(1-o)*r.x+3*o*o*(1-o)*u.x+o*o*o*f.x,l=(1-o)*(1-o)*(1-o)*i.y+3*o*(1-o)*(1-o)*r.y+3*o*o*(1-o)*u.y+o*o*o*f.y;n.push(new t.datavisualization.Diagram.Point(c,l))}},i.prototype.flattenQuadraticBezier=function(n,i,r,u,f){for(var f=1.5,s=Number((t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r))/f),o=0;o<=s;o++){var e=o/s,h=(1-e)*(1-e)*i.x+2*e*(1-e)*r.x+e*e*u.x,c=(1-e)*(1-e)*i.y+2*e*(1-e)*r.y+e*e*u.y;n.push(new t.datavisualization.Diagram.Point(h,c))}},i.prototype.getBezierBounds=function(n,i,r,u,f){for(var f=3,o,s,h,c,y=Number((t.datavisualization.Diagram.Geometry.distance(i,n)+t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r))/f),l=0;l<=y;l++){var e=l/y,a=(1-e)*(1-e)*(1-e)*n.x+3*e*(1-e)*(1-e)*i.x+3*e*e*(1-e)*r.x+e*e*e*u.x,v=(1-e)*(1-e)*(1-e)*n.y+3*e*(1-e)*(1-e)*i.y+3*e*e*(1-e)*r.y+e*e*e*u.y;l==0?(o=h=a,s=c=v):(o=Math.min(a,o),s=Math.min(v,s),h=Math.max(a,h),c=Math.max(v,c))}return{x:o,y:s,width:h-o,height:c-s}},i.prototype.getQuadraticBounds=function(n,i,r,u){for(var u=3,e,o,s,h,v=Number((t.datavisualization.Diagram.Geometry.distance(i,n)+t.datavisualization.Diagram.Geometry.distance(r,i))/u),c=0;c<=v;c++){var f=c/v,l=(1-f)*(1-f)*n.x+2*f*(1-f)*i.x+f*f*r.x,a=(1-f)*(1-f)*n.y+2*f*(1-f)*i.y+f*f*r.y;c==0?(e=s=l,o=h=a):(e=Math.min(l,e),o=Math.min(a,o),s=Math.max(l,s),h=Math.max(a,h))}return{x:e,y:o,width:s-e,height:h-o}},i}();t.datavisualization.Diagram.Canvas=i;t.datavisualization.Diagram.CanvasContext={_renderDocument:function(n,i){var r={id:n.canvas.id+"_canvas",width:i._canvas.clientWidth,height:i._canvas.clientHeight,version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:n.style,"pointer-events":"none"};n._canvas=new t.datavisualization.Diagram.Canvas(r);i._view=n.canvas;n.canvas.appendChild(n._canvas.document);n.type=="mainview"&&(this._canvas=n.canvas,i._svg=this._svg=n._canvas)},_renderGroupBackground:function(n,t){var i,r,u,f,e,o;n.pivot||(n.pivot={},n.pivot.x=.5,n.pivot.y=.5);i=t.document.getContext("2d");n.visible&&(r={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY},i.save(),i.translate(r.x,r.y),i.rotate(r.angle*Math.PI/180),i.translate(-r.x,-r.y),i.save(),i.fillStyle=n.type!="bpmn"?n.fillColor:"transparent",i.strokeStyle=n.type!="bpmn"?n.borderColor:"transparent",i.lineWidth=n.borderWidth,n.borderDashArray&&(n.borderDashArray.indexOf("[")!=-1||n.borderDashArray instanceof Array?u=n.borderDashArray:n.borderDashArray.indexOf(",")!=-1?u=n.borderDashArray.split(","):n.borderDashArray.indexOf(" ")!=-1&&(u=n.borderDashArray.split(" ")),i.setLineDash?i.setLineDash(u):i.mozDash?i.mozDash=u:f={dashArray:u}));e=n.offsetX-n.width*n.pivot.x;o=n.offsetY-n.height*n.pivot.y;t.rect(e,o,n.width,n.height,null,f)},renderGroup:function(n,t,i){var u,r,f,e;if(n.visible){for(this._renderGroupBackground(n,t,i),u=0;u<n.children.length;u++)r=i.nameTable[n.children[u]],r&&(r._type==="group"?this.renderGroup(r,t,i):r._type==="node"?this.renderNode(r,t):r.segments&&this.renderConnector(r,t));f=n.offsetX-n.width*n.pivot.x;e=n.offsetY-n.height*n.pivot.y;n.isLane||(this.renderLabels(n,t),this.renderPorts(n,t,f,e))}},renderNode:function(n,i){var r=i.document.getContext("2d"),h,s,u,f,l,e,a,o,c;if(n.visible){if(o={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY},r.save(),r.translate(o.x,o.y),r.rotate(o.angle*Math.PI/180),r.translate(-o.x,-o.y),r.save(),r.fillStyle=n.fillColor,r.strokeStyle=n.borderColor,r.lineWidth=n.borderWidth,r.globalAlpha=n.opacity,n.borderDashArray&&(n.borderDashArray.indexOf("[")!=-1||n.borderDashArray instanceof Array?h=n.borderDashArray:n.borderDashArray.indexOf(",")!=-1?h=n.borderDashArray.split(","):n.borderDashArray.indexOf(" ")!=-1&&(h=n.borderDashArray.split(" ")),r.setLineDash?r.setLineDash(h):r.mozDash?r.mozDash=h:s={dashArray:h}),u=n.offsetX-n.width*n.pivot.x,f=n.offsetY-n.height*n.pivot.y,n._shape=="path"?this._renderGradient(n,r,0,0):this._renderGradient(n,r,u,f),l=n.fillColor,n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){r.save();r.strokeStyle="lightgrey";e=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance);r.fillStyle=l!="none"||l!="transparent"?"lightgrey":"none";switch(n._shape){case"image":case"rectangle":i.rect(u+e.x,f+e.y,n.width,n.height,null);break;case"ellipse":i.ellipse(n.offset.x+e.x,n.offset.y+e.y,n.width,n.height,null);break;case"path":i.path(n._absolutePath,u+e.x,f+e.y,n.width,n.height,null);break;case"polygon":this._updatePolygonPoints(n);ct.x.translate(e.x,e.y);i.polygon(n.points,null,s)}r.restore()}switch(n._shape){case"rectangle":i.rect(u,f,n.width,n.height,null,s);break;case"ellipse":i.ellipse(n.offsetX,n.offsetY,n.width/2,n.height/2,null,s);break;case"path":i.path(n._absolutePath,u,f,n.width,n.height,null,s);break;case"image":i.rect(u,f,n.width,n.height,null,s);a=new Image;a.src=n.source;o={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY};i.image(a,u,f,n.width,n.height,o);break;case"text":i.rect(u,f,n.width,n.height,null,s);n.textBlock&&(c="",n.textBlock.italic&&(c+="italic "),n.textBlock.bold&&(c+="bold "),c+=n.textBlock.fontSize+" ",c+=n.textBlock.fontFamily,r.font=c,this._renderTextElement(n,n.textBlock,i));break;case"polygon":this._updatePolygonPoints(n);i.polygon(n.points,null,s)}r.restore();this.renderLabels(n,i);this.renderPorts(n,i,u,f);r.restore()}},renderPhases:function(n,t,i){var f,r,u;n&&t&&(r=t.document.getContext("2d"),r.save(),r.strokeStyle=n.lineColor?n.lineColor:"black",r.lineWidth=n.lineWidth?n.lineWidth:1,n.lineDashArray&&(n.lineDashArray.indexOf("[")!=-1||n.lineDashArray instanceof Array?u=n.lineDashArray:n.lineDashArray.indexOf(",")!=-1?u=n.lineDashArray.split(","):n.lineDashArray.indexOf(" ")!=-1&&(u=n.lineDashArray.split(" ")),r.setLineDash?r.setLineDash(u):r.mozDash?r.mozDash=u:f={dashArray:u}),i&&i.length>0&&t.line(i[0],i[1],f))},renderConnector:function(n,t){var i,r,u;n.visible&&(i=t.document.getContext("2d"),i.save(),i.strokeStyle=n.lineColor,i.lineWidth=n.lineWidth,n.lineDashArray&&(n.lineDashArray.indexOf("[")!=-1||n.lineDashArray instanceof Array?r=n.lineDashArray:n.lineDashArray.indexOf(",")!=-1?r=n.lineDashArray.split(","):n.lineDashArray.indexOf(" ")!=-1&&(r=n.lineDashArray.split(" ")),i.setLineDash?i.setLineDash(r):i.mozDash?i.mozDash=r:u={dashArray:r}),n.segments&&this._renderSegments(n,t,u),i.restore(),this.renderLabels(n,t),this._renderDecorators(n,t))},_renderSegments:function(n,i,r){for(var f,e,o,s,u,a,p,y,h,v,c,l=0;l<n.segments.length;l++){if(f=n.segments[l],f._bridges.length>0)for(h=0;h<f._bridges.length;h++)v=f._bridges[h],v._rendered=!1;if(f.type=="bezier")i.bezierCurve(f._startPoint,f._point1,f._point2,f._endPoint,r);else if(n.cornerRadius>0){for(e=f.points,u=0;u<e.length-1;u++)if(f._bridges.length>0&&u>0&&this._updateBridging(f,i,u,o?o:e[u],s?s:e[u+1],n.bridgeSpace,r,!0),a=t.datavisualization.Diagram.Geometry.distance(e[u],e[u+1]),a>0&&(p=s,s=l<n.segments.length-1||u<e.length-2?a<n.cornerRadius*2?this._adjustPoint(e[u],e[u+1],!1,a/2):this._adjustPoint(e[u],e[u+1],!1,n.cornerRadius):e[u+1],(l>0||u>0)&&(a<n.cornerRadius*2?(o=this._adjustPoint(e[u],e[u+1],!0,a/2),(l<n.segments.length-1||u<e.length-2)&&(s=null)):o=this._adjustPoint(e[u],e[u+1],!0,n.cornerRadius)),o?i.quadraticCurve(p,e[u],o,r):o=e[u],s))if(u+1===e.length-1&&f._bridges.length>0){for(this._updateBridging(f,i,u+1,o?o:e[u],s?s:e[u+1],n.bridgeSpace,r,!0),y=!1,h=0;h<f._bridges.length;h++)v=f._bridges[h],v.segmentPointIndex===u+1&&(y=!0);y||i.line(o,s,r)}else f._bridges.length>0||i.line(o,s,r)}else for(c=1;c<f.points.length;c++)f._bridges.length>0?this._updateBridging(f,i,c,f.points[c-1],f.points[c],n.bridgeSpace,r):i.line(f.points[c-1],f.points[c],r)}},_updateBridging:function(n,t,i,r,u,f,e,o){var c,v=this._findAngle(r,u),h,s,l,a;if(n._bridges.length>0)if(n.type==="straight")for(h=0;h<n._bridges.length;h++)s=n._bridges[h],s._rendered||(c=n._bridges[h-1]!=null?n._bridges[h-1].endPoint:r,t.line(c,s.startPoint,e),l=s.startPoint.x+(s.endPoint.x-s.startPoint.x)/2,a=s.startPoint.y+(s.endPoint.y-s.startPoint.y)/2,t.arc(l,a,f/2,v,e),n._bridges[h+1]!=null?t.line(s.endPoint,n._bridges[h+1].startPoint,e):t.line(s.endPoint,u,e),s._rendered=!0);else if(n.type==="orthogonal")for(h=0;h<n._bridges.length;h++)s=n._bridges[h],s.segmentPointIndex!==i||s._rendered?o||t.line(r,u,e):(c=n._bridges[h-1]!=null?n._bridges[h-1].endPoint:r,t.line(c,s.startPoint,e),l=s.startPoint.x+(s.endPoint.x-s.startPoint.x)/2,a=s.startPoint.y+(s.endPoint.y-s.startPoint.y)/2,t.arc(l,a,f/2,v,e),n._bridges[h+1]!=null?t.line(s.endPoint,n._bridges[h+1].startPoint,e):t.line(s.endPoint,u,e),s._rendered=!0)},_findAngle:function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)*(180/Math.PI)},_adjustPoint:function(n,i,r,u){var f=r?{x:n.x,y:n.y}:{x:i.x,y:i.y},e;return n.x==i.x?n.y<i.y&&r||n.y>i.y&&!r?f.y+=u:f.y-=u:n.y==i.y?n.x<i.x&&r||n.x>i.x&&!r?f.x+=u:f.x-=u:r?(e=t.datavisualization.Diagram.Geometry.findAngle(n,i),f=t.datavisualization.Diagram.Geometry.transform(n,e,u)):(e=t.datavisualization.Diagram.Geometry.findAngle(i,n),f=t.datavisualization.Diagram.Geometry.transform(i,e,u)),f},renderLabels:function(n,i){for(var r=0;r<n.labels.length;r++){var u=n.labels[r],e=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Util._getLabelPosition(u,e),f=i.document.getContext("2d");f.lineWidth=u.borderWidth;f.strokeStyle=u.borderColor;this._renderTextElement(n,u,i)}},renderPorts:function(n,i,r,u){for(var f,e,s,c,l,o=i.document.getContext("2d"),h=0;h<n.ports.length;h++)if(f=n.ports[h],!(f.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||f.visibility&t.datavisualization.Diagram.PortVisibility.Hover||f.visibility&t.datavisualization.Diagram.PortVisibility.Connect)){e=t.datavisualization.Diagram.Util._getPortPosition(f,t.datavisualization.Diagram.Util.bounds(n));o.fillStyle=f.fillColor;o.strokeStyle=f.borderColor;o.lineWidth=f.borderWidth;switch(f.shape){case"x":s=new t.datavisualization.Diagram.Size(f.size,f.size);o.beginPath();o.moveTo(e.x-s/2,e.y-s/2);o.lineTo(e.x+s/2,e.y+s/2);o.moveTo(e.x+s/2,e.y-s/2);o.lineTo(e.x-s/2,e.y+s/2);o.stroke();o.fill();o.closePath();break;case"circle":c=s.width/2;l=s.height/2;i.ellipse(r+e.x,u+e.y,c,l);break;case"square":i.rect(e.x-f.size/2,e.y-f.size/2,f.size,f.size)}}},_renderTextElement:function(n,t,i){if(t){var r={childNodes:[]};this._wrapText(n,r,t,i);this._alignTextOnLabel(t,n,r,i)}},_alignTextOnLabel:function(n,i,r,u){var o={width:n.width,height:r.childNodes.length*n.fontSize},p=t.datavisualization.Diagram.Util.bounds(i),e=t.datavisualization.Diagram.Util._getLabelPosition(n,p),f={x:0,y:0},w=0,s,h,c,v,y,l;w=n.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Top?e.y:n.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Center?e.y-o.height/2:e.y-o.height;f.y=w;switch(n.horizontalAlignment){case t.datavisualization.Diagram.HorizontalAlignment.Left:switch(n.textAlign){case t.datavisualization.Diagram.TextAlign.Left:f.x=e.x;break;case t.datavisualization.Diagram.TextAlign.Center:f.x=e.x+o.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:f.x=e.x+o.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:switch(n.textAlign){case t.datavisualization.Diagram.TextAlign.Left:f.x=e.x-o.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:f.x=e.x;break;case t.datavisualization.Diagram.TextAlign.Right:f.x=e.x+o.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:switch(n.textAlign){case t.datavisualization.Diagram.TextAlign.Left:f.x=e.x-o.width;break;case t.datavisualization.Diagram.TextAlign.Center:f.x=e.x-o.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:f.x=e.x}}for(s=u.document.getContext("2d"),h="",n.italic&&(h+="italic "),n.bold&&(h+="bold "),h+=n.fontSize+"px ",h+=n.fontFamily,v=p.x,y=p.y,i.segments||(v=i.offsetX-i.width/2,y=i.offsetY-i.height/2),c={angle:n.rotateAngle,x:v+f.x,y:y+f.y},s.save(),s.translate(c.x,c.y),s.rotate(c.angle*Math.PI/180),s.translate(-c.x,-c.y),l=0;l<r.childNodes.length;l++){var a=r.childNodes[l],b=v+f.x+a.x,k=y+f.y+3*n.fontSize/4+a.dy*l,d=s.measureText(a.text).width;u.rect(b,k-3*n.fontSize/4,d,n.fontSize,null,{fill:n.fillColor?n.fillColor:"transparent"});s.textAlign=n.textAlign;u.text({text:a.text},b-a.x,k,null,{fill:n.fontColor,font:h})}s.restore()},_wrapText:function(n,i,r,u){var y=r.text,c=t.datavisualization.Diagram.Util.bounds(n),h,a,e;n.segments?(h=c.width,a=c.height):(h=c.width-r.margin.left-r.margin.right,a=c.height-r.margin.top-r.margin.bottom);h=h<r.width?r.width:h;for(var s=y.split("\n"),p,l,o,v=u.document.getContext("2d"),f=0;f<s.length;f++)for(e="",o=0;o<s[f].length;o++)l=v.measureText(e).width,r.wrapping!="nowrap"?l>=h-r.fontSize?(e+=s[f][o],p=-l,o==s[f].length-1||(i.childNodes[i.childNodes.length]={text:e},e="")):(e+=s[f][o],o==s[f].length-1&&(i.childNodes[i.childNodes.length]={text:e},e="")):e+=s[f][o];this._wrapTextAlign(i,i.childNodes,r.fontSize,r.textAlign,v)},_wrapTextAlign:function(n,t,i,r,u){for(var f,e=0;e<t.length;e++){f=u.measureText(t[e].text).width;switch(r){case"left":f=0;break;case"center":f=-f/2;break;case"right":f=-f}t[e].x=Number(f);t[e].dy=i}},_renderGradient:function(n,t,i,r){var f,o,s,u,e,h;if(n.gradient){for(u=0;u<n.gradient.stops.length;u++)f=f?Math.max(f,n.gradient.stops[u].offset):n.gradient.stops[u].offset,o=o?Math.min(o,n.gradient.stops[u].offset):n.gradient.stops[u].offset;if(n.gradient.type=="linear")for(s=t.createLinearGradient(i+n.gradient.x1,r+n.gradient.y1,i+n.gradient.x2,r+n.gradient.y2),u=0;u<n.gradient.stops.length;u++)e=n.gradient.stops[u],h=o<0?(f+e.offset)/(2*f):e.offset/f,s.addColorStop(h,e.color);else if(n.gradient.type=="radial")for(s=t.createRadialGradient(i+n.gradient.cx,r+n.gradient.cy,0,i+n.gradient.fx,r+n.gradient.fy,n.gradient.r),u=0;u<n.gradient.stops.length;u++)e=n.gradient.stops[u],h=o<0?(f+e.offset)/(2*f):e.offset/f,s.addColorStop(h,e.color);t.fillStyle=s}},_renderDecorators:function(n,t){var r,u,i;n.targetDecorator&&n.targetDecorator.shape&&(i=n.segments[n.segments.length-1],r=i.points[i.points.length-2],u=n.targetPoint,i.type=="bezier"&&(r=i._point2),this._renderDecorator(n.name+"_targetDecorator",u,r,n.targetDecorator,t));n.sourceDecorator&&n.sourceDecorator.shape&&(i=n.segments[0],r=n.sourcePoint,u=i.points[1],i.type=="bezier"&&(u=i._point1),this._renderDecorator(n.name+"_sourceDecorator",r,u,n.sourceDecorator,t))},_renderDecorator:function(n,i,r,u,f){var a,e=new t.datavisualization.Diagram.Size(u.width,u.height),s=f.document.getContext("2d"),h,o,c,l;s.fillStyle=u.fillColor;s.strokeStyle=u.borderColor;h=t.datavisualization.Diagram.Geometry.findAngle(i,r);o={angle:h,x:i.x,y:i.y};switch(u.shape){case"arrow":f.arrow(i,o,e);break;case"openarrow":f.arrow(i,o,e,!0);break;case"circle":c=e.width/2;l=e.height/2;f.ellipse(i.x+e.width/2,i.y,c,l,o);break;case"diamond":f.diamond(i,o,e);break;case"path":f.path(u._absolutePath,0,0,e.width,e.height,o)}return a},_updatePolygonPoints:function(n){var i,r,f,e;if(n.points&&(i=n.points,i.length)){this._scalePoints(i,n);var u=t.datavisualization.Diagram.Geometry.rect(i),o=n.offsetX-n.width/2-u.x,s=n.offsetY-n.height/2-u.y;for(r=0,f=i.length;r<f;++r)e=t.datavisualization.Diagram.Geometry.translate(i[r],o,s),i[r]=e}},_scalePoints:function(n,i){var u=t.datavisualization.Diagram.Geometry.rect(n),f,e,r,o;if(u.width>0&&u.height>0)for(f=i.width/u.width,e=i.height/u.height,r=0,o=n.length;r<o;++r)n[r].x=n[r].x*f,n[r].y=n[r].y*e},updateNode:function(n,t){this.refreshCanvas(n,t)},updateConnector:function(n,t){this.refreshCanvas(n,t)},updateGroup:function(n,t){this.refreshCanvas(n,t)},refreshCanvas:function(n,t){var r=t.document.getContext("2d"),u,i;for(r.save(),view.scale&&r.scale(1/view.scale.x,1/view.scale.y),u={x:t.document.offsetLeft,y:t.document.offsetTop,width:t.document.offsetWidth,height:t.document.offsetHeight},r.clearRect(u.x,u.y,u.width,u.height),view.scale&&r.scale(view.scale.x,view.scale.y),r.restore(),i=0;i<n.nodes.length;i++)n.nodes[i]._type==="node"?this.renderNode(n.nodes[i],t):n.nodes[i]._type==="group"&&this.renderGroup(n.nodes[i],t);for(i=0;i<n.connectors.length;i++)this.renderConnector(n.connectors[i],t)},updateViewport:function(){},addNodeLabel:function(n,t){this.refreshCanvas(n,t)},updateLabel:function(n,t){this.refreshCanvas(n,t)},setNodeShape:function(n,t){this.refreshCanvas(n,t)},setLine:function(n,t){this.refreshCanvas(n,t)},renderDecorators:function(n,t){this.refreshCanvas(n,t)},clearDecorators:function(n,t){this.refreshCanvas(n,t)},updateTargetDecoratorStyle:function(n,t){this.refreshCanvas(n,t)},updateSourceDecoratorStyle:function(n,t){this.refreshCanvas(n,t)},_updateNodeStyle:function(n,t){this.refreshCanvas(n,t)},updateLabelStyle:function(n,t){this.refreshCanvas(n,t)},updateConnectorStyle:function(n,t){this.refreshCanvas(n,t)},updateTextBlock:function(n,t,i){this.refreshCanvas(n,i)},removeChild:function(){}}}(jQuery,Syncfusion)})